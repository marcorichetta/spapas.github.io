<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://spapas.github.io/favicon.png" rel="icon">

    <link href="https://spapas.github.io/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://spapas.github.io/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">

<style>
#gHPzseYvFrhZ123 {
display: none;
margin-bottom: 30px;
padding: 20px 10px;
background: #D30000;
text-align: center;
font-weight: bold;
color: #fff;
border-radius: 5px;
}
</style>


    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://spapas.github.io/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
    <div id="gHPzseYvFrhZ123">
      Hello! I see that you have an ad blocker. If you find something useful here 
      and want to support me somehow please consider disabling your ad blocker for this site. It won't cost you anything.
      
    </div>
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/09/12/django-split-query/">Splitting a query into individual fields in Django</a>
      </h1>
    <p class="meta">
<time datetime="2016-09-12T16:20:00+03:00" pubdate>Δευ 12 Σεπτέμβριος 2016</time>    </p>
</header>

<div class="entry-content"><p>As you should have already seen in <a class="reference external" href="https://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/">previous articles</a>, I really like using <a class="reference external" href="https://github.com/alex/django-filter">django-filter</a> since it covers (nearly) all my queryset filtering needs.
With django-filter, you define a bunch of fields and it will automatically create inputs for each one of these fields so that you can filter by each one of these fields individually or a
combination of&nbsp;them.</p>
<p>However, one thing that django-filter (and django in generally) lacks is the ability to <em>filter multiple fields using a single input</em>. This functionality may be familiar to some readers from
the <a class="reference external" href="https://datatables.net/">datatable</a> jquery plugin. If you take a look at the example in the datatable homepage, you&#8217;ll see a single &#8220;Search&#8221; field. What is really great is that you can enter multiple values (seperated
by spaces) into that field and it will filter the individual table values by each one of them. For example, if you enter &#8220;2011 Engineer&#8221; you&#8217;ll see all engineering positions that started
on 2011. If you append &#8220;Singapore&#8221; (so you&#8217;ll have &#8220;2011 Engineer Singapore&#8221;) you&#8217;ll also get only the corresponding&nbsp;results!</p>
<p>This functionality is really useful and is very important to have if you use single-input fields to query your data. One such example is if you use autocompletes, for example with
django-autocomplete-light: You&#8217;ll have a single input however you may need to filter on more than one field to find out your&nbsp;selection.</p>
<p>In the following ost I&#8217;ll show you how to implement this functionality using Django and django-filters (actually django-filters will be used to provide the form) - to see it
in action you may use the <a class="reference external" href="https://github.com/spapas/django_table_filtering">https://github.com/spapas/django_table_filtering</a> repository (check out the <cite>/filter_ex/</cite> view).</p>
<p>I won&#8217;t go into detail on how the code is structured (it&#8217;s really simple) and I&#8217;ll go directly to the filter I am using. Instead of using a filter you can of course directly query on
your view. What you actually need&nbsp;is:</p>
<blockquote>
<ul class="simple">
<li>a queryset with the instances you want to&nbsp;search</li>
<li>a text value with the query (that may contain&nbsp;spaces)</li>
<li>a list of the names of the fields you want to&nbsp;search</li>
</ul>
</blockquote>
<p>In my case, I am using a <cite>Book</cite> model that has the following fields: <cite>id, title, author, category</cite>. I have created a filter with a single field named <cite>ex</cite> that will filter on
all these fields. So you should be able to enter &#8220;King It&#8221; and find &#8220;It by Stephen King&#8221;. Let&#8217;s see how the filter is&nbsp;implemented:</p>
<pre class="code literal-block">
import itertools

class BookFilterEx(django_filters.FilterSet):
    ex = django_filters.MethodFilter()
    search_fields = ['title', 'author', 'category', 'id', ]

    def filter_ex(self, qs, value):
        if value:
            q_parts = value.split()

            # Permutation code copied from http://stackoverflow.com/a/12935562/119071

            list1=self.search_fields
            list2=q_parts
            perms = [zip(x,list2) for x in itertools.permutations(list1,len(list2))]

            q_totals = Q()
            for perm in perms:
                q_part = Q()
                for p in perm:
                    q_part = q_part &amp; Q(**{p[0]+'__icontains': p[1]})
                q_totals = q_totals | q_part

            qs = qs.filter(q_totals)
        return qs

    class Meta:
        model = books.models.Book
        fields = ['ex']
</pre>
<p>The meat of this code is in the <tt class="docutils literal">filter_ex</tt> method, let&#8217;s analyze it line by line:
First of all, we split the value to its corresponding parts using the whitespace to sperate into individual tokens. For example if the user has entered
<tt class="docutils literal">King It</tt>, <tt class="docutils literal">q_parts</tt> be equal to <tt class="docutils literal">['King', 'It']</tt>. As you can see the <cite>search_fields</cite> attribute contains the names of the
fields we want to search. The first thing I like to do is to generate all possible combinations between <tt class="docutils literal">q_parts</tt>
and <tt class="docutils literal">search_fields</tt>, I&#8217;ve copied the list combination code from <a class="reference external" href="http://stackoverflow.com/a/12935562/119071">http://stackoverflow.com/a/12935562/119071</a> and it is the line
<tt class="docutils literal">perms = [zip(x,list2) for x in <span class="pre">itertools.permutations(list1,len(list2))]</span></tt>.</p>
<p>The <tt class="docutils literal">itertools.permutations(list1,len(list2))</tt> will generate all permutations of list1
that have length equal to the length of list2. I.e if list2 is <tt class="docutils literal">['King', 'It']</tt> (len=2) then it will generate all combinations
of search_fields with length=2, i.e it will generate the following list of&nbsp;tuples:</p>
<pre class="code literal-block">
[
    ('title', 'author'), ('title', 'category'), ('title', 'id'), ('author', 'title'),
    ('author', 'category'), ('author', 'id'), ('category', 'title'), ('category', 'author'),
    ('category', 'id'), ('id', 'title'), ('id', 'author'), ('id', 'category')
]
</pre>
<p>Now, the <tt class="docutils literal">zip</tt> will combine the elements of each one of these tuples with the elements of <tt class="docutils literal">list2</tt>, so, in our example
(<tt class="docutils literal"><span class="pre">list2=['King',</span> 'It']</tt>) <tt class="docutils literal">perms</tt> will be the following&nbsp;array:</p>
<pre class="code literal-block">
[
    [('title', 'King'), ('author', 'It')],
    [('title', 'King'), ('category', 'It')],
    [('title', 'King'), ('id', 'It')],
    [('author', 'King'), ('title', 'It')],
    [('author', 'King'), ('category', 'It')],
    [('author', 'King'), ('id', 'It')],
    [('category', 'King'), ('title', 'It')],
    [('category', 'King'), ('author', 'It')],
    [('category', 'King'), ('id', 'It')],
    [('id', 'King'), ('title', 'It')],
    [('id', 'King'), ('author', 'It')],
    [('id', 'King'), ('category', 'It')]
]
</pre>
<p>Notice that <tt class="docutils literal">itertools.permutations(list1,len(list2))</tt> will return an empty list if <tt class="docutils literal">len(list2) &gt; len(list1)</tt> - this is actually what
we want since that means that the user entered more query parts than the available fields, i.e we can&#8217;t match each one of the
possible values after we split the input with a search field so we should return&nbsp;nothing.</p>
<p>Now, what I want is to create a single query that will combine the tuples in each of these combinations by <span class="caps">AND</span> (i.e
<tt class="docutils literal"><span class="pre">title==King</span> <span class="caps">AND</span> <span class="pre">author==It</span></tt> ) and then combine all these subqueries using <span class="caps">OR</span> (i.e
&#8220; (title==King <span class="caps">AND</span> author==It) <span class="caps">OR</span> (title==King <span class="caps">AND</span> category==It) <span class="caps">OR</span> (title==King <span class="caps">AND</span> id==It) <span class="caps">OR</span>&nbsp;&#8230;&#8220;.</p>
<p>This could of course be implemented with a raw sql query however we could use some interesting django tricks for this.
I&#8217;ve already done something similar to <a class="reference external" href="https://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/">a previous article</a> so I won&#8217;t go
into much detail explaining the code that creates the <tt class="docutils literal">q_totals</tt> <tt class="docutils literal">Q</tt> object. What it does is that it create a big django <tt class="docutils literal">Q</tt> object that combines using <span class="caps">AND</span> (<tt class="docutils literal">&amp;</tt>)
all individual <tt class="docutils literal">q_part</tt> objects. Each <tt class="docutils literal">q_part</tt> object combines using <span class="caps">OR</span> (<tt class="docutils literal">|</tt>) the individual combinations of field name
and value &#8212; I&#8217;ve used <cite>__icontains`</cite> to create the query. So the result will be something like&nbsp;this:</p>
<pre class="code literal-block">
q_totals =
    Q(title__icontains='King') &amp; Q(author__icontains='It')
    |
    Q(title__icontains='King') &amp; Q(category__icontains='It')
    |
    Q(title__icontains='King') &amp; Q(id__icontains='It')
    |
    Q(author__icontains='King') &amp; Q(title__icontains='It')
    ...
</pre>
<p>Filtering by this <tt class="docutils literal">q_totals</tt> will return the correct&nbsp;values!</p>
<p>One extra complication we should be aware of is what happens if the user needs to also search for books with multiple words
in their titles. For example, if the user enters &#8220;Under the Dome King&#8221; or &#8220;It Stephen King&#8221; or even &#8220;The Stand Stephen King&#8221;
we won&#8217;t get any results&nbsp;:(</p>
<p>To fix this, we need to get all possible combinations of sequential substrings, i.e for &#8220;Under the Dome King&#8221;, after we
split it to [&#8216;Under&#8217;, &#8216;the&#8217;, &#8216;Dome&#8217;, &#8216;King&#8217;] we&#8217;ll need the following&nbsp;combinations:</p>
<pre class="code literal-block">
[
    ['Under', 'the', 'Dome', 'King'],
    ['Under', 'the', 'Dome King'],
    ['Under', 'the Dome', 'King'],
    ['Under', 'the Dome King'],
    ['Under the', 'Dome', 'King'],
    ['Under the', 'Dome King'],
    ['Under the Dome', 'King'],
    ['Under the Dome King']
]
</pre>
<p>A possible solution for that problem can be found on this <span class="caps">SO</span> answer: <a class="reference external" href="http://stackoverflow.com/a/27263616/119071">http://stackoverflow.com/a/27263616/119071</a>.</p>
<p>Now, to extend our solution to include this, we&#8217;d need to actually search for each one of the above possiblities
and combine again the results with <span class="caps">OR</span>, something like&nbsp;this:</p>
<pre class="code literal-block">
def filter_ex(self, qs, value):
    if value:
        q_parts = value.split()

        # Use a global q_totals
        q_totals = Q()

        # This part will get us all possible segmantiation of the query parts and put it in the possibilities list
        combinatorics = itertools.product([True, False], repeat=len(q_parts) - 1)
        possibilities = []
        for combination in combinatorics:
            i = 0
            one_such_combination = [q_parts[i]]
            for slab in combination:
                i += 1
                if not slab: # there is a join
                    one_such_combination[-1] += ' ' + q_parts[i]
                else:
                    one_such_combination += [q_parts[i]]
            possibilities.append(one_such_combination)

        # Now, for all possiblities we'll append all the Q objects using OR
        for p in possibilities:
            list1=self.search_fields
            list2=p
            perms = [zip(x,list2) for x in itertools.permutations(list1,len(list2))]

            for perm in perms:
                q_part = Q()
                for p in perm:
                    q_part = q_part &amp; Q(**{p[0]+'__icontains': p[1]})
                q_totals = q_totals | q_part

        qs = qs.filter(q_totals)
    return qs
</pre>
<p>The previous filtering code works fine with querise like &#8220;The Stand&#8221; or &#8220;Under the Dome Stephen&nbsp;King&#8221;!</p>
<p>One thing that you must be careful is that this code will create <em>very complicated and big</em> queries. For example,
searching for &#8220;Under the Dome Stephen King&#8221; will result to <cite>q_totals</cite> getting this monster&nbsp;value:</p>
<pre class="code literal-block">
(OR:
(AND: ),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the'), ('category__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the'), ('id__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the'), ('author__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the'), ('id__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the'), ('author__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the'), ('category__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the'), ('category__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the'), ('id__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the'), ('title__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the'), ('id__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the'), ('title__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the'), ('category__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the'), ('author__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the'), ('id__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the'), ('title__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the'), ('id__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the'), ('title__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the'), ('author__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the'), ('author__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the'), ('category__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the'), ('title__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the'), ('category__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the'), ('title__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the'), ('author__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the'), ('category__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the'), ('id__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the'), ('author__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the'), ('id__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the'), ('author__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the'), ('category__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the'), ('category__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the'), ('id__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the'), ('title__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the'), ('id__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the'), 'title__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the'), ('category__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the'), ('author__icontains', u'Dome Stephen'),('id__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the'), ('id__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the'), ('title__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the'), ('id__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the'), ('title__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the'), ('author__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the'), ('author__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the'), ('category__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the'), ('title__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the'), ('category__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the'), ('title__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the'), ('author__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome'), ('category__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome'), ('id__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome'), ('author__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome'), ('id__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome'), ('author__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome'), ('category__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome'), ('category__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome'), ('id__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome'), ('title__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome'), ('id__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome'), ('title__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome'), ('category__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome'), ('author__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome'), ('id__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome'), ('title__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome'), ('id__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome'), ('title__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome'), ('author__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome'), ('author__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome'), ('category__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome'), ('title__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome'), ('category__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome'), ('title__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome'), ('author__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under'), ('author__icontains', u'the Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('category__icontains', u'the Dome Stephen King')),
(AND: ('title__icontains', u'Under'), ('id__icontains', u'the Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('title__icontains', u'the Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('category__icontains', u'the Dome Stephen King')),
(AND: ('author__icontains', u'Under'), ('id__icontains', u'the Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('title__icontains', u'the Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('author__icontains', u'the Dome Stephen King')),
(AND: ('category__icontains', u'Under'), ('id__icontains', u'the Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('title__icontains', u'the Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('author__icontains', u'the Dome Stephen King')),
(AND: ('id__icontains', u'Under'), ('category__icontains', u'the Dome Stephen King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome'), ('category__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome'), ('id__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome'), ('author__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome'), ('id__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome'), ('author__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome'), ('category__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome'), ('category__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome'), ('id__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome'), ('title__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome'), ('id__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome'), ('title__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome'), ('category__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome'), ('author__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome'), ('id__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome'), ('title__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome'), ('id__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome'), ('title__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome'), ('author__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome'), ('author__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome'), ('category__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome'), ('title__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome'), ('category__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome'), ('title__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome'), ('author__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome'), ('category__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('author__icontains', u'Under the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('category__icontains', u'Under the'), ('id__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under the'), ('title__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under the'), ('author__icontains', u'Dome Stephen King')),
(AND: ('id__icontains', u'Under the'), ('category__icontains', u'Dome Stephen King')),
(AND: ('title__icontains', u'Under the Dome'), ('author__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome'), ('author__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome'), ('category__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome'), ('category__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome'), ('id__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome'), ('id__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome'), ('title__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome'), ('title__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome'), ('category__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome'), ('category__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome'), ('id__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome'), ('id__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome'), ('title__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome'), ('title__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome'), ('author__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome'), ('author__icontains', u'Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome'), ('id__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome'), ('id__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome'), ('title__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome'), ('title__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome'), ('author__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome'), ('author__icontains', u'Stephen'), ('category__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome'), ('category__icontains', u'Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome'), ('category__icontains', u'Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('author__icontains', u'Under the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('category__icontains', u'Under the Dome'), ('id__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the Dome'), ('title__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the Dome'), ('author__icontains', u'Stephen King')),
(AND: ('id__icontains', u'Under the Dome'), ('category__icontains', u'Stephen King')),
(AND: ('title__icontains', u'Under the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('title__icontains', u'Under the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome Stephen'), ('category__icontains', u'King')),
(AND: ('author__icontains', u'Under the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('category__icontains', u'Under the Dome Stephen'), ('id__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome Stephen'), ('title__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome Stephen'), ('author__icontains', u'King')),
(AND: ('id__icontains', u'Under the Dome Stephen'), ('category__icontains', u'King')),
('title__icontains', u'Under the Dome Stephen King'),
('author__icontains', u'Under the Dome Stephen King'),
('category__icontains', u'Under the Dome Stephen King'),
('id__icontains', u'Under the Dome Stephen King')
)
</pre>
<p>This query has around 200 different <span class="caps">OR</span> parts!!! So please be careful on the amount of search fields you&#8217;ll enable to works
with this method or your database will really&nbsp;struggle!</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/06/27/download-imgur-album-images/">How to download all images of an imgur album</a>
      </h1>
    <p class="meta">
<time datetime="2016-06-27T14:20:00+03:00" pubdate>Δευ 27 Ιούνιος 2016</time>    </p>
</header>

<div class="entry-content"><p>Recently I stubmled upon a great <a class="reference external" href="http://imgur.com/">imgur</a> album that contained
<a class="reference external" href="http://imgur.com/a/aoi3T">379 movie stills that could be used for desktop background</a>. I
really liked the idea and wanted to download all the images in order
to put them in a folder and use them as a slideshow for my Windows
desktop&nbsp;background.</p>
<p>Downloading them one by one would be considered penal
labour so I tried to find out an automatic way to get them all. With some
research in google, I found out an old post with the hint that by appending <tt class="docutils literal">/zip</tt>
to the <span class="caps">URL</span>  you could get a zip with all the images &#8212; this didn&#8217;t work for me. I
also tried various browser tools for scrapping or downloading all images from a page but they
didn&#8217;t work also (they could only download a small number of the images and not&nbsp;all).</p>
<p>This seemed strange to me until I understood how imgur loads its images by &#8220;inspecting&#8221;
an image and taking a look at the page&#8217;s <span class="caps">DOM</span> structure through the&nbsp;console:</p>
<img alt="How imgur loads images" src="/images/imgur.gif" style="width: 700px;" />
<p>As we can see, the imgur client-side code has a component with a <tt class="docutils literal"><span class="pre">post-images</span></tt> class
that contains the visible images (and thoese that are above/below the visible images). When
the user scrolls up/down the contents of <tt class="docutils literal"><span class="pre">post-images</span></tt> will be changed accordingly
(notice how the component with <tt class="docutils literal">id=EKMGEPc</tt> moves down when I scroll up).
What this means is that each time there are 3-4 images (this actually depends on your window size)
under <tt class="docutils literal"><span class="pre">post-images</span></tt> that are changed when you scroll &#8212; that&#8217;s why downloaders / scrappers are not working (since these
tools just inspect the <span class="caps">DOM</span> they only see these 3-4 images to&nbsp;download).</p>
<p>Another interesting observation is that if you take a look at the network tab when you
scroll app down you won&#8217;t see any ajax calls (the only network calls are the images that
are downloaded when they are appended to the <span class="caps">DOM</span>). So this means that somewhere there&#8217;s
an array that is loaded when the page is loaded and contains all the images of the album.
If we can access this array then we&#8217;d be able to get all the URLs of the&nbsp;images&#8230;</p>
<p>From a quick look at the <span class="caps">DOM</span> structure we can understand that this is a React application
(components have a <tt class="docutils literal"><span class="pre">data-reactid</span></tt> attribute). So I tried the <a class="reference external" href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React Developer Tools</a>
extension to see if I could find anything insteresting. Here&#8217;s the&nbsp;output:</p>
<img alt="Imgur - react dev tools" src="/images/imgur-react.png" style="width: 1000px;" />
<p>As you can see, there seem to be 4 top-level react elements &#8212; the interesting one is <tt class="docutils literal">GalleryPost</tt>.
If you take a look at its props (in the right hand side of the react-devtools) you&#8217;ll see that it has
an <tt class="docutils literal">album_image_store</tt> property which also seems interesting (it should be the image store for this
album). After searching a bit its attributes
you&#8217;ll see that it has a <tt class="docutils literal">_</tt> child attribute, which has a <tt class="docutils literal">posts</tt> child attribute which has an <tt class="docutils literal">aoi3T</tt>
attribute (notice that this is similar to the <span class="caps">URL</span> id of the album) and, finally this has an <tt class="docutils literal">images</tt>
attribute with objects describing all the images of that album&nbsp;\o/!</p>
<p>Now we need to get our hands on that <tt class="docutils literal">images</tt> array contents. Unfortunately, right clicking doesn&#8217;t seem
to do anything from react-dev-tools and there doesn&#8217;t seem a way to copy data from that panel&#8230; However, in
the upper right position of that window you&#8217;ll see the hint <tt class="docutils literal">($r in the console)</tt> which means that
the selected react component is available as $r in the normal javascript console - so by&nbsp;entering</p>
<pre class="code literal-block">
copy($r.props.album_image_store._.posts.aoi3T.images)
</pre>
<p>I was able to copy the images of the album to my clipboard (please notice that <tt class="docutils literal">$r</tt> will have the
value of the selected react component so, before trying it you must select the <tt class="docutils literal">GalleryPost</tt>
component in the react-dev-tools&nbsp;tab)!</p>
<p>I dumped this to a file to take a look at it - it is really easy to interpret&nbsp;it:</p>
<pre class="code literal-block">
[
  {
    &quot;hash&quot;: &quot;MQplfkV&quot;,
    &quot;title&quot;: &quot;2001: A Space Odyssey&quot;,
    &quot;description&quot;: &quot;Cinematographer: Geoffrey Unsworth\n\nsource:\nhttp://www.filmcaptures.com/2001-a-space-odyssey/&quot;,
    &quot;width&quot;: 1920,
    &quot;height&quot;: 864,
    &quot;size&quot;: 2262862,
    &quot;ext&quot;: &quot;.png&quot;,
    &quot;animated&quot;: false,
    &quot;prefer_video&quot;: false,
    &quot;looping&quot;: false,
    &quot;datetime&quot;: &quot;2014-10-25 04:02:58&quot;,
    &quot;thumbsize&quot;: &quot;g&quot;,
    &quot;minHeight&quot;: 306,
    &quot;shown&quot;: true,
    &quot;containerHeight&quot;: 501
  },
..
</pre>
<p>The imgur images have a <span class="caps">URL</span> of http//i.imgur.com/{hash}{ext} so, we
can use the following small python 2 program to download all images from that&nbsp;album:</p>
<pre class="code literal-block">
import requests
import json
from slugify import slugify

# Modified from http://stackoverflow.com/a/16696317/119071
def download_file(url, local_filename):
    r = requests.get(url, stream=True)
    with open(local_filename, 'wb') as f:
        for chunk in r.iter_content(chunk_size=1024):
            if chunk: # filter out keep-alive new chunks
                f.write(chunk)
                #f.flush() commented by recommendation from J.F.Sebastian
    return local_filename


if __name__ == '__main__':
    for i, jo in enumerate(json.loads(open(&quot;album.txt&quot;).read())):
        filename = '{0}-{1}{2}'.format(slugify(jo['title']), i+1, jo['ext'])
        url = 'http://i.imgur.com/{0}{1}'.format(jo['hash'].strip(), jo['ext'])
        print filename, url
        download_file(url, filename)
</pre>
<p>Notice that the above uses the <tt class="docutils literal">requests</tt> library to retrieve the files and the
<tt class="docutils literal"><span class="pre">python-slugify</span></tt> library to generate a filename using the image title so these
libraries must be installed by using <tt class="docutils literal">pip install requests <span class="pre">python-slugify</span></tt>. This
will read a file named <tt class="docutils literal">album.txt</tt> that should contain the copied imgur album images
in the same directory and download all the&nbsp;images.</p>
<p><strong>Disclaimer</strong> The above methodology works today (27-06-2016) - probably it will
stop working sometime in the future, when imgur changes its image loading algorithm
or its image object representation.
Also, I haven&#8217;t been able to find a way to quickly access the <tt class="docutils literal">GalleryPost</tt> react
component from the javascript console - you need to install the react dev tools and
select that component from there so that you&#8217;ll have the <tt class="docutils literal">$r</tt> reference to it in
the javascript console. Finally, don&#8217;t forget to change the
<tt class="docutils literal"><span class="pre">copy($r.props.album_image_store._.posts.aoi3T.images)</span></tt>
depending on your album id (also if the id is not a valid identifier, for example it
starts with number, use <tt class="docutils literal"><span class="pre">copy($r.props.album_image_store._.posts['aoi3T'].images</span></tt>).</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/06/07/django-werkzeug-debugger/">Using Werkzeug debugger with Django</a>
      </h1>
    <p class="meta">
<time datetime="2016-06-07T10:40:00+03:00" pubdate>Τρι 07 Ιούνιος 2016</time>    </p>
</header>

<div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p><a class="reference external" href="http://werkzeug.pocoo.org/">Werkzeug</a> is a <span class="caps">WSGI</span> utility library for Python. Beyond others, it includes an interactive
debugger - what this means is that when your python application throws an exception,
Werkzeug will display the exception stacktrace in the browser (that&#8217;s not a big deal)
and allow you to write python commands interactively wherever you want in that stacktrace
(that&#8217;s the important&nbsp;stuff).</p>
<p>Now, the even more important stuff is that you can <em>abuse</em> the above feature by adding
code that will throw an exception in various parts of your application and, as a result
get an interactive python prompt at <em>specific</em> parts of your application (for example,
before validating your form, or when a method in your model is executed). All this,
without the need to use a specific <span class="caps">IDE</span> to add&nbsp;breakpoints!</p>
<p>This is an old trick however some people don&#8217;t use it and make their work more
difficult. Actually, this one of the first things I learned when starting with django
and use it all the time since then - I am writing this post mainly to emphasize
its usefulness and to urge more people to use it. If you don&#8217;t already use it please try
it (and thank me&nbsp;later).</p>
</div>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>There are two components you need to install in your django project to use the
above&nbsp;technique:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/django-extensions/django-extensions">django-extensions</a>: a swiss army knife toolset for django - beyond other useful tools it includes a management command (<tt class="docutils literal">runserver_plus</tt>) to start the Werkzeug interactive debugger with your&nbsp;project</li>
<li>werkzeug: the werkzeug utility&nbsp;library</li>
</ul>
<p>Both of these can just be installed with pip (even on windows). After installing them, add <tt class="docutils literal">django_extensions</tt> to your <tt class="docutils literal">INSTALLED_APPS</tt> setting to enable
the management&nbsp;command.</p>
<p>After that, you can just run <tt class="docutils literal">python manage.py runserver_plus</tt> - if everything was installed successfully you should see something like this (in windows at&nbsp;least):</p>
<pre class="code literal-block">
(venv) C:\progr\py\werkzeug\testdebug&gt;python manage.py runserver_plus
 * Restarting with stat
Performing system checks...

System check identified no issues (0 silenced).

Django version 1.9.7, using settings 'testdebug.settings'
Development server is running at http://127.0.0.1:8000/
Using the Werkzeug debugger (http://werkzeug.pocoo.org/)
Quit the server with CTRL-BREAK.
 * Debugger is active!
 * Debugger pin code: 143-738-172
 * Debugger is active!
 * Debugger pin code: 174-740-467
 * Running on http://127.0.0.1:8000/ (Press CTRL+C to quit)
</pre>
<p>Now, the &#8220;debugger pin&#8221; you see is a way to protect your interactive debugger (i.e it asks for the pin
before allowing you to enter the interactive prompt). Since this feature should <em>only</em> be used in your
local development system I recommend to just disable it by setting the <tt class="docutils literal">WERKZEUG_DEBUG_PIN</tt> environment
variable to <tt class="docutils literal">off</tt> (i.e <tt class="docutils literal">set WERKZEUG_DEBUG_PIN=off</tt> in windows). After that you should see the message
&#8220; * Debugger pin disabled.  <span class="caps">DEBUGGER</span> <span class="caps">UNSECURED</span>!&#8220;. Please be careful with the interactive debugger
and  <em>never, ever use it in a production deployment</em> even with the debug pin enabled. I also recommend to
use it <em>only</em> on a local development server (i.e the server must be run on 127.0.0.1/local <span class="caps">IP</span> and not
allow remote&nbsp;connections).</p>
</div>
<div class="section" id="usage">
<h2>Usage</h2>
<p>Now its time for the magic: Let&#8217;s add a django view that throws an exception, like&nbsp;this:</p>
<pre class="code literal-block">
def test(request):
    a+=1
</pre>
<p>to your urls.py ( <tt class="docutils literal"><span class="pre">url(r'^test/',</span> test )</tt> ) and after you visit <cite>test</cite> you should see something like&nbsp;this:</p>
<img alt="Werkzeug debugger" src="/images/werkzeug.png" style="width: 800px;" />
<p>Since the <tt class="docutils literal">a</tt> variable was not defined you&#8217;ll get an exception when you try to increaseit.
Now, notice the console icon in the lower right corner - when you click it you&#8217;ll get the interactive debugger!
Now you can enter python commands exactly where the <tt class="docutils literal"><span class="pre">a+=1</span></tt> code was. For example, you can see what are the
attributes of the <tt class="docutils literal">request</tt> object you receive (for example, just enter <tt class="docutils literal">request.<span class="caps">GET</span></tt> to output the <tt class="docutils literal"><span class="caps">GET</span></tt>
dictionary to the interactive&nbsp;console).</p>
<p>Notice that you can get interactive consoles wherever you want in the stacktrace, i.e I could get a console at line 147
of <cite>django.core.handlers.base</cite> module on the <tt class="docutils literal">get_response</tt> method &#8212; this is needed sometimes especially when you
want to see how your code is called by other&nbsp;modules.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>As you can see, using the presented technique you can really quickly start an interactive console wherever you
want and start entering commands. I use it whenever I need to write anything non trivial (or even trivial stuff -
I sometimes prefer opening and interactive debugger to find out by trial and error how should I write a django
<span class="caps">ORM</span> query than open models.py) and really miss it on other environments&nbsp;(Java).</p>
<p>The above technique should also work with few modifications with other python web frameworks so it&#8217;s not&nbsp;django-only.</p>
<p>Finally, please notice that both Werkzeug and django-extensions offer many more tools beyond the interactive debugger presented here -
I encourage you to research them since - if you follow my advice - you&#8217;ll integrate these to <em>all</em> your django&nbsp;projects!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/04/27/python-nested-list-comprehensions/">Understanding nested list comprehension syntax in Python</a>
      </h1>
    <p class="meta">
<time datetime="2016-04-27T11:20:00+03:00" pubdate>Τετ 27 Απρίλιος 2016</time>    </p>
</header>

<div class="entry-content"><p>List comprehensions are one of the really nice and powerful features of Python. It
is actually a smart way to introduce new users to functional programming concepts
(after all a list comprehension is just a combination of map and filter) and compact&nbsp;statements.</p>
<p>However, one thing that always troubled me when using list comprehensions is their
non intuitive syntax when nesting was needed. For example, let&#8217;s say that we just
want to flatten a list of lists using a nested list&nbsp;comprehension:</p>
<div class="highlight"><pre><span></span><span class="n">non_flat</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
<p>To write that, somebody would think: For a simple list
comprehension I need to
write <tt class="docutils literal">[ x for x in non_flat ]</tt> to get all its items - however I want to retrieve each element of the <tt class="docutils literal">x</tt> list so I&#8217;ll write something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span><span class="p">]</span>
<span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
<p>Well duh! At this time I&#8217;d need research google for a working list comprehension syntax and adjust it to my needs (or give up and write it as a double for&nbsp;loop).</p>
<p>Here&#8217;s the correct nested list comprehension people&nbsp;wondering:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
<p>What if I wanted to add a third level of nesting or an if? Well I&#8217;d just bite the bullet and use for&nbsp;loops!</p>
<p>However, if you take a look at the document describing list comprehensions in python (<cite><span class="caps">PEP</span> 202</cite>) you&#8217;ll see
the following&nbsp;phrase:</p>
<blockquote>
It is proposed to allow conditional construction of list literals
using for and if clauses. <strong>They would nest in the same way for
loops and if statements nest now.</strong></blockquote>
<p>This statement explains everything! <em>Just think in for-loops syntax</em>. So, If I used for loops for the previous flattening, I&#8217;d do something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">y</span>
</pre></div>
<p>which, if <cite>y</cite> is moved to the front and joined in one line would be the correct nested list&nbsp;comprehension!</p>
<p>So that&#8217;s the way&#8230; What If I wanted to include only lists with more than 2 elements in the flattening
(so <cite>[7,8]</cite> should not be included)? I&#8217;ll write it with for loops&nbsp;first:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span>
</pre></div>
<p>so by convering this to list comprehension we&nbsp;get:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>
<p>Success!</p>
<p>One final, more complex example: Let&#8217;s say that we have a list
of lists of words and we want to get a list of all the letters of these words
along with the index of the list they belong to
but only for words with more than two characters. Using the same
for-loop syntax for the nested list comprehensions we&#8217;ll&nbsp;get:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;taz&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;koko&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">]</span>
<span class="p">[(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/03/31/spring-boot-settings/">Configuring Spring Boot</a>
      </h1>
    <p class="meta">
<time datetime="2016-03-31T19:20:00+03:00" pubdate>Πεμ 31 Μάρτιος 2016</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#properties-vs-yml-files" id="id2">properties vs yml&nbsp;files</a></li>
<li><a class="reference internal" href="#structuring-your-configuration-files" id="id3">Structuring your configuration files</a><ul>
<li><a class="reference internal" href="#main-application-settings" id="id4">Main application&nbsp;settings</a></li>
<li><a class="reference internal" href="#profiles" id="id5">Profiles</a><ul>
<li><a class="reference internal" href="#some-more-advanced-profile-usage" id="id6">Some more advanced profile&nbsp;usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overriding-settings" id="id7">Overriding settings</a><ul>
<li><a class="reference internal" href="#using-a-config-application-properties" id="id8">Using a&nbsp;config/application.properties</a></li>
<li><a class="reference internal" href="#passing-command-line-arguments" id="id9">Passing command line&nbsp;arguments</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#deploying-spring-boot-applications" id="id10">Deploying Spring Boot&nbsp;applications</a></li>
<li><a class="reference internal" href="#conclusion" id="id11">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>The <a class="reference external" href="http://projects.spring.io/spring-boot/">Spring Boot</a> project is great way of building Java applications using
Spring. Instead of trying to integrate everything by hand (and usually
end up with a configuration hell) you use spring-boot to help you to
bootstrap your application: Just include its
dependencies in your pom.xml and Spring Boot will try its
best to auto-configure all these&nbsp;components!</p>
<p>Of course, no matter how hard Spring Boot tries to auto-configure everything,
you&#8217;ll still need to pass some configuration to configure your databases,
caches, email sending, security etc. Thankfully, Spring Boot
can be configured without <em>any</em> xml (actually, its a bad practice to
use xml-based configuration with it), using plain Java .properties
files or (if you prefer the more compact syntax) <a class="reference external" href="https://en.wikipedia.org/wiki/YAML"><span class="caps">YAML</span></a> .yml&nbsp;files!</p>
<p>In this guide, along with a simple introduction to the way Spring Boot configuration
works, we&#8217;ll talk about a specific way of stucturing your settings configuration files in
order to&nbsp;have:</p>
<ul class="simple">
<li>A global configuration file that will contain all your&nbsp;settings</li>
<li>Different settings for each of your environments (development, <span class="caps">UAT</span>, staging, production and&nbsp;test)</li>
<li>A way to configure your passwords and other sensitive data (that you don&#8217;t want to put to your <span class="caps">VCS</span>)</li>
<li>Being able to override any setting in any&nbsp;environment</li>
<li>Deploying your Spring Boot app in Linux using <tt class="docutils literal">init.d</tt></li>
</ul>
<p>To quickly test the proposed settings configuration I&#8217;ve created a simple
Spring Boot project &#64; <a class="reference external" href="https://github.com/spapas/spring-boot-config">https://github.com/spapas/spring-boot-config</a>. Just clone
it, optionally change the packaged settings (more on this later), package it (<tt class="docutils literal">mvn package</tt>), optionally change
the <tt class="docutils literal">config</tt> settings (more on this also later) and run it
(using something like <tt class="docutils literal">java <span class="pre">-jar</span> <span class="pre">spring-boot-config-0.0.1-<span class="caps">SNAPSHOT</span>.jar</span></tt>) optionally passing it command line settings (more on this
also later). You&#8217;ll then be able to visit <tt class="docutils literal"><span class="pre">http://127.0.0.1:8080</span></tt> and check the current&nbsp;settings!</p>
</div>
<div class="section" id="properties-vs-yml-files">
<h2><a class="toc-backref" href="#id2">properties vs yml&nbsp;files</a></h2>
<p>You can use two kinds of files to configure your settings: Normal Java .properties files
or <a class="reference external" href="https://en.wikipedia.org/wiki/YAML"><span class="caps">YAML</span></a> .yml files. The .properties files have the&nbsp;form:</p>
<pre class="code literal-block">
config.value.a=1
config.value.b=2
config.value.c=3
</pre>
<p>while the .yml files are&nbsp;like:</p>
<pre class="code literal-block">
config:
    value:
        a: 1
        b: 2
        c: 3
</pre>
<p>You may use whatever you wish - in the examples I&#8217;ll use normal Java .properties
files because they are more compact (you don&#8217;t need to use multiple lines to represent
a single setting like in <span class="caps">YAML</span>).</p>
</div>
<div class="section" id="structuring-your-configuration-files">
<h2><a class="toc-backref" href="#id3">Structuring your configuration&nbsp;files</a></h2>
<p>Spring Boot reads its configuration from <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">various places</a>, however in this article we&#8217;ll talk
about four of them which should be enough for most cases. Starting from the most global to the most
specific ones (i.e the latter ones will override the previous ones) these&nbsp;are:</p>
<ul class="simple">
<li>Main (global) application&nbsp;settings</li>
<li>Profile&nbsp;settings</li>
<li>Local (/config)&nbsp;settings</li>
<li>Command line&nbsp;arguments</li>
</ul>
<p>The first two are setting files that will be contained inside the artifact (jar or war) that will be
created and should be commited to your version control system. I&#8217;ll call them jar-packaged
settings. The other two won&#8217;t be commited to the version control but will be created directly
on the server to-deploy. Let&#8217;s see a little more about&nbsp;them:</p>
<div class="section" id="main-application-settings">
<h3><a class="toc-backref" href="#id4">Main application&nbsp;settings</a></h3>
<p>These are kept in a file named <tt class="docutils literal">application.properties</tt> (or <tt class="docutils literal">yml</tt> &#8212; from now on I&#8217;ll just use
<cite>.properties`</cite> but keep in mind that you may use <tt class="docutils literal">.yml</tt>): This file should reside
inside the <tt class="docutils literal">src\main\resources</tt> folder
of your project and ideally contain all the settings your spring-boot application users. Some
of these settings will be overriden by settings kept in the next source so they may have a
default value or even be empty if they will be always overriden (or contain sensitive data
like passwords), however I still prefer to list
them all in this file even as placeholders to have a central source of all the settings that
your Spring Boot application&nbsp;uses.</p>
</div>
<div class="section" id="profiles">
<h3><a class="toc-backref" href="#id5">Profiles</a></h3>
<p>A profile is a set of settings that can be configured to override settings from <tt class="docutils literal">application.properties</tt>.
Each profile is contained in a file named <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> where <tt class="docutils literal">profilename</tt> is
the name of the profile. Now, a profile could configure anything you want, however
for most projects I propose to
have the following&nbsp;profiles:</p>
<ul class="simple">
<li><tt class="docutils literal">dev</tt> for your local development&nbsp;settings</li>
<li><tt class="docutils literal">uat</tt> for your <span class="caps">UAT</span> server&nbsp;settings</li>
<li><tt class="docutils literal">staging</tt> for your staging server&nbsp;settings</li>
<li><tt class="docutils literal">prod</tt> for your production&nbsp;settings</li>
<li><tt class="docutils literal">test</tt> for running your&nbsp;tests</li>
</ul>
<p>(depending of course on what are your requirements, some projects may not
need <tt class="docutils literal">uat</tt> or <tt class="docutils literal">staging</tt> but all projects should have a <tt class="docutils literal">dev</tt>, a <tt class="docutils literal">prod</tt> and a <tt class="docutils literal">test</tt> profile).
The configuration for these environemnts needs to be different for obvious reasons.
For example when developing you may want
to use a local database, when running tests an ephemeral in memory database
and your production database when deploying to production.
These profile configuration files will be stored inside your <tt class="docutils literal">src\main\resources</tt> folder,
right next to the <tt class="docutils literal">application.properties</tt>, i.e you&#8217;ll have
<tt class="docutils literal"><span class="pre">application-dev.properties</span></tt>, <tt class="docutils literal"><span class="pre">application-prod.properties</span></tt>,
<tt class="docutils literal"><span class="pre">application-test.properties</span></tt> etc - and all these files will be kept
in your <span class="caps">VCS</span> (and will also be jar-packaged since they will be
contained in the resulting&nbsp;artifact).</p>
<p>How do you select which profile is active each time (i.e pick it
when running the Spring Boot application under
its corresponding&nbsp;environment)?</p>
<p>For tests, since they can be run by a different <tt class="docutils literal">Main</tt> than
the normal application, you should use the <tt class="docutils literal">&#64;ActiveProfiles</tt> annotation
(for example <tt class="docutils literal"><span class="pre">&#64;ActiveProfiles(&quot;test&quot;)</span></tt>) to make sure that the tests
will run with the correct settings. So if the contents of your <tt class="docutils literal"><span class="pre">application-test.properties</span></tt>
are <tt class="docutils literal">config.value=Hello test!</tt> running this test should produce no&nbsp;errors:</p>
<div class="highlight"><pre><span></span><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringApplicationConfiguration</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="n">SpringBootConfigApplication</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringBootConfigApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${config.value}&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;${spring.profiles.active}&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">profile</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextLoads</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;Hello test!&quot;</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">profile</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<p>To activate a different profile when running your Spring Boot applications
you&#8217;ll need to use the <tt class="docutils literal">spring.profiles.active</tt> setting, so if you set
<tt class="docutils literal">spring.profiles.active=prod</tt> in your <tt class="docutils literal">application.properties</tt> and
create the packaged jar (or war) then you&#8217;ll have the production settings
when you run your application (i.e the contents of <tt class="docutils literal"><span class="pre">application-prod.properties</span></tt>
will be used to override your <tt class="docutils literal">application.properties</tt>). Of course, to deploy it
to <span class="caps">UAT</span>, you&#8217;ll need to change
<tt class="docutils literal">spring.profiles.active</tt> to <tt class="docutils literal">uat</tt> and re-create the packaged artifact &#8212;
see some repetition and penal labour here? Definitely you don&#8217;t want to do re-create
your artifacts for each of the environments you may want to deploy &#8212;
we&#8217;ll see in the next sections how to improve this flow by overriding
jar-packaged&nbsp;settings!</p>
<div class="section" id="some-more-advanced-profile-usage">
<h4><a class="toc-backref" href="#id6">Some more advanced profile&nbsp;usage</a></h4>
<p>You may have noticed in the previous section that the name of the
annotation is <tt class="docutils literal">&#64;ActiveProfiles</tt> and the name of the setting
<tt class="docutils literal">spring.profiles.active</tt> - both in plural. This of course is
on purpose: You may have <em>more than one</em> active&nbsp;profiles!</p>
<p>This, along with the fact that you can make <tt class="docutils literal">&#64;Components</tt> or <tt class="docutils literal">&#64;Configuration</tt>
available <em>only</em> on certail profiles is a really powerful&nbsp;tool!</p>
<p>Here are some&nbsp;examples:</p>
<ul class="simple">
<li>Configure two spring-security <tt class="docutils literal">&#64;Configuration</tt> s: Use in memory security for your dev environment, while using <span class="caps">LDAP</span> for your&nbsp;production.</li>
<li>If you want to support more than one database you can configure multiple profiles &#8212; and use them along with the dev/uat/prod I mentioned&nbsp;before.</li>
<li>Create verbose and non-verbose logging profiles and quickly change between&nbsp;them</li>
</ul>
</div>
</div>
<div class="section" id="overriding-settings">
<h3><a class="toc-backref" href="#id7">Overriding&nbsp;settings</a></h3>
<p>All the above settings we&#8217;ve defined should be safely kept inside
your <span class="caps">VCS</span> - however we wouldn&#8217;t like storing passwords or other
sensitive data to a <span class="caps">VCS</span>! Sensitive settings should be empty
(or have a default value) when
saved to <span class="caps">VCS</span> and overriden by &#8220;local&#8221;&nbsp;settings.</p>
<p>Also, all the previous are jar-packaged
and we definitely need a way to override them without messing
with the artifacts (for example, we need to select the
correct profile for running the application by overriding
<tt class="docutils literal">spring.profiles.active</tt>).</p>
<p>There two methods of overriding settings, and these are the last
two methods of the four we discussed&nbsp;above:</p>
<div class="section" id="using-a-config-application-properties">
<h4><a class="toc-backref" href="#id8">Using a&nbsp;config/application.properties</a></h4>
<p>You can put files in a directory named <tt class="docutils literal">config</tt> that is at the same level
as the location from which you try to run your jar. These file should be
named either <tt class="docutils literal">application.properties</tt> or <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt>
and will be used to override your jar-packaged&nbsp;settings.</p>
<p>What happens is that Spring will at first try to load a file named <tt class="docutils literal">config/application.properties</tt> that will
override your jar-packaged <tt class="docutils literal">application.properties</tt> (so here you can set your current profile). Then, it will also try to load
a file named <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt> that will override
your jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> (so here you may
override any profile related&nbsp;properties).</p>
<p>The priority of the files from lowest to&nbsp;highest:</p>
<ul class="simple">
<li>jar-packaged <tt class="docutils literal">application.properties</tt></li>
<li>local <tt class="docutils literal">config/application.properties</tt></li>
<li>jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt></li>
<li>local <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt></li>
</ul>
<p>So (repeating for emphasis) the settings in your jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> will <em>only</em>
be overriden by <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt> (and not by the <tt class="docutils literal">config/application.properties</tt>
which will only override settings on the jar-packaged <tt class="docutils literal">application.properties</tt>).</p>
<p>Also, to make everything clear about where the <tt class="docutils literal">config</tt> directory should be&nbsp;kept:</p>
<p>If the current directory from which you&#8217;ll run your jar is <tt class="docutils literal">/home/serafeim</tt> and
you want to execute <tt class="docutils literal"><span class="pre">/opt/spring/my-spring-app.jar</span></tt> (so you&#8217;ll run something like
<tt class="docutils literal">/home/serafeim$ java <span class="pre">-jar</span> <span class="pre">/opt/spring/my-spring-app.jar</span></tt>) then
the <tt class="docutils literal">config</tt> directory should
be at <tt class="docutils literal">/home/serafeim/config</tt> (i.e at the same directory from where you execute
jar). Normally however and to avoid confusion, the best approach would
be to just put it at <tt class="docutils literal">/opt/spring/config</tt> and <tt class="docutils literal">cd /opt/spring</tt> before running
your jar (so <tt class="docutils literal">config</tt> will be right next to your jar and run the jar from the&nbsp;directory).</p>
<p>Finally, my recommendation is to keep these <tt class="docutils literal"><span class="pre">config/*properties</span></tt> files off version control
(after all they should be different for each of your environments - common settings should
go to the jar-packaged files)
and to put only the profile selection setting and sensitive settings there. That means that
the <tt class="docutils literal">config/application.properties</tt> file should <em>only</em> contain a <tt class="docutils literal">spring.profiles.active=profilename</tt>
setting to set the correct profile for this instance of your app and the <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt>
will contain all sensitive information that you&#8217;ll need to run that&nbsp;profile.</p>
<p>For example in your <span class="caps">UAT</span> server you&#8217;ll have <tt class="docutils literal">spring.profiles.active=uat</tt> in your <tt class="docutils literal">application.properties</tt>
and your uat server passwords in your <tt class="docutils literal"><span class="pre">application-uat.properties</span></tt></p>
</div>
<div class="section" id="passing-command-line-arguments">
<h4><a class="toc-backref" href="#id9">Passing command line&nbsp;arguments</a></h4>
<p>The most specific way of overriding parameters (including the active profile of course) is by
directly passing these parameters as arguments when running your jar. For example,
if you run <tt class="docutils literal">java <span class="pre">-Dconfig.value=foo</span> <span class="pre">-jar</span> <span class="pre">my-spring-app.jar</span></tt> then the <tt class="docutils literal">config.value</tt>
will always have a value of <tt class="docutils literal">foo</tt> no matter what you have in your other config&nbsp;files.</p>
<p>That&#8217;s a different way to set your active profile (by passing <tt class="docutils literal"><span class="pre">-Dspring.profiles.active=profilename</span></tt>)
or to quickly set sensitive settings however
I prefer to keep the settings in properties files (and not to put them in scripts where they will definitely
be missed and will be more difficult to be managed)
so I&#8217;ll recommend the previous way of using a non-commited to version control local config/application.properties.
Use command line arguments only for quick tests (run something with a specific setting to test how it&nbsp;works).</p>
</div>
</div>
</div>
<div class="section" id="deploying-spring-boot-applications">
<h2><a class="toc-backref" href="#id10">Deploying Spring Boot&nbsp;applications</a></h2>
<p>If you check
the deployment documentation of Spring Boot you&#8217;ll see that it has various hints on
<a class="reference external" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#deployment">on deploying Spring Boot applications</a>. I won&#8217;t go into much detail about these however I&#8217;ll
represent my recommendation on deploying Spring Boot apps on Linux as an init.d&nbsp;script:</p>
<p>What is really interesting about Spring boot is that it allows you to make your jar-packaged jars <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment-install.html">executable as an init.d script</a> so that you will
be able to manage it using something like <tt class="docutils literal">service springbootapp start/stop/restart</tt> etc. To do that,
you&#8217;ll just need to add the <tt class="docutils literal"><span class="pre">&lt;executable&gt;true&lt;/executable&gt;</span></tt> <tt class="docutils literal">configuration</tt> for your pom&#8217;s
<tt class="docutils literal"><span class="pre">spring-boot-maven-plugin</span></tt>. This will add some things in the start of your resulting jar file
that will make it behave as a unix init.d script. If you take a look at your package artifact
you&#8217;ll see something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1">#    .   ____          _            __ _ _</span>
<span class="c1">#   /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<span class="c1">#  ( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \</span>
<span class="c1">#   \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<span class="c1">#    &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<span class="c1">#   =========|_|==============|___/=/_/_/_/</span>
<span class="c1">#   :: Spring Boot Startup Script ::</span>
<span class="c1">#</span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          spring-boot-config</span>
<span class="c1"># Required-Start:    $remote_fs $syslog $network</span>
<span class="c1"># Required-Stop:     $remote_fs $syslog $network</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: spring-boot-config</span>
<span class="c1"># Description:       Demo project for Spring Boot configuration</span>
<span class="c1"># chkconfig:         2345 99 01</span>
<span class="c1">### END INIT INFO</span>

<span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$DEBUG</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">set</span> -x

<span class="c1"># Initialize variables that cannot be provided by a .conf file</span>
<span class="nv">WORKING_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="c1"># shellcheck disable=SC2153</span>
<span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$JARFILE</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">jarfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$JARFILE</span><span class="s2">&quot;</span>
<span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$APP_NAME</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">identity</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$APP_NAME</span><span class="s2">&quot;</span>

...
</pre></div>
<p>One thing that may seem puzzling at first is that if make this jar executable
and try to run it you&#8217;ll see that, instead of offering you the well known
options of the init scripts (Usage &#8230; start/stop/restart etc)  it will immediatelly
run the application! This is because the embedded script is smart enough to
check that it will be executed as an init script only when it is executed
as a link from <tt class="docutils literal">/etc/init.d</tt> - else it will immediately run the&nbsp;application.</p>
<p>If
you want to quickly test that behavior, you may override the <tt class="docutils literal"><span class="caps">MODE</span></tt> parameter
which forces the mode of operation of the jar. If you want to run it as a
script (without using a links from /etc/ini.d) then just set <tt class="docutils literal"><span class="caps">MODE</span>=service</tt>.
So, try&nbsp;runnin:</p>
<pre class="code literal-block">
&gt; MODE=service ./springapplication.jar
Usage: ./hsk9eea.jar {start|stop|restart|force-reload|status|run}
</pre>
<p>Success! Of course, this is just for testing purposes, to actually deploy
your application then please create a link to it from <tt class="docutils literal">/etc/init.d</tt> as
proposed by the Spring Boot&nbsp;docs.</p>
<p>If you want to <a class="reference external" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#deployment-script-customization">customize the init.d script</a>  you can use a file named
<tt class="docutils literal">sprinbootapp.conf</tt> in the same directory as your <tt class="docutils literal">springbootapp.jar</tt>
(i.e it should have the same name as your jar with an extension of .conf). The
options from it will be sourced before running your application &#8212; for example
you could set the active profile using <tt class="docutils literal">RUN_ARGS</tt>, however as I already
recommended, explicitly setting it to a file named <tt class="docutils literal">config/applications.properties</tt>
is&nbsp;preferrable.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id11">Conclusion</a></h2>
<p>Using the described file structure you should be able to fully configure Spring Boot and have all the
goodies you&#8217;d expect from a modern framework: global settings, profiles, non-version control settings! Also, using the
advanced profiles techniques (multiple profiles, profile enabled
&#64;Components and &#64;Configurations) you&#8217;ll be able to implement
some really complex configurations! Finally, you&#8217;ll be able to really
quickly deploy the resulting jar as an init.d system&nbsp;service!</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://spapas.github.io/index6.html">&larr; Older</a>

    <a class="next" href="https://spapas.github.io/index4.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>

  <style>
    .bmc-button img {
      width: 27px !important;
      margin-bottom: 3px !important;
      box-shadow: none !important;
      border: none !important;
      vertical-align: middle !important;
    }

    .bmc-button {
      line-height: 36px !important;
      height: 37px !important;
      text-decoration: none !important;
      display: inline-block !important;
      color: #ffffff !important;
      background-color: #000000 !important;
      border-radius: 3px !important;
      border: 1px solid transparent !important;
      padding: 1px 9px !important;
      font-size: 23px !important;
      letter-spacing: 0.6px !important;
      ;
      box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
      -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      margin: 0 auto !important;
      font-family: 'Cookie', cursive !important;
      -webkit-box-sizing: border-box !important;
      box-sizing: border-box !important;
      -o-transition: 0.3s all linear !important;
      -webkit-transition: 0.3s all linear !important;
      -moz-transition: 0.3s all linear !important;
      -ms-transition: 0.3s all linear !important;
      transition: 0.3s all linear !important;
    }

    .bmc-button:hover,
    .bmc-button:active,
    .bmc-button:focus {
      -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      text-decoration: none !important;
      box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      opacity: 0.85 !important;
      color: #ffffff !important;
    }
  </style>
  <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://spapas.github.io/2020/03/27/wagtail-add-latest-changes/">Adding a latest-changes list to your Wagtail site</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2020/03/18/django-crispy-form-quick-easy-layout/">Quick and easy layout of django forms using django-crispy-forms and django-widget-tweaks</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/10/17/declarative-ecto-query-sorting/">Declarative Ecto query sorting</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/10/03/html-form-submit-php/">How to properly handle an HTML form</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/07/25/declarative-ecto-query-filters/">Declarative Ecto query filters</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://spapas.github.io/category/android.html">android</a></li>
      <li><a href="https://spapas.github.io/category/css.html">css</a></li>
      <li><a href="https://spapas.github.io/category/django.html">django</a></li>
      <li><a href="https://spapas.github.io/category/elixir.html">elixir</a></li>
      <li><a href="https://spapas.github.io/category/flask.html">flask</a></li>
      <li><a href="https://spapas.github.io/category/git.html">git</a></li>
      <li><a href="https://spapas.github.io/category/html.html">html</a></li>
      <li><a href="https://spapas.github.io/category/javascript.html">javascript</a></li>
      <li><a href="https://spapas.github.io/category/pelican.html">pelican</a></li>
      <li><a href="https://spapas.github.io/category/postgresql.html">postgresql</a></li>
      <li><a href="https://spapas.github.io/category/python.html">python</a></li>
      <li><a href="https://spapas.github.io/category/spring.html">spring</a></li>
      <li><a href="https://spapas.github.io/category/unix.html">unix</a></li>
      <li><a href="https://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://spapas.github.io/tag/less.html">less</a>,    <a href="https://spapas.github.io/tag/django-crispy-forms.html">django-crispy-forms</a>,    <a href="https://spapas.github.io/tag/rest.html">rest</a>,    <a href="https://spapas.github.io/tag/query.html">query</a>,    <a href="https://spapas.github.io/tag/ecto.html">ecto</a>,    <a href="https://spapas.github.io/tag/tables.html">tables</a>,    <a href="https://spapas.github.io/tag/pivot_table.html">pivot_table</a>,    <a href="https://spapas.github.io/tag/console.html">console</a>,    <a href="https://spapas.github.io/tag/async.html">async</a>,    <a href="https://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="https://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="https://spapas.github.io/tag/forms.html">forms</a>,    <a href="https://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="https://spapas.github.io/tag/404.html">404</a>,    <a href="https://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="https://spapas.github.io/tag/immutable.html">immutable</a>,    <a href="https://spapas.github.io/tag/initd.html">init.d</a>,    <a href="https://spapas.github.io/tag/django-widget-tweaks.html">django-widget-tweaks</a>,    <a href="https://spapas.github.io/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://spapas.github.io/tag/python.html">python</a>,    <a href="https://spapas.github.io/tag/django-extensions.html">django-extensions</a>,    <a href="https://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="https://spapas.github.io/tag/scipy.html">scipy</a>,    <a href="https://spapas.github.io/tag/grid.html">grid</a>,    <a href="https://spapas.github.io/tag/ag-grid.html">ag-grid</a>,    <a href="https://spapas.github.io/tag/du.html">du</a>,    <a href="https://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="https://spapas.github.io/tag/settings.html">settings</a>,    <a href="https://spapas.github.io/tag/flux.html">flux</a>,    <a href="https://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://spapas.github.io/tag/queries.html">queries</a>,    <a href="https://spapas.github.io/tag/debug.html">debug</a>,    <a href="https://spapas.github.io/tag/imgur.html">imgur</a>,    <a href="https://spapas.github.io/tag/security.html">security</a>,    <a href="https://spapas.github.io/tag/npm.html">npm</a>,    <a href="https://spapas.github.io/tag/hyperapp.html">hyperapp</a>,    <a href="https://spapas.github.io/tag/spring.html">spring</a>,    <a href="https://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="https://spapas.github.io/tag/cron.html">cron</a>,    <a href="https://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="https://spapas.github.io/tag/design.html">design</a>,    <a href="https://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="https://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="https://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="https://spapas.github.io/tag/rq.html">rq</a>,    <a href="https://spapas.github.io/tag/redis.html">redis</a>,    <a href="https://spapas.github.io/tag/python-3.html">python-3</a>,    <a href="https://spapas.github.io/tag/research.html">research</a>,    <a href="https://spapas.github.io/tag/werkzeug.html">werkzeug</a>,    <a href="https://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="https://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://spapas.github.io/tag/disk-usage.html">disk-usage</a>,    <a href="https://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="https://spapas.github.io/tag/component.html">component</a>,    <a href="https://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="https://spapas.github.io/tag/elixir.html">elixir</a>,    <a href="https://spapas.github.io/tag/ipython.html">ipython</a>,    <a href="https://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="https://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="https://spapas.github.io/tag/properties.html">properties</a>,    <a href="https://spapas.github.io/tag/bash.html">bash</a>,    <a href="https://spapas.github.io/tag/es6.html">es6</a>,    <a href="https://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="https://spapas.github.io/tag/postgresql.html">postgresql</a>,    <a href="https://spapas.github.io/tag/kotlin.html">kotlin</a>,    <a href="https://spapas.github.io/tag/adapter.html">adapter</a>,    <a href="https://spapas.github.io/tag/filter.html">filter</a>,    <a href="https://spapas.github.io/tag/flask.html">flask</a>,    <a href="https://spapas.github.io/tag/notebook.html">notebook</a>,    <a href="https://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="https://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="https://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="https://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="https://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="https://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="https://spapas.github.io/tag/unix.html">unix</a>,    <a href="https://spapas.github.io/tag/google.html">google</a>,    <a href="https://spapas.github.io/tag/linux.html">linux</a>,    <a href="https://spapas.github.io/tag/pivot.html">pivot</a>,    <a href="https://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="https://spapas.github.io/tag/git.html">git</a>,    <a href="https://spapas.github.io/tag/java.html">java</a>,    <a href="https://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="https://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="https://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="https://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://spapas.github.io/tag/numpy.html">numpy</a>,    <a href="https://spapas.github.io/tag/form.html">form</a>,    <a href="https://spapas.github.io/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="https://spapas.github.io/tag/rst.html">rst</a>,    <a href="https://spapas.github.io/tag/python-2.html">python-2</a>,    <a href="https://spapas.github.io/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://spapas.github.io/tag/middleware.html">middleware</a>,    <a href="https://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="https://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="https://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="https://spapas.github.io/tag/error.html">error</a>,    <a href="https://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="https://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://spapas.github.io/tag/select2.html">select2</a>,    <a href="https://spapas.github.io/tag/history.html">history</a>,    <a href="https://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="https://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="https://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="https://spapas.github.io/tag/plpgsql.html">plpgsql</a>,    <a href="https://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="https://spapas.github.io/tag/generic.html">generic</a>,    <a href="https://spapas.github.io/tag/babel.html">babel</a>,    <a href="https://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="https://spapas.github.io/tag/html.html">html</a>,    <a href="https://spapas.github.io/tag/android.html">android</a>,    <a href="https://spapas.github.io/tag/pandas.html">pandas</a>,    <a href="https://spapas.github.io/tag/css.html">css</a>,    <a href="https://spapas.github.io/tag/node.html">node</a>,    <a href="https://spapas.github.io/tag/phoenix.html">phoenix</a>,    <a href="https://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="https://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="https://spapas.github.io/tag/react.html">react</a>,    <a href="https://spapas.github.io/tag/autocompelte.html">autocompelte</a>,    <a href="https://spapas.github.io/tag/declarative.html">declarative</a>,    <a href="https://spapas.github.io/tag/php.html">php</a>,    <a href="https://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="https://spapas.github.io/tag/branching.html">branching</a>,    <a href="https://spapas.github.io/tag/github.html">github</a>,    <a href="https://spapas.github.io/tag/jupyter.html">jupyter</a>,    <a href="https://spapas.github.io/tag/windows.html">windows</a>,    <a href="https://spapas.github.io/tag/youtube.html">youtube</a>,    <a href="https://spapas.github.io/tag/django.html">django</a>,    <a href="https://spapas.github.io/tag/q.html">q</a>,    <a href="https://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="https://spapas.github.io/tag/redux.html">redux</a>,    <a href="https://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://spapas.github.io/posts/2013/">2013</a>,    <a href="https://spapas.github.io/posts/2014/">2014</a>,    <a href="https://spapas.github.io/posts/2015/">2015</a>,    <a href="https://spapas.github.io/posts/2016/">2016</a>,    <a href="https://spapas.github.io/posts/2017/">2017</a>,    <a href="https://spapas.github.io/posts/2018/">2018</a>,    <a href="https://spapas.github.io/posts/2019/">2019</a>,    <a href="https://spapas.github.io/posts/2020/">2020</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://spapas.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://spapas.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2020  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="https://spapas.github.io/theme/js/ender.js"></script>
  <script src="https://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
  <script src="https://spapas.github.io/theme/js/ads.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
  <script>
    if( window.canRunAds === undefined ){
        // adblocker detected, show fallback
        console.log("CANNOT RUN ADS");
        document.getElementById('gHPzseYvFrhZ123').style.display='block';
      }
  </script>
</body>

</html>