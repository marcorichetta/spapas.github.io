<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://spapas.github.io/favicon.png" rel="icon">

    <link href="https://spapas.github.io/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://spapas.github.io/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">


    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://spapas.github.io/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/06/07/django-werkzeug-debugger/">Using Werkzeug debugger with Django</a>
      </h1>
    <p class="meta">
<time datetime="2016-06-07T10:40:00+03:00" pubdate>Τρι 07 Ιούνιος 2016</time>    </p>
</header>

<div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p><a class="reference external" href="http://werkzeug.pocoo.org/">Werkzeug</a> is a <span class="caps">WSGI</span> utility library for Python. Beyond others, it includes an interactive
debugger - what this means is that when your python application throws an exception,
Werkzeug will display the exception stacktrace in the browser (that&#8217;s not a big deal)
and allow you to write python commands interactively wherever you want in that stacktrace
(that&#8217;s the important&nbsp;stuff).</p>
<p>Now, the even more important stuff is that you can <em>abuse</em> the above feature by adding
code that will throw an exception in various parts of your application and, as a result
get an interactive python prompt at <em>specific</em> parts of your application (for example,
before validating your form, or when a method in your model is executed). All this,
without the need to use a specific <span class="caps">IDE</span> to add&nbsp;breakpoints!</p>
<p>This is an old trick however some people don&#8217;t use it and make their work more
difficult. Actually, this one of the first things I learned when starting with django
and use it all the time since then - I am writing this post mainly to emphasize
its usefulness and to urge more people to use it. If you don&#8217;t already use it please try
it (and thank me&nbsp;later).</p>
</div>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>There are two components you need to install in your django project to use the
above&nbsp;technique:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/django-extensions/django-extensions">django-extensions</a>: a swiss army knife toolset for django - beyond other useful tools it includes a management command (<tt class="docutils literal">runserver_plus</tt>) to start the Werkzeug interactive debugger with your&nbsp;project</li>
<li>werkzeug: the werkzeug utility&nbsp;library</li>
</ul>
<p>Both of these can just be installed with pip (even on windows). After installing them, add <tt class="docutils literal">django_extensions</tt> to your <tt class="docutils literal">INSTALLED_APPS</tt> setting to enable
the management&nbsp;command.</p>
<p>After that, you can just run <tt class="docutils literal">python manage.py runserver_plus</tt> - if everything was installed successfully you should see something like this (in windows at&nbsp;least):</p>
<pre class="code literal-block">
(venv) C:\progr\py\werkzeug\testdebug&gt;python manage.py runserver_plus
 * Restarting with stat
Performing system checks...

System check identified no issues (0 silenced).

Django version 1.9.7, using settings 'testdebug.settings'
Development server is running at http://127.0.0.1:8000/
Using the Werkzeug debugger (http://werkzeug.pocoo.org/)
Quit the server with CTRL-BREAK.
 * Debugger is active!
 * Debugger pin code: 143-738-172
 * Debugger is active!
 * Debugger pin code: 174-740-467
 * Running on http://127.0.0.1:8000/ (Press CTRL+C to quit)
</pre>
<p>Now, the &#8220;debugger pin&#8221; you see is a way to protect your interactive debugger (i.e it asks for the pin
before allowing you to enter the interactive prompt). Since this feature should <em>only</em> be used in your
local development system I recommend to just disable it by setting the <tt class="docutils literal">WERKZEUG_DEBUG_PIN</tt> environment
variable to <tt class="docutils literal">off</tt> (i.e <tt class="docutils literal">set WERKZEUG_DEBUG_PIN=off</tt> in windows). After that you should see the message
&#8220; * Debugger pin disabled.  <span class="caps">DEBUGGER</span> <span class="caps">UNSECURED</span>!&#8220;. Please be careful with the interactive debugger
and  <em>never, ever use it in a production deployment</em> even with the debug pin enabled. I also recommend to
use it <em>only</em> on a local development server (i.e the server must be run on 127.0.0.1/local <span class="caps">IP</span> and not
allow remote&nbsp;connections).</p>
</div>
<div class="section" id="usage">
<h2>Usage</h2>
<p>Now its time for the magic: Let&#8217;s add a django view that throws an exception, like&nbsp;this:</p>
<pre class="code literal-block">
def test(request):
    a+=1
</pre>
<p>to your urls.py ( <tt class="docutils literal"><span class="pre">url(r'^test/',</span> test )</tt> ) and after you visit <cite>test</cite> you should see something like&nbsp;this:</p>
<img alt="Werkzeug debugger" src="/images/werkzeug.png" style="width: 800px;" />
<p>Since the <tt class="docutils literal">a</tt> variable was not defined you&#8217;ll get an exception when you try to increaseit.
Now, notice the console icon in the lower right corner - when you click it you&#8217;ll get the interactive debugger!
Now you can enter python commands exactly where the <tt class="docutils literal"><span class="pre">a+=1</span></tt> code was. For example, you can see what are the
attributes of the <tt class="docutils literal">request</tt> object you receive (for example, just enter <tt class="docutils literal">request.<span class="caps">GET</span></tt> to output the <tt class="docutils literal"><span class="caps">GET</span></tt>
dictionary to the interactive&nbsp;console).</p>
<p>Notice that you can get interactive consoles wherever you want in the stacktrace, i.e I could get a console at line 147
of <cite>django.core.handlers.base</cite> module on the <tt class="docutils literal">get_response</tt> method &#8212; this is needed sometimes especially when you
want to see how your code is called by other&nbsp;modules.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>As you can see, using the presented technique you can really quickly start an interactive console wherever you
want and start entering commands. I use it whenever I need to write anything non trivial (or even trivial stuff -
I sometimes prefer opening and interactive debugger to find out by trial and error how should I write a django
<span class="caps">ORM</span> query than open models.py) and really miss it on other environments&nbsp;(Java).</p>
<p>The above technique should also work with few modifications with other python web frameworks so it&#8217;s not&nbsp;django-only.</p>
<p>Finally, please notice that both Werkzeug and django-extensions offer many more tools beyond the interactive debugger presented here -
I encourage you to research them since - if you follow my advice - you&#8217;ll integrate these to <em>all</em> your django&nbsp;projects!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/04/27/python-nested-list-comprehensions/">Understanding nested list comprehension syntax in Python</a>
      </h1>
    <p class="meta">
<time datetime="2016-04-27T11:20:00+03:00" pubdate>Τετ 27 Απρίλιος 2016</time>    </p>
</header>

<div class="entry-content"><p>List comprehensions are one of the really nice and powerful features of Python. It
is actually a smart way to introduce new users to functional programming concepts
(after all a list comprehension is just a combination of map and filter) and compact&nbsp;statements.</p>
<p>However, one thing that always troubled me when using list comprehensions is their
non intuitive syntax when nesting was needed. For example, let&#8217;s say that we just
want to flatten a list of lists using a nested list&nbsp;comprehension:</p>
<div class="highlight"><pre><span></span><span class="n">non_flat</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
<p>To write that, somebody would think: For a simple list
comprehension I need to
write <tt class="docutils literal">[ x for x in non_flat ]</tt> to get all its items - however I want to retrieve each element of the <tt class="docutils literal">x</tt> list so I&#8217;ll write something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span><span class="p">]</span>
<span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
<p>Well duh! At this time I&#8217;d need research google for a working list comprehension syntax and adjust it to my needs (or give up and write it as a double for&nbsp;loop).</p>
<p>Here&#8217;s the correct nested list comprehension people&nbsp;wondering:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
<p>What if I wanted to add a third level of nesting or an if? Well I&#8217;d just bite the bullet and use for&nbsp;loops!</p>
<p>However, if you take a look at the document describing list comprehensions in python (<cite><span class="caps">PEP</span> 202</cite>) you&#8217;ll see
the following&nbsp;phrase:</p>
<blockquote>
It is proposed to allow conditional construction of list literals
using for and if clauses. <strong>They would nest in the same way for
loops and if statements nest now.</strong></blockquote>
<p>This statement explains everything! <em>Just think in for-loops syntax</em>. So, If I used for loops for the previous flattening, I&#8217;d do something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">y</span>
</pre></div>
<p>which, if <cite>y</cite> is moved to the front and joined in one line would be the correct nested list&nbsp;comprehension!</p>
<p>So that&#8217;s the way&#8230; What If I wanted to include only lists with more than 2 elements in the flattening
(so <cite>[7,8]</cite> should not be included)? I&#8217;ll write it with for loops&nbsp;first:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span>
</pre></div>
<p>so by convering this to list comprehension we&nbsp;get:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">non_flat</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>
<p>Success!</p>
<p>One final, more complex example: Let&#8217;s say that we have a list
of lists of words and we want to get a list of all the letters of these words
along with the index of the list they belong to
but only for words with more than two characters. Using the same
for-loop syntax for the nested list comprehensions we&#8217;ll&nbsp;get:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;taz&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;koko&#39;</span><span class="p">]</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">word</span><span class="p">]</span>
<span class="p">[(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/03/31/spring-boot-settings/">Configuring Spring Boot</a>
      </h1>
    <p class="meta">
<time datetime="2016-03-31T19:20:00+03:00" pubdate>Πεμ 31 Μάρτιος 2016</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#properties-vs-yml-files" id="id2">properties vs yml&nbsp;files</a></li>
<li><a class="reference internal" href="#structuring-your-configuration-files" id="id3">Structuring your configuration files</a><ul>
<li><a class="reference internal" href="#main-application-settings" id="id4">Main application&nbsp;settings</a></li>
<li><a class="reference internal" href="#profiles" id="id5">Profiles</a><ul>
<li><a class="reference internal" href="#some-more-advanced-profile-usage" id="id6">Some more advanced profile&nbsp;usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overriding-settings" id="id7">Overriding settings</a><ul>
<li><a class="reference internal" href="#using-a-config-application-properties" id="id8">Using a&nbsp;config/application.properties</a></li>
<li><a class="reference internal" href="#passing-command-line-arguments" id="id9">Passing command line&nbsp;arguments</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#deploying-spring-boot-applications" id="id10">Deploying Spring Boot&nbsp;applications</a></li>
<li><a class="reference internal" href="#conclusion" id="id11">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>The <a class="reference external" href="http://projects.spring.io/spring-boot/">Spring Boot</a> project is great way of building Java applications using
Spring. Instead of trying to integrate everything by hand (and usually
end up with a configuration hell) you use spring-boot to help you to
bootstrap your application: Just include its
dependencies in your pom.xml and Spring Boot will try its
best to auto-configure all these&nbsp;components!</p>
<p>Of course, no matter how hard Spring Boot tries to auto-configure everything,
you&#8217;ll still need to pass some configuration to configure your databases,
caches, email sending, security etc. Thankfully, Spring Boot
can be configured without <em>any</em> xml (actually, its a bad practice to
use xml-based configuration with it), using plain Java .properties
files or (if you prefer the more compact syntax) <a class="reference external" href="https://en.wikipedia.org/wiki/YAML"><span class="caps">YAML</span></a> .yml&nbsp;files!</p>
<p>In this guide, along with a simple introduction to the way Spring Boot configuration
works, we&#8217;ll talk about a specific way of stucturing your settings configuration files in
order to&nbsp;have:</p>
<ul class="simple">
<li>A global configuration file that will contain all your&nbsp;settings</li>
<li>Different settings for each of your environments (development, <span class="caps">UAT</span>, staging, production and&nbsp;test)</li>
<li>A way to configure your passwords and other sensitive data (that you don&#8217;t want to put to your <span class="caps">VCS</span>)</li>
<li>Being able to override any setting in any&nbsp;environment</li>
<li>Deploying your Spring Boot app in Linux using <tt class="docutils literal">init.d</tt></li>
</ul>
<p>To quickly test the proposed settings configuration I&#8217;ve created a simple
Spring Boot project &#64; <a class="reference external" href="https://github.com/spapas/spring-boot-config">https://github.com/spapas/spring-boot-config</a>. Just clone
it, optionally change the packaged settings (more on this later), package it (<tt class="docutils literal">mvn package</tt>), optionally change
the <tt class="docutils literal">config</tt> settings (more on this also later) and run it
(using something like <tt class="docutils literal">java <span class="pre">-jar</span> <span class="pre">spring-boot-config-0.0.1-<span class="caps">SNAPSHOT</span>.jar</span></tt>) optionally passing it command line settings (more on this
also later). You&#8217;ll then be able to visit <tt class="docutils literal"><span class="pre">http://127.0.0.1:8080</span></tt> and check the current&nbsp;settings!</p>
</div>
<div class="section" id="properties-vs-yml-files">
<h2><a class="toc-backref" href="#id2">properties vs yml&nbsp;files</a></h2>
<p>You can use two kinds of files to configure your settings: Normal Java .properties files
or <a class="reference external" href="https://en.wikipedia.org/wiki/YAML"><span class="caps">YAML</span></a> .yml files. The .properties files have the&nbsp;form:</p>
<pre class="code literal-block">
config.value.a=1
config.value.b=2
config.value.c=3
</pre>
<p>while the .yml files are&nbsp;like:</p>
<pre class="code literal-block">
config:
    value:
        a: 1
        b: 2
        c: 3
</pre>
<p>You may use whatever you wish - in the examples I&#8217;ll use normal Java .properties
files because they are more compact (you don&#8217;t need to use multiple lines to represent
a single setting like in <span class="caps">YAML</span>).</p>
</div>
<div class="section" id="structuring-your-configuration-files">
<h2><a class="toc-backref" href="#id3">Structuring your configuration&nbsp;files</a></h2>
<p>Spring Boot reads its configuration from <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html">various places</a>, however in this article we&#8217;ll talk
about four of them which should be enough for most cases. Starting from the most global to the most
specific ones (i.e the latter ones will override the previous ones) these&nbsp;are:</p>
<ul class="simple">
<li>Main (global) application&nbsp;settings</li>
<li>Profile&nbsp;settings</li>
<li>Local (/config)&nbsp;settings</li>
<li>Command line&nbsp;arguments</li>
</ul>
<p>The first two are setting files that will be contained inside the artifact (jar or war) that will be
created and should be commited to your version control system. I&#8217;ll call them jar-packaged
settings. The other two won&#8217;t be commited to the version control but will be created directly
on the server to-deploy. Let&#8217;s see a little more about&nbsp;them:</p>
<div class="section" id="main-application-settings">
<h3><a class="toc-backref" href="#id4">Main application&nbsp;settings</a></h3>
<p>These are kept in a file named <tt class="docutils literal">application.properties</tt> (or <tt class="docutils literal">yml</tt> &#8212; from now on I&#8217;ll just use
<cite>.properties`</cite> but keep in mind that you may use <tt class="docutils literal">.yml</tt>): This file should reside
inside the <tt class="docutils literal">src\main\resources</tt> folder
of your project and ideally contain all the settings your spring-boot application users. Some
of these settings will be overriden by settings kept in the next source so they may have a
default value or even be empty if they will be always overriden (or contain sensitive data
like passwords), however I still prefer to list
them all in this file even as placeholders to have a central source of all the settings that
your Spring Boot application&nbsp;uses.</p>
</div>
<div class="section" id="profiles">
<h3><a class="toc-backref" href="#id5">Profiles</a></h3>
<p>A profile is a set of settings that can be configured to override settings from <tt class="docutils literal">application.properties</tt>.
Each profile is contained in a file named <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> where <tt class="docutils literal">profilename</tt> is
the name of the profile. Now, a profile could configure anything you want, however
for most projects I propose to
have the following&nbsp;profiles:</p>
<ul class="simple">
<li><tt class="docutils literal">dev</tt> for your local development&nbsp;settings</li>
<li><tt class="docutils literal">uat</tt> for your <span class="caps">UAT</span> server&nbsp;settings</li>
<li><tt class="docutils literal">staging</tt> for your staging server&nbsp;settings</li>
<li><tt class="docutils literal">prod</tt> for your production&nbsp;settings</li>
<li><tt class="docutils literal">test</tt> for running your&nbsp;tests</li>
</ul>
<p>(depending of course on what are your requirements, some projects may not
need <tt class="docutils literal">uat</tt> or <tt class="docutils literal">staging</tt> but all projects should have a <tt class="docutils literal">dev</tt>, a <tt class="docutils literal">prod</tt> and a <tt class="docutils literal">test</tt> profile).
The configuration for these environemnts needs to be different for obvious reasons.
For example when developing you may want
to use a local database, when running tests an ephemeral in memory database
and your production database when deploying to production.
These profile configuration files will be stored inside your <tt class="docutils literal">src\main\resources</tt> folder,
right next to the <tt class="docutils literal">application.properties</tt>, i.e you&#8217;ll have
<tt class="docutils literal"><span class="pre">application-dev.properties</span></tt>, <tt class="docutils literal"><span class="pre">application-prod.properties</span></tt>,
<tt class="docutils literal"><span class="pre">application-test.properties</span></tt> etc - and all these files will be kept
in your <span class="caps">VCS</span> (and will also be jar-packaged since they will be
contained in the resulting&nbsp;artifact).</p>
<p>How do you select which profile is active each time (i.e pick it
when running the Spring Boot application under
its corresponding&nbsp;environment)?</p>
<p>For tests, since they can be run by a different <tt class="docutils literal">Main</tt> than
the normal application, you should use the <tt class="docutils literal">&#64;ActiveProfiles</tt> annotation
(for example <tt class="docutils literal"><span class="pre">&#64;ActiveProfiles(&quot;test&quot;)</span></tt>) to make sure that the tests
will run with the correct settings. So if the contents of your <tt class="docutils literal"><span class="pre">application-test.properties</span></tt>
are <tt class="docutils literal">config.value=Hello test!</tt> running this test should produce no&nbsp;errors:</p>
<div class="highlight"><pre><span></span><span class="nd">@RunWith</span><span class="p">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@SpringApplicationConfiguration</span><span class="p">(</span><span class="n">classes</span> <span class="o">=</span> <span class="n">SpringBootConfigApplication</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="nd">@ActiveProfiles</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringBootConfigApplicationTests</span> <span class="p">{</span>

    <span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${config.value}&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">value</span><span class="p">;</span>

    <span class="nd">@Value</span><span class="p">(</span><span class="s">&quot;${spring.profiles.active}&quot;</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">profile</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextLoads</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">is</span><span class="p">(</span><span class="s">&quot;Hello test!&quot;</span><span class="p">));</span>
        <span class="n">assertThat</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">is</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>To activate a different profile when running your Spring Boot applications
you&#8217;ll need to use the <tt class="docutils literal">spring.profiles.active</tt> setting, so if you set
<tt class="docutils literal">spring.profiles.active=prod</tt> in your <tt class="docutils literal">application.properties</tt> and
create the packaged jar (or war) then you&#8217;ll have the production settings
when you run your application (i.e the contents of <tt class="docutils literal"><span class="pre">application-prod.properties</span></tt>
will be used to override your <tt class="docutils literal">application.properties</tt>). Of course, to deploy it
to <span class="caps">UAT</span>, you&#8217;ll need to change
<tt class="docutils literal">spring.profiles.active</tt> to <tt class="docutils literal">uat</tt> and re-create the packaged artifact &#8212;
see some repetition and penal labour here? Definitely you don&#8217;t want to do re-create
your artifacts for each of the environments you may want to deploy &#8212;
we&#8217;ll see in the next sections how to improve this flow by overriding
jar-packaged&nbsp;settings!</p>
<div class="section" id="some-more-advanced-profile-usage">
<h4><a class="toc-backref" href="#id6">Some more advanced profile&nbsp;usage</a></h4>
<p>You may have noticed in the previous section that the name of the
annotation is <tt class="docutils literal">&#64;ActiveProfiles</tt> and the name of the setting
<tt class="docutils literal">spring.profiles.active</tt> - both in plural. This of course is
on purpose: You may have <em>more than one</em> active&nbsp;profiles!</p>
<p>This, along with the fact that you can make <tt class="docutils literal">&#64;Components</tt> or <tt class="docutils literal">&#64;Configuration</tt>
available <em>only</em> on certail profiles is a really powerful&nbsp;tool!</p>
<p>Here are some&nbsp;examples:</p>
<ul class="simple">
<li>Configure two spring-security <tt class="docutils literal">&#64;Configuration</tt> s: Use in memory security for your dev environment, while using <span class="caps">LDAP</span> for your&nbsp;production.</li>
<li>If you want to support more than one database you can configure multiple profiles &#8212; and use them along with the dev/uat/prod I mentioned&nbsp;before.</li>
<li>Create verbose and non-verbose logging profiles and quickly change between&nbsp;them</li>
</ul>
</div>
</div>
<div class="section" id="overriding-settings">
<h3><a class="toc-backref" href="#id7">Overriding&nbsp;settings</a></h3>
<p>All the above settings we&#8217;ve defined should be safely kept inside
your <span class="caps">VCS</span> - however we wouldn&#8217;t like storing passwords or other
sensitive data to a <span class="caps">VCS</span>! Sensitive settings should be empty
(or have a default value) when
saved to <span class="caps">VCS</span> and overriden by &#8220;local&#8221;&nbsp;settings.</p>
<p>Also, all the previous are jar-packaged
and we definitely need a way to override them without messing
with the artifacts (for example, we need to select the
correct profile for running the application by overriding
<tt class="docutils literal">spring.profiles.active</tt>).</p>
<p>There two methods of overriding settings, and these are the last
two methods of the four we discussed&nbsp;above:</p>
<div class="section" id="using-a-config-application-properties">
<h4><a class="toc-backref" href="#id8">Using a&nbsp;config/application.properties</a></h4>
<p>You can put files in a directory named <tt class="docutils literal">config</tt> that is at the same level
as the location from which you try to run your jar. These file should be
named either <tt class="docutils literal">application.properties</tt> or <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt>
and will be used to override your jar-packaged&nbsp;settings.</p>
<p>What happens is that Spring will at first try to load a file named <tt class="docutils literal">config/application.properties</tt> that will
override your jar-packaged <tt class="docutils literal">application.properties</tt> (so here you can set your current profile). Then, it will also try to load
a file named <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt> that will override
your jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> (so here you may
override any profile related&nbsp;properties).</p>
<p>The priority of the files from lowest to&nbsp;highest:</p>
<ul class="simple">
<li>jar-packaged <tt class="docutils literal">application.properties</tt></li>
<li>local <tt class="docutils literal">config/application.properties</tt></li>
<li>jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt></li>
<li>local <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt></li>
</ul>
<p>So (repeating for emphasis) the settings in your jar-packaged <tt class="docutils literal"><span class="pre">application-profilename.properties</span></tt> will <em>only</em>
be overriden by <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt> (and not by the <tt class="docutils literal">config/application.properties</tt>
which will only override settings on the jar-packaged <tt class="docutils literal">application.properties</tt>).</p>
<p>Also, to make everything clear about where the <tt class="docutils literal">config</tt> directory should be&nbsp;kept:</p>
<p>If the current directory from which you&#8217;ll run your jar is <tt class="docutils literal">/home/serafeim</tt> and
you want to execute <tt class="docutils literal"><span class="pre">/opt/spring/my-spring-app.jar</span></tt> (so you&#8217;ll run something like
<tt class="docutils literal">/home/serafeim$ java <span class="pre">-jar</span> <span class="pre">/opt/spring/my-spring-app.jar</span></tt>) then
the <tt class="docutils literal">config</tt> directory should
be at <tt class="docutils literal">/home/serafeim/config</tt> (i.e at the same directory from where you execute
jar). Normally however and to avoid confusion, the best approach would
be to just put it at <tt class="docutils literal">/opt/spring/config</tt> and <tt class="docutils literal">cd /opt/spring</tt> before running
your jar (so <tt class="docutils literal">config</tt> will be right next to your jar and run the jar from the&nbsp;directory).</p>
<p>Finally, my recommendation is to keep these <tt class="docutils literal"><span class="pre">config/*properties</span></tt> files off version control
(after all they should be different for each of your environments - common settings should
go to the jar-packaged files)
and to put only the profile selection setting and sensitive settings there. That means that
the <tt class="docutils literal">config/application.properties</tt> file should <em>only</em> contain a <tt class="docutils literal">spring.profiles.active=profilename</tt>
setting to set the correct profile for this instance of your app and the <tt class="docutils literal"><span class="pre">config/application-profilename.properties</span></tt>
will contain all sensitive information that you&#8217;ll need to run that&nbsp;profile.</p>
<p>For example in your <span class="caps">UAT</span> server you&#8217;ll have <tt class="docutils literal">spring.profiles.active=uat</tt> in your <tt class="docutils literal">application.properties</tt>
and your uat server passwords in your <tt class="docutils literal"><span class="pre">application-uat.properties</span></tt></p>
</div>
<div class="section" id="passing-command-line-arguments">
<h4><a class="toc-backref" href="#id9">Passing command line&nbsp;arguments</a></h4>
<p>The most specific way of overriding parameters (including the active profile of course) is by
directly passing these parameters as arguments when running your jar. For example,
if you run <tt class="docutils literal">java <span class="pre">-Dconfig.value=foo</span> <span class="pre">-jar</span> <span class="pre">my-spring-app.jar</span></tt> then the <tt class="docutils literal">config.value</tt>
will always have a value of <tt class="docutils literal">foo</tt> no matter what you have in your other config&nbsp;files.</p>
<p>That&#8217;s a different way to set your active profile (by passing <tt class="docutils literal"><span class="pre">-Dspring.profiles.active=profilename</span></tt>)
or to quickly set sensitive settings however
I prefer to keep the settings in properties files (and not to put them in scripts where they will definitely
be missed and will be more difficult to be managed)
so I&#8217;ll recommend the previous way of using a non-commited to version control local config/application.properties.
Use command line arguments only for quick tests (run something with a specific setting to test how it&nbsp;works).</p>
</div>
</div>
</div>
<div class="section" id="deploying-spring-boot-applications">
<h2><a class="toc-backref" href="#id10">Deploying Spring Boot&nbsp;applications</a></h2>
<p>If you check
the deployment documentation of Spring Boot you&#8217;ll see that it has various hints on
<a class="reference external" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#deployment">on deploying Spring Boot applications</a>. I won&#8217;t go into much detail about these however I&#8217;ll
represent my recommendation on deploying Spring Boot apps on Linux as an init.d&nbsp;script:</p>
<p>What is really interesting about Spring boot is that it allows you to make your jar-packaged jars <a class="reference external" href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment-install.html">executable as an init.d script</a> so that you will
be able to manage it using something like <tt class="docutils literal">service springbootapp start/stop/restart</tt> etc. To do that,
you&#8217;ll just need to add the <tt class="docutils literal"><span class="pre">&lt;executable&gt;true&lt;/executable&gt;</span></tt> <tt class="docutils literal">configuration</tt> for your pom&#8217;s
<tt class="docutils literal"><span class="pre">spring-boot-maven-plugin</span></tt>. This will add some things in the start of your resulting jar file
that will make it behave as a unix init.d script. If you take a look at your package artifact
you&#8217;ll see something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1">#    .   ____          _            __ _ _</span>
<span class="c1">#   /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<span class="c1">#  ( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \</span>
<span class="c1">#   \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span>
<span class="c1">#    &#39;  |____| .__|_| |_|_| |_\__, | / / / /</span>
<span class="c1">#   =========|_|==============|___/=/_/_/_/</span>
<span class="c1">#   :: Spring Boot Startup Script ::</span>
<span class="c1">#</span>

<span class="c1">### BEGIN INIT INFO</span>
<span class="c1"># Provides:          spring-boot-config</span>
<span class="c1"># Required-Start:    $remote_fs $syslog $network</span>
<span class="c1"># Required-Stop:     $remote_fs $syslog $network</span>
<span class="c1"># Default-Start:     2 3 4 5</span>
<span class="c1"># Default-Stop:      0 1 6</span>
<span class="c1"># Short-Description: spring-boot-config</span>
<span class="c1"># Description:       Demo project for Spring Boot configuration</span>
<span class="c1"># chkconfig:         2345 99 01</span>
<span class="c1">### END INIT INFO</span>

<span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$DEBUG</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">set</span> -x

<span class="c1"># Initialize variables that cannot be provided by a .conf file</span>
<span class="nv">WORKING_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="c1"># shellcheck disable=SC2153</span>
<span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$JARFILE</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">jarfile</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$JARFILE</span><span class="s2">&quot;</span>
<span class="o">[[</span> -n <span class="s2">&quot;</span><span class="nv">$APP_NAME</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nv">identity</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$APP_NAME</span><span class="s2">&quot;</span>

...
</pre></div>
<p>One thing that may seem puzzling at first is that if make this jar executable
and try to run it you&#8217;ll see that, instead of offering you the well known
options of the init scripts (Usage &#8230; start/stop/restart etc)  it will immediatelly
run the application! This is because the embedded script is smart enough to
check that it will be executed as an init script only when it is executed
as a link from <tt class="docutils literal">/etc/init.d</tt> - else it will immediately run the&nbsp;application.</p>
<p>If
you want to quickly test that behavior, you may override the <tt class="docutils literal"><span class="caps">MODE</span></tt> parameter
which forces the mode of operation of the jar. If you want to run it as a
script (without using a links from /etc/ini.d) then just set <tt class="docutils literal"><span class="caps">MODE</span>=service</tt>.
So, try&nbsp;runnin:</p>
<pre class="code literal-block">
&gt; MODE=service ./springapplication.jar
Usage: ./hsk9eea.jar {start|stop|restart|force-reload|status|run}
</pre>
<p>Success! Of course, this is just for testing purposes, to actually deploy
your application then please create a link to it from <tt class="docutils literal">/etc/init.d</tt> as
proposed by the Spring Boot&nbsp;docs.</p>
<p>If you want to <a class="reference external" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#deployment-script-customization">customize the init.d script</a>  you can use a file named
<tt class="docutils literal">sprinbootapp.conf</tt> in the same directory as your <tt class="docutils literal">springbootapp.jar</tt>
(i.e it should have the same name as your jar with an extension of .conf). The
options from it will be sourced before running your application &#8212; for example
you could set the active profile using <tt class="docutils literal">RUN_ARGS</tt>, however as I already
recommended, explicitly setting it to a file named <tt class="docutils literal">config/applications.properties</tt>
is&nbsp;preferrable.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id11">Conclusion</a></h2>
<p>Using the described file structure you should be able to fully configure Spring Boot and have all the
goodies you&#8217;d expect from a modern framework: global settings, profiles, non-version control settings! Also, using the
advanced profiles techniques (multiple profiles, profile enabled
&#64;Components and &#64;Configurations) you&#8217;ll be able to implement
some really complex configurations! Finally, you&#8217;ll be able to really
quickly deploy the resulting jar as an init.d system&nbsp;service!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2016/03/02/react-redux-tutorial/">A comprehensive react-redux tutorial</a>
      </h1>
    <p class="meta">
<time datetime="2016-03-02T11:20:00+02:00" pubdate>Τετ 02 Μάρτιος 2016</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#introduction-to-redux" id="id3">Introduction to redux</a><ul>
<li><a class="reference internal" href="#a-simple-example" id="id4">A simple&nbsp;example</a></li>
<li><a class="reference internal" href="#interlude-so-what-s-a-reducer" id="id5">Interlude: So what&#8217;s a&nbsp;reducer?</a></li>
<li><a class="reference internal" href="#what-about-react-redux" id="id6">What about&nbsp;react-redux?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#our-project" id="id7">Our project</a><ul>
<li><a class="reference internal" href="#other-libraries-used" id="id8">Other libraries&nbsp;used</a></li>
<li><a class="reference internal" href="#redux-thunk" id="id9">redux-thunk?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#explaining-the-application" id="id10">Explaining the application</a><ul>
<li><a class="reference internal" href="#main-js" id="id11">main.js</a></li>
<li><a class="reference internal" href="#store-js" id="id12">store.js</a><ul>
<li><a class="reference internal" href="#interlude-combining-reducers" id="id13">Interlude: Combining&nbsp;reducers</a></li>
<li><a class="reference internal" href="#interlude-middlewares" id="id14">Interlude:&nbsp;Middlewares</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reducers-js" id="id15">reducers.js</a><ul>
<li><a class="reference internal" href="#the-global-state-tree" id="id16">The global state&nbsp;tree</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actions-js" id="id17">actions.js</a></li>
<li><a class="reference internal" href="#components-app-js" id="id18">components/app.js</a><ul>
<li><a class="reference internal" href="#components-notification-js" id="id19">components/notification.js</a></li>
<li><a class="reference internal" href="#creating-a-re-usable-notification" id="id20">Creating a re-usable&nbsp;notification</a></li>
<li><a class="reference internal" href="#components-loading-js" id="id21">components/loading.js</a></li>
<li><a class="reference internal" href="#components-statpanel-js" id="id22">components/StatPanel.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components-bookpanel-js" id="id23">components/BookPanel.js</a><ul>
<li><a class="reference internal" href="#components-booksearchpanel-js" id="id24">components/BookSearchPanel.js</a></li>
<li><a class="reference internal" href="#components-table-js" id="id25">components/Table.js</a></li>
<li><a class="reference internal" href="#components-pagingpanel-js" id="id26">components/PagingPanel.js</a></li>
<li><a class="reference internal" href="#interlude-a-more-functional-component" id="id27">Interlude: A more functional&nbsp;component</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components-bookform" id="id28">components/BookForm</a><ul>
<li><a class="reference internal" href="#components-input" id="id29">components/Input</a></li>
<li><a class="reference internal" href="#components-select" id="id30">components/Select</a></li>
<li><a class="reference internal" href="#components-datepicker" id="id31">components/DatePicker</a></li>
<li><a class="reference internal" href="#should-i-create-my-own-input-components" id="id32">Should I create my own input&nbsp;components?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components-authorpanel" id="id33">components/AuthorPanel</a></li>
<li><a class="reference internal" href="#components-authorform" id="id34">components/AuthorForm</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changing-the-ui-when-the-data-is-changed" id="id35">Changing the <span class="caps">UI</span> when the data is&nbsp;changed</a></li>
<li><a class="reference internal" href="#conclusion" id="id36">Conclusion</a></li>
</ul>
</div>
<p><strong>Update 10/05/2016</strong>: Add a section on how to update the <span class="caps">UI</span> when the data in the database is changed without using the <span class="caps">UI</span>.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a></h2>
<p>Continuing the series of React-related articles, we&#8217;ll try to make a comprehensive
tutorial to the <a class="reference external" href="https://github.com/rackt/redux">redux</a> framework and its integrations with React, using the
<a class="reference external" href="https://github.com/rackt/react-redux">react-redux</a> library. Redux can be used as an alternative to Flux
(which we discussed in <a class="reference external" href="https://spapas.github.io/2015/07/02/comprehensive-react-flux-tutorial-2/">a previous article</a>)
to orchestrate the message passing between&nbsp;ui/components/data.</p>
<p>This tutorial will also produce as a result an opinionated (my opinion) boilerplate
project for creating react-redux Single Page Applications. I have used Django
as the back end however you could use any server-side framework you like,
Django is only used for implementing a bunch of <span class="caps">REST</span> APIs through django-rest-framework.
You may replace it with any other <span class="caps">REST</span> framework you&nbsp;like.</p>
<p>I have also used <tt class="docutils literal">browserify</tt> to pack the client-side code &#8212; I prefer it
from webpack as I find it much easier, clear and less-magical, and, since
it fills all my needs I don&#8217;t see any reason to take the webpack&nbsp;pill.</p>
<p>All client side code is written in <span class="caps">ES6</span> javascript using the latest trends &#8212; I will
try to explain anything I feel that is not very&nbsp;clear.</p>
<p>Before continuing, I have to mention that although I will provide an
(as comprehensive as possible) introduction to redux,
I will concentrate on the correct integration between redux, react-redux and
React in a complex, production level application. I&#8217;ll try to explain everything
I talk about, however, before reading the rest of
this article I recommend reading the introduction and basics sections
of <a class="reference external" href="http://rackt.org/redux/index.html">redux documentation</a> and watching the <a class="reference external" href="https://egghead.io/series/getting-started-with-redux">getting started with redux</a> from the
creator of redux &#8212; I can&#8217;t recommend the videos enough, they are really&nbsp;great!</p>
<p>One final thing: This is a <em>really long</em> article (more than 100 kb). It will
require a lot of time to read and understand it, especially if you are not
familiar with the concepts described here. Please take your time when reading
it and try verifying what I say here through the project that accompanies
this article &#64; <a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>, tag <tt class="docutils literal"><span class="pre">react-redux</span></tt>.</p>
</div>
<div class="section" id="introduction-to-redux">
<h2><a class="toc-backref" href="#id3">Introduction to&nbsp;redux</a></h2>
<p>I have to say that I got interested in redux because of all that buzz this
framework generated. However, I got really interested in it when I
understood how close its philosophy was to functional programming -
this, when combined with the usage of react functional components will
enable you to write great code <em>and</em> (most important for me) really
enjoy coding with it (if you like functional programming of course :)&nbsp;)</p>
<p>Redux is simpler, having fewer and less complex concepts than the original Flux
implementation and more opinionated - this is a good&nbsp;thing!</p>
<p>Here are the basic building blocks of&nbsp;redux:</p>
<ul class="simple">
<li>One (and only one) <strong>state</strong>: It is an object that keeps the <em>global</em> state of your application. Everything has to be in that object, both data and&nbsp;ui.</li>
<li>A bunch of <strong>actions</strong>: These are simple objects that are created/dispatched when something happens (ui interaction, server response etc) with a mandatory property (their type) and a number of optional properties that define the data that accompanies each&nbsp;action.</li>
<li>A bunch of <strong>action creators</strong>: These are very simple functions that create action objects. Usually, there are as many action creators as actions (unless you use redux-thunk, we&#8217;ll talk about it&nbsp;later).</li>
<li>One (and only one) <strong>reducer</strong>: It is a function that retrieves the current state and an action and creates the resulting state. This is the central component of a redux application - every action along with the current state will be passed to the reducer and the state of the application will be the resulting, new&nbsp;state.</li>
<li>One (and only one) <strong>store</strong>: It is an object that is created by redux and is used as a glue between the state, the reducer and the&nbsp;components</li>
</ul>
<p>The general idea/flow&nbsp;is:</p>
<ul class="simple">
<li>Something (let&#8217;s call it event) happens (i.e a user clicks a button, a timeout is fired, an ajax request&nbsp;responds)</li>
<li>An action describing that event is created by its the corresponding action creator and dispatched (i.e passed to the reducer along with the current state) through the&nbsp;store</li>
<li>The dispach calls the reducer with the current state object and the action as&nbsp;parameters</li>
<li>The reducer checks the type of the action and, depending on the action type and any other properties this action has, creates a new state&nbsp;object</li>
<li>The store applies the new state to all&nbsp;components</li>
</ul>
<p>One thing we can see from the above is that redux is not react-only (although its general architecture is a perfect fit to react) but
could be also used with different view frameworks, or even with <em>no view framework</em>!</p>
<div class="section" id="a-simple-example">
<h3><a class="toc-backref" href="#id4">A simple&nbsp;example</a></h3>
<p>I&#8217;ve implemented a very simple redux example &#64; jsfiddle that increases and decreases
a number using two buttons to support the&nbsp;above:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="http://jsfiddle.net/8aba3sp6/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>Its html&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;state_container&#39;</span><span class="p">&gt;</span>0<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#39;increase()&#39;</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&#39;decrease()&#39;</span><span class="p">&gt;</span>-<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</pre></div>
<p>while its javascript (es6) code&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;INCREASE&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="nx">state</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">case</span> <span class="s1">&#39;DECREASE&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="nx">state</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">default</span><span class="o">:</span> <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">let</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">Redux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>
<span class="kd">let</span> <span class="nx">unsubscribe</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="p">=&gt;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;state_container&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">()</span>
<span class="p">)</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">increase</span> <span class="o">=</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;INCREASE&#39;</span>
<span class="p">})</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">decrease</span> <span class="o">=</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;DECREASE&#39;</span>
<span class="p">})</span>
</pre></div>
<p>The <span class="caps">HTML</span> just displays a div which keeps the current number value
and two buttons that call the increase and decrease&nbsp;functions.</p>
<p>Now, for the javascript, we create a reducer function that
gets the previous state value (which initially is the number 0) and the
action that is dispatched. When the reducer is called it will check if the action type is &#8216;<span class="caps">INCREASE</span>&#8217;
or &#8216;<span class="caps">DECREASE</span>&#8217; and correspondigly increase or decreases the state,
which is just that number. Normally, the state will be a (rather fat)&nbsp;object.</p>
<p>We then create a store which gets the reducer as its only parameter
then and call its subscribe method passing a callback. This callback will be
called whenever the state is changed - in our case, the callback just updates
the div with the current number from the state. Finally, the increase
and decrease methods that are called when the butts are clicked
will just dispatch the corresponding&nbsp;action.</p>
<p>Please notice that in the above example I didn&#8217;t use action creators for
simplicity. For completeness, the action creator for increase would be something&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">increaseCreator</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;INCREASE&#39;</span>
<span class="p">}</span>
</pre></div>
<p>i.e it would just return an <tt class="docutils literal"><span class="caps">INCREASE</span></tt> action and <tt class="docutils literal">window.increase</tt>
would be <tt class="docutils literal">window.increase = e =&gt; <span class="pre">store.dispatch(increaseCreator())</span></tt>. Notice that
the <tt class="docutils literal">increaseCreator</tt> is called (has <tt class="docutils literal">()</tt>) so that <tt class="docutils literal">dispatch</tt> will receive the
resulting action object as a&nbsp;parameter.</p>
<p>The flow of the data when the increase button is clicked is the&nbsp;following:</p>
<ul class="simple">
<li><tt class="docutils literal">button.onClick</tt></li>
<li><tt class="docutils literal">increase()</tt></li>
<li><tt class="docutils literal">increaseCreator()</tt> (if we used action creators - this a param to <tt class="docutils literal">dispatch</tt> so it will be called&nbsp;first)</li>
<li><tt class="docutils literal"><span class="pre">store.dispatch({type:</span> '<span class="caps">INCREASE</span>' })</tt></li>
<li><tt class="docutils literal">reducer(current_state, {type: <span class="pre">'<span class="caps">INCREASE</span>'})</span></tt></li>
<li>Reducer returns the new state (<tt class="docutils literal">state+1</tt>)</li>
<li><tt class="docutils literal">callback()</tt></li>
<li>value is&nbsp;updated</li>
</ul>
<p>Having one and only one store/state makes the flow of the data crystal and
resolves some of the dillemas I had when using the original Flux architecture!
Some people may argue that although a single reducer function is nice for
the above simple demo, having a huge (spaghetti-like) switch statement in
your reducer is not a very good practice - thankfully redux has a bunch
of tools that will presented later and greatly help on this (seperating the
reducing logic, using different modules for each module&nbsp;etc).</p>
</div>
<div class="section" id="interlude-so-what-s-a-reducer">
<h3><a class="toc-backref" href="#id5">Interlude: So what&#8217;s a&nbsp;reducer?</a></h3>
<p>I&#8217;d like to talk a bit about the &#8220;reducer&#8221;, mainly for people not familiar with
functional programming (although people writing Javascript <em>should</em> be familiar
with functional programming since Javascript has functional features) to clarify
my statement above that the redux philosophy is close to functional&nbsp;programming.</p>
<p>One basic concept of functional programming is the concept of
&#8220;map-reduce&#8221;. Mapping means calling a function (let&#8217;s call it mapper)
for all elements of a list and creating a new list with the output of each
individual call. So, a mapper gets only one parameter, the current value of
the list. For example the &#8220;double&#8221; mapper, defined like
<tt class="docutils literal">let double = x =&gt; x*2</tt> would &#8220;map&#8221; the list <tt class="docutils literal">[1,2,3]</tt> to <tt class="docutils literal">[2,4,6]</tt>.</p>
<p>Reducing means calling a function (let&#8217;s call it <em>reducer</em>) for all elements
of a list and creating a single value that accumulates the result of each
individual call. This can be done because the reducer gets <em>two</em> parameters,
the accumulated value of the list until this point and the current value of the list.
Also, when doing a reduce we need to define a starting value for the accumulator.
For example, the &#8220;sum&#8221; reducer, defined like <tt class="docutils literal">let sum = (s=0, x) =&gt; s+x</tt>,
(which has an initial value of 0), would &#8220;reduce&#8221; the list <tt class="docutils literal">[1,2,3]</tt> to <tt class="docutils literal">6</tt> by calling
the <tt class="docutils literal">sum</tt> reducer three&nbsp;times:</p>
<div class="highlight"><pre><span></span><span class="nx">tmp1</span> <span class="o">=</span> <span class="nx">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// tmp1 = 1</span>
<span class="nx">tmp2</span> <span class="o">=</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">tmp1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// tmp2 = 3</span>
<span class="nx">result</span> <span class="o">=</span> <span class="nx">sum</span><span class="p">(</span><span class="nx">tmp2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// result = 6</span>
</pre></div>
<p>So, a redux reducer is <em>actually</em> a (rather complex) functional reducer, getting the current
state (as the accumulated value) and each individual action as the value and
returning the new state which is the result of applying this action to the&nbsp;state!</p>
<p>Three extra things to make sure about your redux reducers are&nbsp;that:</p>
<ul class="simple">
<li>they should have an initial value (with the initial state of the application) or know how to handle an undefined initial&nbsp;state</li>
<li>they must not not mutate (change) the state object but instead create and return a new one (not allowing object mutations is a general practice in functional programming but in redux also helps to quickly apply the changes to the&nbsp;components)</li>
<li>always return a valid state as a result (or else the application will have invalid&nbsp;state)</li>
</ul>
</div>
<div class="section" id="what-about-react-redux">
<h3><a class="toc-backref" href="#id6">What about&nbsp;react-redux?</a></h3>
<p>React-redux is a rather simple framework that offers two helpful utilities for integrating
redux with&nbsp;React:</p>
<ul class="simple">
<li>A <tt class="docutils literal">connect</tt> function that &#8220;connects&#8221; React components to the redux store. This function (among others) retrieves a callback parameter that defines properties that will be passed to that component and each one will be (magically) mapped to state&nbsp;properties.</li>
<li>A <tt class="docutils literal">Provider</tt> component. This is a parent component that can be used to (magically) pass the store properties to its children&nbsp;components.</li>
</ul>
<p>Please notice that nothing actually magical happens when the store properties are passed to the children
components through <tt class="docutils literal">connect</tt> and <tt class="docutils literal">Provider</tt>! this is accomplished through the <a class="reference external" href="https://facebook.github.io/react/docs/context.html">react context</a> feature
that allows you to &#8220;pass data through the component tree without having to pass the props down manually
at every level&#8221;. So <tt class="docutils literal"><span class="pre">connect``ed</span> components used context to retrieve the store properties that
have been passed to the context by the ``Provider</tt>.</p>
<p>How react-redux is used be made more clear with another jsfiddle that will convert the previous example to React and&nbsp;react-redux:</p>
<div class="jsfiddle"><iframe width="100%" height="300" src="http://jsfiddle.net/8aba3sp6/2/embedded/js,resources,html,css,result/light/" allowfullscreen="allowfullscreen" frameborder="0"></iframe></div><p>The html is just <tt class="docutils literal">&lt;div <span class="pre">id='container'&gt;&lt;/div&gt;</span></tt> since the components will
be rendered through react, while the es6/jsx code&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;INCREASE&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="nx">state</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">case</span> <span class="s1">&#39;DECREASE&#39;</span><span class="o">:</span> <span class="k">return</span> <span class="nx">state</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">default</span><span class="o">:</span> <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">Redux</span><span class="p">.</span><span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">RootComponent</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="p">{</span><span class="nx">number</span><span class="p">,</span> <span class="nx">increase</span><span class="p">,</span> <span class="nx">decrease</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">number</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nx">increase</span><span class="p">()}</span><span class="o">&gt;+&lt;</span><span class="err">/button&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nx">decrease</span><span class="p">()}</span><span class="o">&gt;</span> <span class="o">-</span> <span class="o">&lt;</span><span class="err">/button&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">({</span>
  <span class="nx">number</span><span class="o">:</span> <span class="nx">state</span>
<span class="p">})</span>

<span class="kd">let</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="p">=&gt;</span> <span class="p">({</span>
  <span class="nx">increase</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;INCREASE&#39;</span><span class="p">}),</span>
  <span class="nx">decrease</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;DECREASE&#39;</span><span class="p">})</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">ConnectedRootComponent</span> <span class="o">=</span> <span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span>
    <span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">RootComponent</span><span class="p">)</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">ReactRedux</span><span class="p">.</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">ConnectedRootComponent</span> <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/ReactRedux.Provider&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
<p>As we can see, the reducer and store are the same as the non-react version. What is new
here is that I&#8217;ve added a React <tt class="docutils literal">RootComponent</tt> that has two properties, one named <tt class="docutils literal">number</tt>
and one named <tt class="docutils literal">dispatch</tt> that can be used to dispatch an action through the&nbsp;store.</p>
<p>Using react-redux&#8217;s <tt class="docutils literal">connect</tt> function we create a new component, <tt class="docutils literal">ConnnectedRootComponent</tt>
which is a new component with the redux-enabled functionality (i.e it will have access to
store). The <tt class="docutils literal">connect()</tt> function takes
a bunch of optional arguments. I won&#8217;t go into much detail since its a little complex
(the <a class="reference external" href="https://github.com/rackt/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options">react-redux documentation</a> is clear enough), however in our example we have defined
two objects named <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt>
which are passed to <tt class="docutils literal">connect</tt> and define how the state and the dispatch are mapped to
the properties the connected component will&nbsp;have.</p>
<p>The <tt class="docutils literal">mapStateToProps</tt> is a function that will be called whenever the store&#8217;s state
changes and should return an object whose attributes will be passed to the connected component
as properties. In our example,
we return an object with a number attribute having the current state
(which don&#8217;t forget that is just a number) as its value -
that&#8217;s why we can extract the <tt class="docutils literal">number</tt> attribute from <tt class="docutils literal">this.props</tt> when&nbsp;rendering.</p>
<p>The <tt class="docutils literal">mapDispatchToProps</tt> as we use it, once again returns an object
whose attributes will be passed to the connected component and will dispatch
actions when&nbsp;called.</p>
<p>Of course, in order for
the <tt class="docutils literal">ConnectedRootComponent</tt> to <em>actually</em> have these properties that we passed through <tt class="docutils literal">connect</tt>,
it must
be enclosed in a <tt class="docutils literal">&lt;Provider&gt;</tt> parent component (so that the correct react context will be initialized).
Notice that this is recursive so if we had&nbsp;something</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">Provider</span> <span class="na">store</span><span class="o">=</span><span class="s">{store}</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Component1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">Component2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ConnectedComponent</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">ConnectedComponent</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Component2</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">Component1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">Provider</span><span class="p">&gt;</span>
</pre></div>
<p>the <tt class="docutils literal">&lt;ConnectedComponent&gt;</tt> would still get the props (dispatch + state slice) we mentioned above
even if its parent components were not&nbsp;connected.</p>
<p>Although we could have avoided using react-redux  by passing the store directly
to <tt class="docutils literal">&lt;RootComponent&gt;</tt> and subscibing to the store changes from the <tt class="docutils literal">RootComponent</tt>&#8216;s <tt class="docutils literal">componentWillMount</tt> method,
the added-value of react-redux is that using <tt class="docutils literal">connect</tt> and <tt class="docutils literal">Provider</tt> we could pass dispatch and
state slices deep inside our component hierarchy without the need to explicitly pass the store
to each individual component and also that react-redux will make optimizations so that the
each connected component will be re-rendered only when needed (depending on the state slice it uses)
and not for every state change. Please be warned that this does not mean that you should connect everything
so that everything will have access to the global state and be able to dispatch actions. You should be very
careful to connect only the components that really need to be connected (redux calls them container components)
and pass dispatch and state as
properties to their children (which are called presentational components). Also, each connected component should receive only
the part of the global state it
needs and not everything (so that each particular component will update only when needed and not for
every state update). The above is absolutely necessary if you want to crate re-usable (<span class="caps">DRY</span>) and
easily testable components. I&#8217;ll discuss this a little more when
describing the sample&nbsp;project.</p>
<p>Finally, notice how easy it is to create reusable container
components using <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt>:
Both the way the component gets its state and calls its actions are
defined through these two objects so you can create
as many connected objects as you want by passing different
<tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt> - more on this&nbsp;later.</p>
</div>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#id7">Our&nbsp;project</a></h2>
<p>After this rather lengthy introduction to redux and react-redux we may move on to our
project. First of all, let&#8217;s see an example of what we&#8217;ll actually build&nbsp;here:</p>
<img alt="Our project" src="/images/demo3.gif" style="width: 600px;" />
<p>This is a single-page application that supports client side routing and
has four different routes: A books list, an authors list, a book editing/create
form and an author editing/create form.
The books list supports searching (with the filter field),
pagination (with 5 books per page) and per-column sorting when
clicking the column name (ascending/descending). The book form
supports validation (on the book title), cascading drop downs
(changing category limits the subcategory choices) and a
jquery ui datepicker to select the book publish date. Also,
you can delete books or authors from their corresponding
form. Notice that there&#8217;s a statistics panel showing the current
number of authors and books. A nice loading spinner
will be displayed when asynchronous ajax actions are executed
and a snackbar notification will be shown when such an action
is executed. Finally, although you won&#8217;t be able to see it,
the url of the application is changed according to the choices
the user&nbsp;makes.</p>
<div class="section" id="other-libraries-used">
<h3><a class="toc-backref" href="#id8">Other libraries&nbsp;used</a></h3>
<p>React (and redux) have a big ecosystem of great libraries. Some of these have been used
for this project and will also be discussed in this&nbsp;article:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/gaearon/redux-thunk">redux-thunk</a>: This is a nice add-on for redux that generalizes action&nbsp;creators.</li>
<li><a class="reference external" href="https://github.com/erikras/redux-form">redux-form</a>: A better way to use forms with react and redux. Always use it if you have non-trivial&nbsp;forms.</li>
<li><a class="reference external" href="https://github.com/rackt/react-router">react-router</a>: A library to create routes for single page applications with&nbsp;React.</li>
<li><a class="reference external" href="https://github.com/rackt/react-router-redux">react-router-redux</a> (ex redux-simple-router): This library will help integrating react-router with&nbsp;redux.</li>
<li><a class="reference external" href="https://github.com/rackt/history">history</a>: This is used bt react-router to crete the page history (so that back forward etc&nbsp;work).</li>
<li><a class="reference external" href="https://github.com/pburtchaell/react-notification">react-notification</a>: A simple react component to display&nbsp;notifications.</li>
</ul>
<p>The triplet react-router, react-router-redux and history needs to be used for projects that
enable client side routing. The redux-form is really useful if you have non-trivial forms
in your projects - you may skip it if you don&#8217;t use forms or for example you use a form for
searching/filtering with a single input. react-notification just displays notifications,
you can easily exchange it with other similar components or create your&nbsp;own.</p>
</div>
<div class="section" id="redux-thunk">
<h3><a class="toc-backref" href="#id9">redux-thunk?</a></h3>
<p>Now, about redux-thunk. I won&#8217;t go into much detail here, you can read more about it in this <a class="reference external" href="http://stackoverflow.com/a/35415559/119071">great <span class="caps">SO</span> answer</a>,
however I&#8217;d like to point out here that <strong>everything that can be done with redux-thunk
can also be done without it</strong> so you may safely skip it if you feel that you don&#8217;t really
need it in your&nbsp;project.</p>
<p>But what does it do? Well, redux-thunk allows you to create action creators that don&#8217;t only return
action objects but can do various other things, like calling other actions or
dispatching actions conditionally. When using redux-thunk, an action returns a function
that can do any of the above mentioned things, something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">thunkAction</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// here you may</span>
    <span class="c1">// dispatch other actions (more than one) using the provided dispatch() parameter</span>
    <span class="c1">// or</span>
    <span class="c1">// check the current state using the getState() parameter and do conditional dispatches</span>
    <span class="c1">// or</span>
    <span class="c1">// call functions asynchronously so that these will use the provided</span>
    <span class="c1">// dispatch function when they return</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Let&#8217;s say that we wanted to implement an asynchronous, ajax call.
If we don&#8217;t want to use redux thunk,
then we need to create a normal function that gets <tt class="docutils literal">dispatch</tt> as an argument, something
like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="p">{</span><span class="nx">showLoadingAction</span><span class="p">,</span> <span class="nx">hideLoadingAction</span><span class="p">,</span> <span class="nx">showDataAction</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./actions&#39;</span>

<span class="kr">const</span> <span class="nx">getData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showLoadingAction</span><span class="p">())</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">data_url</span><span class="p">,</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">hideLoadingAction</span><span class="p">())</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showDataAction</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>
<p>The main problem with this approach is that the getData functions <em>is not</em>
called like a normal
action creator (like <tt class="docutils literal">showLoadingAction</tt>, <tt class="docutils literal">hideLoadingAction</tt> and <tt class="docutils literal">showDataAction</tt>)
since it actually returns nothing (so nothing will be dispatched),
so you&#8217;ll need to remember to call it directly
and pass it the <tt class="docutils literal">dispatch</tt> <em>instead of</em> passing its return value to <tt class="docutils literal">dispatch</tt>!</p>
<p>If however we used thunk, then we&#8217;d have something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">getDataThunk</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showLoadingAction</span><span class="p">())</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">data_url</span><span class="p">,</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">hideLoadingAction</span><span class="p">())</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showDataAction</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Now, the above can be used like a normal action (i.e it can be called using <tt class="docutils literal"><span class="pre">dispatch(getDataThunk())</span></tt>).
That&#8217;s more or less the main advantage of redux-thunk: You are able to create thunk action creators that
can be called like normal actions and can do more complex things than just returning action objects
so you don&#8217;t have to remember how to call each&nbsp;function.</p>
<p>I have to repeat
again that everything that you be done with thunk action creators, can also be done with normal functions
that get <tt class="docutils literal">dispatch</tt> as a paremeter - the advantage of thunk action creators is that you don&#8217;t need to
remember if an action creator needs to be called through <tt class="docutils literal"><span class="pre">disaptch(actionCreator())</span></tt>
or <tt class="docutils literal">actionCreator(dispatch)</tt>.</p>
<p>In this tutorial you&#8217;ll see heavy use of redux-thunk. This is just my personal preference - you may
use it less or not at all (however, if you&#8217;ve configured your project to use redux-thunk then I propose
to go all the way and use it all the time for those more complex action&nbsp;creators).</p>
</div>
</div>
<div class="section" id="explaining-the-application">
<h2><a class="toc-backref" href="#id10">Explaining the&nbsp;application</a></h2>
<p>In the following paragraphs we&#8217;ll see together the structure and source code of
this application. I&#8217;ll try to go into as much detail as possible in order to solve
any questions you may have (I know I had many when I tried setting up everything for
the first time). I&#8217;ll skip imports and non-interesting components - after all the
complete source code can be found &#64; <a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>,
checkout the tag <tt class="docutils literal"><span class="pre">react-redux</span></tt>.
We&#8217;ll use a top down approach, starting from the main component where the
client side routing
is defined and the application is mounted to the <span class="caps">DOM</span>:</p>
<div class="section" id="main-js">
<h3><a class="toc-backref" href="#id11">main.js</a></h3>
<p>This module is used as an entry point for browserify (i.e we call browserify with
<tt class="docutils literal">browserify main.js <span class="pre">-o</span> bundle.js</tt> ) and uses components defined elsewhere to
create the basic structure of our application. Let&#8217;s take a look at the important
part of&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">About</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">About</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
        <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">Home</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">}</span>

<span class="nx">render</span><span class="p">((</span>
    <span class="o">&lt;</span><span class="nx">Provider</span> <span class="nx">store</span><span class="o">=</span><span class="p">{</span><span class="nx">store</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Router</span> <span class="nx">history</span><span class="o">=</span><span class="p">{</span><span class="nx">history</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">App</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">IndexRoute</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">BookPanel</span><span class="p">}</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/book_create/&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">BookForm</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/book_update/:id&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">BookForm</span><span class="p">}</span> <span class="o">/&gt;</span>

                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/authors/&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AuthorPanel</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/author_create/&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AuthorForm</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/author_update/:id&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">AuthorForm</span><span class="p">}</span> <span class="o">/&gt;</span>

                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;/about&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">About</span><span class="p">}</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">path</span><span class="o">=</span><span class="s2">&quot;*&quot;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">NoMatch</span><span class="p">}</span><span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="err">/Route&gt;</span>
        <span class="o">&lt;</span><span class="err">/Router&gt;</span>
    <span class="o">&lt;</span><span class="err">/Provider&gt;</span>
  <span class="p">),</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
<p>We can see the well-known <tt class="docutils literal">render</tt> function from ReactDOM that gets a component
and a <span class="caps">DOM</span> element to mount it to. The domponent we provide to render is the <tt class="docutils literal">Provider</tt>
from react-redux we talked about before in order to enable all children components
to use <tt class="docutils literal">connect</tt> to have access to the store properties and dispatch. This is the usual
approact with react-redux: <em>The outer component will always be the&nbsp;&#8220;Provider&#8220;.</em></p>
<p>The <tt class="docutils literal">Provider</tt> component gets one parameter which is the store that redux will use. We
have initialized our store in a different module which I will present&nbsp;below.</p>
<p>Inside the <tt class="docutils literal">Provider</tt> we are defining a <tt class="docutils literal">Router</tt> from <tt class="docutils literal"><span class="pre">react-router</span></tt>. This should
be the parent component inside which all client-side routes of our appliccation are defined.
The <tt class="docutils literal">Router</tt> gets a <tt class="docutils literal">history</tt> parameter which is initialized elsewhere (stick with me
for now, I will talk about it&nbsp;later).</p>
<p>Now, inside <tt class="docutils literal">Router</tt> we are defining the actual routes of this application. As we
can see,
there&#8217;s a parent <tt class="docutils literal">Route</tt> that is connnected to the <tt class="docutils literal">App</tt> component which actually
contains everything else. The parent route contains an <tt class="docutils literal">IndexRoute</tt> whose corresponding
component (<tt class="docutils literal">BookPanel</tt>) is called
when no route is defined and a bunch of normal <tt class="docutils literal">Route</tt> components whose
components are called when the url matches their part. Notice how we pass parameters
to urls (e.g <tt class="docutils literal"><span class="pre">/book_update/:id</span></tt>) and the match-all route
(<tt class="docutils literal">&lt;Route <span class="pre">path=&quot;*&quot;</span> <span class="pre">component={NoMatch}/&gt;</span></tt>).</p>
<p>Finally as an example of a routed-to component, notice the <tt class="docutils literal">About</tt> component
which is rendered when the route is <tt class="docutils literal">/about</tt>. This is just a normal react component that-
will be rendered <em>inside</em> the <tt class="docutils literal">App</tt> component -
the <tt class="docutils literal">Link</tt> is a <tt class="docutils literal"><span class="pre">react-router</span></tt> component that renders a link to a defined&nbsp;route.</p>
</div>
<div class="section" id="store-js">
<h3><a class="toc-backref" href="#id12">store.js</a></h3>
<p>The <tt class="docutils literal">store.js</tt> module contains the definition of the global store of our application
(which is passed to the <tt class="docutils literal">Provider</tt>).
Here, we also define the <tt class="docutils literal">history</tt> object we passed to the parent <tt class="docutils literal">Router</tt>.</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">reducer</span> <span class="nx">as</span> <span class="nx">formReducer</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;redux-form&#39;</span><span class="p">;</span>

<span class="kr">import</span> <span class="nx">createHistory</span> <span class="nx">from</span> <span class="s1">&#39;history/lib/createHashHistory&#39;</span>

<span class="c1">// Opt-out of persistent state, not recommended.</span>
<span class="c1">// https://github.com/reactjs/history/blob/master/docs/HashHistoryCaveats.md</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">createHistory</span><span class="p">({</span>
    <span class="nx">queryKey</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">});</span>
</pre></div>
<p>First of all, we see that our <tt class="docutils literal">history</tt> object is of type <tt class="docutils literal">HashHistory</tt>
(<a class="reference external" href="https://github.com/reactjs/react-router/blob/latest/docs/guides/Histories.md#hashhistory">more info about history types</a>) and I&#8217;ve also opted out of using
<tt class="docutils literal">queryKey</tt>. If I hadn&#8217;t used the <tt class="docutils literal">queryKey: false</tt> configuration
then there&#8217;d be a <tt class="docutils literal"><span class="pre">?_k=ckuvup</span></tt> query parameter in the <span class="caps">URL</span>. Now, this
parameter is actually useful (it stores location state <em>not</em> present
in the <span class="caps">URL</span> for example <span class="caps">POST</span> form data) but I don&#8217;t need it for this
example (and generally I prefer cleaner <span class="caps">URLS</span>) - but if you don&#8217;t like
the behavior of your history without it then go ahead and add&nbsp;it.</p>
<p>Also, notice that I&#8217;ve used <tt class="docutils literal">HashHistory</tt> which will append a <tt class="docutils literal">#</tt>
to the <span class="caps">URL</span> and the client-side <span class="caps">URL</span> will come after that, so all
URLs will be under (for example) <tt class="docutils literal">/index.html</tt> like <tt class="docutils literal"><span class="pre">/index.html#/authors</span></tt>.
The react-router
documentation recommends using <tt class="docutils literal">BrowserHistory</tt> which uses normal (clean)
urls &#8212; so instead of <tt class="docutils literal"><span class="pre">/index.html#/authors</span></tt> we&#8217;d see <tt class="docutils literal">/authors</tt> if we&#8217;d
used <tt class="docutils literal">BrowserHistory</tt>.</p>
<p>The problem with <tt class="docutils literal">BrowserHistory</tt> is that you&#8217;ll need to configure correctly
your <span class="caps">HTTP</span> server so that it will translate every <span class="caps">URL</span> (/foo) to the same
<span class="caps">URL</span> under <tt class="docutils literal">/index.html</tt> (<tt class="docutils literal"><span class="pre">/index.html#/foo</span></tt>) - as can be understood,
without that configuration the <span class="caps">HTTP</span> server doesn&#8217;t know anything about the
client side urls so when the webserver sees <tt class="docutils literal">/authors</tt> it will pass
<tt class="docutils literal">/authors</tt> to your server side framework (which will return a 404 error) - that&#8217;s
why this translation is&nbsp;needed.</p>
<p>However, in my case, I don&#8217;t think
that configuring your <span class="caps">HTTP</span> server to rewrite urls is worth the trouble and also I do really
prefer using <tt class="docutils literal">#</tt> for client-side urls! This is a common patter, recognised
by everybody and even without the <span class="caps">HTTP</span> server-configuration part I&#8217;d still
prefer <tt class="docutils literal">HashHistory</tt> over <tt class="docutils literal">BrowserHistory</tt> - of course this is just my opinion, feel free to use
<tt class="docutils literal">BrowserHistory</tt> if you don&#8217;t like the hash <tt class="docutils literal">#</tt>!</p>
<p>The next block of code from the <tt class="docutils literal">store</tt> module creates the
most important thing of a redux application, its reducer
along with the global&nbsp;store:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="p">{</span>
        <span class="nx">books</span><span class="p">,</span>
        <span class="nx">notification</span><span class="p">,</span>
        <span class="nx">ui</span><span class="p">,</span>
        <span class="nx">categories</span><span class="p">,</span>
        <span class="nx">authors</span><span class="p">,</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">routing</span><span class="o">:</span> <span class="nx">routeReducer</span>
    <span class="p">},</span> <span class="p">{</span>
        <span class="nx">form</span><span class="o">:</span> <span class="nx">formReducer</span>
    <span class="p">})</span>
<span class="p">)</span>

<span class="kr">const</span> <span class="nx">reduxRouterMiddleware</span> <span class="o">=</span> <span class="nx">syncHistory</span><span class="p">(</span><span class="nx">history</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">applyMiddleware</span><span class="p">(</span>
    <span class="nx">thunk</span><span class="p">,</span> <span class="nx">reduxRouterMiddleware</span>
<span class="p">));</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">store</span>
</pre></div>
<p>Please notice above that the <tt class="docutils literal">Object.assign</tt> method is used - I&#8217;ll talk about
it later &#8212;  however, another common <span class="caps">ES6</span> idiom that I&#8217;ve used here
is that when you define
an object you can change  <tt class="docutils literal">{ x: x }</tt> to <tt class="docutils literal">{ x }</tt> (so <tt class="docutils literal">{books}</tt>
means <tt class="docutils literal">{'books': books}</tt>).</p>
<p>The <tt class="docutils literal">combineReducers</tt> function is provided
by redux and is a helper function that helps you in &#8230; combining reducers!
As you see, I&#8217;ve combined the reducers defined in this application
<tt class="docutils literal">(books, notification, ui, categories, authors)</tt> with the reducers
of <tt class="docutils literal"><span class="pre">react-router-redux</span></tt> and <tt class="docutils literal"><span class="pre">redux-form</span></tt>
to create <em>the reducer</em>. We&#8217;ll talk a bit in the next
interlude on what does combining reducers&nbsp;is.</p>
<p>The <tt class="docutils literal">routeReducer</tt> and <tt class="docutils literal">formReducer</tt> reducers are provided by
react-router-redux and refux-form to properly handle the routing
and form-related&nbsp;actions.</p>
<p>The remaining of the code generates the <tt class="docutils literal">store</tt>: First of all, a middleware
(please see next-next interlude for more)
is created with <tt class="docutils literal">syncHistory</tt> that allows actions to call history methods
(so that when the <span class="caps">URL</span> is changed through actions they will be reflected to the
history). Then, the <tt class="docutils literal">createStoreWithMiddleware</tt> function is called to generate
the store that will be passed to the <tt class="docutils literal">Provider</tt>. This function takes the
reducer as a parameter along with any store enchancers that we&#8217;d like to
apply. A store enchancer is a function that modifies the store. The only
store enchanccer that we use now is the output of the
<tt class="docutils literal">applyMiddleware</tt> function that combines the two middlewares we&#8217;ve defined (one is for
redux thunk, the other is for <tt class="docutils literal">syncHistory</tt>). I know, your head hurts but
I&#8217;ll try to clear things out&nbsp;below.</p>
<div class="section" id="interlude-combining-reducers">
<h4><a class="toc-backref" href="#id13">Interlude: Combining&nbsp;reducers</a></h4>
<p>So, what does the <tt class="docutils literal">combineReducers</tt> function do? As we&#8217;ve already seen,
the reducer is a simple function that gets the current state and an
action as parameters and returns the next state (which is the result of applying
the action to the state). The reducer will have a big switch statement that
checks the type of the action and returns the correct new state. Unfortunately,
this switch statement may get way too fat and unmaintainable for large&nbsp;projects.</p>
<p>That&#8217;s where combining reducers comes to the rescue: Instead of having one big,
monolithic reducer for all the parts of our application state tree, we can break it to individual
reducers depending only on specific slices of the state object. What this means is
that if we have for example a state tree like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;data&#39;</span><span class="o">:</span> <span class="p">{},</span>
  <span class="s1">&#39;ui&#39;</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
<p>with actions that manipulate either data or ui, we could create two indivdual reducers,
one for the <tt class="docutils literal">data</tt> slice, and one for the <tt class="docutils literal">ui</tt> slice of the state tree. These reducers would get <em>only</em>
the slice of the state that they are interested in, so the <tt class="docutils literal">dataReducer</tt> will get
only the <tt class="docutils literal">data</tt> part of the state tree and the <tt class="docutils literal">uiReducer</tt> will get only the <tt class="docutils literal">ui</tt>
part of the state&nbsp;tree.</p>
<p>To <em>combine</em> these reducers the <tt class="docutils literal">combineReducers</tt> function is used. This function
gets an object with the name of the state part for each sub-reducer as attribute names
and that sub-reducer
as values and returns a reducer function that passes the action along with
the correct state slice to each of the sub-reducers and creates the global state object by
combining the output of each&nbsp;sub-reducer.</p>
<p>This may be clarified more with our own version of a combine reducers&nbsp;function:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">combineReducers2</span> <span class="o">=</span> <span class="nx">o</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">mapped</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span> <span class="p">=&gt;</span> <span class="p">(</span>
          <span class="p">{</span>
              <span class="nx">key</span><span class="o">:</span> <span class="nx">k</span><span class="p">,</span>
              <span class="nx">slice</span><span class="o">:</span> <span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="nx">state</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span> <span class="nx">action</span><span class="p">)</span> <span class="c1">// call k sub-reducer and get result</span>
          <span class="p">}</span>
      <span class="p">))</span>
      <span class="kr">const</span> <span class="nx">reduced</span> <span class="o">=</span> <span class="nx">mapped</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span> <span class="nx">x</span><span class="p">)=&gt;{</span>
          <span class="nx">s</span><span class="p">[</span><span class="nx">x</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]]</span><span class="o">=</span><span class="nx">x</span><span class="p">[</span><span class="s1">&#39;slice&#39;</span><span class="p">]</span>
          <span class="k">return</span> <span class="nx">s</span>
      <span class="p">},</span> <span class="p">{})</span>

      <span class="k">return</span> <span class="nx">reduced</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The above function gets an object (<tt class="docutils literal">o</tt>) with state slices and sub-reducers
as input and returns a function (that function is the resulting reducer)&nbsp;that:</p>
<ul class="simple">
<li>Creates an array (named <tt class="docutils literal">mapped</tt>) of objects with two attributes: <tt class="docutils literal">key</tt> for each attribute of <tt class="docutils literal">o</tt> and <tt class="docutils literal">slice</tt> after applying the sub-reducer to the corresponding state&nbsp;slice</li>
<li>Reduces and returns the above array (<tt class="docutils literal">reduced</tt>) to a single object that has attributes for each state slice and the resulting state slice as values (this is actually the global&nbsp;state)</li>
</ul>
<p>To show-off the <span class="caps">ES6</span> code (and my most sadistic tendencies),
the above code could be also writen like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">combineReducers3</span> <span class="o">=</span> <span class="nx">o</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">k</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="nx">k</span><span class="p">,</span> <span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">](</span><span class="nx">state</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span> <span class="nx">action</span><span class="p">)</span>
<span class="p">]).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="p">{</span>
    <span class="p">[</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">:</span> <span class="nx">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">}),</span> <span class="p">{})</span>
</pre></div>
<p>I wouldn&#8217;t like to explain this - its more or less a more functional version of <tt class="docutils literal">combineReducers2</tt>.</p>
</div>
<div class="section" id="interlude-middlewares">
<h4><a class="toc-backref" href="#id14">Interlude:&nbsp;Middlewares</a></h4>
<p>A redux middleware is <a class="reference external" href="http://redux.js.org/docs/advanced/Middleware.html">rather difficult to explain</a> technically but easier to explain
conceptually: What it does it that it can be used to extend the store&#8217;s dispatch by providing
extra functionality. We&#8217;ve already seen such functionality, the ability to use
thunk action creators (for action creators that don&#8217;t return the next state&nbsp;object).</p>
<p>If you take a look at the <tt class="docutils literal">createStore</tt> function, you&#8217;ll see that
its second parameter is called <tt class="docutils literal">enhancer</tt>. When <tt class="docutils literal">enhancer</tt>
is a function (like in our case where it is the
result of <tt class="docutils literal">applyMiddleware</tt>) the return value of <tt class="docutils literal">createStore</tt>
is <tt class="docutils literal"><span class="pre">enhancer(createStore(...))</span></tt> so it will call the result of <tt class="docutils literal">applyMiddleware</tt>
with the store as&nbsp;parameter.</p>
<p>Now, what does <tt class="docutils literal">applyMiddleware</tt>? It gets a variable
number of functions (using the spread <tt class="docutils literal">...</tt> operator) as input arguments (let&#8217;s call
them middlewares) and returns
<em>another</em> function (this is the <tt class="docutils literal">enhancer</tt> we mentioned in the previous paragraph)
that gets a store as an input and
returns the same store with its <tt class="docutils literal">dispatch</tt> method modified so that it will
call each middleware and pass the result to the next. So, in our case the
resulting store&#8217;s dispatch function would be something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">reduxRouterMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span><span class="p">)))</span>
</pre></div>
<p>Now, a middleware function looks like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">middleware</span> <span class="o">=</span> <span class="nx">store</span> <span class="p">=&gt;</span> <span class="nx">next</span> <span class="p">=&gt;</span> <span class="nx">action</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
<p>it returns a function that gets the <tt class="docutils literal">store</tt> as input
and returns another function. This returned function
gets <tt class="docutils literal">next</tt> as an input. What is next? It&#8217;s just the
next <tt class="docutils literal">dispatch</tt> function to be called. So the first middleware will have the original
store&#8217;s <tt class="docutils literal">dispatch</tt> as its <tt class="docutils literal">next</tt> parameter, the second middleware will have the
result of passing the store&#8217;s <tt class="docutils literal">dispatch</tt> from the first middleware, etc. Something like
this: <tt class="docutils literal">middleware2Dispatch(next=middleware1Dispatch(next=storeDispatch))</tt>.</p>
<p>Another
explanation of the above is that a&nbsp;middleware:</p>
<ul class="simple">
<li>is a function (that gets a store to enhance as input) that&nbsp;returns</li>
<li>another function (that gets the next dispatcher to be called as input) that&nbsp;returns</li>
<li>another function (that gets an action as input) which&nbsp;is</li>
<li>the dispatcher modified by this&nbsp;middleware</li>
</ul>
<p>Let&#8217;s take a look at the thunk middleware to actually see what it looks&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thunkMiddleware</span><span class="p">({</span> <span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span> <span class="p">})</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">next</span> <span class="p">=&gt;</span> <span class="nx">action</span> <span class="p">=&gt;</span>
    <span class="k">typeof</span> <span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">?</span>
      <span class="nx">action</span><span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="o">:</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<p>So, it gets the store (<tt class="docutils literal">dispatch</tt> and <tt class="docutils literal">getState</tt> are store attributes)
as an input and returns a function that gets <tt class="docutils literal">next</tt> (i.e
the next dispatcher to be called) as input. This function returns <em>another function</em>
(the modified <tt class="docutils literal">dispatch</tt>). Since this function is a dispatcher, it will get
an <tt class="docutils literal">action</tt> as an input and if that action
is a function it calls this function passing it dispatch (remember how we
said if we didn&#8217;t want to use thunk then we&#8217;d just create normal functions
to which we&#8217;d pass the dispatch as a parameter - that&#8217;s what it does here!).
If this action is not a function
(so it is a normal object) it just returns <tt class="docutils literal">dispatch(action)</tt> to dispatch&nbsp;it.</p>
<p>Finally, we&#8217;ll create a simple middleware that will output the action type and the
state for every&nbsp;dispatch:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">logStateMiddleware</span> <span class="o">=</span> <span class="p">({</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="nx">next</span> <span class="p">=&gt;</span> <span class="nx">action</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// log the action type</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">getState</span><span class="p">())</span>
  <span class="c1">// now we must call next(action) to propagate and finally dispatch the action object</span>
  <span class="nx">next</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>just put it in the applyMiddleware parameter list and observe all state&nbsp;changes!</p>
</div>
</div>
<div class="section" id="reducers-js">
<h3><a class="toc-backref" href="#id15">reducers.js</a></h3>
<p>This module contains the definition for our own defined sub-reducers that we combined
in the previous paragraph (<tt class="docutils literal">books, notification, ui, categories, authors</tt>) to create
the global reducer of the application. I&#8217;ve put everything in a single file, however
it is more common to create a <tt class="docutils literal">reducers</tt> directory and put every sub-reducer inside it
as a different module. Let&#8217;s start reviewing the code of the <tt class="docutils literal">reducers.js</tt> module:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">notification</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;SHOW_NOTIFICATION&#39;</span><span class="o">:</span>
            <span class="kd">let</span> <span class="p">{</span> <span class="nx">notification_type</span><span class="p">,</span> <span class="nx">message</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">action</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">message</span><span class="p">,</span>
                <span class="nx">notification_type</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="k">case</span> <span class="s1">&#39;CLEAR_NOTIFICATION&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="p">{}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>


<span class="kr">export</span> <span class="kr">const</span> <span class="nx">ui</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="p">{},</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;IS_LOADING&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">isLoading</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">isLoading</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;IS_SUBMITTING&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">isSubmitting</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">isSubmitting</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">notification</tt> and <cite>ui</cite> are two sub-reducers that control the state of the notification popup and if
the application is loading / is submitting. I won&#8217;t go into much detail about
them, they are really simple. However, notice that they both create a new state object
for each of their actions. To achieve this, the <tt class="docutils literal">Object.assign()</tt> method is used.
This method is defined like this:
<tt class="docutils literal">Object.assign(target, <span class="pre">...sources)</span></tt>. Its first parameter is an object (a new, empty object) while the rest
parameters (<tt class="docutils literal">sources</tt>) are other objects whose properties will be assigned <tt class="docutils literal">target</tt>. The rightmost members of
<tt class="docutils literal">sources</tt> overwrite the previous ones if they have the same names. So, for example the&nbsp;code</p>
<div class="highlight"><pre><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">rows</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">results</span><span class="p">,</span>
    <span class="nx">count</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">count</span><span class="p">,</span>
<span class="p">});</span>
</pre></div>
<p>creates a new object which will have all the properties of the current <tt class="docutils literal">state</tt> with the exception of the
<tt class="docutils literal">rows</tt> and <tt class="docutils literal">count</tt> attributes which will get their values from the <tt class="docutils literal">action</tt>. This is a common idiom in
redux and you are going to see it all the time so please make sure that you grok it before continuing. Also,
notice that the new state is a new, empty object in which
all the attributes of the new state are copied - this is because
the old state cannot be&nbsp;mutated.</p>
<p>Now we&#8217;ll see the reducer that handles books. Before understanding the actual reducer, I will present
the initial value of the books state&nbsp;slice:</p>
<div class="highlight"><pre><span></span><span class="c1">//http://stackoverflow.com/a/5158301/119071</span>
<span class="kd">function</span> <span class="nx">getParameterByName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;[?&amp;]&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;=([^&amp;]*)&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+/g</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">));</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">BOOKS_INITIAL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">rows</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">page</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">sorting</span><span class="o">:</span> <span class="nx">getParameterByName</span><span class="p">(</span><span class="s1">&#39;sorting&#39;</span><span class="p">),</span>
    <span class="nx">search</span><span class="o">:</span> <span class="nx">getParameterByName</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">),</span>
    <span class="nx">book</span><span class="o">:</span> <span class="p">{},</span>
<span class="p">}</span>
</pre></div>
<p>As we see, the <tt class="docutils literal">BOOK_INITIAL</tt>
constant is used to setup an initial state for the books slice of the global state. The <tt class="docutils literal">BOOKS_INITIAL</tt>
attributs&nbsp;are:</p>
<ul class="simple">
<li><tt class="docutils literal">rows</tt>: The rows of the book&nbsp;table</li>
<li><tt class="docutils literal">count</tt>: The number of rows that are&nbsp;displayed</li>
<li><tt class="docutils literal">page</tt>: The current page we are&nbsp;on</li>
<li><tt class="docutils literal">sorting</tt>: User-defined&nbsp;sorting</li>
<li><tt class="docutils literal">search</tt>: User-search /&nbsp;filtering</li>
<li><tt class="docutils literal">book</tt>: The data of the book to be&nbsp;edited/displayed</li>
</ul>
<p>The <tt class="docutils literal">BOOK_INITIAL</tt> constant
gets the <tt class="docutils literal">sorting</tt> and the <tt class="docutils literal">search</tt> initial values from the <span class="caps">URL</span> to allow these parameters
to be initialized from the <span class="caps">URL</span> (so that using a url like <tt class="docutils literal"><span class="pre">#?search=foo</span></tt> will show all books
containing <tt class="docutils literal">foo</tt>). To get the parameters from the <span class="caps">URL</span> I&#8217;m using the <tt class="docutils literal">getParameterByName</tt>
function. Now, the actual reducer&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">books</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="nx">BOOKS_INITIAL</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;SHOW_BOOKS&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">rows</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">results</span><span class="p">,</span>
                <span class="nx">count</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">count</span><span class="p">,</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;SHOW_BOOK&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">book</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">book</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;CHANGE_PAGE&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">page</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">page</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;TOGGLE_SORTING&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">sorting</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">sorting</span><span class="o">==</span><span class="nx">action</span><span class="p">.</span><span class="nx">sorting</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nx">action</span><span class="p">.</span><span class="nx">sorting</span><span class="p">)</span><span class="o">:</span><span class="nx">action</span><span class="p">.</span><span class="nx">sorting</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;CHANGE_SEARCH&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">search</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">search</span>
            <span class="p">});</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;ADD_BOOK&#39;</span><span class="o">:</span>
            <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">book</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
                <span class="nx">count</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                <span class="nx">rows</span><span class="o">:</span> <span class="p">[</span>
                    <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">,</span>
                    <span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">});</span>
        <span class="k">case</span> <span class="s1">&#39;UPDATE_BOOK&#39;</span><span class="o">:</span>
            <span class="nx">idx</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span> <span class="nx">r</span> <span class="p">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">idx</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">book</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">book</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">book</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
                    <span class="nx">rows</span><span class="o">:</span> <span class="p">[</span>
                        <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">idx</span><span class="p">),</span>
                        <span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
                        <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;DELETE_BOOK&#39;</span><span class="o">:</span>
            <span class="nx">idx</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span> <span class="nx">r</span> <span class="p">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">action</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">idx</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">book</span><span class="o">:</span> <span class="kc">undefined</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">state</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">book</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
                    <span class="nx">count</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="nx">rows</span><span class="o">:</span> <span class="p">[</span>
                        <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">idx</span><span class="p">),</span>
                        <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>The books subreducer handles the <tt class="docutils literal">SHOW_BOOKS, SHOW_BOOK, CHANGE_PAGE, TOGGLE_SORTING</tt> and <tt class="docutils literal">CHANGE_SEARCH</tt>
actions by retrieving the paramaters of these actions and returning a new books-state-slice object
with the correct parameters using <tt class="docutils literal">Object.assign</tt>.</p>
<p>The <tt class="docutils literal">ADD_BOOK</tt> action is a little more complicated: This action will be dispached when a new book is added with
the data of that new book as a parameter (<tt class="docutils literal">action.book</tt>). In order to make everything easier, I just append the new
book to the end of the books that are displayed on the
current page and increase the count number (I also set the new book to be the <tt class="docutils literal">book</tt> attribute
of the state). This means that the newly created book will not go to its correct place (based on the ordering) and
that the visible items will be more than the ajax page coun (also notice that if you add another book then the visible
items will also be increased by one more). This is not a problem (for me) since if the user changes page or does a search
everything will fall back to its place. However, if you don&#8217;t like it there are two solutions, one easier and one more&nbsp;difficult:</p>
<ul class="simple">
<li>Easier solution: When adding a book just <em>invalidate</em> (make undefined) the <tt class="docutils literal">books</tt> state attribute. This will result in an ajax call to reload the books and everything will be in place. However the user may not see the newly added book if it does not fall to the currently selected page (and there&#8217;d be an extra, unnecessary ajax&nbsp;call)</li>
<li>Harder solution: Depending on the sorting you may check if the current books should be displayed or not on the current page and push it to its correct place (and remove the last item of <tt class="docutils literal">rows</tt> so that count is not increased). Once again, the newly book may no be displayed at all if it does not belong to the visible&nbsp;page</li>
</ul>
<p>The <tt class="docutils literal">UPDATE_BOOK</tt> and <tt class="docutils literal">DELETE_BOOK</tt> actions are even more complex. I&#8217;ll only explain update, delete is more or less
the same (with the difference that update has the updated book as an action parameter while delete has only its id
as an acton parameter): First of all we check if the updated book is currently displayed (if one of the books of
<tt class="docutils literal">rows</tt> has the same <tt class="docutils literal">id</tt> as the updated book). If the book is not displayed then only the current edited book
is set to the new state. However, if it is displayed then it would need to be updated because the <tt class="docutils literal">rows</tt> array
does not know anything about the updated values of the&nbsp;book!</p>
<p>So, inside the <tt class="docutils literal">else</tt> branch, the <tt class="docutils literal">idx</tt> variable will hold its current index and the
<tt class="docutils literal">rows</tt> attribute of the new state will get the following&nbsp;value:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">idx</span><span class="p">),</span>
    <span class="nx">action</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
    <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
<p>The <tt class="docutils literal">...</tt> spread operator expands an array so, for example <tt class="docutils literal">[ <span class="pre">...[1,2,3]</span> ]</tt> would be like <tt class="docutils literal">[1,2,3]</tt>
and the <tt class="docutils literal">slice</tt> method gets two parameters and returns a copy of the array elements between them. Using
this knowledge, we can understand that the above code returns an array (<tt class="docutils literal">[]</tt>) that contains the books of
<tt class="docutils literal">rows</tt> from the first to the updated one (not including the updated one), the updated book
object (which we get
from <tt class="docutils literal">action</tt>) and the rest of the books of <tt class="docutils literal">rows</tt> (after the updated&nbsp;one).</p>
<p>The code for the <tt class="docutils literal">authors</tt> and <tt class="docutils literal">categories</tt> sub-reducers does not have any surprises so I won&#8217;t go
into detail about&nbsp;it.</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">AUTHORS_INITIAL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">authors</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="nx">AUTHORS_INITIAL</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">CATEGORIES_INITIAL</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">categories</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="o">=</span><span class="nx">CATEGORIES_INITIAL</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
<div class="section" id="the-global-state-tree">
<h4><a class="toc-backref" href="#id16">The global state&nbsp;tree</a></h4>
<p>Remember that all the above are sub-reducers, each one taking only a slice
of the global state tree. They are all combined, along with the routing and
form reducers to create the global reducer&nbsp;function.</p>
<p>This also means, that the global state object will be something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">books</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">notification</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">ui</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">categories</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">authors</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">routing</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">form</span><span class="o">:</span> <span class="p">{},</span>
<span class="p">}</span>
</pre></div>
<p>We won&#8217;t see this object anywhere because each sub-reducer will get its corresponding
slice of that&nbsp;object.</p>
</div>
</div>
<div class="section" id="actions-js">
<h3><a class="toc-backref" href="#id17">actions.js</a></h3>
<p>The <tt class="docutils literal">actions.js</tt> module should probably have been named <tt class="docutils literal">action_creators.js</tt> since
it actually contains redux action creators. Also, a common practice is create a folder
named <tt class="docutils literal">actions</tt> and put there individual modules that contain action creators for
the sub-reducers (in our case, for example there would be <tt class="docutils literal">books.js</tt>, <tt class="docutils literal">authors.s</tt> etc).</p>
<p>In any case, for simplicity I chose to just use a module named <tt class="docutils literal">actions.js</tt> and put
everything there. One important thing to keep in mind is that <tt class="docutils literal">actions.js</tt> contains both
normal action creators (i.e functions that return actions and should be &#8220;dispatched&#8221;)
<em>and</em> thunk action creators (i.e
functions that not necessarily return actions but can be &#8220;dispatcher&#8221;) - please see the
discussion about redux-thunk on a previous&nbsp;paragraph.</p>
<p>First of all, there&#8217;s a bunch of some simple action creators that just return
the corresponding action object with the correct parameters. Notice that
the action creators that end in <tt class="docutils literal">*Result</tt> are called when an
(async) ajax request returns, for example <tt class="docutils literal">showBooksResult</tt> will be
called when the book loading has returned and pass its result data to
the reducer. The other action creators change various parts of the state
object, for example <tt class="docutils literal">loadingChanged</tt> will create an action that when
dispatched it will set <tt class="docutils literal">ui.isLoading</tt> attribute
to the action&nbsp;parameter.</p>
<pre class="code literal-block">
showBooksResult(books) for &quot;SHOW_BOOKS&quot;,
showBookResult(book) for &quot;SHOW_BOOK&quot;,
addBookResult(book) for &quot;ADD_BOOK&quot;,
updateBookResult(book) for &quot;UPDATE_BOOK&quot;,
deleteBookResult(id) for &quot;DELETE_BOOK&quot;,

showAuthorsResult(authors) for &quot;SHOW_AUTHORS&quot;,
showAuthorResult(author) for &quot;SHOW_AUTHOR&quot;,
addAuthorResult(author) for &quot;ADD_AUTHOR&quot;,
updateAuthorResult(author) for &quot;UPDATE_AUTHOR&quot;,
deleteAuthorResult(id) &quot;DELETE_AUTHOR&quot;,

showCategoriesResult(categories) for &quot;SHOW_CATEGORIES&quot;,
showSubCategoriesResult(subcategories) for &quot;SHOW_SUBCATEGORIES&quot;,
loadingChanged(isLoading) for &quot;IS_LOADING&quot;,
submittingChanged(isSubmitting) for &quot;IS_SUBMITTING&quot;,
toggleSorting(sorting) for &quot;TOGGLE_SORTING&quot;,
changePage(page) for &quot;CHANGE_PAGE&quot;,
changeSearch(search) for 'CHANGE_SEARCH',
showSuccessNotification(message) for 'SHOW_NOTIFICATION' (type: success),
showErrorNotification(message) for 'SHOW_NOTIFICATION', (type: error)
hideNotification() for 'CLEAR_NOTIFICATION'
</pre>
<p>The following two are thunk action creators that are called when either the
user sorting or the search/filtering parameters of the displayed books are&nbsp;changed:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">changeSearchAndLoadBooks</span><span class="p">(</span><span class="nx">search</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">changeSearch</span><span class="p">(</span><span class="nx">search</span><span class="p">))</span>
        <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">{</span>
            <span class="nx">search</span><span class="o">:</span> <span class="nx">formatUrl</span><span class="p">(</span><span class="nx">getState</span><span class="p">().</span><span class="nx">books</span><span class="p">)</span>
        <span class="p">}</span> <span class="p">)</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBooks</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">toggleSortingAndLoadBooks</span><span class="p">(</span><span class="nx">sorting</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">toggleSorting</span><span class="p">(</span><span class="nx">sorting</span><span class="p">))</span>
        <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">{</span>
            <span class="nx">search</span><span class="o">:</span> <span class="nx">formatUrl</span><span class="p">(</span><span class="nx">getState</span><span class="p">().</span><span class="nx">books</span><span class="p">)</span>
        <span class="p">}</span> <span class="p">)</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBooks</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Notice that these are thunk action creators (they return a function) and
the important thing that they do is that they call two other action creators
(<tt class="docutils literal">toggleSorting</tt> or <tt class="docutils literal">changeSearch</tt> and <tt class="docutils literal">loadBooks</tt>) and update the
<span class="caps">URL</span> using <tt class="docutils literal">history.push</tt>. The <tt class="docutils literal">history</tt> object is the one we had created in
the <tt class="docutils literal">store.js</tt> and its <tt class="docutils literal">push</tt> method changes the displayed <span class="caps">URL</span>. This
method <a class="reference external" href="https://github.com/reactjs/history/blob/master/docs/Location.md#location-descriptors">uses a location descriptor</a> that contains
an attribute for the path name and an attribute for the query parameters
- in or case we just want to update the query parameters (i.e <tt class="docutils literal"><span class="pre">#/url/?search=query1&amp;sorting=query2</span></tt>),
so we pass an obect with only the <tt class="docutils literal">search</tt> attribute. The <tt class="docutils literal">formatUrl</tt> function, to
which the books state slice is passsed, is a rather simple function
that checks if either the sorting or the search should exist in th <span class="caps">URL</span> and
returns the full <span class="caps">URL</span>. This function is contained in the <tt class="docutils literal">util/formatters.s</tt> module.</p>
<p>The following thunk action creators are used for asynchronous, ajax&nbsp;queries:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">loadBooks</span><span class="p">(</span><span class="nx">page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">();</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">sorting</span><span class="p">,</span> <span class="nx">search</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">books</span>
        <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`//127.0.0.1:8000/api/books/?format=json&amp;page=</span><span class="si">${</span><span class="nx">page</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">sorting</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">url</span><span class="o">+=</span><span class="sb">`&amp;ordering=</span><span class="si">${</span><span class="nx">sorting</span><span class="si">}</span><span class="sb">`</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">search</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">url</span><span class="o">+=</span><span class="sb">`&amp;search=</span><span class="si">${</span><span class="nx">search</span><span class="si">}</span><span class="sb">`</span>
        <span class="p">}</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showBooksResult</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
                <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
            <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kr">export</span> <span class="kd">function</span> <span class="nx">loadBookAction</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`//127.0.0.1:8000/api/books/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">/?format=json`</span><span class="p">;</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showBookResult</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadSubCategories</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">category</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">loadAuthors</span><span class="p">(</span><span class="nx">page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// similar to loadBooks</span>
<span class="p">}</span>


<span class="kr">export</span> <span class="kd">function</span> <span class="nx">loadAuthor</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// similar to loadBook</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">loadCategories</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// similar to loadBooks</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">loadSubCategories</span><span class="p">(</span><span class="nx">category</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">category</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSubCategoriesResult</span><span class="p">([]));</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`//127.0.0.1:8000/api/subcategories/?format=json&amp;category=</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSubCategoriesResult</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">loadBooks</tt> thunk action creator creates the <span class="caps">URL</span> parameters that should
be passed to the <span class="caps">REST</span> <span class="caps">API</span> using the <tt class="docutils literal">getState()</tt> method that returns the current state.
It then dispatches the <tt class="docutils literal">loadingChanged</tt> action so that the <tt class="docutils literal">ui.isLoading</tt> will be
changed to true. After that it asynchronously calls the load books <span class="caps">REST</span> <span class="caps">API</span> passing
it the created url and returns.
Since this is a thunk action there&#8217;s no problem that nothing is returned. When the
ajax call returns it will dispatch the <tt class="docutils literal">showBooksResult</tt>, passing the book data to
change the state with the loaded book data and the <tt class="docutils literal">loadingChanged</tt> to hide the loading
spinner. Also, please notice that I&#8217;ve put the return of the ajax call inside a <tt class="docutils literal">setTimeout</tt>
to emulate a 1 second delay and be able to see the loading&nbsp;spinner.</p>
<p>I may have used
setTimeout in some other places to make sure to be able to emulate server-side delays so
<em>please don&#8217;t forget to remove these &#8220;setTimeout&#8220;s from your&nbsp;code!</em></p>
<p>The <tt class="docutils literal">loadBook</tt> is more or less the same - however here only a single book&#8217;s data will
be loaded. When this book is loaded the <tt class="docutils literal">loadSubCategories</tt> action will also be dispatched,
passing it the loaded book&#8217;s category (so that the correct subcategories based on the category
will be displayed to the&nbsp;form).</p>
<p>I won&#8217;t go into any detail about the other thunk action creators, they are simpler than those
we&#8217;ve already described, except <tt class="docutils literal">loadSubCategories</tt>: This one, checks if there&#8217;s a category
and if not it will just set the displayed subcategories to and empty list (by dispatching
<tt class="docutils literal"><span class="pre">showSubCategoriesResult([])</span></tt>). If the category is not empty, it will retrieve asynchronously the
subcategories of the passed&nbsp;category.</p>
</div>
<div class="section" id="components-app-js">
<h3><a class="toc-backref" href="#id18">components/app.js</a></h3>
<p>We&#8217;ll now start explaining the actual react components (modified to be used through redux of course).
The parent of all other components is the <tt class="docutils literal">App</tt> which, as we&#8217;ve already seen in <tt class="docutils literal">main.js</tt>
is connected with the parent&nbsp;route:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">isLoading</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">ui</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>

            <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">children</span><span class="p">}</span>

            <span class="o">&lt;</span><span class="nx">NotificationContainer</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">LoadingContainer</span> <span class="nx">isLoading</span><span class="o">=</span><span class="p">{</span><span class="nx">isLoading</span><span class="p">}</span> <span class="o">/&gt;</span>

            <span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>

            <span class="o">&lt;</span><span class="nx">StatPanel</span> <span class="nx">bookLength</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span> <span class="nx">authorLength</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button&#39;</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="nx">Books</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>
            <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button&#39;</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/authors/&quot;</span><span class="o">&gt;</span><span class="nx">Authors</span><span class="o">&lt;</span><span class="err">/Link&gt;</span>

        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">}</span>

    <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">loadBooks</span><span class="p">,</span> <span class="nx">loadAuthors</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loadBooks</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">loadAuthors</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">books</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">,</span>
    <span class="nx">authors</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">authors</span><span class="p">,</span>
    <span class="nx">ui</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">ui</span><span class="p">,</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="p">=&gt;</span> <span class="nx">bindActionCreators</span><span class="p">({</span>
    <span class="nx">loadBooks</span><span class="p">,</span> <span class="nx">loadAuthors</span>
<span class="p">},</span> <span class="nx">dispatch</span><span class="p">)</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">App</span><span class="p">);</span>
</pre></div>
<p>As we can see, there&#8217;s an internal component (named <tt class="docutils literal">App</tt>) but we export the <tt class="docutils literal"><span class="pre">connect``ed</span> component.
One interesting thing to notice is that ``App</tt> is an <span class="caps">ES6</span> class based react component (i.e it extends
<tt class="docutils literal">React.Component</tt> &#8212; I&#8217;ll talk a bit about these components while taking a look at
the <tt class="docutils literal">BookSearchPanel</tt> which has some more interesting&nbsp;features).</p>
<p>Concerning the exported,
connected component, it
uses <tt class="docutils literal">mapStateToProps</tt> for defining the state attributes that should be passed as properties
to the componnt (<tt class="docutils literal"><span class="pre">state.{books,</span> authors, ui}</tt>) and <tt class="docutils literal">mapDispatchToProps</tt> for defining the <tt class="docutils literal">props</tt> methods that will
dispatch actions. To make <tt class="docutils literal">mapDispatchToProps</tt> more compact I&#8217;ve used the <tt class="docutils literal">bindActionCreators</tt> method from redux.
This method gets an object whose values are action creators and the <tt class="docutils literal">dispatch</tt> (from store) and returns an object
whose values are the dispatch-enabled corresponding action creators. So, in our case
the returned object would be something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nx">loadBooks</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBooks</span><span class="p">()),</span>
    <span class="nx">loadAuthors</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadAuthors</span><span class="p">()),</span>
<span class="p">}</span>
</pre></div>
<p>This object of course could be created by hand, however <tt class="docutils literal">bindActionCreators</tt> would be really useful if we wanted
to dispatch lots of actions in a component (or if we had seperated our action creators to different modules) &#8212;
we could for example do something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">actions</span> <span class="nx">from</span> <span class="s1">&#39;../actions&#39;</span>

<span class="kr">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="p">=&gt;</span> <span class="nx">bindActionCreators</span><span class="p">(</span><span class="nx">actions</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">)</span>
</pre></div>
<p>The <tt class="docutils literal">import *</tt> statemenet will create an object named item that will have all the exported actions and then
<tt class="docutils literal">bindActionCreators</tt> will return an object that dispatches these actions &#8212; passing this <tt class="docutils literal">mapDispatchToProps</tt>
to connect will allow your component to call every action and automatically dispatch&nbsp;it.</p>
<p>The internal component returns a <tt class="docutils literal">&lt;div /&gt;</tt> containing, among others <tt class="docutils literal">{this.props.children}</tt> - this
will be provided by rendering the child routes. It also renders a <tt class="docutils literal">NotificationContainer</tt> to render the notifications, a
<tt class="docutils literal">LoadingContainer</tt> to display a css &#8220;loading&#8221; spinner and a <tt class="docutils literal">StatPanel</tt> to display some stats about books and
authors. It also renders two Links one for the books table and one for the authors&nbsp;table.</p>
<p>Beyond these, when the component is mounted it checks if the authors and books have been loaded and if not, it
dispatches the <tt class="docutils literal">loadBooks</tt> and <tt class="docutils literal">loadAuthors</tt> actions (remember, because we used <tt class="docutils literal">mapDispatchToProps</tt> by
calling these methods from <tt class="docutils literal">props</tt> they&#8217;ll be automatically dspatched when&nbsp;called).</p>
<p>Let&#8217;s take a quick look at the three small components that are contained in <tt class="docutils literal">App</tt></p>
<div class="section" id="components-notification-js">
<h4><a class="toc-backref" href="#id19">components/notification.js</a></h4>
<p>This component is responsible for displaying a notification if there&#8217;s an active one.
It also defines an internal component and exports a connected version of it, passing it the
<tt class="docutils literal">notification</tt> slice of the state tree and an <tt class="docutils literal">onHide</tt> method that dispatches the
<tt class="docutils literal">hidNotification</tt> action.</p>
<p>When the internal component is rendered, it checks to see if the notification should be
displayed (<tt class="docutils literal">isActive</tt> will be true if there&#8217;s an actual message) and select the color
of the background. Finally, it passes this information along with some styling
to the real <tt class="docutils literal">Notification</tt>  component from <tt class="docutils literal"><span class="pre">react-notification</span></tt>.</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">NotificationContainer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="p">{</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">notification_type</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">notification</span><span class="p">;</span>
    <span class="kd">let</span> <span class="p">{</span> <span class="nx">onHide</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">isActive</span> <span class="o">=</span> <span class="nx">message</span><span class="o">?</span><span class="kc">true</span><span class="o">:</span><span class="kc">false</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">color</span><span class="p">;</span>

    <span class="k">switch</span><span class="p">(</span><span class="nx">notification_type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;SUCCESS&#39;</span><span class="o">:</span>
            <span class="nx">color</span> <span class="o">=</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">success</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;ERROR&#39;</span><span class="o">:</span>
            <span class="nx">color</span> <span class="o">=</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">danger</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;INFO&#39;</span><span class="o">:</span>
            <span class="nx">color</span> <span class="o">=</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">info</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Notification</span>
        <span class="nx">isActive</span><span class="o">=</span><span class="p">{</span><span class="nx">isActive</span><span class="p">}</span>
        <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="nx">message</span><span class="o">?</span><span class="nx">message</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="nx">dismissAfter</span><span class="o">=</span><span class="p">{</span><span class="mi">5000</span><span class="p">}</span>
        <span class="nx">onDismiss</span><span class="o">=</span><span class="p">{</span> <span class="p">()=&gt;</span><span class="nx">onHide</span><span class="p">()</span> <span class="p">}</span>
        <span class="nx">action</span><span class="o">=</span><span class="s1">&#39;X&#39;</span>
        <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span> <span class="p">()=&gt;</span><span class="nx">onHide</span><span class="p">()</span> <span class="p">}</span>
        <span class="nx">style</span><span class="o">=</span><span class="p">{{</span>
            <span class="nx">bar</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">background</span><span class="o">:</span> <span class="nx">color</span><span class="p">,</span>
                <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="nx">fontSize</span><span class="o">:</span> <span class="s1">&#39;2rem&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="nx">active</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">left</span><span class="o">:</span> <span class="s1">&#39;3rem&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="nx">action</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#FFCCBC&#39;</span><span class="p">,</span>
                <span class="nx">fontSize</span><span class="o">:</span> <span class="s1">&#39;3rem&#39;</span><span class="p">,</span>
                <span class="nx">border</span><span class="o">:</span> <span class="s1">&#39;1 pt solid black&#39;</span>
            <span class="p">}</span>
        <span class="p">}}</span>
    <span class="o">/&gt;</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">notification</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">notification</span>
<span class="p">})</span>

<span class="kd">let</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">onHide</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">hideNotification</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">NotificationContainer</span><span class="p">);</span>
</pre></div>
<p>Notice the <tt class="docutils literal"><span class="pre">style={{</span> .. }}</tt> snippet above: The external <tt class="docutils literal">{}</tt> are the Javascript code
inclusion tags of <span class="caps">JSX</span> while the internal <tt class="docutils literal">{}</tt> are for creating a normal javascript object
that defines the styling of the&nbsp;notification.</p>
</div>
<div class="section" id="creating-a-re-usable-notification">
<h4><a class="toc-backref" href="#id20">Creating a re-usable&nbsp;notification</a></h4>
<p>Please notice that although I&#8217;ve implemented this as a connected component this is not the only
way to do it! Actually, probably my implementation is less-reusable from the others I will&nbsp;propose&#8230;</p>
<p>In any case, instead of implementing <tt class="docutils literal">NotificationContainer</tt> as a connected component we could
have implemented it as a normal, non connected component that would receive two properties
from its parent:
the <tt class="docutils literal">notification</tt> slice of state and an <tt class="docutils literal">onHide</tt> function that would dispatch
<tt class="docutils literal">hideNotification</tt>. Doing this would be very easy, just change
<tt class="docutils literal">App</tt> so that its <tt class="docutils literal">mapDispatchToProps</tt> would also return the <tt class="docutils literal">notification</tt> slice of
the state - and pass this slice as a property to the <tt class="docutils literal">NotificationContainer</tt>. Also, the
<tt class="docutils literal">onHide</tt> method should have been also defined in the <tt class="docutils literal">mapDispatchToProps</tt> of <tt class="docutils literal">App</tt> and
passed as a property to <tt class="docutils literal">NotificationContainer</tt>. Notice that this makes <tt class="docutils literal">NotificationContainer</tt>
a reusable component since we could pass anything we wanted as the <tt class="docutils literal">notification</tt> object and
<tt class="docutils literal">onHide</tt> method.</p>
<p>Also, if we needed to implement <tt class="docutils literal">NotificationContainer</tt> as a connected object but we still
needed it to be reusable we&#8217;d then export the non-connected <tt class="docutils literal">NotificationContainer</tt>
and create a bunch of <tt class="docutils literal">ConnectedNotificationContainer</tt> that would
define <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt>
and export the connected component. This way, each <tt class="docutils literal">ConnecteNotificationContainer</tt> would
receive a different state slice and a different <tt class="docutils literal">onHide</tt> method, for example we may had
different notifications for books and different notifications for authors. Notice that this
approach, i.e create a reusable non-connected component and use it to create connected
components by defining their <tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt> is the
approach proposed by react-redux to create&nbsp;components.</p>
<p>Finally, one last comment on this approach that may clarify more
the purpose of  <tt class="docutils literal">mapStateToProps</tt> and
<tt class="docutils literal">mapDispatchToProps</tt> of connected components
is that these two functions are <em>dual</em>&nbsp;(mirror):</p>
<ul class="simple">
<li>Using <tt class="docutils literal">mapStateToProps</tt> we define which parts of the state will actually be passed to the component (= reading the&nbsp;state).</li>
<li>Using <tt class="docutils literal">mapDispatchToProps</tt> we define the actions which will be dispatched by the component (= changing/writing the&nbsp;state)</li>
</ul>
</div>
<div class="section" id="components-loading-js">
<h4><a class="toc-backref" href="#id21">components/loading.js</a></h4>
<p>This is a really simple component: If the <tt class="docutils literal">isLoading</tt> parameter is true, display a <tt class="docutils literal">div</tt> with the <tt class="docutils literal">loading</tt> class:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span><span class="nx">isLoading</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="nx">isLoading</span><span class="o">?&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;loading&quot;</span><span class="o">&gt;</span><span class="nx">Loading</span><span class="o">&amp;</span><span class="err">#</span><span class="mi">8230</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/div&gt;:null}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>
<p>The important thing here is what the <tt class="docutils literal">loading</tt> class does to display the spinner - I&#8217;m leaving it to you to check
it at <tt class="docutils literal">static/cssloader.css</tt> (this is not my css code - I&#8217;ve copied it from <a class="reference external" href="http://codepen.io/MattIn4D/pen/LiKFC">http://codepen.io/MattIn4D/pen/LiKFC</a>&nbsp;).</p>
<p>Also, please notice that in this module we just export a function, taking an object which
has an <tt class="docutils literal">isLoading</tt> attribute as a parameter. That&#8217;s a functional react component: A
function that gets a <tt class="docutils literal">params</tt> object as an input and implements the render method,
returning a&nbsp;component.</p>
<p>Using functional components is recommended for reasons that
are far too obvious (easy to test - just call the function, idemponent - no state
to keep track of, less code to write, easier to the eye, <em>functional</em> )
- you should use class based components only when absolutely
necessary (i.e when the component needs to keep some local state or when it needs
to do stuff on <tt class="docutils literal">componentWillMount</tt>).</p>
</div>
<div class="section" id="components-statpanel-js">
<h4><a class="toc-backref" href="#id22">components/StatPanel.js</a></h4>
<p>Another very simple functional component - just display the number of books and authors from the passed&nbsp;parameter.</p>
</div>
</div>
<div class="section" id="components-bookpanel-js">
<h3><a class="toc-backref" href="#id23">components/BookPanel.js</a></h3>
<p>Continuing our top-down approach on exploring the project, we&#8217;ll now talk
about the <tt class="docutils literal">BookPanel</tt> component which is displayed by the <tt class="docutils literal">IndexRoute</tt>.
Before talking about the actual component, I&#8217;d like to present
the <tt class="docutils literal">getCols</tt> function that is used to create an array of the columns
that will be displayed by the <tt class="docutils literal">Table</tt> we render in this&nbsp;panel.</p>
<p>As we can see, the <tt class="docutils literal">getCols</tt> gets one parameter which is the sort method &#8212;
this method gets a string and uses it to toggle sorting by this string.
We use a function to create the columns instead of a constant because
that <tt class="docutils literal">sort_function</tt> needs to <tt class="docutils literal">dispatch</tt> an action &#8212; <tt class="docutils literal">dispatch</tt> is available from
the <tt class="docutils literal">props</tt> that the functional <tt class="docutils literal">BookPanel</tt> component receives so the function
will be called from inside that functional&nbsp;component.</p>
<p>Each column, has up to four&nbsp;parameters:</p>
<ul class="simple">
<li>A <tt class="docutils literal">key</tt> which is the attribute  of the <tt class="docutils literal">row</tt> object to&nbsp;display</li>
<li>A <tt class="docutils literal">title</tt> which is the column&nbsp;title</li>
<li>A <tt class="docutils literal">format</tt> (optional) which may be used to display the value of that column&nbsp;and</li>
<li>A <tt class="docutils literal">sorting</tt> (optional) which is a function that will be called when the column title is clicked (so that the sorting is changed ) - this attribute is created using the <tt class="docutils literal">sort_method</tt></li>
</ul>
<p>We&#8217;ll see how these attributes are used by the <tt class="docutils literal">Table</tt> in the corresponding section. Five
columns have been defined: <tt class="docutils literal">id</tt> (which, when clicked will update the book
that&#8217;s where <tt class="docutils literal">format</tt> is used), <tt class="docutils literal">title</tt>, <tt class="docutils literal">category_name</tt>, <tt class="docutils literal">publish_date</tt>
and <tt class="docutils literal">author_name</tt>:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">getCols</span> <span class="o">=</span> <span class="nx">sort_method</span> <span class="p">=&gt;</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
        <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>
        <span class="nx">format</span><span class="o">:</span> <span class="nx">x</span><span class="p">=&gt;</span><span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="sb">`/book_update/</span><span class="si">${</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Link&gt;,</span>
        <span class="nx">sorting</span><span class="o">:</span> <span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="nx">sorting</span><span class="o">:</span> <span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)},</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;category_name&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Category&#39;</span><span class="p">,</span> <span class="nx">sorting</span><span class="o">:</span> <span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;subcategory__name&#39;</span><span class="p">)},</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;publish_date&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Publish date&#39;</span><span class="p">,</span> <span class="nx">sorting</span><span class="o">:</span> <span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;publish_date&#39;</span><span class="p">)},</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;author_name&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Author&#39;</span><span class="p">,</span> <span class="nx">sorting</span><span class="o">:</span> <span class="nx">sort_method</span><span class="p">(</span><span class="s1">&#39;author__last_name&#39;</span><span class="p">)},</span>
<span class="p">]</span>
</pre></div>
<p>The actual (exported) <tt class="docutils literal">BookPanel</tt> is a connected component - we need to use connect because we can&#8217;t
actually pass properties or <tt class="docutils literal">dispatch</tt> to this component since it is
rendered through a route (and not as a child of another component), so it
must be connected to the store through <tt class="docutils literal">connect</tt> to be able to receive
state attributes and <tt class="docutils literal">dispatch</tt>. We pass the <tt class="docutils literal">books</tt> state
slice as a property using <tt class="docutils literal">mapStateToProps</tt> and use the same techique as
before in <tt class="docutils literal">App</tt>  with
<tt class="docutils literal">bindActionCreators</tt> to create auto-dispatchable&nbsp;actions.</p>
<p>As we can see, after retrieving the needed properties from the <tt class="docutils literal">books</tt> state slice
and the actions to dispatch, we define an <tt class="docutils literal">onSearchChanged</tt> function that will be
passed to the <tt class="docutils literal">BookSearchPanel</tt> to be called when the search query is&nbsp;changed.</p>
<p>Next, the <tt class="docutils literal">sort_method</tt> is defined. This is
a function that gets a <tt class="docutils literal">key</tt> parameter and returns another function that
dispatches <tt class="docutils literal">toggleSortingAndLoadBooks</tt> passing it that <tt class="docutils literal">key</tt>. This is the
parameter that is passed to <tt class="docutils literal">getCols</tt>. So, for example for the <tt class="docutils literal">id</tt>,
the result of the <tt class="docutils literal">sort_method</tt> would be the following function:
<tt class="docutils literal">() =&gt; <span class="pre">toggleSortingAndLoadBooks('id')</span></tt>.</p>
<p>Finally, the <tt class="docutils literal">BookPanel</tt> renders the&nbsp;following:</p>
<ul class="simple">
<li>A <tt class="docutils literal">BookSearchPanel</tt> passing it the <tt class="docutils literal">search</tt> property and the <tt class="docutils literal">onSearchChanged</tt> action</li>
<li>A <tt class="docutils literal">Link</tt> to create a new&nbsp;book</li>
<li>A <tt class="docutils literal">Table</tt> passing it the <tt class="docutils literal">sorting</tt> and <tt class="docutils literal">rows</tt> parameters and the <tt class="docutils literal">cols</tt> constant we just&nbsp;defined</li>
<li>A <tt class="docutils literal">PagingPanel</tt> passing it the total number of books (<tt class="docutils literal">count</tt>), the current page (<tt class="docutils literal">page</tt>) and two methods <tt class="docutils literal">onNextPage</tt> and <tt class="docutils literal">onPreviousPage</tt> that will be called when switch to the next or previous&nbsp;page.</li>
</ul>
<p>As we can see, the <tt class="docutils literal">onNextPage</tt> and <tt class="docutils literal">onPreviousPage</tt> functions dispach the <tt class="docutils literal">changePage</tt> action passing it
the page to change to and reload the books by dispatch <tt class="docutils literal">loadBooks</tt>. Instead of this we could create
a <tt class="docutils literal">changePageAndLoadBooks</tt> thunk action creator that would call these two methods when dispatched
(similarly to how <tt class="docutils literal">changeSearchAndLoadBooks</tt> and <tt class="docutils literal">toggleSortingAndLoadBooks</tt> have been implemented)
- I&#8217;m leaving it like this to show all&nbsp;possibilities:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">BookPanel</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">rows</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">sorting</span><span class="p">,</span> <span class="nx">search</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">books</span><span class="p">;</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">loadBooks</span><span class="p">,</span> <span class="nx">changePage</span><span class="p">,</span> <span class="nx">toggleSortingAndLoadBooks</span><span class="p">,</span> <span class="nx">changeSearchAndLoadBooks</span>  <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">onSearchChanged</span> <span class="o">=</span> <span class="nx">query</span> <span class="p">=&gt;</span> <span class="nx">changeSearchAndLoadBooks</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">sort_method</span> <span class="o">=</span> <span class="nx">key</span> <span class="p">=&gt;</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">toggleSortingAndLoadBooks</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">cols</span> <span class="o">=</span> <span class="nx">getCols</span><span class="p">(</span><span class="nx">sort_method</span><span class="p">)</span>

    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">BookSearchPanel</span> <span class="nx">search</span><span class="o">=</span><span class="p">{</span><span class="nx">search</span><span class="p">}</span> <span class="nx">onSearchChanged</span><span class="o">=</span><span class="p">{</span><span class="nx">onSearchChanged</span><span class="p">}</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;twelve columns&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Book</span> <span class="nx">list</span> <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">fontSize</span><span class="o">:</span><span class="s1">&#39;1em&#39;</span><span class="p">}}</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/book_create/&quot;</span><span class="o">&gt;+&lt;</span><span class="err">/Link&gt;&lt;/h3&gt;</span>
                <span class="o">&lt;</span><span class="nx">Table</span> <span class="nx">sorting</span><span class="o">=</span><span class="p">{</span><span class="nx">sorting</span><span class="p">}</span> <span class="nx">cols</span><span class="o">=</span><span class="p">{</span><span class="nx">cols</span><span class="p">}</span> <span class="nx">rows</span><span class="o">=</span><span class="p">{</span><span class="nx">rows</span><span class="p">}</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="o">&lt;</span><span class="nx">PagingPanel</span> <span class="nx">count</span><span class="o">=</span><span class="p">{</span><span class="nx">count</span><span class="p">}</span> <span class="nx">page</span><span class="o">=</span><span class="p">{</span><span class="nx">page</span><span class="p">}</span> <span class="nx">onNextPage</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">changePage</span><span class="p">(</span><span class="nx">page</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
            <span class="nx">loadBooks</span><span class="p">()</span>
        <span class="p">}}</span> <span class="nx">onPreviousPage</span><span class="o">=</span><span class="p">{</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">changePage</span><span class="p">(</span><span class="nx">page</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
            <span class="nx">loadBooks</span><span class="p">()</span>
        <span class="p">}}</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">books</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">,</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="nx">dispatch</span> <span class="p">=&gt;</span> <span class="nx">bindActionCreators</span><span class="p">({</span>
    <span class="nx">loadBooks</span><span class="p">,</span> <span class="nx">changePage</span><span class="p">,</span> <span class="nx">toggleSortingAndLoadBooks</span><span class="p">,</span> <span class="nx">changeSearchAndLoadBooks</span>
<span class="p">},</span> <span class="nx">dispatch</span><span class="p">)</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span><span class="nx">mapStateToProps</span><span class="p">,</span> <span class="nx">mapDispatchToProps</span><span class="p">)(</span><span class="nx">BookPanel</span><span class="p">);</span>
</pre></div>
<div class="section" id="components-booksearchpanel-js">
<h4><a class="toc-backref" href="#id24">components/BookSearchPanel.js</a></h4>
<p>The <tt class="docutils literal">BookSearchPanel</tt> is a component used for searching books. What
is interesting about this component is that it has internal state (i.e
state that is not reflected to the global search tree). Notice that
<tt class="docutils literal">BookSearchPanel</tt> is an <span class="caps">ES6</span> class component. Here are some of its
characteristics as opposed to non-<span class="caps">ES6</span> react&nbsp;components:</p>
<ul class="simple">
<li>It extends <tt class="docutils literal">React.Component</tt> instead of using <tt class="docutils literal">React.CreateClass</tt></li>
<li>It has a constructor that initializes the local state instead of implementing <tt class="docutils literal">getInitialState</tt></li>
<li>It does not automatically bind the methods to <tt class="docutils literal">this</tt> so we do it in the constructor (or else <tt class="docutils literal">this</tt> would be undefined in <tt class="docutils literal">onSearchChange</tt> and <tt class="docutils literal">onClearSearch</tt>) - <em>be very careful with that, its a common&nbsp;problem</em></li>
</ul>
<p>So, what happens
here? We render an <span class="caps">HTML</span> <tt class="docutils literal">input</tt> element and call <tt class="docutils literal">this.onSearchChange</tt>
method. This method retrieves the current value of the input (using <tt class="docutils literal">this.refs</tt>)
and, if the previous change was more than 400 ms ago calls the provided
(through <tt class="docutils literal">props</tt>) <tt class="docutils literal">onSearchChanged</tt> method that will dispatch the
<tt class="docutils literal">changeSearchAndLoadBooks</tt> action with the current value as a parameter
(notice however that <tt class="docutils literal">this.setState</tt> is <em>always</em> called immediately or else the
user keypresses wouldn&#8217;t be reflected to the&nbsp;input).</p>
<p>The whole thing with the <tt class="docutils literal">ths.promise</tt> and <tt class="docutils literal">clearInterval</tt> is to make
sure that the provided <tt class="docutils literal">onSearchChanged</tt> will not be called too often
(i.e it will be called 400 ms after the last&nbsp;keypress):</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">SearchPanel</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">super</span><span class="p">()</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onClearSearch</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onClearSearch</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;one-fourth column&quot;</span><span class="o">&gt;</span>
                    <span class="nx">Filter</span><span class="o">:</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
                    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">ref</span><span class="o">=</span><span class="s1">&#39;search&#39;</span> <span class="nx">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span> <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span> <span class="p">}</span> <span class="o">/&gt;</span>
                    <span class="p">{(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">search</span><span class="o">||</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">search</span><span class="p">)</span><span class="o">?&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onClearSearch</span><span class="p">}</span> <span class="o">&gt;</span><span class="nx">x</span><span class="o">&lt;</span><span class="err">/button&gt;:&#39;&#39;}</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">onSearchChange</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">search</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">search</span><span class="o">:</span> <span class="nx">query</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">promise</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSearchChanged</span><span class="p">(</span><span class="nx">query</span><span class="p">),</span> <span class="mi">400</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">onClearSearch</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">search</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onSearchChanged</span><span class="p">(</span><span class="kc">undefined</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>Let&#8217;s take a closer look at the <tt class="docutils literal">&lt;input&gt;</tt> element:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">ref</span><span class="o">=</span><span class="s1">&#39;search&#39;</span> <span class="nx">name</span><span class="o">=</span><span class="s1">&#39;search&#39;</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span> <span class="nx">defaultValue</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">search</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">onSearchChange</span> <span class="p">}</span> <span class="o">/&gt;</span>
</pre></div>
<p>The <tt class="docutils literal">ref</tt> property is used to reference this element using <tt class="docutils literal">ReactDOM.findDOMNode</tt> - that&#8217;s
one possible way to retrieve the value of this object. Another way would be to add an <tt class="docutils literal">event</tt>
parameter to <tt class="docutils literal">onSearchChange</tt> - this parameter would receive the <span class="caps">DOM</span> event of the change so
the value of the element could be retrieved using <tt class="docutils literal">event.target.value</tt>.</p>
<p>The difference between the <tt class="docutils literal">defaultValue</tt> and <tt class="docutils literal">value</tt> parameters is really important: The
<tt class="docutils literal">defaultValue</tt> is just the initial value of this specific input and it will be equal to
<tt class="docutils literal">props.search</tt> (so that if the user enters a <span class="caps">URL</span> which has a search query parameter this will
be pre-filled here). On the other hand, the <tt class="docutils literal">value</tt> parameter is the current value of
the element and will be equal to the <tt class="docutils literal">state.search</tt>. When the user types in the input,
the <tt class="docutils literal">onSearchChange</tt> will be called which will <em>always</em> change the <tt class="docutils literal">state.search</tt>
and the <tt class="docutils literal">value</tt> will get the correct, new value (or
else the change wouldn&#8217;t be reflected to the&nbsp;user)!</p>
<p>Finally concerning the clear search query button,
when there&#8217;s a search query a  <tt class="docutils literal">x</tt> button will be displayed
if there&#8217;s something to the input field which, when
clicked the search local state will be cleared
and the provided <tt class="docutils literal">onSearchChanged</tt> will be called with an empty&nbsp;query.</p>
</div>
<div class="section" id="components-table-js">
<h4><a class="toc-backref" href="#id25">components/Table.js</a></h4>
<p>The <tt class="docutils literal">Table</tt> is a reusable, functional react component that is used for both books and&nbsp;authors.</p>
<p>First of all, we define a formatHeader function that is used to format the
table header: This function gets an object with key and label as parameters (which
is the column to be formated) and a sorting parameter (which is the current table&#8217;s
sorting) and returns the label with a <tt class="docutils literal">'+'</tt> in front of it if the sorting is ascending
by this column or a <tt class="docutils literal"><span class="pre">'-'</span></tt> if the sorting is descending by this column or just the
label if this column is not used for&nbsp;sorting:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">formatHeader</span> <span class="o">=</span> <span class="p">({</span><span class="nx">key</span><span class="p">,</span> <span class="nx">label</span><span class="p">},</span> <span class="nx">sorting</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">sorting</span><span class="o">==</span><span class="nx">key</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="o">+</span><span class="nx">label</span><span class="p">)</span><span class="o">:</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">sorting</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nx">key</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nx">label</span><span class="p">)</span><span class="o">:</span><span class="nx">label</span>
<span class="p">)</span>
</pre></div>
<p>The <tt class="docutils literal">Table</tt>
uses the props we mentioned before when talking about
<tt class="docutils literal">BookPanel</tt>. When it is rendered, the headers of the table are constructed by
applying a map method on the items of the <tt class="docutils literal">cols</tt> attribute. Remember that map
will apply a function to all items of a list and return a new list with the results.
So this will create a list of correctly formatted <tt class="docutils literal">&lt;th&gt;</tt> elements.</p>
<p>In our case, the mapper
checks if each column has a <tt class="docutils literal">sorting</tt> attribute and if yes it
creates a clickable header that calls <tt class="docutils literal">sorting</tt> when clicked and is
formatted with <tt class="docutils literal">formatHeader</tt> (remember <tt class="docutils literal">sort_method</tt> we talked about
in <tt class="docutils literal">BookPanel</tt>). If there&#8217;s no <tt class="docutils literal">sorting</tt> for that column it just
displays the column&nbsp;header.</p>
<p>The rows of the table are created using two maps, one that maps the <tt class="docutils literal">rows</tt>
which, for each row maps <tt class="docutils literal">cols</tt> to get the individual values for this row and column.
So, for the rows a list of <tt class="docutils literal">&lt;tr&gt;</tt> elements each one including the correct
<tt class="docutils literal">&lt;td&gt;</tt> elements will be&nbsp;created:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">cols</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">col</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">th</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">col</span><span class="p">.</span><span class="nx">key</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">col</span><span class="p">.</span><span class="nx">sorting</span><span class="o">?&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s1">&#39;#&#39;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="nx">col</span><span class="p">.</span><span class="nx">sorting</span><span class="p">()</span>
        <span class="p">}}</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="nx">formatHeader</span><span class="p">(</span><span class="nx">col</span><span class="p">,</span> <span class="nx">props</span><span class="p">.</span><span class="nx">sorting</span><span class="p">)}</span>
        <span class="o">&lt;</span><span class="err">/a&gt;:col.label</span>
        <span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/th&gt;)</span>
    <span class="kr">const</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">row</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">tr</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">row</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="p">{</span>
            <span class="nx">props</span><span class="p">.</span><span class="nx">cols</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">col</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">col</span><span class="p">.</span><span class="nx">key</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="p">{(</span><span class="nx">col</span><span class="p">.</span><span class="nx">format</span><span class="o">?</span><span class="nx">col</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">row</span><span class="p">)</span><span class="o">:</span><span class="nx">row</span><span class="p">[</span><span class="nx">col</span><span class="p">.</span><span class="nx">key</span><span class="p">])}</span>
            <span class="o">&lt;</span><span class="err">/td&gt;)</span>
        <span class="p">}</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;)</span>

    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">table</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">thead</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="nx">headers</span><span class="p">}</span>
            <span class="o">&lt;</span><span class="err">/tr&gt;</span>
        <span class="o">&lt;</span><span class="err">/thead&gt;</span>
        <span class="o">&lt;</span><span class="nx">tbody</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="nx">rows</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="err">/tbody&gt;</span>
    <span class="o">&lt;</span><span class="err">/table&gt;</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">key</tt> property I am passing to all elements that belong to a list is to
help React identify these child elements - we&#8217;d get a <tt class="docutils literal">Warning: Each
child in an array or iterator should have a unique &quot;key&quot; prop.</tt>
error without this&nbsp;property.</p>
<p>Also, please notice that the <tt class="docutils literal">const headers</tt> and <tt class="docutils literal">rows</tt> we&#8217;ve defined are there just
for clarity - we could instead put them directly inside the returned <tt class="docutils literal">&lt;table&gt;</tt>
and have a cool, totally <em>functional function</em>!</p>
</div>
<div class="section" id="components-pagingpanel-js">
<h4><a class="toc-backref" href="#id26">components/PagingPanel.js</a></h4>
<p>Another functional and reusable component - this one has  params with the
attributes <tt class="docutils literal">page</tt>, <tt class="docutils literal">page_size</tt>, <tt class="docutils literal">count</tt>, <tt class="docutils literal">onNextPage</tt>,
<tt class="docutils literal">onPreviousPage</tt> and, after finding out the total number of pages
it renders the current page number and the total pages number along
with two buttons that will execute the <tt class="docutils literal">onNextPage</tt> and <tt class="docutils literal">onPreviousPage</tt>
that are passed as properties (these methods will dispatch the changePage and
loadBooks actions as we&#8217;ve already seen in <tt class="docutils literal">BookPanel</tt>). One thing to notice
here is that the next and previous page buttons will only be rendered if
we are not in the first or last page (so if there&#8217;s only one page you won&#8217;t
see any&nbsp;buttons).</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span><span class="nx">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nx">page_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">onNextPage</span><span class="p">,</span> <span class="nx">onPreviousPage</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">total_pages</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">count</span> <span class="o">/</span> <span class="nx">page_size</span><span class="p">);</span>

    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="nx">onPreviousPage</span><span class="p">();</span>
        <span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
        <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="nx">Page</span> <span class="p">{</span><span class="nx">page</span><span class="p">}</span> <span class="k">of</span> <span class="p">{</span><span class="nx">total_pages</span><span class="p">}</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
        <span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="nx">total_pages</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
            <span class="nx">onNextPage</span><span class="p">();</span>
        <span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">}</span>
</pre></div>
<p>The same paging panel could be used for any table we wanted to have paging: Just pass it
the page number, page size, total number of items and what to do when next or previous page
buttons are&nbsp;clicked.</p>
</div>
<div class="section" id="interlude-a-more-functional-component">
<h4><a class="toc-backref" href="#id27">Interlude: A more functional&nbsp;component</a></h4>
<p>How could we make <tt class="docutils literal">PagingPanel</tt> more functional (i.e how could we remove the
<tt class="docutils literal">const total_pages</tt> definition) ? The easy way would be to just substitute it
with its definition inside the returned <tt class="docutils literal">&lt;div&gt;</tt> however we&#8217;d need to substitute it <em>two</em> times
so we&#8217;d loose our precious DRYness! So we&#8217;d need to think of another&nbsp;way.</p>
<p>People from the django world will be familiar with the  <a class="reference external" href="https://docs.djangoproject.com/es/1.9/ref/templates/builtins/#with">with template tag</a>. This tag
is used in django templates to assign a complex value to a constant and use this value
instead of the complex value. Something like&nbsp;this</p>
<pre class="code literal-block">
{% with simple=a.complex|calculation %}
    In here I can just use {{ simple }} instead of {{ a.complex|calculation }}!
{% endwith %}
</pre>
<p>Having such a concept in <span class="caps">ES6</span> would be ideal for our case! I am not sure if something
like <tt class="docutils literal">with</tt> actually exists, however we can really easy emulate it with a function
closure, something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span><span class="nx">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nx">page_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">onNextPage</span><span class="p">,</span> <span class="nx">onPreviousPage</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">(</span>
    <span class="nx">total_pages</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
        <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="nx">Page</span> <span class="p">{</span><span class="nx">page</span><span class="p">}</span> <span class="k">of</span> <span class="p">{</span><span class="nx">total_pages</span><span class="p">}</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>
        <span class="p">{</span><span class="nx">page</span><span class="o">==</span><span class="nx">total_pages</span><span class="o">?</span><span class="kc">null</span><span class="o">:&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}}</span><span class="o">&gt;&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/button&gt;}</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="p">)(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">count</span> <span class="o">/</span> <span class="nx">page_size</span><span class="p">))</span>
</pre></div>
<p>We define a function that gets <tt class="docutils literal">total_pages</tt> as a parameter and returns <em>another function</em> (
this one is the actual render method of the <tt class="docutils literal">PagingPanel</tt>) and <em>call the outer function</em>
passing it the value we want to give to <tt class="docutils literal">total_pages</tt>. This way, the <tt class="docutils literal">total_pages</tt> will
have a value in the inner function! Thank you, function&nbsp;closure!!!</p>
<p>Now <tt class="docutils literal">PagingPanel</tt> is also a completely functional function&nbsp;component!</p>
</div>
</div>
<div class="section" id="components-bookform">
<h3><a class="toc-backref" href="#id28">components/BookForm</a></h3>
<p>The last book-related component is <tt class="docutils literal">BookForm</tt>. This component is used to both create and update
a book. It also has a delete button for removing books. To decide if this is a create or an
update form, it relies on the parameter passed from the route - remember how the two routes have
been defined in <tt class="docutils literal">main.js</tt>:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">Route</span> <span class="na">path</span><span class="o">=</span><span class="s">&quot;/book_create/&quot;</span> <span class="na">component</span><span class="o">=</span><span class="s">{BookForm}</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">Route</span> <span class="na">path</span><span class="o">=</span><span class="s">&quot;/book_update/:id&quot;</span> <span class="na">component</span><span class="o">=</span><span class="s">{BookForm}</span> <span class="p">/&gt;</span>
</pre></div>
<p>So, although create and update render the same component, their difference
is that update will contain the <tt class="docutils literal">id</tt> of the book to be
updated in the url. This (along with any other url parameters) is passed by react-router as a property
through an object named <tt class="docutils literal">params</tt> to the <tt class="docutils literal">BookForm</tt> component, so, when updating a book
the <tt class="docutils literal">props.params.id</tt> of <tt class="docutils literal">BookForm</tt>
should have a&nbsp;value.</p>
<p>The <tt class="docutils literal">BookForm</tt> is a connected component (because it needs access to the state slice and dispatch and
is rendered through a route), however because it is also a redux-form, a special
method (<tt class="docutils literal">reduxForm</tt>) is used to connect the component and pass the form-related props to the&nbsp;component:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">initial</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">book</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">books</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">book</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">initial</span> <span class="o">=</span> <span class="nx">book</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">book</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">book</span><span class="p">,</span>
        <span class="nx">categories</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">categories</span><span class="p">,</span>
        <span class="nx">authors</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">authors</span><span class="p">,</span>
        <span class="nx">ui</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">ui</span><span class="p">,</span>
        <span class="nx">initialValues</span><span class="o">:</span> <span class="nx">initial</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">reduxForm</span><span class="p">({</span>
    <span class="nx">form</span><span class="o">:</span> <span class="s1">&#39;bookForm&#39;</span><span class="p">,</span>
    <span class="nx">fields</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;subcategory&#39;</span><span class="p">,</span> <span class="s1">&#39;publish_date&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span> <span class="p">],</span>
    <span class="nx">validate</span>
<span class="p">},</span> <span class="nx">mapStateToProps</span><span class="p">)(</span><span class="nx">BookForm</span><span class="p">);</span>
</pre></div>
<p>The <tt class="docutils literal">mapStateToProps</tt> contains a bunch of required things from the state (we need
the current <tt class="docutils literal">book</tt> that is edited, the <tt class="docutils literal">categories</tt> to select from, the <tt class="docutils literal">authors</tt> to also
select from and the <tt class="docutils literal">ui</tt> to find out if submitting has finished and render the buttons
as enabled/disabled). Beyond these, we see
that there&#8217;s an <tt class="docutils literal">initialValues</tt> attribute to the object returned from <tt class="docutils literal">mapStateToProps</tt>. This
attribute is used to initialize the form fields. So if our form has
fields named <tt class="docutils literal">title</tt> and <tt class="docutils literal">category</tt>, if the <tt class="docutils literal">initial</tt> object had <tt class="docutils literal">title</tt> and
<tt class="docutils literal">category</tt> attributes the form fields would be initialized by them. In our case, we just
check if the <tt class="docutils literal">props.params.id</tt> method is defined and the to-be-updated book has been loaded
to the state and just assign the to-be-updated <tt class="docutils literal">book</tt> to <tt class="docutils literal">initialValues</tt>.</p>
<p>The <tt class="docutils literal">reduxForm</tt> method is used to <tt class="docutils literal">connect</tt> the form component: Beyond the usual
<tt class="docutils literal">mapStateToProps</tt> and <tt class="docutils literal">mapDispatchToProps</tt> (we don&#8217;t actually use <tt class="docutils literal">mapDispatchToProps</tt> here
because I feel that just getting <tt class="docutils literal">dispatch</tt> is more clear),
it needs a required parameter which is the object used to initialize the redux-form form: This
object should&nbsp;have</p>
<ul class="simple">
<li>A <tt class="docutils literal">form</tt> attribute with the name of the form. This must be unique among all forms in your application and will be used as a parameter to the actions that redux-form will&nbsp;dispatch</li>
<li>A <tt class="docutils literal">fields</tt> string array with the names of the form fields. For each one of them a <tt class="docutils literal">field</tt> will be passed to the <tt class="docutils literal">props.fields</tt> array in the form&nbsp;component</li>
<li>A optional <tt class="docutils literal">validate</tt> attribute that is a function that will be called when the form fields are&nbsp;changed</li>
</ul>
<p>The validate function gets an object with the field names with their corresponding values as attributes and
should return another object with the field names that have an error and the error message. In our case,
we want the <tt class="docutils literal">title</tt> to be required and the date to be valid (if exists), so the <tt class="docutils literal">validate</tt> is:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">validate</span> <span class="o">=</span> <span class="nx">values</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">values</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;Required&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">publish_date</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">re</span> <span class="o">=</span> <span class="sr">/^\d{4}-\d{2}-\d{2}$/</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">publish_date</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">errors</span><span class="p">.</span><span class="nx">publish_date</span> <span class="o">=</span> <span class="s1">&#39;Invalid&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">errors</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>I just used a very simple regular expression to check the validity of
the date (it must be in the format <span class="caps">YYYY</span>-<span class="caps">MM</span>-<span class="caps">DD</span>) - this is just to make
a point, for normal date rendered you should use <a class="reference external" href="http://momentjs.com/">moment.js</a>.</p>
<p>This validate function is called <em>whenever a form field is changed</em> so, depending on the implementation
of course, the error messages will be shown and hidden as the user types in the fields. Please notice
that when the user starts typing in a field in an empty form, this field may be valid but all other
fields will be empty - to avoid displaying an error message for fields that the user has not been yet
been able to modify, we can use the <tt class="docutils literal">touched</tt> property of each field &#8212; only display the
field&#8217;s error message if this field has been <tt class="docutils literal">touched</tt>. When the form is submitted all fields are
changed to <tt class="docutils literal">touched</tt> so all error messages will be&nbsp;displayed.</p>
<p>The internal <tt class="docutils literal">BookForm</tt> is an <span class="caps">ES6</span> class based component that needs to do some things
when the <tt class="docutils literal">componentDidMount</tt> method is&nbsp;called:</p>
<ul class="simple">
<li>Check if the categories have been loaded - if not dispatch the <tt class="docutils literal">loadCategories</tt> action</li>
<li>Check if the this is an update and if yes, check to see if the to-be-updated book needs to be loaded and, if it needs dispatch <tt class="docutils literal">loadBook</tt> with the book&#8217;s&nbsp;id</li>
</ul>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">BookForm</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

    <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">categories</span><span class="p">.</span><span class="nx">categories</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadCategories</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">book</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">book</span><span class="p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadBook</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// New book</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">fields</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">title</span><span class="p">,</span> <span class="nx">category</span><span class="p">,</span> <span class="nx">subcategory</span><span class="p">,</span> <span class="nx">publish_date</span><span class="p">,</span> <span class="nx">author</span>
        <span class="p">},</span> <span class="nx">handleSubmit</span><span class="p">,</span> <span class="nx">dispatch</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">;</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">isSubmitting</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">ui</span><span class="p">;</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">categories</span><span class="p">,</span> <span class="nx">subcategories</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">categories</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">authors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">;</span>

        <span class="kr">const</span> <span class="nx">tsubmit</span> <span class="o">=</span> <span class="nx">submit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="nx">id</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">dsubmit</span> <span class="o">=</span> <span class="nx">del</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span><span class="nx">id</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">);</span>

        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">tsubmit</span><span class="p">)}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">Input</span> <span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Title&#39;</span> <span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">title</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">Select</span> <span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Category&#39;</span> <span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">category</span><span class="p">}</span> <span class="nx">options</span><span class="o">=</span><span class="p">{</span><span class="nx">categories</span><span class="p">}</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
                        <span class="nx">category</span><span class="p">.</span><span class="nx">onChange</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
                        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadSubCategories</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span>
                    <span class="p">}}</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">Select</span> <span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Subcategory&#39;</span> <span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">subcategory</span><span class="p">}</span> <span class="nx">options</span><span class="o">=</span><span class="p">{</span><span class="nx">subcategories</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">DatePicker</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span> <span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Publish Date&#39;</span> <span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">publish_date</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
                <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;six columns&#39;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="nx">Select</span> <span class="nx">label</span><span class="o">=</span><span class="s1">&#39;Author&#39;</span> <span class="nx">field</span><span class="o">=</span><span class="p">{</span><span class="nx">author</span><span class="p">}</span> <span class="nx">options</span><span class="o">=</span><span class="p">{</span>
                        <span class="nx">authors</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">a</span> <span class="p">=&gt;</span> <span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">a</span><span class="p">.</span><span class="nx">first_name</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">a</span><span class="p">.</span><span class="nx">last_name</span><span class="si">}</span><span class="sb">`</span><span class="p">}))</span>
                    <span class="p">}</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isSubmitting</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleSubmit</span><span class="p">(</span><span class="nx">tsubmit</span><span class="p">)}</span><span class="o">&gt;</span>
                <span class="nx">Save</span>
            <span class="o">&lt;</span><span class="err">/button&gt;</span>
            <span class="p">{</span><span class="nx">id</span><span class="o">?&lt;</span><span class="nx">button</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">isSubmitting</span><span class="p">}</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;button&#39;</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">backgroundColor</span><span class="o">:</span> <span class="nx">danger</span><span class="p">}}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">dsubmit</span><span class="p">}</span><span class="o">&gt;</span>
                <span class="nx">Delete</span>
            <span class="o">&lt;</span><span class="err">/button&gt;:null}</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
<p>The <tt class="docutils literal">render</tt> method of <tt class="docutils literal">BookForm</tt> defines (for convenience) a bunch of constants which are
attributes of <tt class="docutils literal">props</tt>:</p>
<ul class="simple">
<li>The <tt class="docutils literal">fields</tt> object contains the field attributes of the form which have been defined through the <tt class="docutils literal">reduxForm</tt> function.</li>
<li>The <tt class="docutils literal">handleSubmit</tt> is also provided by <tt class="docutils literal">reduxForm</tt> and is used to submit the form - I&#8217;ll explain it a bit&nbsp;later</li>
<li>The <tt class="docutils literal">dispatch</tt> is provided by <tt class="docutils literal">connect</tt> (remember, <tt class="docutils literal">reduxForm</tt> is a special <tt class="docutils literal">connect</tt>). If you don&#8217;t use <tt class="docutils literal">mapDispatchToProps</tt> then <tt class="docutils literal">connect</tt> will provide <tt class="docutils literal">dispatch</tt> to <tt class="docutils literal">props</tt> to use it as you&nbsp;like</li>
<li>The <tt class="docutils literal">id</tt> is from the route - it will have value when updating and will be undefined when creating a new&nbsp;book</li>
<li>The <tt class="docutils literal">isSubmitting</tt>, <tt class="docutils literal">categories</tt>, <tt class="docutils literal">subcategories</tt> and <tt class="docutils literal">authors</tt> are provided from the state attributes through <tt class="docutils literal">mapStateToProps</tt></li>
<li>The <tt class="docutils literal">tsubmit</tt> and <tt class="docutils literal">dsubmit</tt> are used when the form is submitted or the Delete button is clicked. As we&#8217;ll see the <tt class="docutils literal">tsubmit</tt> is passed as an argument to <tt class="docutils literal">handleSubmit</tt> while the <cite>dsubmit`</cite> is used as it&nbsp;is.</li>
</ul>
<p>Beyond <tt class="docutils literal">fields</tt> and <tt class="docutils literal">handleSubmit</tt> a <tt class="docutils literal">reduxForm</tt> enabled form component has various other
<a class="reference external" href="http://erikras.github.io/redux-form/#/api/props?_k=y5rbd2">properties that you can use</a>, like <tt class="docutils literal">active</tt>, <tt class="docutils literal">dirty</tt>, <tt class="docutils literal">error</tt>, <tt class="docutils literal">pristine</tt> etc.
Each <tt class="docutils literal">field</tt> provided from <tt class="docutils literal">reduxForm</tt> also has a bunch of properties, like
<tt class="docutils literal">active</tt>, <tt class="docutils literal">checked</tt>, <tt class="docutils literal">dirty</tt>, <tt class="docutils literal">error</tt>,
<tt class="docutils literal">onBlur</tt>, <tt class="docutils literal">onChange</tt>, <tt class="docutils literal">onFocus</tt>,
<tt class="docutils literal">pristine</tt>, <tt class="docutils literal">touched</tt>,
<tt class="docutils literal">valid</tt>, <tt class="docutils literal">value</tt>, <tt class="docutils literal">visited</tt>. I won&#8217;t use most of these here however please make sure
that you are familiar with these when using&nbsp;redux-form.</p>
<p>After defining the constants, the <tt class="docutils literal">render</tt> method returns the actual component.
Here we are using a bunch of child components we&#8217;ve defined to render the input
fields, like <tt class="docutils literal">Input</tt>, <tt class="docutils literal">DatePicker</tt> and <tt class="docutils literal">Select</tt> which will be explained
later. For each one of these components we pass the corresponding <tt class="docutils literal">field</tt>
property along with the label we want to show. There are some interesting things
in the parameters we pass to these input&nbsp;components:</p>
<p>All fields except <tt class="docutils literal">category</tt> use their own <tt class="docutils literal">onChange</tt>. For the <tt class="docutils literal">category</tt>
field we pass a custom <tt class="docutils literal">onChange</tt> function that will override the <tt class="docutils literal">field</tt>
onChange in order to dispatch <tt class="docutils literal">loadSubCategories</tt> when the <tt class="docutils literal">category</tt>
is changed (notice that in the custom <tt class="docutils literal">onChange</tt>
I actually call the <tt class="docutils literal">category.onChange</tt> first and then
use <tt class="docutils literal">event.target.value</tt> to get the current value of the dropdown to pass it
to the dispatched <tt class="docutils literal">loadSubCategories</tt>).</p>
<p>The <tt class="docutils literal">Select</tt> fields get an <tt class="docutils literal">options</tt> parameter which should be an array
with <tt class="docutils literal">id/name</tt> objects. For <tt class="docutils literal">authors</tt> we create that array on the fly
using <tt class="docutils literal">map</tt> (since an author object has a <tt class="docutils literal">first_name</tt> and <tt class="docutils literal">last_name</tt>).</p>
<p>The submit and delete buttons will be enabled or disabled depending on the <tt class="docutils literal">isSubmitting</tt> flag,
and will call <tt class="docutils literal">handleClick(tsubmit)</tt> or <tt class="docutils literal">dsubmit</tt> correspondingly. Also, the Delete button will
be hidden if no <tt class="docutils literal">id</tt> is&nbsp;provided.</p>
<p>The <tt class="docutils literal">handleSubmit</tt> method provided by <tt class="docutils literal">reduxForm</tt> will run the <tt class="docutils literal">validate</tt> function passing it
the values from the form (notice that this is synchronous validation, we could also do asynchronous -
on the server- validation for example to immediately check if a username is already used), and if
the validation does not return any errors, it will submit the form.
Submitting the form means that <tt class="docutils literal">handleSubmit</tt> will
either call <tt class="docutils literal">this.props.onSubmit</tt> <em>or</em> will call the argument of <tt class="docutils literal">handleSubmit</tt> (that&#8217;s what
we&#8217;ve done here), passing it the data of the&nbsp;form.</p>
<p>In our case, we want to pass the id of the book to be updated (or undefined when the form
is used to create a book) to the submit function, that&#8217;s why I am assigning
<tt class="docutils literal">submit.bind(undefined,id)</tt> to <tt class="docutils literal">tsubmit</tt> (which is what is passed to <tt class="docutils literal">handleSubmit</tt>) - this
will return a new function with the <tt class="docutils literal">id</tt> as its first argument. The <tt class="docutils literal">handleSubmit</tt> also
passes the <tt class="docutils literal">values</tt> of the form as an object along with the <tt class="docutils literal">dispatch</tt> function, so
<tt class="docutils literal">submit</tt> is a function with three&nbsp;arguments:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">submit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;//127.0.0.1:8000/api/books/&#39;</span>
    <span class="kd">let</span> <span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;POST&#39;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="sb">`//127.0.0.1:8000/api/books/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;PUT&#39;</span>
    <span class="p">}</span>

    <span class="nx">dispatch</span><span class="p">(</span><span class="nx">submittingChanged</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">type</span><span class="p">,</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="nx">values</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">submittingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSuccessNotification</span><span class="p">(</span><span class="s1">&#39;Success!&#39;</span><span class="p">))</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">dispatch</span><span class="p">(</span><span class="nx">updateBookResult</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">dispatch</span><span class="p">(</span><span class="nx">addBookResult</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">routeActions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>

        <span class="p">},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">submittingChanged</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showErrorNotification</span><span class="p">(</span><span class="sb">`Error (</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">) while saving: </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">responseText</span><span class="si">}</span><span class="sb">`</span> <span class="p">))</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>
<p>As we can see it just checks if the <tt class="docutils literal">id</tt> has a value and creates the
url and the <span class="caps">HTTP</span> method for the update (either a <tt class="docutils literal"><span class="caps">POST</span></tt> when creatign a new book or
a <tt class="docutils literal"><span class="caps">PUT</span></tt> when updating an existing one). It will then <tt class="docutils literal">dispatch</tt> the
<tt class="docutils literal">submittingChanged</tt> action to change the <span class="caps">UI</span> (disable the buttons) and do the ajax call. When
the call returns, if everything was ok it will <tt class="docutils literal">dispatch</tt> the <tt class="docutils literal">submittingChanged</tt>
(with false as a parameter), the <tt class="docutils literal">showSuccessNotification</tt> (with success as parameter),
either <tt class="docutils literal">updateBookResult</tt> or <tt class="docutils literal">addBookResult</tt> with the retrieved data as paramater
(depending if there was an <tt class="docutils literal">id</tt>) and finally it will change the <span class="caps">URL</span> to <tt class="docutils literal">/</tt> to display
the books table. If there was an error it will once again dispatch the
<tt class="docutils literal">submittingChanged</tt> action to turn off the submit flag of the state and
<tt class="docutils literal">showErrorNotification</tt> with information on the error. The url won&#8217;t change
so that the user will be able to fix the error and retry&nbsp;submitting.</p>
<p>The <tt class="docutils literal">del</tt> function is a little different. We bind not only with <tt class="docutils literal">id</tt> but also
with <tt class="docutils literal">dispatch</tt> because we don&#8217;t call it through <tt class="docutils literal">handleSubmit</tt>
(since when deleting no validation is actually needed)
but directly as the <tt class="docutils literal">onclick</tt> handler of the delete button
(so we must pass dispatch&nbsp;manually):</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">del</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`//127.0.0.1:8000/api/books/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span>
    <span class="kr">const</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;DELETE&#39;</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">type</span><span class="p">,</span>
        <span class="nx">url</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSuccessNotification</span><span class="p">(</span><span class="s1">&#39;Success!&#39;</span><span class="p">))</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">deleteBookResult</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">routeActions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>
        <span class="p">},</span>
        <span class="nx">error</span><span class="o">:</span> <span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">showErrorNotification</span><span class="p">(</span><span class="sb">`Error (</span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">) while saving: </span><span class="si">${</span><span class="nx">d</span><span class="p">.</span><span class="nx">responseText</span><span class="si">}</span><span class="sb">`</span> <span class="p">))</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>
<p>This function sends a <tt class="docutils literal"><span class="caps">DELETE</span></tt> method to the correct url and, if everything
was ok <tt class="docutils literal">dispatches</tt> the <tt class="docutils literal">showSuccessNotification</tt>, <tt class="docutils literal">deleteBookResult</tt> and
<tt class="docutils literal">routeActions.push</tt>, similarly with <tt class="docutils literal">submit</tt>.</p>
<p>One thing that I&#8217;d like to discuss here is the nature of the <tt class="docutils literal">submit</tt> and <tt class="docutils literal">del</tt>
functions: These function do dispatch other actions but they are not implemented
as thunks so, in order
to be able to actually dispatch something they need to retrieve <tt class="docutils literal">dispatch</tt>
as a parameter
(please remember the discussion on the redux-thunk section and the difference
between <tt class="docutils literal">dispatch(actionCreator)</tt> and <tt class="docutils literal">actionCreator(dispatch)</tt> ). The
<tt class="docutils literal">submit</tt> function  receives <tt class="docutils literal">dispatch</tt> from <tt class="docutils literal">handleSubmit</tt> while we pass
dispatch directly (using <tt class="docutils literal">bind</tt>) to the <tt class="docutils literal">del</tt> function.</p>
<p>I could
have implemented them as thunks (and put them to the <tt class="docutils literal">actions</tt> module) however
I feel that leaving them here
will make the <span class="caps">API</span> of the application more compact (since if these functions
had been put in the actions module they would need to be exported so they&#8217;d
be a part of the public <span class="caps">API</span> of this application - however these two are only
called from <tt class="docutils literal">BookForm</tt>) and also their purpose and integration with <tt class="docutils literal">handleSubmit</tt>
is more clear if we leave them as plain functions. This is just my personal
opinion - if for example you wanted to allow deleting a book not only from the <tt class="docutils literal">BookForm</tt>
but also from the <tt class="docutils literal">BookPanel</tt> (by adding a delete button to each book row) then
you&#8217;d definitely need to export <tt class="docutils literal">del</tt> as an action creator (preferably as a thunk action
creator to be consistent with the&nbsp;others).</p>
<div class="section" id="components-input">
<h4><a class="toc-backref" href="#id29">components/Input</a></h4>
<p>This is a simple functional component that gets a redux-form
text field and a label as properties and renders a text
input with a <tt class="docutils literal">&lt;label&gt;</tt> and an optional error message.
The error message will only be rendered if the field
has been touched (i.e the user has changed the field or
the form has been submitted) and there&#8217;s an actual&nbsp;error:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span><span class="nx">field</span><span class="p">,</span> <span class="nx">label</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">forHtml</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">label</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span> <span class="p">{...</span><span class="nx">field</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span> <span class="o">&amp;&amp;</span> <span class="nx">field</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="nx">backgroundColor</span><span class="o">:</span> <span class="nx">danger</span><span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>
<p>One thing I&#8217;d like to explain is the <tt class="docutils literal"><span class="pre">{...field}</span></tt> snippet
I pass to <tt class="docutils literal">&lt;input&gt;</tt>. This is the object spread operator and will
convert each attribute of the <tt class="docutils literal">field</tt> object to a corresponding <tt class="docutils literal">attr=value</tt>
pair,&nbsp;i.e</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">input</span> <span class="p">...</span> <span class="nx">name</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span> <span class="nx">onChange</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">onChange</span> <span class="nx">value</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">value</span> <span class="nx">onBlur</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">OnBlur</span> <span class="nx">etc</span> <span class="o">/&gt;</span>
</pre></div>
</div>
<div class="section" id="components-select">
<h4><a class="toc-backref" href="#id30">components/Select</a></h4>
<p>The <tt class="docutils literal">Select</tt> component renders a dropdown (select) input.
It should receive a redux-form field, a label and an array
of objects with <tt class="docutils literal">id</tt> and <tt class="docutils literal">name</tt> attributes that will be
rendered as the options. The <tt class="docutils literal">label</tt> and <tt class="docutils literal">error` will be
rendered similarly to ``Input</tt>:</p>
<div class="highlight"><pre><span></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span><span class="nx">field</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">forHtml</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">label</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
    <span class="o">&lt;</span><span class="nx">select</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span> <span class="p">{...</span><span class="nx">field</span><span class="p">}</span> <span class="p">{...</span><span class="nx">props</span><span class="p">}</span> <span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;&lt;</span><span class="err">/option&gt;</span>
        <span class="p">{</span><span class="nx">options</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">c</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">option</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="o">&gt;</span><span class="p">{</span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/option&gt;)}</span>
    <span class="o">&lt;</span><span class="err">/select&gt;</span>
    <span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span> <span class="o">&amp;&amp;</span> <span class="nx">field</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="nx">backgroundColor</span><span class="o">:</span> <span class="nx">danger</span><span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;}</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
</pre></div>
<p>For the options we include an empty option (as a default value) and the other
options are created with the help of a <tt class="docutils literal">map</tt>. Finally, notice that I have
also used <tt class="docutils literal"><span class="pre">...props</span></tt> here in the the function parameter list to capture all parameters not
captured by <tt class="docutils literal">field</tt>, <tt class="docutils literal">label</tt> and <tt class="docutils literal">options</tt> and then pass
both <tt class="docutils literal"><span class="pre">{...field}</span></tt> and <tt class="docutils literal"><span class="pre">{...props}</span></tt> to the <tt class="docutils literal">select</tt> component. This is
to capture the custom <tt class="docutils literal">onChange</tt> (that I pass for the categories <tt class="docutils literal">Select</tt>)
and use that custom <tt class="docutils literal">onChange</tt> when the select value changes. The custom
<tt class="docutils literal">onChange</tt> will override the <tt class="docutils literal">field.onChange</tt> because the {&#8230;props} is
<em>after</em> {&#8230;field}, so the resulting select will be something&nbsp;like:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">select</span> <span class="p">...</span> <span class="nx">onChange</span><span class="o">=</span><span class="nx">field</span><span class="p">.</span><span class="nx">onChange</span> <span class="p">...</span> <span class="nx">onChange</span><span class="o">=</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChange</span> <span class="o">&gt;</span>
</pre></div>
<p>This is
a common idiom for overriding properties of objects that are passed
to components - for example I could pass a <tt class="docutils literal">className</tt> property to
<tt class="docutils literal">&lt;Select&gt;</tt> to override the default one (<tt class="docutils literal"><span class="pre">className=&quot;u-full-width&quot;</span></tt>).</p>
</div>
<div class="section" id="components-datepicker">
<h4><a class="toc-backref" href="#id31">components/DatePicker</a></h4>
<p>This component is used to render a jquery-ui datepicker. Similarly
to the other input components it receives a redux-form <tt class="docutils literal">field</tt>
and a <tt class="docutils literal">label</tt>. However, this is a
class based component because it needs to have <tt class="docutils literal">this</tt> for attaching
the <tt class="docutils literal">datepicker</tt> to an input. Beyond the normal rendering, we can
see that we have added a <tt class="docutils literal"><span class="pre">ref='date'</span></tt> to the <tt class="docutils literal">input</tt> to allow
us to refer to it later. This ref is used by <tt class="docutils literal">componentDidMount</tt>
and <tt class="docutils literal">handleChange</tt>:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">DatePicker</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span> <span class="nx">field</span><span class="p">,</span> <span class="nx">label</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
        <span class="k">return</span><span class="p">(</span>
            <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">label</span> <span class="nx">forHtml</span><span class="o">=</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">label</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
                <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span> <span class="nx">ref</span><span class="o">=</span><span class="s1">&#39;date&#39;</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;u-full-width&quot;</span> <span class="p">{...</span><span class="nx">field</span><span class="p">}</span> <span class="o">/&gt;</span>
                <span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">touched</span> <span class="o">&amp;&amp;</span> <span class="nx">field</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="nx">backgroundColor</span><span class="o">:</span> <span class="nx">danger</span><span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">field</span><span class="p">.</span><span class="nx">error</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/div&gt;}</span>
            <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">date</span><span class="p">)).</span><span class="nx">datepicker</span><span class="p">({</span> <span class="nx">dateFormat</span><span class="o">:</span> <span class="s1">&#39;yy-mm-dd&#39;</span> <span class="p">});</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">date</span><span class="p">)).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="nx">handleChange</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
        <span class="kd">let</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">findDOMNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">date</span><span class="p">).</span><span class="nx">value</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">field</span><span class="p">.</span><span class="nx">onChange</span><span class="p">(</span><span class="nx">date</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>The <tt class="docutils literal">componentDidMount</tt> retrieves the input <span class="caps">DOM</span> element through the <tt class="docutils literal">ref</tt>
and makes it a datepicker. It also sets its <tt class="docutils literal">onchange</tt> method to the
<tt class="docutils literal">handleChange</tt> method (notice the <tt class="docutils literal">bind(this)</tt> part &#8212; this is needed
so that <tt class="docutils literal">this</tt> will be defined correctly inside the <tt class="docutils literal">handleChange</tt>). The
<tt class="docutils literal">handleChange</tt> retrieves the current date (once again from the <tt class="docutils literal">ref</tt>)
and just calls the <tt class="docutils literal">onChange</tt> of the provided <tt class="docutils literal">field</tt>, passing it the
date&nbsp;value.</p>
</div>
<div class="section" id="should-i-create-my-own-input-components">
<h4><a class="toc-backref" href="#id32">Should I create my own input&nbsp;components?</a></h4>
<p>As you&#8217;ve seen, I&#8217;ve created my <em>own</em> custom input components. These components
are created with the correct styling for the css framework I use here (<tt class="docutils literal">skeleton.css</tt>) but
of course with small changes could easily be modified to be used with other css frameworks
(I am using <tt class="docutils literal">bootstrap 3</tt> in most of my normal apps and such components work great).
They also have been created for exactly my needs (i.e get the <tt class="docutils literal"><span class="pre">redux-form</span></tt> field as input,
allow overriding onChange&nbsp;etc).</p>
<p>Instead of creating your own components by hand, you could of course use some specific component
libraries like <a class="reference external" href="http://www.material-ui.com/#/">material-ui</a> or <a class="reference external" href="https://react-bootstrap.github.io/">react-bootstrap</a>. These libraries contain components
such as the <tt class="docutils literal">Input</tt> or <tt class="docutils literal">Select</tt> we implemented here with a consistent <span class="caps">API</span> and
styling. Unfortunately, these components are a little more difficult to use than
just creating your&nbsp;own:</p>
<ul class="simple">
<li>You need to learn their <span class="caps">API</span> (the names of the properties they get, their behavior in various conditions&nbsp;etc)</li>
<li>You need to learn their styling <span class="caps">API</span> (most of them make it difficult to customize their&nbsp;appearence)</li>
<li>It is not very easy to integrate them to your existing css framework (if you have one), so you&#8217;ll need to go all the way to use their&nbsp;styles</li>
<li>You may need to use custom components anyway because you want to use a different javascript component that is not provided by these&nbsp;libraries</li>
</ul>
<p>It all boils down to how big is your project and if you already have some styling for
your pages. If you want to build a rather small project or your project already has a consistent
styling then its better to create the required input components by hand. If on the other hand
you want to build a big project from scratch then probably it would be better to bite the
bullet and use a component library, but keep in mind that you may actually need to create
your own&nbsp;components.</p>
</div>
</div>
<div class="section" id="components-authorpanel">
<h3><a class="toc-backref" href="#id33">components/AuthorPanel</a></h3>
<p>The <tt class="docutils literal">AuthorPanel</tt> uses <tt class="docutils literal">Table</tt> to list the authors. Since I haven&#8217;t used
pagination or sorting here the component is very&nbsp;simple:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">format</span><span class="o">:</span> <span class="nx">x</span><span class="p">=&gt;</span><span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="p">{</span><span class="sb">`/author_update/</span><span class="si">${</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/`</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">x</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/Link&gt;},</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Last name&#39;</span><span class="p">,},</span>
    <span class="p">{</span><span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;First name&#39;</span><span class="p">,},</span>
<span class="p">]</span>

<span class="kr">const</span> <span class="nx">AuthorPanel</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;twelve columns&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Author</span> <span class="nx">list</span> <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">className</span><span class="o">=</span><span class="s1">&#39;button button-primary&#39;</span> <span class="nx">style</span><span class="o">=</span><span class="p">{{</span><span class="nx">fontSize</span><span class="o">:</span><span class="s1">&#39;1em&#39;</span><span class="p">}}</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/author_create/&quot;</span><span class="o">&gt;+&lt;</span><span class="err">/Link&gt;&lt;/h3&gt;</span>
        <span class="o">&lt;</span><span class="nx">Table</span> <span class="nx">cols</span><span class="o">=</span><span class="p">{</span><span class="nx">cols</span><span class="p">}</span> <span class="nx">rows</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>

<span class="kr">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">authors</span><span class="o">:</span><span class="nx">state</span><span class="p">.</span><span class="nx">authors</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="section" id="components-authorform">
<h3><a class="toc-backref" href="#id34">components/AuthorForm</a></h3>
<p>The <tt class="docutils literal">AuthorForm</tt> is similar to <tt class="docutils literal">BookForm</tt> and is used to
create a new author, update or delete an existing one. It uses
the <tt class="docutils literal">Input</tt> component to edit the first and last name
of each author. I won&#8217;t go into more detail about this
component since everything must be clear by&nbsp;now.</p>
</div>
</div>
<div class="section" id="changing-the-ui-when-the-data-is-changed">
<h2><a class="toc-backref" href="#id35">Changing the <span class="caps">UI</span> when the data is&nbsp;changed</a></h2>
<p>Commenter Tomas Jacobsen asked for a tutorial on <a class="reference external" href="http://spapas.github.io/2015/09/08/more-complex-react-flux-example/#comment-2667922265">how the <span class="caps">UI</span> will be updated when the data is changed in a different window</a>. Well,
requirements like this is actually the reason for using react and redux I decided to add that capability to this application. If you want
to check it out, please <tt class="docutils literal">git checkout</tt> the tag <tt class="docutils literal"><span class="pre">react-redux-poll-update</span></tt> of the same repository (<a class="reference external" href="https://github.com/spapas/react-tutorial/">https://github.com/spapas/react-tutorial/</a>).</p>
<p>This extra functionality simply checks (using polling) every few seconds if the number of authors has changed and if it has, it will reload the authors
and dispaly a notification. Beyond the <span class="caps">ES6</span> code, I&#8217;ve added a small <span class="caps">REST</span> <span class="caps">API</span> view that returns the number of authors in the database (it just
returns a number) and a django management command that adds an author. So, to test the new functionality, run
the django application and thhen run <tt class="docutils literal">python manage.py add_author</tt> in a different window - after a few seconds you should see that the
authors have been updated along with a&nbsp;notification.</p>
<p>To implement the <span class="caps">UI</span> update in <span class="caps">ES6</span>, I&#8217;ve added a file named <tt class="docutils literal">scheduler.js</tt> with the following&nbsp;contents:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">&#39;./store&#39;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">loadAuthors</span><span class="p">,</span> <span class="nx">showSuccessNotification</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./actions&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Starting scheduler&quot;</span><span class="p">)</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>

        <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8000/api/authors/get_author_number/&#39;</span><span class="p">;</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">realAuthorNumber</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">authorNumber</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">().</span><span class="nx">authors</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">authorNumber</span><span class="o">!=</span><span class="nx">realAuthorNumber</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">showSuccessNotification</span><span class="p">(</span><span class="s2">&quot;Authors have changed - reloading ...&quot;</span><span class="p">));</span>
                <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">loadAuthors</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">});</span>

    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>and then just import the default function from <tt class="docutils literal">main.js</tt> and call&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">schedule</span> <span class="nx">from</span> <span class="s1">&#39;./scheduler&#39;</span><span class="p">;</span>

<span class="nx">schedule</span><span class="p">();</span>
</pre></div>
<p>So, we can see that every 2 seconds we retrieve (using Ajax) the number of authors and,
if their number is different than the current number of authors in the <span class="caps">UI</span> (which we retrieve from
the store using its <tt class="docutils literal">getState</tt> method) display the notification and reload the authors (by
dispatching two actions (which are created through the corresponding actions creators)! That&#8217;s
all that is needed to update the <span class="caps">UI</span>!</p>
<p>Notice that, although I&#8217;ve used ajax and polling to find out when the <span class="caps">UI</span> needs to be updated
you could instead use whatever different method you like, for example&nbsp;WebSockets.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id36">Conclusion</a></h2>
<p>In the above sections we presented and explained
a more or less complete single page react / redux
application, <em>almost</em> ready to be deployed to production.
I tried to explain every concept I came across that&#8217;s why
this article became more fat that I was expecting when I
started writing it! The presented application supports nearly
everything you&#8217;ll want to use when creating your own&nbsp;apps:</p>
<ul class="simple">
<li>Complex&nbsp;forms</li>
<li>Custom&nbsp;components</li>
<li>Asynchronous actions /&nbsp;Ajax</li>
<li>Creating / updating / deleting&nbsp;objects</li>
<li>Client side&nbsp;routing</li>
<li>Result lists with pagination, sorting and&nbsp;filtering</li>
</ul>
<p>The above have been implemented using the following technologies /&nbsp;libraries:</p>
<ul class="simple">
<li>Django /&nbsp;django-rest-framework</li>
<li><span class="caps">ES6</span> with&nbsp;babel</li>
<li>browserify / watchify /&nbsp;babelify</li>
<li>React / redux /&nbsp;react-redux</li>
<li>redux-thunk / redux-form / react-router-redux /&nbsp;react-notification</li>
</ul>
<p>What could be missing from the application we presented&nbsp;here:</p>
<ul class="simple">
<li>Tests!</li>
<li>Integrating <a class="reference external" href="https://github.com/gaearon/redux-devtools">redux-devtools</a></li>
<li>Using envify to seperate development/production client side code (this is needeed if you actually integrate&nbsp;redux-devtools)</li>
<li>Intagration with a component&nbsp;library</li>
</ul>
<p>I advice you to research these subjects a bit - I&#8217;ll also try to
write another (hopefully thinner) post with more info
about&nbsp;these.</p>
<p>Finally, two thing I&#8217;d like to point out and keep in mind are that using
redux/react-redux the flow of the data is <em>crystal</em> and that as you&#8217;ve already
seen by now, writing functional components and reducers is <em>pure fun</em>!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2015/12/22/ajax-with-react-fixed-data-table/">Ajax data with Fixed Data Table for React</a>
      </h1>
    <p class="meta">
<time datetime="2015-12-22T15:20:00+02:00" pubdate>Τρι 22 Δεκέμβριος 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#our-project" id="id2">Our&nbsp;project</a></li>
<li><a class="reference internal" href="#how-fixeddatatable-gets-its-data" id="id3">How FixedDataTable gets its&nbsp;data</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-1" id="id4">AjaxCell: Non working version&nbsp;1</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-2" id="id5">AjaxCell: Non working version&nbsp;2</a></li>
<li><a class="reference internal" href="#ajaxcell-non-working-version-3" id="id6">AjaxCell: Non working version&nbsp;3</a></li>
<li><a class="reference internal" href="#ajaxcell-final-version" id="id7">AjaxCell: Final&nbsp;version</a></li>
<li><a class="reference internal" href="#the-table-container-component" id="id8">The Table container&nbsp;component</a></li>
<li><a class="reference internal" href="#some-enchancements" id="id9">Some&nbsp;enchancements</a></li>
<li><a class="reference internal" href="#conslusion" id="id10">Conslusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p><a class="reference external" href="https://facebook.github.io/fixed-data-table/">FixedDataTable</a> is a nice React component from Facebook that is used to render tabular data.
Its main characteristic is that it can handle many rows without sacrificing performance, however
probably due to this fact I was not able to find any examples for loading data using Ajax - all
examples I was able to find had the data already loaded (or created on the&nbsp;fly).</p>
<p>So, although FixedDataTable is able to handle many rows, I am against transfering all of them to the user
whenever our page loads since at most one page of data will be shown on screen (30 rows or so ?) -
any other actions (filtering, sorting, aggregate calculations etc) should be done on the&nbsp;server.</p>
<p>In the following I will present a simple, react-only example with a FixedDataTable that can be
used with server-side, asynchronous, paginated&nbsp;data.</p>
</div>
<div class="section" id="our-project">
<h2><a class="toc-backref" href="#id2">Our&nbsp;project</a></h2>
<p>Let&#8217;s see an example of what we&#8217;ll&nbsp;build:</p>
<img alt="Our project" src="/images/ajax_fixed_data_tables.gif" style="width: 600px;" />
<p>As a source of the data I&#8217;ve used the <a class="reference external" href="http://swapi.co/">Star Wars <span class="caps">API</span></a> and specifically its <a class="reference external" href="http://swapi.co/documentation#people">People <span class="caps">API</span></a> by issuing
requests to <a class="reference external" href="http://swapi.co/api/people/?format=json">http://swapi.co/api/people/?format=json</a>. This will return an array of people from the
star wars universe in <span class="caps">JSON</span> format - the results are paginated with a page size of 10 (and we can switch
to another page using the extra <tt class="docutils literal">page=</tt> request&nbsp;parameter).</p>
<p>I will use es6 with the object spread operator (as described in <a class="reference external" href="https://spapas.github.io/2015/11/16/using-browserify-es6/">a previous article</a>)
to write the code, using a single main.js as a source which will be transpiled to <tt class="docutils literal">dist/bundle.js</tt>.</p>
<p>The placeholder <span class="caps">HTML</span> for our application&nbsp;is:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello Ajax Fixed Data Table!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://cdnjs.cloudflare.com/ajax/libs/fixed-data-table/0.6.0/fixed-data-table.min.css&#39;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;dist/bundle.js&#39;</span> <span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>The versions that are used are react 14.3 and fixed-data-table 0.6.0. You can find this project in github &#64;
<a class="reference external" href="https://github.com/spapas/react-tables">https://github.com/spapas/react-tables</a> &#8212; tag name <tt class="docutils literal"><span class="pre">fixed-data-table-ajax</span></tt>.</p>
</div>
<div class="section" id="how-fixeddatatable-gets-its-data">
<h2><a class="toc-backref" href="#id3">How FixedDataTable gets its&nbsp;data</a></h2>
<p>The data of a <tt class="docutils literal">FixedDataTable</tt> component is defined through a number of <tt class="docutils literal">Column</tt> components
and specifically, the <tt class="docutils literal">cell</tt> attribute of that component which sould either return be a static string
to be displayed in that column or a React component (usually a <tt class="docutils literal">Cell</tt>) that will be displayed in
that column or even a function that returns a string or a react component. The function (or component)
passed to <tt class="docutils literal">cell</tt> will have an object with a <tt class="docutils literal">rowIndex</tt> attribute (among others) as a parameter,
for example the&nbsp;following</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">Column</span>
  <span class="na">header</span><span class="o">=</span><span class="s">{&lt;Cell</span><span class="p">&gt;</span>Url<span class="p">&lt;/</span><span class="nt">Cell</span><span class="p">&gt;</span>}
  cell={props =&gt; props.rowIndex}
  width={200}
/&gt;
</pre></div>
<p>will just display the rowIndex for each&nbsp;cell.</p>
<p>So we can see that for each cell that FixedDataTable wants to display it will use its corresponding
<tt class="docutils literal">cell</tt> attribute.
So, a general though if we wanted to support asynchronous, paginated data
is to check the rowIndex and retrieve the correct page asynchronously.
This would lead to a difficulty: What should the <tt class="docutils literal">cell</tt> function return? We&#8217;ll try to resolve this
using an <tt class="docutils literal">AjaxCell</tt> function that should return a react componet to put in the&nbsp;cell:</p>
</div>
<div class="section" id="ajaxcell-non-working-version-1">
<h2><a class="toc-backref" href="#id4">AjaxCell: Non working version&nbsp;1</a></h2>
<p>A first sketch of an <tt class="docutils literal">`AjaxCell</tt> component could be something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1">// Careful - not working</span>
<span class="kr">const</span> <span class="nx">AjaxCell1</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Here we have the result ! But where will it go ?</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="c1">/// what ?</span>
<span class="p">}</span>
</pre></div>
<p>The col attribute will later be used to select the attribute we want to display in this cell.
The <tt class="docutils literal">page</tt> and <tt class="docutils literal">idx</tt> will have the correct page number and idx inside that page (for example,
if <tt class="docutils literal">rowIndex</tt> is 33, <tt class="docutils literal">page</tt> will be 4 and idx will be 3. The problem with the above is that
the fetch function will be called <em>asynchronously</em> so when the AjaxCell returns it will <em>not</em> have
the results (yet)! So we won&#8217;t be able to render anything&nbsp;:(</p>
</div>
<div class="section" id="ajaxcell-non-working-version-2">
<h2><a class="toc-backref" href="#id5">AjaxCell: Non working version&nbsp;2</a></h2>
<p>To be able to render <em>something</em>, we could put the results of fetching a page to a <tt class="docutils literal">cache</tt> dictionary &#8212; and only
fetch that page if it is not inside the <tt class="docutils literal">cache</tt> - if it is inside the cache then we&#8217;ll just return
the correct&nbsp;value:</p>
<div class="highlight"><pre><span></span><span class="c1">// Careful - not working correctly</span>
<span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kr">const</span> <span class="nx">AjaxCell2</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">forceUpdate</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">);</span>
        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;-&lt;</span><span class="err">/Cell&gt;;</span>
<span class="p">}</span>
</pre></div>
<p>The above will work, since it will return an empty (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt>) initially but when the
<tt class="docutils literal">fetch</tt> returns it will set the <tt class="docutils literal">cache</tt> for that page and return the correct value (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;{cache[page][idx][col]}&lt;/Cell&gt;</span></tt>).</p>
<p>However, as can be understood, when the page first loads it will call <tt class="docutils literal">AjaxCell2</tt> for all visible cells &#8212;
because fetch is asynchronous and takes time until it returns (and sets the cache for that page), so the
<tt class="docutils literal">fetch</tt> will be called for <em>all</em>&nbsp;cells!</p>
</div>
<div class="section" id="ajaxcell-non-working-version-3">
<h2><a class="toc-backref" href="#id6">AjaxCell: Non working version&nbsp;3</a></h2>
<p><tt class="docutils literal">fetch</tt> ing each page multiple times is of course not acceptable, so we&#8217;ll add a <tt class="docutils literal">loading</tt> flag
and <tt class="docutils literal">fetch</tt> will be called only when this flag is <tt class="docutils literal">false</tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1">// Not ready yet</span>
<span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">let</span> <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">AjaxCell2</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">);</span>
        <span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
            <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;-&lt;</span><span class="err">/Cell&gt;;</span>
<span class="p">}</span>
</pre></div>
<p>This works much better - the cells are rendered correctly and each page is loaded only once. However, if for example
I tried to move to the end of the table quickly, I would see some cells that are always loading (they never get their correct value). This is because
there is no way to know that the fetch function has actually completed in order to update with the latest (correct) value of that
cell and will contain the stale placeholder (<tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt>)&nbsp;value.</p>
</div>
<div class="section" id="ajaxcell-final-version">
<h2><a class="toc-backref" href="#id7">AjaxCell: Final&nbsp;version</a></h2>
<p>To clear the stale data we need to do an update to the table data
when each fetch is finished &#8212; this should be done by a callback that will be passed to the <tt class="docutils literal">AjaxCell</tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">let</span> <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">AjaxCell</span> <span class="o">=</span> <span class="p">({</span><span class="nx">rowIndex</span><span class="p">,</span> <span class="nx">col</span><span class="p">,</span> <span class="nx">forceUpdate</span><span class="p">,</span> <span class="p">...</span><span class="nx">props</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">rowIndex</span><span class="o">&gt;=</span><span class="nx">pageSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">page</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">rowIndex</span> <span class="o">/</span> <span class="nx">pageSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">idx</span> <span class="o">=</span> <span class="nx">rowIndex</span> <span class="o">%</span> <span class="nx">pageSize</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">][</span><span class="nx">idx</span><span class="p">][</span><span class="nx">col</span><span class="p">]}</span><span class="o">&lt;</span><span class="err">/Cell&gt;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Loading page &quot;</span> <span class="o">+</span> <span class="nx">page</span><span class="p">);</span>
        <span class="nx">loading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
            <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">forceUpdate</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">loadingCell</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>So we pass a forceUpdate callback as a property which is called when a fetch is finished. This may
result to some not needed updates to the table (since we would do a fetch + forceUpdate for non-displayed
data) but we can now be positive that when the data is loaded the table will be updated to dispaly&nbsp;it.</p>
</div>
<div class="section" id="the-table-container-component">
<h2><a class="toc-backref" href="#id8">The Table container&nbsp;component</a></h2>
<p>Finally, the component that contains the table is the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">TableContainer</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
    <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Table</span>
            <span class="nx">rowHeight</span><span class="o">=</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span> <span class="nx">rowsCount</span><span class="o">=</span><span class="p">{</span><span class="mi">87</span><span class="p">}</span> <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">600</span><span class="p">}</span> <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span> <span class="nx">headerHeight</span><span class="o">=</span><span class="p">{</span><span class="mi">30</span><span class="p">}</span><span class="o">&gt;</span>

            <span class="o">&lt;</span><span class="nx">Column</span>
              <span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Name</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
              <span class="nx">cell</span><span class="o">=</span><span class="p">{</span> <span class="o">&lt;</span><span class="nx">AjaxCell</span> <span class="nx">col</span><span class="o">=</span><span class="s1">&#39;name&#39;</span> <span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span> <span class="o">/&gt;</span> <span class="p">}</span>
              <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span>
            <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">Column</span>
              <span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Birth</span> <span class="nx">Year</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
              <span class="nx">cell</span><span class="o">=</span><span class="p">{</span> <span class="o">&lt;</span><span class="nx">AjaxCell</span> <span class="nx">col</span><span class="o">=</span><span class="s1">&#39;birth_year&#39;</span> <span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span> <span class="o">/&gt;</span> <span class="p">}</span>
              <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span>
            <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">Column</span>
              <span class="nx">header</span><span class="o">=</span><span class="p">{</span><span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span><span class="nx">Url</span><span class="o">&lt;</span><span class="err">/Cell&gt;}</span>
              <span class="nx">cell</span><span class="o">=</span><span class="p">{</span> <span class="o">&lt;</span><span class="nx">AjaxCell</span> <span class="nx">col</span><span class="o">=</span><span class="s1">&#39;url&#39;</span> <span class="nx">forceUpdate</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span> <span class="o">/&gt;</span> <span class="p">}</span>
              <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">}</span>
            <span class="o">/&gt;</span>

        <span class="o">&lt;</span><span class="err">/Table&gt;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>I&#8217;ve made it a component in order to be able to bind the <tt class="docutils literal">forceUpdate</tt> method of the component to and
<tt class="docutils literal">this</tt> and pass it to the <tt class="docutils literal">forceUpdate</tt> parameter to the <tt class="docutils literal">AjaxCell</tt> component. I&#8217;ve hard-coded
the rowsCount value &#8212; instead we should have done an initial fetch to the first page of the <span class="caps">API</span> to get
the total number of rows and only after that fetch had returned display the <tt class="docutils literal">&lt;Table&gt;</tt> component (left
as an exercise to the&nbsp;reader).</p>
</div>
<div class="section" id="some-enchancements">
<h2><a class="toc-backref" href="#id9">Some&nbsp;enchancements</a></h2>
<p>Instead of displaying <tt class="docutils literal"><span class="pre">&lt;Cell&gt;-&lt;/Cell&gt;</span></tt> (or <tt class="docutils literal">&lt;/Cell&gt;</tt>) when the page loads, I propose to define a
cell with an embedded spinner,&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">loadingCell</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">Cell</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&quot;16&quot;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&quot;16&quot;</span> <span class="nx">alt</span><span class="o">=</span><span class="s2">&quot;star&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/Cell&gt;</span>
</pre></div>
<p>and return this&nbsp;instead.</p>
<p>Also, if your <span class="caps">REST</span> <span class="caps">API</span> returns too fast and you&#8217;d like to see what would happen if the server request took too long to return, you could
change fetch like&nbsp;this</p>
<div class="highlight"><pre><span></span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://swapi.co/api/people/?format=json&amp;page=&#39;</span><span class="o">+</span><span class="nx">page</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="nx">j</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">];</span>
        <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">forceUpdate</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
<p>to add a 1 second&nbsp;delay.</p>
</div>
<div class="section" id="conslusion">
<h2><a class="toc-backref" href="#id10">Conslusion</a></h2>
<p>The above is a just a proof of concept of using FixedDataTable with asynchronously loaded server-side data.
This of course could be used for small projects (I am already using it for an internal project) but I recommend
using the <a class="reference external" href="https://spapas.github.io/2015/07/02/comprehensive-react-flux-tutorial-2/">flux architecture</a> for more complex projects. What this more or
less means is that a store component
should be developed that will actually keep the data for each row, and a <tt class="docutils literal">fetchCompleted</tt> action should be
dispatched when the <tt class="docutils literal">fetch</tt> is finished instead of calling <tt class="docutils literal">forceUpdate</tt> directly.</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://spapas.github.io/index6.html">&larr; Older</a>

    <a class="next" href="https://spapas.github.io/index4.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  <section>
  <br />
  <a href='/feeds/all.atom.xml'>Atom</a> 
  |
  <a href='/feeds/all.rss.xml'>RSS</a> 
  </section>
  
  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>.subscribe-button {
    /* margin: 10px !important; */
    padding: 10px !important;
    background-color: black;
    display: inline-block;
    color: white !important;
    text-decoration: none;    
    
    line-height: 36px !important;
    height: 37px !important;
    text-decoration: none !important;
    display: inline-block !important;
    color: #ffffff !important;
    background-color: #000000 !important;
    border-radius: 3px !important;
    border: 1px solid transparent !important;
    padding: 1px 9px !important;
    font-size: 23px !important;
    letter-spacing: 0.6px !important;
    box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
    -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
    margin: 0 auto !important;
    font-family: 'Cookie', cursive !important;
    -webkit-box-sizing: border-box !important;
    box-sizing: border-box !important;
    -o-transition: 0.3s all linear !important;
    -webkit-transition: 0.3s all linear !important;
    -moz-transition: 0.3s all linear !important;
    -ms-transition: 0.3s all linear !important;
    transition: 0.3s all linear !important;
    
    }</style>
<a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>
  
  <style>.bmc-button img{width: 27px !important;margin-bottom: 3px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-block !important;color:#ffffff !important;background-color:#000000 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 23px !important;letter-spacing:0.6px !important;;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#ffffff !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">
  
  
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://spapas.github.io/2019/10/17/declarative-ecto-query-sorting/">Declarative Ecto query sorting</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2019/10/03/html-form-submit-php/">How to properly handle an HTML form</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2019/07/25/declarative-ecto-query-filters/">Declarative Ecto query filters</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2019/06/04/phoenix-form-select2-ajax/">Phoenix forms integration with select2 and ajax</a>
      </li>
      <li class="post">
          <a href="https://spapas.github.io/2019/04/05/android-custom-filter-adapter/">How to create a custom filtered adapter in Android</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="https://spapas.github.io/category/android.html">android</a></li>
        <li><a href="https://spapas.github.io/category/css.html">css</a></li>
        <li><a href="https://spapas.github.io/category/django.html">django</a></li>
        <li><a href="https://spapas.github.io/category/elixir.html">elixir</a></li>
        <li><a href="https://spapas.github.io/category/flask.html">flask</a></li>
        <li><a href="https://spapas.github.io/category/git.html">git</a></li>
        <li><a href="https://spapas.github.io/category/html.html">html</a></li>
        <li><a href="https://spapas.github.io/category/javascript.html">javascript</a></li>
        <li><a href="https://spapas.github.io/category/pelican.html">pelican</a></li>
        <li><a href="https://spapas.github.io/category/postgresql.html">postgresql</a></li>
        <li><a href="https://spapas.github.io/category/python.html">python</a></li>
        <li><a href="https://spapas.github.io/category/spring.html">spring</a></li>
        <li><a href="https://spapas.github.io/category/unix.html">unix</a></li>
        <li><a href="https://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="https://spapas.github.io/tag/less.html">less</a>,    <a href="https://spapas.github.io/tag/rest.html">rest</a>,    <a href="https://spapas.github.io/tag/query.html">query</a>,    <a href="https://spapas.github.io/tag/ecto.html">ecto</a>,    <a href="https://spapas.github.io/tag/tables.html">tables</a>,    <a href="https://spapas.github.io/tag/pivot_table.html">pivot_table</a>,    <a href="https://spapas.github.io/tag/console.html">console</a>,    <a href="https://spapas.github.io/tag/async.html">async</a>,    <a href="https://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="https://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="https://spapas.github.io/tag/forms.html">forms</a>,    <a href="https://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="https://spapas.github.io/tag/404.html">404</a>,    <a href="https://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="https://spapas.github.io/tag/immutable.html">immutable</a>,    <a href="https://spapas.github.io/tag/initd.html">init.d</a>,    <a href="https://spapas.github.io/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://spapas.github.io/tag/python.html">python</a>,    <a href="https://spapas.github.io/tag/django-extensions.html">django-extensions</a>,    <a href="https://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="https://spapas.github.io/tag/scipy.html">scipy</a>,    <a href="https://spapas.github.io/tag/grid.html">grid</a>,    <a href="https://spapas.github.io/tag/ag-grid.html">ag-grid</a>,    <a href="https://spapas.github.io/tag/du.html">du</a>,    <a href="https://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="https://spapas.github.io/tag/settings.html">settings</a>,    <a href="https://spapas.github.io/tag/flux.html">flux</a>,    <a href="https://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://spapas.github.io/tag/queries.html">queries</a>,    <a href="https://spapas.github.io/tag/debug.html">debug</a>,    <a href="https://spapas.github.io/tag/imgur.html">imgur</a>,    <a href="https://spapas.github.io/tag/security.html">security</a>,    <a href="https://spapas.github.io/tag/npm.html">npm</a>,    <a href="https://spapas.github.io/tag/hyperapp.html">hyperapp</a>,    <a href="https://spapas.github.io/tag/spring.html">spring</a>,    <a href="https://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="https://spapas.github.io/tag/cron.html">cron</a>,    <a href="https://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="https://spapas.github.io/tag/design.html">design</a>,    <a href="https://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="https://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="https://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="https://spapas.github.io/tag/rq.html">rq</a>,    <a href="https://spapas.github.io/tag/redis.html">redis</a>,    <a href="https://spapas.github.io/tag/python-3.html">python-3</a>,    <a href="https://spapas.github.io/tag/research.html">research</a>,    <a href="https://spapas.github.io/tag/werkzeug.html">werkzeug</a>,    <a href="https://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="https://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://spapas.github.io/tag/disk-usage.html">disk-usage</a>,    <a href="https://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="https://spapas.github.io/tag/component.html">component</a>,    <a href="https://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="https://spapas.github.io/tag/elixir.html">elixir</a>,    <a href="https://spapas.github.io/tag/ipython.html">ipython</a>,    <a href="https://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="https://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="https://spapas.github.io/tag/properties.html">properties</a>,    <a href="https://spapas.github.io/tag/bash.html">bash</a>,    <a href="https://spapas.github.io/tag/es6.html">es6</a>,    <a href="https://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="https://spapas.github.io/tag/postgresql.html">postgresql</a>,    <a href="https://spapas.github.io/tag/kotlin.html">kotlin</a>,    <a href="https://spapas.github.io/tag/adapter.html">adapter</a>,    <a href="https://spapas.github.io/tag/filter.html">filter</a>,    <a href="https://spapas.github.io/tag/flask.html">flask</a>,    <a href="https://spapas.github.io/tag/notebook.html">notebook</a>,    <a href="https://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="https://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="https://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="https://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="https://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="https://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="https://spapas.github.io/tag/unix.html">unix</a>,    <a href="https://spapas.github.io/tag/google.html">google</a>,    <a href="https://spapas.github.io/tag/linux.html">linux</a>,    <a href="https://spapas.github.io/tag/pivot.html">pivot</a>,    <a href="https://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="https://spapas.github.io/tag/git.html">git</a>,    <a href="https://spapas.github.io/tag/java.html">java</a>,    <a href="https://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="https://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="https://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="https://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://spapas.github.io/tag/numpy.html">numpy</a>,    <a href="https://spapas.github.io/tag/form.html">form</a>,    <a href="https://spapas.github.io/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="https://spapas.github.io/tag/rst.html">rst</a>,    <a href="https://spapas.github.io/tag/python-2.html">python-2</a>,    <a href="https://spapas.github.io/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://spapas.github.io/tag/middleware.html">middleware</a>,    <a href="https://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="https://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="https://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="https://spapas.github.io/tag/error.html">error</a>,    <a href="https://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="https://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://spapas.github.io/tag/select2.html">select2</a>,    <a href="https://spapas.github.io/tag/history.html">history</a>,    <a href="https://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="https://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="https://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="https://spapas.github.io/tag/plpgsql.html">plpgsql</a>,    <a href="https://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="https://spapas.github.io/tag/generic.html">generic</a>,    <a href="https://spapas.github.io/tag/babel.html">babel</a>,    <a href="https://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="https://spapas.github.io/tag/html.html">html</a>,    <a href="https://spapas.github.io/tag/android.html">android</a>,    <a href="https://spapas.github.io/tag/pandas.html">pandas</a>,    <a href="https://spapas.github.io/tag/css.html">css</a>,    <a href="https://spapas.github.io/tag/node.html">node</a>,    <a href="https://spapas.github.io/tag/phoenix.html">phoenix</a>,    <a href="https://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="https://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="https://spapas.github.io/tag/react.html">react</a>,    <a href="https://spapas.github.io/tag/autocompelte.html">autocompelte</a>,    <a href="https://spapas.github.io/tag/declarative.html">declarative</a>,    <a href="https://spapas.github.io/tag/php.html">php</a>,    <a href="https://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="https://spapas.github.io/tag/branching.html">branching</a>,    <a href="https://spapas.github.io/tag/github.html">github</a>,    <a href="https://spapas.github.io/tag/jupyter.html">jupyter</a>,    <a href="https://spapas.github.io/tag/windows.html">windows</a>,    <a href="https://spapas.github.io/tag/youtube.html">youtube</a>,    <a href="https://spapas.github.io/tag/django.html">django</a>,    <a href="https://spapas.github.io/tag/q.html">q</a>,    <a href="https://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="https://spapas.github.io/tag/redux.html">redux</a>,    <a href="https://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>
  
  <section>
  <h1>Yearly archives</h1>
    <a href="https://spapas.github.io/posts/2013/">2013</a>,    <a href="https://spapas.github.io/posts/2014/">2014</a>,    <a href="https://spapas.github.io/posts/2015/">2015</a>,    <a href="https://spapas.github.io/posts/2016/">2016</a>,    <a href="https://spapas.github.io/posts/2017/">2017</a>,    <a href="https://spapas.github.io/posts/2018/">2018</a>,    <a href="https://spapas.github.io/posts/2019/">2019</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://spapas.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://spapas.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @_serafeim_</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2019 Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="https://spapas.github.io/theme/js/ender.js"></script>
  <script src="https://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>

</html>