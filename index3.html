<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://spapas.github.io/favicon.png" rel="icon">

    <link href="https://spapas.github.io/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://spapas.github.io/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">

<style>
#gHPzseYvFrhZ123 {
display: none;
margin-bottom: 30px;
padding: 20px 10px;
background: #D30000;
text-align: center;
font-weight: bold;
color: #fff;
border-radius: 5px;
}
</style>


    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://spapas.github.io/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
    <div id="gHPzseYvFrhZ123">
      Hello! I see that you have an ad blocker. If you find something useful here 
      and want to support me somehow please consider disabling your ad blocker for this site. It won't cost you anything.
      
    </div>
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2018/03/19/comprehensive-django-cbv-guide/">A comprehensive Django CBV guide</a>
      </h1>
    <p class="meta">
<time datetime="2018-03-19T12:20:00+02:00" pubdate>Δευ 19 Μάρτιος 2018</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#a-gentle-introduction-to-cbvs" id="id1">A gentle introduction to CBVs</a><ul>
<li><a class="reference internal" href="#hand-made-cbvs" id="id2">Hand-made&nbsp;CBVs</a></li>
<li><a class="reference internal" href="#is-this-really-dry" id="id3">Is this really <span class="caps">DRY</span>&nbsp;?</a></li>
<li><a class="reference internal" href="#re-using-view-functionality" id="id4">Re-using view&nbsp;functionality</a></li>
<li><a class="reference internal" href="#interlude-an-mro-primer" id="id5">Interlude: An <span class="caps">MRO</span>&nbsp;primer</a></li>
<li><a class="reference internal" href="#using-mixins-for-code-reuse" id="id6">Using mixins for&nbsp;code-reuse</a></li>
<li><a class="reference internal" href="#the-super-situation" id="id7">The super&nbsp;situation</a></li>
<li><a class="reference internal" href="#using-super-in-our-hierarchy" id="id8">Using super in our&nbsp;hierarchy</a></li>
<li><a class="reference internal" href="#testing-all-this" id="id9">Testing all&nbsp;this</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-high-level-overview-of-cbvs" id="id10">A high level overview of CBVs</a><ul>
<li><a class="reference internal" href="#taking-a-look-at-the-view" id="id11">Taking a look at the&nbsp;View</a></li>
<li><a class="reference internal" href="#redirectview-and-templateview" id="id12">RedirectView and&nbsp;TemplateView</a></li>
<li><a class="reference internal" href="#the-formview" id="id13">The&nbsp;FormView</a></li>
<li><a class="reference internal" href="#the-listview-and-detailview" id="id14">The ListView and&nbsp;DetailView</a></li>
<li><a class="reference internal" href="#the-createview" id="id15">The&nbsp;CreateView</a></li>
<li><a class="reference internal" href="#the-updateview-and-deleteview" id="id16">The UpdateView and&nbsp;DeleteView</a></li>
<li><a class="reference internal" href="#access-control-mixins" id="id17">Access control&nbsp;mixins</a></li>
<li><a class="reference internal" href="#some-other-cbvs" id="id18">Some other&nbsp;CBVs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#real-world-use-cases" id="id19">Real world use cases</a><ul>
<li><a class="reference internal" href="#do-something-when-a-valid-form-is-submitted" id="id20">Do something when a valid form is&nbsp;submitted</a></li>
<li><a class="reference internal" href="#change-the-queryset-of-the-cbv" id="id21">Change the queryset of the <span class="caps">CBV</span></a></li>
<li><a class="reference internal" href="#allow-each-user-to-list-view-edit-delete-only-his-own-items" id="id22">Allow each user to list/view/edit/delete only his own&nbsp;items</a></li>
<li><a class="reference internal" href="#configure-the-form-s-initial-values-from-get-parameters" id="id23">Configure the form&#8217;s initial values from <span class="caps">GET</span>&nbsp;parameters</a></li>
<li><a class="reference internal" href="#pass-extra-kwargs-to-the-formview-form" id="id24">Pass extra kwargs to the FormView&nbsp;form</a></li>
<li><a class="reference internal" href="#add-values-to-the-context" id="id25">Add values to the&nbsp;context</a></li>
<li><a class="reference internal" href="#add-a-simple-filter-to-a-listview" id="id26">Add a simple filter to a&nbsp;ListView</a></li>
<li><a class="reference internal" href="#support-for-success-messages" id="id27">Support for success&nbsp;messages</a></li>
<li><a class="reference internal" href="#implement-a-quick-moderation" id="id28">Implement a quick&nbsp;moderation</a></li>
<li><a class="reference internal" href="#allow-access-to-a-view-if-a-user-has-one-out-of-a-group-of-permissions" id="id29">Allow access to a view if a user has one out of a group of&nbsp;permissions</a></li>
<li><a class="reference internal" href="#disable-a-view-based-on-some-condition" id="id30">Disable a view based on some&nbsp;condition</a></li>
<li><a class="reference internal" href="#output-non-html-views" id="id31">Output non-html&nbsp;views</a></li>
<li><a class="reference internal" href="#use-one-templateview-for-multiple-html-templates" id="id32">Use one TemplateView for multiple html&nbsp;templates</a></li>
<li><a class="reference internal" href="#implement-a-partial-ajax-view" id="id33">Implement a partial Ajax&nbsp;view</a></li>
<li><a class="reference internal" href="#add-a-dynamic-filter-and-or-table-to-the-context" id="id34">Add a dynamic filter and/or table to the&nbsp;context</a></li>
<li><a class="reference internal" href="#configure-forms-for-your-views" id="id35">Configure forms for your&nbsp;views</a></li>
<li><a class="reference internal" href="#display-a-different-form-for-create-and-update" id="id36">Display a different form for Create and&nbsp;Update</a></li>
<li><a class="reference internal" href="#only-allow-specific-http-methods-for-a-view" id="id37">Only allow specific <span class="caps">HTTP</span> methods for a&nbsp;view</a></li>
<li><a class="reference internal" href="#create-an-umbrella-view-for-multiple-models" id="id38">Create an umbrella View for multiple&nbsp;models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-heavy-cbv-user-project" id="id39">A heavy <span class="caps">CBV</span> user&nbsp;project</a></li>
<li><a class="reference internal" href="#conclusion" id="id40">Conclusion</a></li>
</ul>
</div>
<p>Class Based Views (<span class="caps">CBV</span>) is one of my favourite things about Django. During my
first Django projects (using Django 1.4 around 6 years ago) I was mainly using
functional views &#8212; that&#8217;s what the tutorial recommended then anyway. However,
slowly in my next projects I started reducing the amount of functional views
and embracing CBVs, slowly understanding their usage and usefulness. Right now,
I more or less only use CBVs for my views; even if sometimes it seems more work
to use a <span class="caps">CBV</span> instead of a functional one I know that sometime in the future I&#8217;d
be glad that I did it since I&#8217;ll want to re-use some view functionality and
CBVs are more or less the only way to have <span class="caps">DRY</span> views in&nbsp;Django.</p>
<p>I&#8217;ve heard various rants about them, mainly that they are too complex and difficult to
understand and use, however I believe that they are not really difficult when
you start from the basics. Even if it is a little work to become comfortable with
the <span class="caps">CBV</span> logic, when they are used properly they will greatly improve your Django experience
so it is definitely worth&nbsp;it.</p>
<p>Notice
that to properly understand CBVs you must have a good understanding of how
Python&#8217;s (multiple) inheritance and <span class="caps">MRO</span> work. Yes, this is a rather complex and
confusing thing but I&#8217;ll try to also explain this as good as I can to the first chapter
of this article so if you follow along you shouldn&#8217;t have any&nbsp;problems.</p>
<p>This guide has four&nbsp;parts:</p>
<ul class="simple">
<li>A gentle introduction to how CBVs are working and to the the problems that do solve. For this we&#8217;ll implement
our own simple Custom Class Based View variant and take a look at python&#8217;s inheritance&nbsp;model.</li>
<li>A high level overview of the real Django CBVs using <a class="reference external" href="http://ccbv.co.uk`"><span class="caps">CBV</span> inspector</a> as our&nbsp;guide.</li>
<li>A number of use cases where CBVs can be used to elegantly solve real world&nbsp;problems</li>
<li>Describing the usage of some of the previous use cases to a real Django&nbsp;application</li>
</ul>
<p>I&#8217;ve implemented an accompanying project to this article which you can find at <a class="reference external" href="https://github.com/spapas/cbv-tutorial">https://github.com/spapas/cbv-tutorial</a>.
This project has two separate parts. One that is the implementation of the Custom Class Based View variant
to see how it is working and the other is the application that contains the usage of the various <span class="caps">CBV</span> use&nbsp;cases.</p>
<div class="section" id="a-gentle-introduction-to-cbvs">
<h2>A gentle introduction to&nbsp;CBVs</h2>
<p>In this part of the guide we&#8217;ll do a gentle introduction to how CBVs work by implementing
our own class based views variant - along with it we&#8217;ll introduce and try to understand
some concepts of  python (multiple) inheritance and how it applies to&nbsp;CBVs.</p>
<p>Before continuing, let&#8217;s talk about the concept of the &#8220;view&#8221; in Django:
Django is considered an <span class="caps">MVT</span> (Model View Template) framework - the View as
conceived by Django is not the same as the <span class="caps">MVC</span>-View. A Django View is more or
less a way to define the data that the Template (which is cloased to the <span class="caps">MVC</span>-View)
will display, so the Django View (with the help of the Django Framework) is similar
to the <span class="caps">MVC</span>-Controller.</p>
<p>In any case, traditionally a view in Django is a normal python function that takes a single parameter,
the <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/request-response/#django.http.HttpRequest">request</a> object and must return a <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/request-response/#django.http.HttpResponse">response</a> object (notice that if the
view uses request parameters for example the id of an object to be edited
they will also be passed to the function). The responsibility of the
view function is to properly parse the request parameters and construct the
response object - as can be understood there is a lot of work that need to be
done for each view (for example check if the method is <span class="caps">GET</span> or <span class="caps">POST</span>, if the user
has access to that page, retrieve objects from the database, crate a context dict
and pass it to the template to be rendered&nbsp;etc).</p>
<p>Now, since functional views are simple python functions it is <em>not</em> easy to override,
reuse or extend their behaviour. There are more or less two methods for this: Use function
decorators or pass extra parameters when adding the view to your urls. I&#8217;d like
to point out here that there&#8217;s a third method for code-reuse: Extracting
functionality to common and re-usable functions or classes that will be called from the
functional views but this is not something specific to Django views but a general
concept of good programming style which you should follow&nbsp;anyway.</p>
<p>The first one uses <a class="reference external" href="https://wiki.python.org/moin/PythonDecorators">python decorators</a> to create a functional view that wraps the
initial one. The new view is called before the initial one, adds some functionality
(for example check if the current user has access, modify request parameters etc),
calls the initial one which will return a response object, modify the response if needed
and then return that. This is how <a class="reference external" href="https://docs.djangoproject.com/en/2.0/topics/auth/default/#the-login-required-decorator">login_required</a> works. Notice that by using
decorators you can change things before and after the original view runs but
you can&#8217;t do anything about the way the original view&nbsp;works.</p>
<p>For the second one (adding extra view parameters) you must
write your function view in a way which allows it to be reused, for example instead
of hard-coding the template name allow it to be passed as a parameter or instead
of using a specific form class for a form make it configurable through a parameter. Then,
when you add this function to your urls you will pass different parameters
depending on how you want to configure your view. Using this method you can
override the original function behaviour however there&#8217;s a limit to the number of
parameters you can allow your function views to have and notice that these
function views cannot be further overridden. The <a class="reference external" href="https://docs.djangoproject.com/en/2.0/topics/auth/default/#django.contrib.auth.views.login">login</a> authentication view (which
is now deprecated in favour of a <span class="caps">CBV</span> one)
is using this technique, for example you can pass it
the template name that will be used, a custom authentication form&nbsp;etc.</p>
<p>It should be obvious that both these methods have severe limitations and do not allow you to be as <span class="caps">DRY</span> as
you should be. When using the wrapped views you can&#8217;t actually
change the functionality of the original view (since that original function needs
to be called) but only do things before and after calling it. Also, using the
parameters will lead to spaghetti code with multiple if / else conditions in order
to take into account the various cases that may arise. All the above lead to
very reduced re-usability and DRYness of functional views - usually the best thing
you can do is to gather the common things in external normal python functions (not view functions) that could be
re-used from other functional views as already&nbsp;discussed.</p>
<p>Class based views solve the above problem of non-<span class="caps">DRY</span>-ness by using the well known
concept of <span class="caps">OO</span> inheritance: The view is defined from a class which has methods
for implementing the view functionality - you inherit from that class and override
the parts you want so the inherited class based view will use the overridden methods instead
of the original ones. You can also create re-usable classes (mixins) that offer a specific
functionality to your class based view by implementing some of the methods of the
original class. Each one of your class based views can inherit its functionality from
multiple mixins thus allowing you to define a single class for each thing you need
and re-using it everywhere. Notice of course that this is possible only if the
CBVs are <em>properly implemented</em> to allow overriding their functionality. We&#8217;ll see
how this is possible in the next&nbsp;section.</p>
<div class="section" id="hand-made-cbvs">
<h3>Hand-made&nbsp;CBVs</h3>
<p>To make things more clear we&#8217;ll start implementing our own class based views hierarchy. Here&#8217;s
a rather naive first&nbsp;try:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomClassView</span><span class="p">:</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;html&gt;</span>
<span class="s2">                &lt;body&gt;</span>
<span class="s2">                    &lt;h1&gt;{header}&lt;/h1&gt;</span>
<span class="s2">                    {body}</span>
<span class="s2">                &lt;/body&gt;</span>
<span class="s2">            &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">as_view</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">render</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">view</span>
</pre></div>
<p>This class can be used to render a simple <span class="caps">HTML</span> template with a custom header and
a list of items in the body (named <tt class="docutils literal">context</tt>). There are two things to notice here: The <tt class="docutils literal">__init__</tt> method (which
will be called as the object&#8217;s constructor) will assign all the keyword arguments (<tt class="docutils literal">kwargs</tt>) it receives
as instance attributes (for example <tt class="docutils literal"><span class="pre">CustomClassView(header='hello')</span></tt> will create
an instance with <tt class="docutils literal">'hello'</tt> as its <tt class="docutils literal">header</tt> attribute). The <tt class="docutils literal">as_view</tt> is a class method
(i.e it can be called directly on the <em>class</em> without the need to instantiate an object
for example you can call <tt class="docutils literal">CustomClassView.as_view()</tt> ) that
defines and returns a traditional functional view (named <tt class="docutils literal">view</tt>) that will be used to
actually serve the view. The returned
functional view is very simple - it just instantiates a new instance (object)
of <tt class="docutils literal">CustomClassView</tt> passing
the <tt class="docutils literal">kwargs</tt> it got in the constructor and then returns a normal <tt class="docutils literal">HttpResponse</tt> with
the instance&#8217;s <tt class="docutils literal">render()</tt> result. This <tt class="docutils literal">render()</tt> method will just output some html
using the instance&#8217;s header and context to fill&nbsp;it.</p>
<p>Notice that the instance of the <tt class="docutils literal">CustomClassView</tt> inside the <tt class="docutils literal">as_view</tt> class method
is not created using
<tt class="docutils literal"><span class="pre">CustomClassView(**kwargs)</span></tt> but using <tt class="docutils literal"><span class="pre">cls(**kwargs)</span></tt> - <tt class="docutils literal">cls</tt> is the name of the
class that <tt class="docutils literal">as_view</tt> was called on and is actually passed as a parameter for
class methods (in a similar manner to how <tt class="docutils literal">self</tt> is passed to instance methods).
This is important to instantiate an object instance of the proper&nbsp;class.</p>
<p>For example, if you created a class that inherited from <tt class="docutils literal">CustomClassView</tt>
and called its <tt class="docutils literal">as_view</tt> method then when you use the <tt class="docutils literal">cls</tt> parameter to instantiate
the object it will correctly create an object of the <em>inherited</em> class and not the <em>base</em> one
(if on the other hand you had used <tt class="docutils literal"><span class="pre">CustomClassView(**kwargs)</span></tt> to instantiate the instance
then the <tt class="docutils literal">as_view</tt> method of the inheriting classes would instantiate instances of
<tt class="docutils literal">CustomClassView</tt> so inheritance wouldn&#8217;t really&nbsp;work!).</p>
<p>To add the above class method in your urls, just use its <tt class="docutils literal">as_view()</tt> as you&#8217;d
normally use a functional&nbsp;view:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^ccv-empty/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">CustomClassView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ccv-empty&#39;</span><span class="p">),</span>
    <span class="c1"># ... other urls</span>
<span class="p">]</span>
</pre></div>
<p>This doesn&#8217;t actually render anything since both header and context are empty on
the created instance &#8212; remember that <tt class="docutils literal">as_view</tt> returns a functional view that
instantiates a <tt class="docutils literal">CustomClassView</tt> objet and returns an <tt class="docutils literal">HttpResponse</tt> filling it
with the object&#8217;s <tt class="docutils literal">render()</tt> reuslts. To add some output we can either
create another class that inherits from <tt class="docutils literal">CustomClassView</tt> or
initialize the attributes from the constructor of the class (using the kwargs functionality described&nbsp;above).</p>
<p>The inherited class can just override the values of the&nbsp;attributes:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InheritsCustomClassView</span><span class="p">(</span><span class="n">CustomClassView</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;Hi&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test2&#39;</span> <span class="p">]</span>
</pre></div>
<p>And then just add the inherited class to your urls as&nbsp;before:</p>
<div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^ccv-inherits/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">InheritsCustomClassView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ccv-inherits&#39;</span><span class="p">),</span>
</pre></div>
<p>The <tt class="docutils literal">as_view()</tt> method will create an instance of <tt class="docutils literal">InheritsCustomClassView</tt> that has
the values configured in the class as attributes and return
its <tt class="docutils literal">render()</tt> output as&nbsp;response.</p>
<p>The other way to configure the attributes of the class is to
pass them to the <tt class="docutils literal">as_view</tt> class method (which in turn will pass them to the instances
constructor which will set the attributes in the instance). Here&#8217;s an&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^ccv-with-values/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">CustomClassView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="p">],</span> <span class="n">footer</span><span class="o">=</span><span class="s1">&#39;Bye&#39;</span><span class="p">,</span> <span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ccv-with-values&#39;</span><span class="p">),</span>
</pre></div>
<p>The above will create a <tt class="docutils literal">CustomClassView</tt> instance with the provided values as its&nbsp;attributes.</p>
<p>Although this method of configuration is used in normal django CBVs (for example
setting the <tt class="docutils literal">template_name</tt> in a <tt class="docutils literal">TemplateView</tt>) I recommend you avoid using it because passing parameters
to the <tt class="docutils literal">as_view</tt> method pollutes the urls.py with configuration
that (at least in my opinion) should <em>not</em> be there (and there&#8217;s no reason to have to take a look at both
your urls.py and your views.py to understand the behavior of your views) and also, even for very simple views I know that after some time I&#8217;ll need
to add some functionality that cannot be implemented by passing the parameters so I prefer to bite the
bullet and define all my views as inherited classes so it will be easy for me to further customize them later (we&#8217;ll
see how this is done in a second). Thus, even if you&nbsp;have</p>
<p>In any case, I won&#8217;t discuss passing parameters to the <tt class="docutils literal">as_view</tt> method any more,
so from now on any class based views I define will be added to urls py using <tt class="docutils literal">ClassName.as_view()</tt> without any
parameters to the <tt class="docutils literal">as_view()</tt> class&nbsp;method.</p>
</div>
<div class="section" id="is-this-really-dry">
<h3>Is this really <span class="caps">DRY</span>&nbsp;?</h3>
<p>Let&#8217;s now suppose that we wanted to allow our class based view to print something on the header even if no header is provided
when you configure it. The only way to do it would be to re-define the <tt class="docutils literal">render</tt> method like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">else</span> <span class="s2">&quot;DEFAULT HEADER&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;html&gt;</span>
<span class="s2">            &lt;body&gt;</span>
<span class="s2">                &lt;h1&gt;{header}&lt;/h1&gt;</span>
<span class="s2">                {body}</span>
<span class="s2">            &lt;/body&gt;</span>
<span class="s2">        &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
        <span class="p">)</span>
</pre></div>
<p>This is definitely not the <span class="caps">DRY</span> way to do it because you would need to re-define the whole <tt class="docutils literal">render</tt> method. Think
what would happen if
you wanted to print <tt class="docutils literal">&quot;<span class="caps">ANOTHER</span> <span class="caps">DEFAULT</span> <span class="caps">HEADER</span>&quot;</tt> as a default header for some other view - once again re-defining
<tt class="docutils literal">render</tt>! In fact, the above
<tt class="docutils literal">CustomClassView</tt> is naively implemented because it does not allow proper customization through inheritance. The
same problems for the header arise also when you need modify the body; for
example, if you wanted to add an index number before displaying the items of the list then you&#8217;d need to again re-implement the
whole <tt class="docutils literal">render</tt> method.</p>
<p>If that was our only option then we could just stick to functional views. However, we can do
much better if we define the class based view in such a way that allows inherited classes to override methods that
define specific parts of the functionality. To do this the class-based-view must be properly implemented so each
part of its functionality is implemented by a different&nbsp;method.</p>
<p>Here&#8217;s how we could improve the <tt class="docutils literal">CustomClassView</tt> to make it more <span class="caps">DRY</span>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BetterCustomClassView</span><span class="p">(</span><span class="n">CustomClassView</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Better Custom Class View&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;html&gt;</span>
<span class="s2">                &lt;body&gt;</span>
<span class="s2">                    &lt;h1&gt;{header}&lt;/h1&gt;</span>
<span class="s2">                    {body}</span>
<span class="s2">                &lt;/body&gt;</span>
<span class="s2">            &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_header</span><span class="p">(),</span> <span class="n">body</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">render_context</span><span class="p">(),</span>
            <span class="p">)</span>
</pre></div>
<p>So what happens here? First of all we inherit from <tt class="docutils literal">ClassClassView</tt> to keep the
<tt class="docutils literal">as_view</tt> method which doesn&#8217;t need changing. Beyond this, the render
uses methods (<tt class="docutils literal">get_header</tt> and <tt class="docutils literal">render_context</tt>) to retrieve the values from the header and the body - this means
that we could re-define these methods to an inherited class in order to override
what these methods will return. Beyond <tt class="docutils literal">get_header</tt> and <tt class="docutils literal">render_contex</tt> I&#8217;ve added
a <tt class="docutils literal">get_context</tt> method that is used by <tt class="docutils literal">render_context</tt> to make this <span class="caps">CBV</span> even
more re-usable. For example I may
need to configure the context (add/remove items from the context i.e have a <span class="caps">CBV</span>
that adds a last item with the number of list items to the list to be displayed). Of course this could
be done from <tt class="docutils literal">render_context</tt> <em>but</em> this means that I would need to define my new functionality
(modifying the context items) <em>and</em> re-defining the context list formatting. It is much
better (in my opinion always) to keep properly separated these&nbsp;things.</p>
<p>Now, the above is a first try that I created to mainly fulfil my requirement of
having a default header and some more examples I will discuss later (and keep
everything simple enough). You could
extract more functionality as methods-for-overriding, for example the render
method could be written like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_header</span><span class="p">(),</span> <span class="n">body</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">render_context</span><span class="p">(),</span>
        <span class="p">)</span>
</pre></div>
<p>and add a <tt class="docutils literal">get_template</tt> method that will return the actual html template. There&#8217;s no
hard rules here on what functionality should be extracted to a method (so it could
be overridden) however I recommend to follow the <span class="caps">YAGNI</span> rule (i.e implement everything
as normal and when you see that some functionality needs to be overridden then refactor
your code to extract it to a separate&nbsp;method).</p>
<p>Let&#8217;s see an example of adding the default header functionality by overriding <tt class="docutils literal">get_header</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultHeaderBetterCustomClassView</span><span class="p">(</span><span class="n">BetterCustomClassView</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">else</span> <span class="s2">&quot;DEFAULT HEADER&quot;</span>
</pre></div>
<p>Classes inheriting from <tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> can choose to not
actually define a header attribute so <tt class="docutils literal">&quot;<span class="caps">DEFAULT</span> <span class="caps">HEADER</span>&quot;</tt> will be printed instead. Keep in
mind that for <tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> to be actually useful you&#8217;ll need to
have more than one classes that need this default-header functionality (or else you could
just set the header attribute of your class to <tt class="docutils literal">&quot;<span class="caps">DEFAULT</span> <span class="caps">HEADER</span>&quot;</tt> - this is not
user generated input, this is your source&nbsp;code!).</p>
</div>
<div class="section" id="re-using-view-functionality">
<h3>Re-using view&nbsp;functionality</h3>
<p>We have come now to a crucial point in this chapter, so please stick with me. Let&#8217;s say that you have
<em>more than one</em> class based views that contain a header attribute. You want to include
the default header functionality on all of them so that if any view instantiated from these
class based views doesn&#8217;t define a header
the default string will be output (I know that this may be a rather trivial example but I want
to keep everything simple to make following easy - instead of the default header the functionality
you want to override may be adding stuff to the context or filtering the objects you&#8217;ll retrieve
from the&nbsp;database).</p>
<p>To re-use this default header functionality from multiple classes you have <em>two</em> options:
Either inherit all classes that need this functionality from <tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> or
extract the custom <tt class="docutils literal">get_header</tt> method to a <em>mixin</em> and inherit from the mixin. A mixin is a class not
related to the class based view hierarchy we are using - the mixin inherits from object (or from another
mixin) and just defines the methods and attributes that need to be overridden. When the mixin is <em>mixed</em>
with the ancestors of a class its functionality will be used by that class (we&#8217;ll see how shortly). So
the mixin will only define <tt class="docutils literal">get_header</tt> and not all other methods like
<tt class="docutils literal">render</tt>, <tt class="docutils literal">get_context</tt> etc. Using the
<tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> is enough for some cases but for the general case
of re-using the functionality you&#8217;ll need to create the mixin. Let&#8217;s see&nbsp;why:</p>
<p>Suppose that you have a base class that renders the header and context as <span class="caps">JSON</span> instead of the <span class="caps">HTML</span>
template, something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">JsonCustomClassView</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">as_view</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
                <span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_header</span><span class="p">(),</span>
                <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_context</span><span class="p">(),</span>
            <span class="p">}))</span>

        <span class="k">return</span> <span class="n">view</span>
</pre></div>
<p>Notice that this class does not inherit from our previous hierarchy (i.e does not
inherit from BetterCustomClassView) but from object since it provides
its own <tt class="docutils literal">as_view</tt> method. How could we re-use default header functionality
in this class (without having to re-implement it)? One solution would be to create a class that
inherits from both <tt class="docutils literal">JsonCustomClassView</tt> and <tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> using something&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="c1"># OPTION 1</span>
<span class="k">class</span> <span class="nc">DefaultHeaderJsonCustomClassView</span><span class="p">(</span><span class="n">DefaultHeaderBetterCustomClassView</span><span class="p">,</span> <span class="n">JsonCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># OR</span>
<span class="c1"># OPTION 2</span>
<span class="k">class</span> <span class="nc">JsonDefaultHeaderCustomClassView</span><span class="p">(</span><span class="n">JsonCustomClassView</span><span class="p">,</span> <span class="n">DefaultHeaderBetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>What will happen here? Notice that the methods <tt class="docutils literal">get_header</tt> and <tt class="docutils literal">as_view</tt> exist in <em>both</em> ancestor classes! So
which one will be used in each case? Actually, there&#8217;s a (rather complex) rule for that called
<span class="caps">MRO</span> (Method Resolution Order). The <span class="caps">MRO</span> is also what can used to know which <tt class="docutils literal">get_header</tt>
and <tt class="docutils literal">as_view</tt> will be used in each case in the previous&nbsp;example.</p>
</div>
<div class="section" id="interlude-an-mro-primer">
<h3>Interlude: An <span class="caps">MRO</span>&nbsp;primer</h3>
<p>What is <span class="caps">MRO</span>? For every class that Python sees, it tries to create a <em>list</em> (<span class="caps">MRO</span> list) of ancestor classes containing that class as
the first element and its ancestors in a specific order I&#8217;ll discuss in the next paragraph. When a method
of an object of that specific class needs to be
called, then the method will be searched in the <span class="caps">MRO</span> list (from the first element of the <span class="caps">MRO</span> list i.e. starting with the class it self) - when a class is found
in the list that defines the method then that method instance (i.e. the method defined in this class) will be called and the search will stop (careful readers: I haven&#8217;t
yet talked about <em>super</em> so please be&nbsp;patient).</p>
<p>Now, how is the <span class="caps">MRO</span> list created? As I explained, the first element
is the class itself. The second element is the <span class="caps">MRO</span> of the <em>leftmost</em> ancestor of that object (so <span class="caps">MRO</span> will
run recursively on each ancestor), the third element will be the <span class="caps">MRO</span> of the ancestor right next to the leftmost
ancestor etc. There is one extra and important rule: When a class is found multiple times in the <span class="caps">MRO</span> list (for example
if some elements have a common ancestor) then <em>only the last occurrence in the list will be kept</em> - so each class
will exist only once in the <span class="caps">MRO</span> list. The above rule implies that the
rightmost element in every <span class="caps">MRO</span> list will always be object - please make sure you
understand why before&nbsp;continuing.</p>
<p>Thus, the <span class="caps">MRO</span> list for <tt class="docutils literal">DefaultHeaderJsonCustomClassView</tt> defined in the previous section
is (remember, start
with the class to the left and add the <span class="caps">MRO</span> of each of its ancestors starting
from the leftmost one):
<tt class="docutils literal">[DefaultHeaderJsonCustomClassView, DefaultHeaderBetterCustomClassView, BetterCustomClassView, CustomClassView, JsonCustomClassView, object]</tt>, while
for <tt class="docutils literal">JsonDefaultHeaderCustomClassView</tt> is
<tt class="docutils literal">[JsonDefaultHeaderCustomClassView, JsonCustomClassView, DefaultHeaderBetterCustomClassView, BetterCustomClassView, CustomClassView, object]</tt>. What this
means is that for <tt class="docutils literal">DefaultHeaderJsonCustomClassView</tt> the <tt class="docutils literal">CustomClassView.as_view()</tt> and <tt class="docutils literal">DefaultHeaderBetterCustomClassView.get_header()</tt>  (thus
we will not get the <span class="caps">JSON</span> output) and for <tt class="docutils literal">JsonDefaultHeaderCustomClassView</tt> the <tt class="docutils literal">JsonCustomClassView.as_view()</tt> and <tt class="docutils literal">JsonCustomClassView.get_header()</tt>
will be used (so we won&#8217;t get the default header functionality) - i.e none of those two options will result to the desired&nbsp;behaviour.</p>
<p>Let&#8217;s try an example that has the same base class twice in the hierarchy (actually the previous examples also had a class twice in
the hierarchy - <tt class="docutils literal">object</tt> but let&#8217;s be more explicit). For this, we&#8217;ll create a
<tt class="docutils literal">DefaultContextBetterCustomClassView</tt> that returns a default context if the context is empty
(similar to the default header&nbsp;functionality).</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultContextBetterCustomClassView</span><span class="p">(</span><span class="n">BetterCustomClassView</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;DEFAULT CONTEXT&quot;</span><span class="p">]</span>
</pre></div>
<p>Now we&#8217;ll create a class that inherits from both <tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> and <tt class="docutils literal">DefaultContextBetterCustomClassView</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultHeaderContextCustomClassView</span><span class="p">(</span><span class="n">DefaultHeaderBetterCustomClassView</span><span class="p">,</span> <span class="n">DefaultContextBetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Let&#8217;s do the <span class="caps">MRO</span> for the <tt class="docutils literal">DefaultHeaderContextCustomClassView</tt> class:</p>
<p>Initially, the <span class="caps">MRO</span> will be the&nbsp;following:</p>
<pre class="code literal-block">
Starting with the initial class
1. DefaultHeaderContextCustomClassView
Follows the leftmost class (DefaultHeaderBetterCustomClassView) MRO
2. DefaultHeaderContextCustomClassView, 3. BetterCustomClassView, 4. CustomClassView, 5. object
And finally the next class (DefaultContextBetterCustomClassView) MRO
6. DefaultContextBetterCustomClassView, 7. BetterCustomClassView, 8. CustomClassView, 9. object
</pre>
<p>Notice that classes <tt class="docutils literal">BetterCustomClassView</tt>, <tt class="docutils literal">CustomClassView</tt> and <tt class="docutils literal">object</tt> are repeated two times
(on place 3,4,5 and 7,8,9) thus <em>only</em> their last (rightmost) occurrences will be kept in the list. So the
resulting <span class="caps">MRO</span> is the following (3,4,5 are&nbsp;removed):</p>
<p><tt class="docutils literal">[DefaultHeaderContextCustomClassView, DefaultHeaderBetterCustomClassView, DefaultContextBetterCustomClassView, BetterCustomClassView, CustomClassView, object]</tt></p>
<p>One funny thing here is that the <tt class="docutils literal">DefaultHeaderContextCustomClassView</tt> <em>will actually work</em> properly because the
<tt class="docutils literal">get_header</tt> will be found in <tt class="docutils literal">DefaultHeaderBetterCustomClassView</tt> and the
<tt class="docutils literal">get_context</tt> will be found in <tt class="docutils literal">DefaultContextBetterCustomClassView</tt> so this
result to the correct&nbsp;functionality.</p>
<p>Yes it does work but at what cost? Do you really want to do the mental exercise
of finding out the <span class="caps">MRO</span> for each class you define to see which method will be actually used? Also, what would happen if the
<tt class="docutils literal">DefaultHeaderContextCustomClassView</tt> class also had a <tt class="docutils literal">get_context</tt> method defined
(hint: that <tt class="docutils literal">get_context</tt> would be used and the <tt class="docutils literal">get_context</tt> of <tt class="docutils literal">DefaultContextBetterCustomClassView</tt>
would be&nbsp;ignored).</p>
<p>Before finishing this interlude, I&#8217;d like to make a confession: The Python <span class="caps">MRO</span> algorithm is not as simple as
than the procedure I described. It uses an algorithm called <a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 linearization</a> which seems way too complex
to start explaining or understanding if you not a <span class="caps">CS</span> student. What you&#8217;ll need to remember is that the
procedure I described works fine in normal cases when you don&#8217;t try to do something stupid. Here&#8217;s a
<a class="reference external" href="https://medium.com/technology-nineleaps/python-method-resolution-order-4fd41d2fcc">post that explains the theory more</a>. However if you  follow along my recommendations below you won&#8217;t
have any problems with <span class="caps">MRO</span>, actually you won&#8217;t really need to use the <span class="caps">MRO</span> that much to understand
the method calling&nbsp;hierarchy.</p>
</div>
<div class="section" id="using-mixins-for-code-reuse">
<h3>Using mixins for&nbsp;code-reuse</h3>
<p>The above explanation of <span class="caps">MRO</span> should convince you that you should avoid
mixing hierarchies of classes - if you are not convinced then wait until I introduce <tt class="docutils literal">super()</tt>
in the next section and I guarantee that you&#8217;ll&nbsp;be!</p>
<p>So, that&#8217;s why I
propose implementing common functionality that needs to be re-used between
classes only with mixins (hint: that&#8217;s also what Django does). Each re-usable functionality
will be implemented in its own mixin;  class views that need to implement that
functionality will just inherit from the mixin along with the base class view. Each
one of the view classes you define should inherit from <em>one and only one</em> other class
view and any number of mixins you want. Make sure that the view class is rightmost in
the ancestors list and the mixins are to the left of it (so that they will properly override
its behaviour; remember that the methods of the ancestors to the left are searched first
in the <span class="caps">MRO</span> list &#8212; and the methods of the defined class have of course the highest priority
since it goes first in the <span class="caps">MRO</span>&nbsp;list).</p>
<p>Let&#8217;s try implementing the proposed mixins for a default header and&nbsp;context:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultHeaderMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">else</span> <span class="s2">&quot;DEFAULT HEADER&quot;</span>

<span class="k">class</span> <span class="nc">DefaultContextMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;DEFAULT CONTEXT&quot;</span><span class="p">]</span>
</pre></div>
<p>and all the proposed use cases using the base class view and the&nbsp;mixins:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultHeaderMixinBetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">DefaultHeaderMixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">DefaultContextMixinBetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">DefaultContextMixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">DefaultHeaderContextMixinBetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">DefaultHeaderMixin</span><span class="p">,</span> <span class="n">mixins</span><span class="o">.</span><span class="n">DefaultContextMixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">JsonDefaultHeaderMixinCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">DefaultHeaderMixin</span><span class="p">,</span> <span class="n">JsonCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>I believe that the above definitions are self-documented and it is very easy to know which
method of the resulting class will be called each time: Start from the main class and if
the method is not found there continue from left to right to the ancestor list; since the mixins
do only one thing and do it well you&#8217;ll know what each class does simply by looking at its&nbsp;definition.</p>
</div>
<div class="section" id="the-super-situation">
<h3>The super&nbsp;situation</h3>
<p>The final (and most complex) thing and extension I&#8217;d like to discuss for our custom class based views is the case
where you want to use the functionality of more than one mixins for the <em>same thing</em>. For example, let&#8217;s suppose
that we had a mixin that added some data to the context and a different mixing that added
some different data to the context. Both would use the <tt class="docutils literal">get_context</tt> method
and you&#8217;d like to have the context data of both of them to your context. But
this is not possible using the implementations above because when a
<tt class="docutils literal">get_context</tt> is found in the <span class="caps">MRO</span> list it will be called and the <span class="caps">MRO</span> search
will finish&nbsp;there!</p>
<p>So how could we add the functionality of both these mixins to a class based view? This is the same problem as
if we wanted to inherit from a mixin (or a class view) and override one of its methods
but <em>also</em> call its parent (overridden) method for example to get its output and use it as the base
of the output for the overridden method. Both these situations (re-use
functionality of two mixins with the same method or re-use functionality
from a parent method you override) are the same because what stays in the end is
the <span class="caps">MRO</span> list. For example say we we had the following base&nbsp;class</p>
<pre class="code literal-block">
class V:pass
</pre>
<p>and we wanted to override it either using mixins or by using normal&nbsp;inheritance.</p>
<p>When using mixins for example like&nbsp;this:</p>
<pre class="code literal-block">
class M1:pass
class M2:pass
class MIXIN(M2, M1, V):pass
</pre>
<p>we&#8217;ll have the following <span class="caps">MRO</span>:</p>
<pre class="code literal-block">
# MIXIN.mro()
# [MIXIN, M2, M1, V, object, ]
</pre>
<p>while when using inheritance like&nbsp;this:</p>
<pre class="code literal-block">
class M1V(V):pass
class M2M1V(M1V):pass
class INHERITANCE(M2M1V):pass
</pre>
<p>we&#8217;ll have the following <span class="caps">MRO</span>:</p>
<blockquote>
# <span class="caps">INHERITANCE</span>.mro()
# [<span class="caps">INHERITANCE</span>, <span class="caps">M2M1V</span>, <span class="caps">M1V</span>, V, object ]</blockquote>
<p>As we can see in both cases the base class V is the last one (just next to object)
and between this class and the one that needs the functionality (<tt class="docutils literal"><span class="caps">MIXIN</span></tt> in the first
case and <tt class="docutils literal"><span class="caps">INHERITANCE</span></tt> in the second case) there are
the classes that will define the extra functionality that needs to be re-used: <tt class="docutils literal">M2</tt> and <tt class="docutils literal">M1</tt> (start from
left to right) in the first case and <tt class="docutils literal"><span class="caps">M2M1V</span></tt> and <tt class="docutils literal"><span class="caps">M1V</span></tt> (follow the inheritance hierarchy)
in the second case. So in both cases when calling a method they will be searched the same way using
the <span class="caps">MRO</span> list and when the method is found it will be executed and the search will&nbsp;stop.</p>
<p>But what if we needed to re-use some method from <tt class="docutils literal">V</tt> (or from some other ancestor) and
a class on the left of the <span class="caps">MRO</span> list has the same method?
The answer, as you should have guessed by now if you have some Python knowledge is <tt class="docutils literal">super()</tt>.</p>
<p>The <tt class="docutils literal">super</tt> method can be used by a class method to call a method of <em>its ancestors</em> respecting
the <span class="caps">MRO</span>. Thus, running <tt class="docutils literal"><span class="pre">super().x()</span></tt> from a method instance will try to find method <tt class="docutils literal">x()</tt>
on the <span class="caps">MRO</span> ancestors of this instance <em>even if the instance defines the &#8220;x()&#8220; method</em> i.e it will
not search the first element of the <span class="caps">MRO</span> list. Notice
that if the <tt class="docutils literal">x()</tt> method does not exist in the headless-<span class="caps">MRO</span> chain you&#8217;ll get an attribute error.
So, usually, you&#8217;ll can <tt class="docutils literal"><span class="pre">super().x()</span></tt> from <em>inside</em> the <tt class="docutils literal">x()</tt> method to call your parent&#8217;s (as
specified by the <span class="caps">MRO</span> list) same-named method and retrieve its&nbsp;output.</p>
<p>Let&#8217;s take a closer look at how <tt class="docutils literal">super()</tt> works using a simple example. For this, we&#8217;ll define a method calld <tt class="docutils literal">x()</tt> on all classes
of the previous&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">V</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From V&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">M1</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From M1&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">M2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From M2&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MIXIN</span><span class="p">(</span><span class="n">M2</span><span class="p">,</span> <span class="n">M1</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From MIXIN&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">M1V</span><span class="p">(</span><span class="n">V</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From M1V&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">M2M1V</span><span class="p">(</span><span class="n">M1V</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From M2M1V&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">INHERITANCE</span><span class="p">(</span><span class="n">M2M1V</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;From INHERITANCE&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s2">&quot;MIXIN OUTPUT&quot;</span><span class="p">)</span>
<span class="n">MIXIN</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>

<span class="k">print</span> <span class="p">(</span><span class="s2">&quot;INHERITANCE OUTPUT&quot;</span><span class="p">)</span>
<span class="n">INHERITANCE</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
</pre></div>
<p>Here&#8217;s the&nbsp;output:</p>
<pre class="code literal-block">
MIXIN OUTPUT
From V
From M1
From M2
From MIXIN
INHERITANCE OUTPUT
From V
From M1V
From M2M1V
From INHERITANCE
</pre>
<p>Notice when each message is printed: Because x() first calls its <tt class="docutils literal">super()</tt> method
and then it prints the message in both cases first the <tt class="docutils literal">From V</tt> message is printed
from the base class and then from the following classes in the hierarchy (as per the <span class="caps">MRO</span>)
ending with the class of the instance (either <tt class="docutils literal"><span class="caps">MIXIN</span></tt> or <tt class="docutils literal"><span class="caps">INHERITANCE</span></tt>). Also the
print order is the same in both cases as we&#8217;ve already explained. Please make
sure you understand why the output is like this before&nbsp;continuing.</p>
</div>
<div class="section" id="using-super-in-our-hierarchy">
<h3>Using super in our&nbsp;hierarchy</h3>
<p>Using super and mixins it is easy to mix and match functionality to create new
classes. Of course, super can be used without mixins when overriding a method from
a class you inherit from and want to also call your ancestor&#8217;s&nbsp;method.</p>
<p>Here&#8217;s how we could add a prefix to the&nbsp;header:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HeaderPrefixMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;PREFIX: &quot;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_header</span><span class="p">()</span>
</pre></div>
<p>and here&#8217;s how it could be&nbsp;used:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HeaderPrefixBetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">HeaderPrefixMixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Hello!&#39;</span>
</pre></div>
<p>This will retrieve the header from the ancestor and properly print the header displaying both <span class="caps">PREFIX</span> and Hello.
What if we wanted to re-use the default header mixin? First let&#8217;s change <tt class="docutils literal">DefaultHeaderMixin</tt>
to properly use <tt class="docutils literal">super()</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultHeaderSuperMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_header</span><span class="p">()</span> <span class="k">if</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_header</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;DEFAULT HEADER&quot;</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HeaderPrefixDefaultBetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">HeaderPrefixMixin</span><span class="p">,</span> <span class="n">mixins</span><span class="o">.</span><span class="n">DefaultHeaderSuperMixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Notice the order of the ancestor classes. The <tt class="docutils literal">get_header()</tt> of  <tt class="docutils literal">HeaderPrefixMixin</tt> will be called which
will call the <tt class="docutils literal">get_header()</tt> of
<tt class="docutils literal">DefaultHeaderSuperMixin</tt> (which will call the <tt class="docutils literal">get_header()</tt> of <tt class="docutils literal">BetterCustomClassView</tt> returning <tt class="docutils literal">None</tt>).
So the result will be <tt class="docutils literal">&quot;<span class="caps">PREFIX</span>: <span class="caps">DEFAULT</span> <span class="caps">HEADER</span>&quot;</tt>. However if instead we had defined this class&nbsp;like</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HeaderPrefixDefaultBetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">DefaultHeaderSuperMixin</span><span class="p">,</span> <span class="n">mixins</span><span class="o">.</span><span class="n">HeaderPrefixMixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>the result would be <tt class="docutils literal">&quot;<span class="caps">PREFIX</span>: &quot;</tt> (<span class="caps">DEFAULT</span> <span class="caps">HEADER</span> won&#8217;t be printed). Can you understand&nbsp;why?</p>
<p>One thing to keep in mind is that most probably you&#8217;ll need to call <tt class="docutils literal">super()</tt> and return its output when you override a method.
Even if you think that you don&#8217;t need to call it for this view or mixin, you may need it later from some other view or mixin that
inherits from this view. Also notice that <tt class="docutils literal">super()</tt> may not return anything but may have some
side-effects in your class (for example set a <tt class="docutils literal">self</tt> attribute) which you won&#8217;t get if you don&#8217;t call&nbsp;it!</p>
<p>For another example of super, let&#8217;s define a couple of mixins that add things to the&nbsp;context:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExtraContext1Mixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;data1&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span>


<span class="k">class</span> <span class="nc">ExtraContext2Mixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;data2&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
<p>The first one retrieves the ancestor context list and appends <tt class="docutils literal">'data1'</tt> to the
it while the second one will insert <tt class="docutils literal">'data2'</tt> to the start of the list. To use
these mixins just add them to the ancestor list of your class hierarchy as usually.
One interesting thing to notice here is that because of how <tt class="docutils literal">get_context</tt> is
defined we&#8217;ll get the same output no matter the order of the mixins in the hierarchy
since <tt class="docutils literal">ExtraContext1Mixin</tt> will append <tt class="docutils literal">data1</tt> to the end of the context list and
the <tt class="docutils literal">ExtraContext2Mixin</tt> will insert <tt class="docutils literal">data2</tt> to the start of the context&nbsp;list.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExtraContext12BetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">ExtraContext1Mixin</span><span class="p">,</span> <span class="n">mixins</span><span class="o">.</span><span class="n">ExtraContext2Mixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ExtraContext21BetterCustomClassView</span><span class="p">(</span><span class="n">mixins</span><span class="o">.</span><span class="n">ExtraContext2Mixin</span><span class="p">,</span> <span class="n">mixins</span><span class="o">.</span><span class="n">ExtraContext1Mixin</span><span class="p">,</span> <span class="n">BetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>If instead both of these mixins appended the item to the end of the list, then
the output would be different depending on the ancestor order.
Of course, since we&#8217;ve already defined <tt class="docutils literal">HeaderPrefixMixin</tt> and <tt class="docutils literal">DefaultHeaderSuperMixin</tt> nothing stops us
from using all those mixins&nbsp;together!</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AllTogetherNowBetterCustomClassView</span><span class="p">(</span>
        <span class="n">mixins</span><span class="o">.</span><span class="n">HeaderPrefixMixin</span><span class="p">,</span>
        <span class="n">mixins</span><span class="o">.</span><span class="n">DefaultHeaderSuperMixin</span><span class="p">,</span>
        <span class="n">mixins</span><span class="o">.</span><span class="n">ExtraContext1Mixin</span><span class="p">,</span>
        <span class="n">mixins</span><span class="o">.</span><span class="n">ExtraContext2Mixin</span><span class="p">,</span>
        <span class="n">BetterCustomClassView</span>
    <span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>This will have the desired behaviour of adding a prefix to the header, having a default header if not one was defined
and adding the extra context from both&nbsp;mixins!</p>
</div>
<div class="section" id="testing-all-this">
<h3>Testing all&nbsp;this</h3>
<p>In the accompanying project at <a class="reference external" href="https://github.com/spapas/cbv-tutorial">https://github.com/spapas/cbv-tutorial</a> you can take a look at how this
custom <span class="caps">CBV</span> hierarchy works by running it and taking a look at the <tt class="docutils literal">core</tt> project (visit <a class="reference external" href="http://127.0.0.1:8001/non-django-cbv/">http://127.0.0.1:8001/non-django-cbv/</a>).
There you can take a look at the views.py and mixins.py to see all the views and mixins we&#8217;ve discussed in this&nbsp;chapter.</p>
</div>
</div>
<div class="section" id="a-high-level-overview-of-cbvs">
<h2>A high level overview of&nbsp;CBVs</h2>
<p>After the previous rather long (but I hope gentle enough) introduction to implementing
our own class based view hierarchy using inheritance, mixins, <span class="caps">MRO</span>, method overriding
and <tt class="docutils literal">super</tt> we can now start talking about the Django Class Based Views (CBVs). Our
guide will be the <a class="reference external" href="http://ccbv.co.uk`"><span class="caps">CBV</span> inspector</a> application which displays all classes and mixins
that Django CBVs are using along with their methods and attributes. Using this application
and after reading this article you should be able to quickly and definitely know
which method or attribute you need to define to each one of your mixins or&nbsp;views.</p>
<p>To use <span class="caps">CBV</span> inspector, just click on a class name (for example <tt class="docutils literal">CreateView</tt>); you will
immediately see its <span class="caps">MRO</span> ancestors, its list of attributes (and the ancestor class that defines
each one) and finally a list of methods that this class and all its ancestors define.
Of course when a method is defined by multiple classes the <span class="caps">MRO</span> ordering will be used -
super is used when the functionality of the ancestor classes is also used. The <span class="caps">CBV</span>
inspector (and our project) has Python 3 syntax. If you want to follow along with
Python 2 (I don&#8217;t recommend it though since Django 2.0 only supports Python 3.x) use the following
syntax to call super for method <tt class="docutils literal">x()</tt>:</p>
<div class="highlight"><pre><span></span><span class="nb">super</span><span class="p">(</span><span class="n">ClassName</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
</pre></div>
<p>this is the same as&nbsp;calling</p>
<div class="highlight"><pre><span></span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
</pre></div>
<p>in Python&nbsp;3.x.</p>
<div class="section" id="taking-a-look-at-the-view">
<h3>Taking a look at the&nbsp;View</h3>
<p>In any case, our travel starts from the central <span class="caps">CBV</span> class which is (intuitively) called &#8230; <a class="reference external" href="https://ccbv.co.uk/View">View</a>!</p>
<p>This class is used as the base in Django&#8217;s <span class="caps">CBV</span> hierarchy (similar to how  <tt class="docutils literal">CustomClassView</tt>
was used in our own hierarchy). It has only one attribute
(<tt class="docutils literal">http_method_names</tt>) and a very small number of methods. The most important method is the
<tt class="docutils literal">as_view</tt> class method (which is similar to the one we defined in the previous section).
The <tt class="docutils literal">as_view</tt> will instantiate an instance object of the <tt class="docutils literal">View</tt> class
(actually the class that inherits from <tt class="docutils literal">View</tt>) and use this object to properly generate a functional&nbsp;view.</p>
<p>The <tt class="docutils literal">View</tt> class cannot be used as it is
but it must be inherited by a child class. The child class needs to define a method
that has the same name as each http method that is supported - for example if
only <span class="caps">HTTP</span> <span class="caps">GET</span> and <span class="caps">HTTP</span> <span class="caps">POST</span> are supported then the inherited class must define a
<tt class="docutils literal">get</tt> and a <tt class="docutils literal">post</tt> method; these methods are called from the functional view
through a method called <tt class="docutils literal">dispatch</tt> and need to return a proper response object. So,
we have two central methods here: The <tt class="docutils literal">as_view</tt> class method that creates the
object instance and returns its view function and <tt class="docutils literal">dispatch</tt> that will call
the proper named class method depending on the <span class="caps">HTTP</span> method (i.e post, get, put
etc). One thing to keep from this discussion is that you shouldn&#8217;t ever need to
mess with <tt class="docutils literal">as_view</tt> but, because <tt class="docutils literal">dispatch</tt> is the only instance method that is
guaranteed to run every time the class based view will run, you will frequently
need to override it especially to control access&nbsp;control.</p>
<p>As an example, we can implemented the <tt class="docutils literal">BetterCustomClassView</tt> from the first
section using <tt class="docutils literal">View</tt> as its&nbsp;ancestor:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DjangoBetterCustomClassView</span><span class="p">(</span><span class="n">View</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">context</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_context</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;html&gt;</span>
<span class="s2">                &lt;body&gt;</span>
<span class="s2">                    &lt;h1&gt;{header}&lt;/h1&gt;</span>
<span class="s2">                    {body}</span>
<span class="s2">                &lt;/body&gt;</span>
<span class="s2">            &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_header</span><span class="p">(),</span> <span class="n">body</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">render_context</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></div>
<p>This method won&#8217;t print anything but of course it could use the mixins from
before to have some default&nbsp;values:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DefaultHeaderContextDjangoBetterCustomClassView</span><span class="p">(</span><span class="n">DefaultHeaderMixin</span><span class="p">,</span> <span class="n">DefaultContextMixin</span><span class="p">,</span> <span class="n">DjangoBetterCustomClassView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Of course instead of using our mixins and render methods it would be much better
to use the proper ones defined by Django - that&#8217;s what we&#8217;re going to do from
now on I just wanted to make clear that there&#8217;s nothing special in Django&#8217;s <span class="caps">CBV</span>
hierarchy and can be overridden as we&#8217;d&nbsp;like.</p>
</div>
<div class="section" id="redirectview-and-templateview">
<h3>RedirectView and&nbsp;TemplateView</h3>
<p>Continuing our tour of Django CBVs I&#8217;d like to talk a little about the classes
that the <span class="caps">CBV</span> Inspector puts in the same level as <tt class="docutils literal">View</tt> (<span class="caps">GENERIC</span> <span class="caps">BASE</span>):
<a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/base/#redirectview">RedirectView</a> and <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/base/#templateview">TemplateView</a>. Both inherit directly from <tt class="docutils literal">View</tt> and, the
first one defines a <tt class="docutils literal">get</tt> method that returns a redirect to another page
while the latter one renders and returns a Django template in the <tt class="docutils literal">get</tt>
method.</p>
<p>The <tt class="docutils literal">RedirectView</tt> inherits directly from view and has attributes like <tt class="docutils literal">url</tt>
(to use a static url)
or <tt class="docutils literal">pattern_name</tt> (to use one of the patterns define in your urls.py)
to define where it should redirect. These attributes are
used by the <tt class="docutils literal">get_redirect_url</tt> which will generate the actual url to redirect
to and can be overriden for example to redirect to a different location depending
on the current&nbsp;user.</p>
<p>The <tt class="docutils literal">TemplateView</tt> on the other hand inherits from <tt class="docutils literal">View</tt> and two more classes (actually
these are mixins) beyond <tt class="docutils literal">View</tt>: <tt class="docutils literal">TemplateResponseMixin</tt> and
<tt class="docutils literal">ContextMixin</tt>. If you take a look at them you&#8217;ll see that the
<tt class="docutils literal">TemplateResponseMixin</tt> defines some template-related attributes (most important being
the <tt class="docutils literal">template_name</tt>) and two
methods: One that retrieves the template that will be used to render this View
(<tt class="docutils literal">get_template_names</tt>)
and one that actually renders the template (<tt class="docutils literal">render_to_response</tt>) using a
<a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/template-response/#django.template.response.TemplateResponse">TemplateResponse</a> instance. The
<tt class="docutils literal">ContextMixin</tt> provides the <tt class="docutils literal">get_context_data</tt> that is
passed to the template to be rendered and should be overridden if you want to
pass more context&nbsp;variables.</p>
<p>We can already see many opportunities of reusing and overriding
functionality and improving our <span class="caps">DRY</span> score, for example: Create a catch all RedirectView
that depending on the remainder of the url it will redirect to a different page,
create a mixin that appends some things to the context of all CBVs using it, use dynamic templates
based on some other condition (that&#8217;s actually what Detail/List/UpdateView
are doing), render a template to a different output than Html (for example a
text file) etc. I&#8217;ll try to present examples for these in the next&nbsp;section.</p>
</div>
<div class="section" id="the-formview">
<h3>The&nbsp;FormView</h3>
<p>The next view we&#8217;re going to talk about is <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-editing/#formview">FormView</a>. This is a view that can be
used whenever we want to display a form (<em>not</em> a form related to a Model i.e for
Create/Update/Delete, for these cases there are specific CBVs we&#8217;ll see later).
It is interesting to take a look at the list of its
ancestors: <tt class="docutils literal">TemplateResponseMixin</tt>, <tt class="docutils literal">BaseFormView</tt>, <tt class="docutils literal">FormMixin</tt>, <tt class="docutils literal">ContextMixin</tt>, <tt class="docutils literal">ProcessFormView</tt> and <tt class="docutils literal">View</tt>.
We are familiar with <tt class="docutils literal">TemplateResponseMixin</tt>, <tt class="docutils literal">ContextMixin</tt> and <tt class="docutils literal">View</tt> but not with
the others. Before discussing these classes let&#8217;s take a look at the FormView
hierarchy, courtesy of <a class="reference external" href="http://ccbv.cco.uk">http://ccbv.cco.uk</a> and <a class="reference external" href="http://yuml.me">http://yuml.me</a>:</p>
<img src="https://yuml.me/diagram/plain;/class/[TemplateResponseMixin%7Bbg:white%7D]%5E-[FormView%7Bbg:green%7D],%20[BaseFormView%7Bbg:white%7D]%5E-[FormView%7Bbg:green%7D],%20[FormMixin%7Bbg:white%7D]%5E-[BaseFormView%7Bbg:white%7D],%20[ContextMixin%7Bbg:white%7D]%5E-[FormMixin%7Bbg:white%7D],%20[ProcessFormView%7Bbg:white%7D]%5E-[BaseFormView%7Bbg:white%7D],%20[View%7Bbg:lightblue%7D]%5E-[ProcessFormView%7Bbg:white%7D].svg" alt="FormView"><p>The above diagram should make everything easier: The <tt class="docutils literal">FormMixin</tt> inherits
from <tt class="docutils literal">ContextMixin</tt> and overrides its <tt class="docutils literal">get_context_data</tt> method to add the
form to the view. Beyond this, it adds some attributes and methods for proper form handling, for
example the <tt class="docutils literal">form_class</tt> (attribute when the form class will be the same always) and
<tt class="docutils literal">get_form_class()</tt> (method when the form class will be dynamic for example
depending on the logged in user), <tt class="docutils literal">initial</tt> and <tt class="docutils literal">get_initial()</tt> (same logic as before for
the form&#8217;s initial values), <tt class="docutils literal">form_valid()</tt> and <tt class="docutils literal">form_invalid()</tt> to define
what should happen when the form is valid or invalid, <tt class="docutils literal">get_form_kwargs</tt> to pass
some keyword arguments to the form&#8217;s constructor etc. Notice that FormMixin
does not define any form handling logic (i.e check if the form is valid and call
its <tt class="docutils literal">form_valid()</tt> method) &#8212; this logic is defined in the <tt class="docutils literal">ProcessFormView</tt>
which inherits from <tt class="docutils literal">View</tt> and defines proper <tt class="docutils literal">get()</tt> (just render the form)
and <tt class="docutils literal">post()</tt> (check if the form is valid and call <tt class="docutils literal">form_valid</tt> else call <tt class="docutils literal">form_invalid</tt>)&nbsp;methods.</p>
<p>One interesting here is to notice here is that Django defines both the <tt class="docutils literal">FormMixin</tt> and <tt class="docutils literal">ProcessFormView</tt>.
The <tt class="docutils literal">FormMixin</tt> offers the basic Form elements (the form class, initial data
etc) and could be re-used in a different flow beyond the one offered by
<tt class="docutils literal">ProcessFormView</tt> (for example display the form as a <span class="caps">JSON</span> object instead of a
Django template). On the other hand, <tt class="docutils literal">ProcessFormView</tt> is required in order to
define the <tt class="docutils literal">get</tt> and <tt class="docutils literal">post</tt> methods that are needed from the <tt class="docutils literal">View</tt>. These
methods can&#8217;t be overridden in the FormMixin since that would mean that the mixin
would behave as a&nbsp;view!</p>
<p>Finally, the <tt class="docutils literal">BaseFormView</tt> class is used to
inherit from <tt class="docutils literal">ProcessFormView</tt> and <tt class="docutils literal">FormMixin</tt>. It does not do anything
more than providing a base class that other classes that want to use the form
functionality (i.e both the <tt class="docutils literal">ProcessFormView</tt> and <tt class="docutils literal">FormMixin</tt>) will inherit&nbsp;from.</p>
</div>
<div class="section" id="the-listview-and-detailview">
<h3>The ListView and&nbsp;DetailView</h3>
<p>Next in our Django <span class="caps">CBV</span> tour is the <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#listview">ListView</a>. The <tt class="docutils literal">ListView</tt> is used to render multiple
objects in a template, for example in a list or table. Here&#8217;s a diagram of the class
hierarchy (courtesy of <a class="reference external" href="http://ccbv.cco.uk">http://ccbv.cco.uk</a> and <a class="reference external" href="http://yuml.me">http://yuml.me</a>):</p>
<img src="https://yuml.me/diagram/plain;/class/[MultipleObjectTemplateResponseMixin%7Bbg:white%7D]%5E-[ListView%7Bbg:green%7D],%20[TemplateResponseMixin%7Bbg:white%7D]%5E-[MultipleObjectTemplateResponseMixin%7Bbg:white%7D],%20[BaseListView%7Bbg:white%7D]%5E-[ListView%7Bbg:green%7D],%20[MultipleObjectMixin%7Bbg:white%7D]%5E-[BaseListView%7Bbg:white%7D],%20[ContextMixin%7Bbg:white%7D]%5E-[MultipleObjectMixin%7Bbg:white%7D],%20[View%7Bbg:lightblue%7D]%5E-[BaseListView%7Bbg:white%7D].svg" alt="ListView"><p>The <tt class="docutils literal">MultipleObjectMixin</tt> is used make a query to the database (either using a
model or a queryset) and pass the results to the context. It also supports
custom ordering (<tt class="docutils literal">get_ordering()</tt>) and pagination (<tt class="docutils literal">paginate_queryset()</tt>).
However, the most important method of this mixin is <tt class="docutils literal">get_queryset()</tt>. This
method checks to see if the <tt class="docutils literal">queryset</tt> or <tt class="docutils literal">model</tt> attribute are defined
(<tt class="docutils literal">queryset</tt> will be checked first so it has priority if both are defined) and
returns a queryset result (taking into account the ordering). This queryset
result will be used by the <tt class="docutils literal">get_context_data()</tt> method of this mixin to
actually put it to the context by saving to a context variable named <tt class="docutils literal">object_list</tt>.
Notice that you can set the <tt class="docutils literal">context_object_name</tt> attribute to add and extra
another variable to the context with the queryset beyond <tt class="docutils literal">object_list</tt> (for
example if you have an <tt class="docutils literal">ArticleLsitView</tt> you can set <tt class="docutils literal">context_object_name = articles</tt> to
be able to do <tt class="docutils literal">{% for article in articles %}</tt> in your context instead of
<tt class="docutils literal">{% for article in object_list %}</tt>).</p>
<p>The <tt class="docutils literal">MultipleObjectMixin</tt> can be used and
overridden when we need to put multiple objects in a View. This mixin is
inherited (along with <tt class="docutils literal">View</tt>) from <tt class="docutils literal">BaseListView</tt> that adds a proper <tt class="docutils literal">get</tt>
method to call <tt class="docutils literal">get_context_data</tt> and pass the result to the&nbsp;template.</p>
<p>As we can also see, Django uses the <tt class="docutils literal">MultipleObjectTemplateResponseMixin</tt> that
inherits from <tt class="docutils literal">TemplateResponseMixin</tt> to render the template. This mixin does
some magic with the queryset or model to define a
template name (so you won&#8217;t need to define it yourself) - that&#8217;s from where the
<tt class="docutils literal">app_label/app_model_list.html</tt> default template name is&nbsp;created.</p>
<p>Similar to the <tt class="docutils literal">ListView</tt> is the <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#detailview">DetailView</a> which has the same class hierarchy as the <tt class="docutils literal">ListView</tt> with two differences:
It uses <tt class="docutils literal">SingleObjectMixin</tt> instead of <tt class="docutils literal">MultipleOjbectMixin</tt>,
<tt class="docutils literal">SingleObjectTemplateResponseMixin</tt> instead of <tt class="docutils literal">MultipleObjectTemplateResponseMixin</tt>
and <tt class="docutils literal">BaseDetailView</tt> instead of <tt class="docutils literal">BaseListView</tt>. The
<tt class="docutils literal">SingleObjectMixin</tt> will use the <tt class="docutils literal">get_queryset()</tt> (in a similar manner to the <tt class="docutils literal">get_queryset()</tt> of
<tt class="docutils literal">MultipleObjectMixin</tt>) method to return a single object (so all attributes and methods
concerning ordering or pagination are missing) but instead has the <tt class="docutils literal">get_object()</tt> method which
will pick and return a single object from that queryset (using a <tt class="docutils literal">pk</tt> or <tt class="docutils literal">slug</tt> parameter). This object
will be put to the context of this view by the <tt class="docutils literal">get_context_data</tt>. The <tt class="docutils literal">BaseDetailView</tt> just
defines a proper <tt class="docutils literal">get</tt> to call the <tt class="docutils literal">get_context_data</tt> (of <tt class="docutils literal">SingleObjectMixin</tt>) and finally
the <tt class="docutils literal">SingleObjectTemplateResponseMixin</tt> will automatically generate the template name (i.e generate
<tt class="docutils literal">app_label/app_model_detail.html</tt>).</p>
</div>
<div class="section" id="the-createview">
<h3>The&nbsp;CreateView</h3>
<p>The next Django <span class="caps">CBV</span> we&#8217;ll talk about is <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#createview">CreateView</a>. This class is used to create a new instance
of a model. It has a rather complex hierarchy diagram but we&#8217;ve already discussed most of these&nbsp;classes:</p>
<img src="https://yuml.me/diagram/plain;/class/[SingleObjectTemplateResponseMixin%7Bbg:white%7D]%5E-[CreateView%7Bbg:green%7D],%20[TemplateResponseMixin%7Bbg:white%7D]%5E-[SingleObjectTemplateResponseMixin%7Bbg:white%7D],%20[BaseCreateView%7Bbg:white%7D]%5E-[CreateView%7Bbg:green%7D],%20[ModelFormMixin%7Bbg:white%7D]%5E-[BaseCreateView%7Bbg:white%7D],%20[FormMixin%7Bbg:white%7D]%5E-[ModelFormMixin%7Bbg:white%7D],%20[ContextMixin%7Bbg:white%7D]%5E-[FormMixin%7Bbg:white%7D],%20[SingleObjectMixin%7Bbg:white%7D]%5E-[ModelFormMixin%7Bbg:white%7D],%20[ContextMixin%7Bbg:white%7D]%5E-[SingleObjectMixin%7Bbg:white%7D],%20[ProcessFormView%7Bbg:white%7D]%5E-[BaseCreateView%7Bbg:white%7D],%20[View%7Bbg:lightblue%7D]%5E-[ProcessFormView%7Bbg:white%7D].svg" /><p>As we can see the <tt class="docutils literal">CreateView</tt> inherits from <tt class="docutils literal">BaseCreateView</tt> and <tt class="docutils literal">SingleObjectTemplateResponseMixin</tt>. The
<tt class="docutils literal">SingleObjectTemplateResponseMixin</tt> is mainly used to define the template names that will be searched for
(i.e <tt class="docutils literal">app_label/app_model_form.html</tt>), while the <tt class="docutils literal">BaseCreateView</tt>
is used to combine the functionality of <tt class="docutils literal">ProcessFormView</tt> (that handles the basic form workflow as we have
already discussed) and <tt class="docutils literal">ModelFormMixin</tt>. The <tt class="docutils literal">ModelFormMixin</tt> is a rather complex mixin that inherits from
both <tt class="docutils literal">SingleObjectMixin</tt> and <tt class="docutils literal">FormMixin</tt>. The <tt class="docutils literal">SingleObjectMixin</tt> functionality is not really used by <tt class="docutils literal">CreateView</tt>
(since no object will need to be retrieved for the <tt class="docutils literal">CreateView</tt>) however the <tt class="docutils literal">ModelFormMixin</tt> is also used
by <tt class="docutils literal">UpdateView</tt> that&#8217;s why <tt class="docutils literal">ModelFormMixin</tt> also inherits from it (to retrieve the object that will be&nbsp;updated).</p>
<p><tt class="docutils literal">ModelFormMixin</tt> mixin adds functionality
for handling forms related to models and object instances. More specifically it adds functionality for:
* creating a form class (if one is not provided) by the configured model / queryset. If you don&#8217;t provide the form class (by using the <tt class="docutils literal">form_class</tt> attribute) then you need to configure the fields that the generated form will display by passing an array of field names through the <tt class="docutils literal">fields</tt> attribute
* overrides the <tt class="docutils literal">form_valid</tt> in order to save the object instance of the form
* fixes <tt class="docutils literal">get_success_url</tt> to redirect to the saved object&#8217;s absolute_url when the object is saved
* pass the current object to be updated (that was retrieving through the <tt class="docutils literal">SingleObjectMixin</tt>) -if there is a current object- to the form as the <tt class="docutils literal">instance</tt> attribute</p>
</div>
<div class="section" id="the-updateview-and-deleteview">
<h3>The UpdateView and&nbsp;DeleteView</h3>
<p>The <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#updateview">UpdateView</a> class is almost identical to the <tt class="docutils literal">CreateView</tt> - the only difference is that
<tt class="docutils literal">UpdateView</tt> inherits from <tt class="docutils literal">BaseUpdateView</tt> (and <tt class="docutils literal">SingleObjectTemplateResponseMixin</tt>) instead
of <tt class="docutils literal">BaseCreateView</tt>.  The <tt class="docutils literal">BaseUpdateView</tt> overrides the <tt class="docutils literal">get</tt> and <tt class="docutils literal">post</tt> methods of
<tt class="docutils literal">ProcessFormView</tt> to retrieve the object (using <tt class="docutils literal">SingleObjectMixin</tt>&#8216;s <tt class="docutils literal">get_object()</tt>)
and assign it to an instance variable - this will then be picked up by the <tt class="docutils literal">ModelFormMixin</tt> and used
properly in the form as explained before. One thing I notice here is that it seems that the hierarchy would
be better if the <tt class="docutils literal">ModelFormMixin</tt> inherited <em>only</em> from <tt class="docutils literal">FormMixin</tt> (instead of both from
<tt class="docutils literal">FormMixin</tt> and <tt class="docutils literal">SingleObjectMixin</tt>) and <tt class="docutils literal">BaseUpdateView</tt> inheriting from <tt class="docutils literal">ProcessFormView</tt>,
<tt class="docutils literal">ModelForMixin</tt> <em>and</em> <tt class="docutils literal">SingleObjectMixin</tt>. This way the <tt class="docutils literal">BaseCreateView</tt> wouldn&#8217;t get the
non-needed <tt class="docutils literal">SingleObjectMixin</tt> functionality. I am not sure why Django is implemented this way
(i.e the <tt class="docutils literal">ModelFormMixin</tt> also inheriting from <tt class="docutils literal">SingleObjectMixin</tt> thus passing this non-needed
functionality to <tt class="docutils literal">BaseCreateView</tt>) &#8212; if a reader has a clue I&#8217;d like to know&nbsp;it.</p>
<p>In any way, I&#8217;d like to also present the <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#deleteview">DeleteView</a> which is more or less the same as the <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/class-based-views/generic-display/#detailview">DetailView</a>
with the addition of the <tt class="docutils literal">DeleteMixin</tt> in the mix. The <tt class="docutils literal">DeleteMixin</tt> adds a <tt class="docutils literal">post()</tt> method
that will delete the object when called and makes <tt class="docutils literal">success_url</tt> required (since there would be no
object to redirect to after this view is&nbsp;posted).</p>
</div>
<div class="section" id="access-control-mixins">
<h3>Access control&nbsp;mixins</h3>
<p>Another small hierarchy of class based views (actually these are all mixins) are the authentication ones which
can be used to control access to a view.
These are <tt class="docutils literal">AcessMixin</tt>, <tt class="docutils literal">LoginRequiredMixin</tt>, <tt class="docutils literal">PermissionRequiredMixin</tt> and <tt class="docutils literal">UserPassesTestMixin</tt>.
The <tt class="docutils literal">AccessMixin</tt> provides some basic functionality (i.e what to do when the user does not have access
to the view, find out the login url to redirect him etc) and is used as a base for the other three. These
three override the <tt class="docutils literal">dispatch()</tt> method of <tt class="docutils literal">View</tt> to check if the user has the specific rights (i.e
if he has logged in for <tt class="docutils literal">LoginRequiredMixin</tt>, if he has the defined permissions for <tt class="docutils literal">PermissionRequiredMixin</tt>
or if he passes the provided test in <tt class="docutils literal">UserPassesTextMixin</tt>). If the user has the rights the view will proceed
as normally (call super&#8217;s dispatch) else the access denied functionality from <tt class="docutils literal">AccessMixin</tt> will be&nbsp;implemented.</p>
</div>
<div class="section" id="some-other-cbvs">
<h3>Some other&nbsp;CBVs</h3>
<p>Beyond the class based views I discussed in this section, Django also has a bunch of CBVs related
to account views (<tt class="docutils literal">LoginView</tt>, <tt class="docutils literal">LogoutView</tt>, <tt class="docutils literal">PasswordChangeView</tt> etc) and Dates (<tt class="docutils literal">DateDetailView</tt>, <tt class="docutils literal">YearArchiveView</tt> etc).
I won&#8217;t go into detail about these since they follow the same concepts and use most of the mixins
we&#8217;ve discussed before. Using the <span class="caps">CBV</span> Inspector you should be able to follow along and decide the methods you need
to override for your&nbsp;needs.</p>
<p>Also, most well written Django packages will define their own CBVs that inherit
from the Django CBVs - with the knowledge you acquired here you will be able to follow along on their source code to understand how everything&nbsp;works.</p>
</div>
</div>
<div class="section" id="real-world-use-cases">
<h2>Real world use&nbsp;cases</h2>
<p>In this section I am going to present a number of use cases demonstrating the usefulness of Django CBVs. In most of
these examples I am going to override one of the methods of the mixins I discussed in the previous section. There
are <em>two</em> methods you can use for integrating the following use cases to your&nbsp;application.</p>
<p>Create your own class inheriting from one of the Django CBVs and add to it directly the method to override. For example,
if you wanted to override the <tt class="docutils literal">get_queryset()</tt> method a <tt class="docutils literal">ListView</tt> you would do&nbsp;a:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GetQuerysetOverrideListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;PUBLISHED&#39;</span><span class="p">)</span>
</pre></div>
<p>This is useful if you know that you aren&#8217;t going to need the overriden <tt class="docutils literal">get_queryset</tt> functionality to a different
method and following the <span class="caps">YAGNI</span> principle (or if you know that even if you need it you could inherit from <tt class="docutils literal">GetQuerysetOverrideListView</tt>
i.e in another ListView).
However, if you know that there may be more CBVs that would need their
queryset filtered by <tt class="docutils literal"><span class="pre">status='<span class="caps">PUBLISHED</span>'</span></tt> then you should add a mixin that would be used by your&nbsp;CBVs:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GetQuerysetOverrideMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;PUBLISHED&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GetQuerysetOverrideListView</span><span class="p">(</span><span class="n">GetQuerysetOverrideMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>Now, one thing that needs some discussion here is that the method <tt class="docutils literal">get_queryset</tt> is provided by a mixin (in fact
it is provided by two mixins: <tt class="docutils literal">MultipleObjectMixin</tt> for <tt class="docutils literal">ListView</tt> and <tt class="docutils literal">SingleObjectMixin</tt> for <tt class="docutils literal">DetailView</tt>,
<tt class="docutils literal">UpdateView</tt> and <tt class="docutils literal">DeleteView</tt>). Because of how <span class="caps">MRO</span> works, I won&#8217;t need to inherit <tt class="docutils literal">GetQuerysetOverrideMixin</tt> from
<tt class="docutils literal">MultipleObjectMixin</tt> (or <tt class="docutils literal">SingleObjectMixin</tt> but let&#8217;s ignore that for now) but I can just inherit from object
and make sure that, as already discussed, put the mixin <em>before</em> (to the left) of the <span class="caps">CBV</span>. Notice that even if I had
defined <tt class="docutils literal">GetQuerysetOverrideMixin</tt> as <tt class="docutils literal">GetQuerysetOverrideMixin(MultipleObjectMixin)</tt> the <tt class="docutils literal">MultipleObjectMixin</tt> class would
be found <em>twice</em> in the <span class="caps">MRO</span> list so only the rightmost instance would remain. So the <span class="caps">MRO</span> for both <tt class="docutils literal">GetQuerysetOverrideMixin(object, )</tt>
and <tt class="docutils literal">GetQuerysetOverrideMixin(MultipleObjectMixin)</tt> <em>would be the same</em>! Also, inheriting directly from object makes
our <tt class="docutils literal">GetQuerysetOverrideMixin</tt> more <span class="caps">DRY</span> since if it inherited from <tt class="docutils literal">MultipleObjectMixin</tt> we&#8217;d need to create <em>another</em>
version of it that would inherit from <tt class="docutils literal">SingleObjectMixin</tt>; this is because <tt class="docutils literal">get_queryset</tt> exists in both these&nbsp;mixins.</p>
<p>For some of the following use cases I am also going to use the following models for user generated content (articles and uploaded&nbsp;files):</p>
<div class="highlight"><pre><span></span><span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;DRAFT&#39;</span><span class="p">,</span> <span class="s1">&#39;Draft&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PUBLISHED&#39;</span><span class="p">,</span> <span class="s1">&#39;Published&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;REMOVED&#39;</span><span class="p">,</span> <span class="s1">&#39;Removed&#39;</span><span class="p">,</span> <span class="p">),</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;publisher_access&quot;</span><span class="p">,</span> <span class="s2">&quot;Publisher Access&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;admin_access&quot;</span><span class="p">,</span> <span class="s2">&quot;Admin Access&quot;</span><span class="p">),</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">AbstractGeneralInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">created_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(class)s</span><span class="s1">_created_by&#39;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">modified_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">modified_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(class)s</span><span class="s1">_modified_by&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="n">owned_by</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(class)s</span><span class="s1">_owned_by&#39;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">published_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>


<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">AbstractGeneralInfo</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">AbstractGeneralInfo</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">()</span>
</pre></div>
<p>All this can be found on the accompanying project <a class="reference external" href="https://github.com/spapas/cbv-tutorial">https://github.com/spapas/cbv-tutorial</a> on the djangocbv app (visit <a class="reference external" href="http://127.0.0.1:8001/djangocbv/">http://127.0.0.1:8001/djangocbv/</a>).</p>
<div class="section" id="do-something-when-a-valid-form-is-submitted">
<h3>Do something when a valid form is&nbsp;submitted</h3>
<p>When a form is submitted and the form is valid
the <tt class="docutils literal">form_valid</tt> method of <tt class="docutils literal">ModelForMixin</tt> (and <tt class="docutils literal">FormMixin</tt>) will be called. This method
can be overridden to do various things before (or after) the form is saved. For example,
you may want have a field whose value is calculated from other fields in the form or you want to
create an extra object. Let&#8217;s see a generic example of overriding a <tt class="docutils literal">CreateView</tt> or <tt class="docutils literal">UpdateView</tt> with&nbsp;comments:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="p">):</span>
    <span class="c1"># let&#39;s calculate a field value</span>
    <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">calculated_field</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;data2&#39;</span><span class="p">]</span>

    <span class="c1"># save the form by calling super().form_valid(); keep the return value - it is the value of get_success_url</span>
    <span class="n">redirect_to</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>

    <span class="c1"># For Create or UpdateView, the just-saved object will be assigned to self.object</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Created an object with id {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1"># return the redirect</span>
    <span class="k">return</span> <span class="n">redirect_to</span>
</pre></div>
<p>This is rather complex so I&#8217;ll also explain it: The form_valid gets the actual form which, since is validated
has a <tt class="docutils literal">cleaned_data</tt> dictionary of values. This form also has an <tt class="docutils literal">instance</tt> attribute which is the object
that this form is bound to - notice that a normal <tt class="docutils literal">Form</tt> won&#8217;t have an instance only a <tt class="docutils literal">ModelForm</tt>.
This can be used to modify the instance of this form as needed - before saving it. When you want to actually save
the instance you call <tt class="docutils literal"><span class="pre">super().form_valid()</span></tt> passing it the modified form (and instance). This method does
three&nbsp;things</p>
<ul class="simple">
<li>It saves the instance to the&nbsp;database</li>
<li>It assigns the saved object to the <tt class="docutils literal">object</tt> instance attribute (so you can refer to it by <tt class="docutils literal">self.instance</tt>)</li>
<li>It uses <tt class="docutils literal">get_redirect_url</tt> to retrieve the location where you should redirect after the form is&nbsp;submitted</li>
</ul>
<p>Thus in this example we save <tt class="docutils literal">redirect_to</tt> to return it also from our method also and then can use <tt class="docutils literal">self.object.id</tt>
to log the id of the current&nbsp;object.</p>
<p>On a more specific example, notice the <tt class="docutils literal">Article</tt> and <tt class="docutils literal">Document</tt> models which both inherit (abstract)
from <tt class="docutils literal">AbstractGeneralInfo</tt> have a <tt class="docutils literal">created_by</tt> and
a <tt class="docutils literal">modified_by</tt> field. These fields have to be filled automatically from the current logged in user. Now, there are various
options to do that but what I vote for is using an <tt class="docutils literal">AuditableMixin</tt> as I have already described in <a class="reference external" href="https://spapas.github.io/2015/01/21/django-model-auditing/#adding-simple-auditing-functionality-ourselves">my Django model auditing article</a>.</p>
<p>To replicate the functionality we&#8217;ll create an <tt class="docutils literal">AuditableMixin</tt> like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AuditableMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">created_by</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">created_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">modified_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
<p>This mixin can be used by both the create and update view of both <tt class="docutils literal">Article</tt> and <tt class="docutils literal">Document</tt>. So all four of these
classes will share the same functionality. Notice that the <tt class="docutils literal">form_valid</tt> method is overridden - the <tt class="docutils literal">created_by</tt>
of the form&#8217;s instance (which is the object that was edited, remember how <tt class="docutils literal">ModelFormMixin</tt> works) will by set
to the current user if it is null (so it will be only set once) while the <tt class="docutils literal">modified_by</tt> will be set always to the
current user. Finally we call <tt class="docutils literal"><span class="pre">super().form_valid</span></tt> and return its response so
that the form will be actually saved and the redirect will go to the proper success url. To use it for example for the
<tt class="docutils literal">Article</tt>, <tt class="docutils literal">CreateView</tt> should be defined like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticleCreateView</span><span class="p">(</span><span class="n">AuditableMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
</pre></div>
</div>
<div class="section" id="change-the-queryset-of-the-cbv">
<h3>Change the queryset of the <span class="caps">CBV</span></h3>
<p>All CBVs that inherit from <tt class="docutils literal">SingleObjectMixin</tt> or <tt class="docutils literal">MultipleObjectMixin</tt> (<tt class="docutils literal">ListView</tt>, <tt class="docutils literal">DetailView</tt>, <tt class="docutils literal">UpdateView</tt> and <tt class="docutils literal">DeleteView</tt>)
have a <tt class="docutils literal">model</tt> and a <tt class="docutils literal">queryset</tt> property that can be used (either one or the other) to define the queryset that will be used for
querying the database for that CBVs results. This queryset can be further dynamically refined by overriding the <tt class="docutils literal">get_queryset()</tt> method.
What I usually do is that I define the <tt class="docutils literal">model</tt> attribute and then override <tt class="docutils literal">get_querset</tt> in order to dynamically modify the&nbsp;queryset.</p>
<p>For example, let&#8217;s say that I wanted to add a count of articles and documents per each category. Here&#8217;s how the <tt class="docutils literal">CategoryListView</tt> could be&nbsp;done:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ExportCsvMixin</span><span class="p">,</span> <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;categories&#39;</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">article_cnt</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">),</span> <span class="n">document_cnt</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">))</span>
</pre></div>
<p>Notice that I also use some more mixins for this <tt class="docutils literal">ListView</tt> (they&#8217;ll be explained later). The <tt class="docutils literal">get_queryset</tt> adds
the annotation to the <tt class="docutils literal">super()</tt> queryset (which will be <tt class="docutils literal">Category.objects.all()</tt>). One final comment is that instead
of this, I could have more or less the same functionality by implementing <tt class="docutils literal">CategoryListView</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ExportCsvMixin</span><span class="p">,</span> <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;categories&#39;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">article_cnt</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">),</span> <span class="n">document_cnt</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">))</span>
</pre></div>
<p>This has the same functionality (return all categories with the number of articles and documents for each one) and
saves some typing from overriding the <tt class="docutils literal">get_queryset</tt>  method. However as I said most of the time I use the model
attribute and override the <tt class="docutils literal">get_queryset</tt> method because it seems more explicit and descriptive to me and most of
the time I&#8217;ll need to add some more filtering (based on the current user, based on some query parameter etc) that
can only be implemented on the <tt class="docutils literal">get_queryset</tt>.</p>
</div>
<div class="section" id="allow-each-user-to-list-view-edit-delete-only-his-own-items">
<h3>Allow each user to list/view/edit/delete only his own&nbsp;items</h3>
<p>Continuing from the previous example of modifying the queryset, let&#8217;s suppose that we want to allow each
user to be able to list the items (articles and
documents) he has created and view/edit/delete them. We also want to allow admins and publishers to view/edit&nbsp;everything.</p>
<p>Since the <tt class="docutils literal">Article</tt> and <tt class="docutils literal">Document</tt> models both have an <tt class="docutils literal">owned_by</tt> element we can use use this to filter
the results returned by <tt class="docutils literal">get_queryset()</tt>. For example, here&#8217;s a mixin that checks if the current user is
admin or publisher. If he is a publisher then he will just return the <tt class="docutils literal">super()</tt> queryset. If however he is a simple
user it will return only the results that are owned by him with <tt class="docutils literal">qs.filter(owned_by=self.request.user)</tt>.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LimitAccessMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;djangocbv.admin_access&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;djangocbv.publisher_access&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">qs</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">owned_by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
<p>Another similar mixin that is used is the <tt class="docutils literal">HideRemovedMixin</tt> that, for simple users, excludes from the queryset the objects that
are&nbsp;removed:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HideRemovedMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;djangocbv.admin_access&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;djangocbv.publisher_access&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">qs</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;REMOVED&#39;</span><span class="p">)</span>
</pre></div>
<p>One thing that needs a little discussion is that for both of these mixins I am using <tt class="docutils literal">get_queryset</tt> to implement access control to
allow using the same mixin for views that inherit from both <tt class="docutils literal">SingleObjectMixin</tt> and <tt class="docutils literal">MultipleObjectMixin</tt> (since the <tt class="docutils literal">get_queryset</tt> is
used in both of them). This
means that when a user tries to access an object that has not access to he&#8217;ll get a nice 404&nbsp;error.</p>
<p>Beyond this, instead of filtering the queryset,
for views inheriting from <tt class="docutils literal">SingleObjectMixin</tt> (i.e <tt class="docutils literal">DetailView</tt>, <tt class="docutils literal">UpdateView</tt> and <tt class="docutils literal">DeleteView</tt>)
we could have overridden the <tt class="docutils literal">get_object</tt> method to raise an access denied exception. Here&#8217;s how <tt class="docutils literal">get_object</tt> could be
overridden to raise a 403 Forbidden status when a user tries to access an object that does not belong to&nbsp;him:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">PermissionDenied</span>

<span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">owned_by</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PermissionDenied</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>
</div>
<div class="section" id="configure-the-form-s-initial-values-from-get-parameters">
<h3>Configure the form&#8217;s initial values from <span class="caps">GET</span>&nbsp;parameters</h3>
<p>Sometimes we want to have a <tt class="docutils literal">CreateView</tt> with some fields already filled. I usually
implement this by passing the proper parameters to the <span class="caps">URL</span> (i.e by calling it as /create_view?category_id=2)
and then using the following mixin to override the <tt class="docutils literal">FormMixin</tt> <tt class="docutils literal">get_initial</tt> method in order to
return the form&#8217;s initial data from&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SetInitialMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,):</span>
    <span class="k">def</span> <span class="nf">get_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">initial</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SetInitialMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_initial</span><span class="p">()</span>
        <span class="n">initial</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">initial</span>
</pre></div>
<p>So if the /article_create url can be used to initialte the <tt class="docutils literal">CreateView</tt> for the article,
using <tt class="docutils literal"><span class="pre">/article_create?category_id=3</span></tt> will show the CreateView with the Category with id=3
pre-selected in the category&nbsp;field!</p>
</div>
<div class="section" id="pass-extra-kwargs-to-the-formview-form">
<h3>Pass extra kwargs to the FormView&nbsp;form</h3>
<p>This is a very common requirement. The form may need to be modified by an external condition,
for example the current user or something that can be calculated from the view. Here&#8217;s a
sample mixin that passes the current request (which also includes the user) to the&nbsp;form:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RequestArgMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">RequestArgMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">kwargs</span>
</pre></div>
<p>Please notice that the form has to properly handle the extra kwarg in its constructor,
before calling the super&#8217;s constructor. For
example, here&#8217;s how a form that can accept the request could be&nbsp;implemented:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RequestForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p>We use <tt class="docutils literal">pop</tt> to remove the request from the received <tt class="docutils literal">kwargs</tt> and only then we call the
parent&nbsp;constructor.</p>
</div>
<div class="section" id="add-values-to-the-context">
<h3>Add values to the&nbsp;context</h3>
<p>To add values to the context of a <span class="caps">CBV</span> we override the <tt class="docutils literal">get_context_data()</tt> method. Here&#8217;s
a mixin that adds a list of categories to all CBVs using&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoriesContextMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
<p>Notice that the mixin calls super to get the context data of its ancestors and appends to it. This
mean that if we also had a mixin that f.e added the current logged in user to the context (this isn&#8217;t really
needed since there&#8217;s a context processor for this but anyway) then when a <span class="caps">CBV</span> inherited from both of
them then the data of both of them would be added to the&nbsp;context.</p>
<p>As a general comment there are three other methods the same functionality could be&nbsp;achieved:</p>
<ul class="simple">
<li>Just override the <tt class="docutils literal">get_context_data</tt> of the <span class="caps">CBV</span> you want to add extra data to its&nbsp;context</li>
<li>Add a template tag that will bring the needed data to the&nbsp;template</li>
<li>Use a context processor to bring the data to all&nbsp;templates</li>
</ul>
<p>As can be understood, each of the above methods has certain advantages and disadvantages. For
example, if the extra data will query the database then the context processor method will add
one extra query for all page loads (even if the data is not needed). On the other hand,
the template tag will query the database only on specific views but it makes debugging and
reasoning about your template more difficult since if you have a lot of template tags you&#8217;ll have
various context variables appearing from thing&nbsp;air!</p>
<p>One final comment is that overriding the <tt class="docutils literal">get_context_data</tt> method will probably be the most
common thing you&#8217;re going to do when using CBVs (you&#8217;ll definitely need to add things to the context)
so try to remember the following 3 needed&nbsp;lines:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># ... here we add stuff to the ctx</span>
    <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
</div>
<div class="section" id="add-a-simple-filter-to-a-listview">
<h3>Add a simple filter to a&nbsp;ListView</h3>
<p>For filtering I recommend using the excellent <a class="reference external" href="https://github.com/carltongibson/django-filter">django-filter</a> package as I&#8217;ve already
presented in <a class="reference external" href="https://spapas.github.io/2017/10/11/essential-django-packages/">my essential Django package list</a>. Here&#8217;s how a mixin can be created that
adds a filter to the&nbsp;context:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AddFilterMixin</span><span class="p">:</span>
    <span class="n">filter_class</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_class</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Please define filter_class when using AddFilterMixin&quot;</span><span class="p">)</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">())</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_object_name</span><span class="p">:</span>
            <span class="n">ctx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context_object_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">qs</span>
        <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
<p>Notice that the <tt class="docutils literal">get_context_data</tt> checks to see if the <tt class="docutils literal">filter_class</tt> attribute has been
defined (if not it will raise a useful explanation). It will then instantiate the filter class
passing it the <tt class="docutils literal">self.request.<span class="caps">GET</span></tt> and the current queryset (<tt class="docutils literal">self.get_queryset()</tt>) - so for
example any extra filtering you are doing to the queryset (for example only show content owned by the
current user) will be also used. Finally, pass the filter to the context and assign the
contect_object_name to the filtered&nbsp;queryset.</p>
<p>Here&#8217;s for example how this mixin is used for <tt class="docutils literal">ArticleListView</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticleListView</span><span class="p">(</span><span class="n">AddFilterMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;articles&#39;</span>
    <span class="n">filter_class</span> <span class="o">=</span> <span class="n">ArticleFilter</span>
</pre></div>
<p>And then just add the following to the <tt class="docutils literal">article_list.html</tt> template:</p>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="nb">filter</span><span class="o">.</span><span class="n">form</span> <span class="p">}}</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;Filter&#39;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">article</span> <span class="ow">in</span> <span class="n">articles</span> <span class="o">%</span><span class="p">}</span>
    <span class="n">Display</span> <span class="n">article</span> <span class="n">info</span> <span class="o">-</span> <span class="n">only</span> <span class="n">filtered</span> <span class="n">articles</span> <span class="n">will</span> <span class="n">be</span> <span class="n">here</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<div class="section" id="support-for-success-messages">
<h3>Support for success&nbsp;messages</h3>
<p>Django has a very useful <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/contrib/messages/">messages framework</a> which can be used to add flash messages
to a view. A flash message is a message that persists in the sesion until it is viewed
by the user. So, for example when a user edits an object and saves it, he&#8217;ll be redirected
to the success page - if you have configured a flash message to inform the user that the
save was ok then he&#8217;ll see this message once and then if he reloads the page it will
be&nbsp;removed.</p>
<p>Here&#8217;s a mixin that can be used to support flash messages using Django&#8217;s message&nbsp;framework:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuccessMessageMixin</span><span class="p">:</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_success_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_message</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_success_message</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
<p>This mixin overrides the <tt class="docutils literal">form_valid</tt> and adds the message using <tt class="docutils literal">get_success_message</tt> - this
can be overriden if you want to have a dynamic message or just set the <tt class="docutils literal">success_message</tt> attribute
for a static message, for example something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SuccesMessageArticleCreateView</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Object was created!&#39;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
</pre></div>
<p>I&#8217;d like to once again point out here that since the <tt class="docutils literal"><span class="pre">super().form_valid(form)</span></tt> method is properly used
then if a <span class="caps">CBV</span> uses multiple mixins that override form_valid (for example if your <span class="caps">CBV</span> overrides both
<tt class="docutils literal">SuccessMessageMixin</tt> and <tt class="docutils literal">AuditableMixin</tt> then the form_valid of <em>both</em> will be called so you&#8217;ll
get both the created_by/modified_by values set to the current user and the success&nbsp;message!</p>
<p>Notice that Django actually provides an implementation of <a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/contrib/messages/#adding-messages-in-class-based-views">a message mixin</a> which can be used instead
of the proposed implementation here (I didn&#8217;t know it until recently that&#8217;s why I am using this to some
projects and I also present it&nbsp;here).</p>
</div>
<div class="section" id="implement-a-quick-moderation">
<h3>Implement a quick&nbsp;moderation</h3>
<p>It is easy to implement some moderation to our model publishing. For example, let&#8217;s suppose that we only
allow publishers to publish a model. Here&#8217;s how it can be&nbsp;done:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;REMOVED&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;djangocbv.publisher_access&#39;</span><span class="p">):</span>
            <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;PUBLISHED&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;DRAFT&#39;</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
<p>So, first of all we make sure that the object is not <tt class="docutils literal"><span class="caps">REMOVED</span></tt> (if it is
remove it we don&#8217;t do anything else). Next we check if the current user has
<tt class="docutils literal">publisher_access</tt> if yes we change the object&#8217;s status to <tt class="docutils literal"><span class="caps">PUBLISHED</span></tt> - on any
other case we change its status to <tt class="docutils literal"><span class="caps">DRAFT</span></tt>. Notice that this means that whenever a
publisher saves the object it will be published and whenever a non-publisher saves it
it will be made a draft. We then call our ancestor&#8217;s <tt class="docutils literal">form_valid</tt> to save the object
and return to success&nbsp;url.</p>
<p>I&#8217;d like to repeat here that this mixin, since it calls super, can work concurrently
with any other mixins that override <tt class="docutils literal">form_valid</tt> (and also call their super method
of course), for example it can be used together with the audit (auto-fill created_by
and moderated_by) and the success mixin we defined&nbsp;previously!</p>
</div>
<div class="section" id="allow-access-to-a-view-if-a-user-has-one-out-of-a-group-of-permissions">
<h3>Allow access to a view if a user has one out of a group of&nbsp;permissions</h3>
<p>For this we&#8217;ll need to use the authentication mixins functionality. We could implement
this by overriding <tt class="docutils literal">PermissionRequiredMixin</tt> or by overriding <tt class="docutils literal">UserPassesTestMixin</tt>.</p>
<p>Using <tt class="docutils literal">PermissionRequiredMixin</tt> is not very easy because the way it works
it will allow access if the user has <em>all</em> permissions from the group (not only one as is the requirement).
Of course you could override its <tt class="docutils literal">has_permission</tt> method to change the way it checks if
the user has the permissions (i.e make sure it has one permission instead of&nbsp;all):</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AnyPermissionRequiredMixin</span><span class="p">(</span><span class="n">PermissionRequiredMixin</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permission_required</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">)</span>
</pre></div>
<p>Also we could implement our mixin using <tt class="docutils literal">UserPassesTestMixin</tt> as its&nbsp;base:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AnyPermissionRequiredAlternativeMixin</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">):</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">permissions</span><span class="p">)</span>
</pre></div>
<p>The functionality is very simple: If the user has one of the list of the configured permissions then the test will pass (so he&#8217;ll have access to the view).
If instead the user has none of the permissions then he won&#8217;t be able to access the&nbsp;view.</p>
<p>Notice that for the above implementations we inherited from <tt class="docutils literal">PermissionRequiredMixin</tt> or <tt class="docutils literal">UserPassesTextMixin</tt> to keep their functionality - if we had inherited
these mixins from object then we&#8217;d need to inherit our CBVs from both <tt class="docutils literal">AnyPermissionRequiredMixin</tt> and <tt class="docutils literal">PermissionRequiredMixin</tt> or
<tt class="docutils literal">AnyPermissionRequiredAlternativeMixin</tt> and <tt class="docutils literal">UserPassesTestMixin</tt> (with the correct <span class="caps">MRO</span> order of&nbsp;course).</p>
<p>Now, the whole permission cheking functionality can be even more <span class="caps">DRY</span>. Let&#8217;s suppose that we know that there are a couple of views which should only
be visible to users having either the <tt class="docutils literal">app.admin</tt> or <tt class="docutils literal">app.curator</tt> permission. Instead of inheriting all these views from <tt class="docutils literal">AnyPermissionRequiredMixin</tt>
and configuring the permissions list to each one, the <span class="caps">DRY</span> way to implement this is to add yet another mixin from which the CBVs will actually&nbsp;inhert:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdminOrPublisherPermissionRequiredMixin</span><span class="p">(</span><span class="n">AnyPermissionRequiredMixin</span><span class="p">):</span>
    <span class="n">permissions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;djangocbv.admin_access&#39;</span><span class="p">,</span> <span class="s1">&#39;djangocbv.publisher_access&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="disable-a-view-based-on-some-condition">
<h3>Disable a view based on some&nbsp;condition</h3>
<p>There are times you want to disable a view based on an arbitrary condition - for example example make the view
disabled before a specific date. Here&#8217;s a simple mixin that overrides <tt class="docutils literal">dispatch</tt> to do&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DisabledDateMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">the_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">the_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PermissionDenied</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p>You can even disable a view completely  in case you want to keep it in your urls.py using this&nbsp;mixin:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DisabledDateMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PermissionDenied</span>
</pre></div>
</div>
<div class="section" id="output-non-html-views">
<h3>Output non-html&nbsp;views</h3>
<p>I&#8217;ve written a whole article about this, please take a look at my <a class="reference external" href="https://spapas.github.io/2014/09/15/django-non-html-responses/">Django non-<span class="caps">HTML</span> responses</a>&nbsp;article.</p>
<p>Also, notice that is very easy to create a mixin that will output a view to <span class="caps">PDF</span> - I have already written
an <a class="reference external" href="https://spapas.github.io/2015/11/27/pdf-in-django/#using-a-cbv">essential guide for outputting PDFs in Django</a> so I am just going to refer you to this article for
(much more)&nbsp;information!</p>
<p>Finally, let&#8217;s take a look at a generic Mixin that you can use to add <span class="caps">CSV</span> exporting capabilities to a
<tt class="docutils literal">ListView</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExportCsvMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csv&#39;</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;text/csv&#39;</span><span class="p">)</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&quot;export.csv&quot;&#39;</span>

            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;object_list&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># Write headers</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">response</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">)</span>
</pre></div>
<p>As you can see this mixin overrides the <tt class="docutils literal">render_to_response</tt> method. It will check if there&#8217;s a
<tt class="docutils literal">csv</tt> key to the <tt class="docutils literal"><span class="caps">GET</span></tt> queryset dictionary, thus the url must be called with <tt class="docutils literal"><span class="pre">?csv=true</span></tt> or something similar. You
can just add this link to your&nbsp;template:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;button&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;?csv=true&#39;</span><span class="p">&gt;</span>Export csv<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
<p>So if the view needs to be exported to <span class="caps">CSV</span>, it will create a new <tt class="docutils literal">HttpResponse</tt> object with the correct content type.
The next line will add a header that (<tt class="docutils literal"><span class="pre">Content-Disposition</span></tt>) will mark the response as an attachment and give it a default file name.
We then crate a new <tt class="docutils literal">csv.writer</tt> passing the just-created response as the place to write the csv. The <tt class="docutils literal">for</tt> loop that follows
enumerates the <tt class="docutils literal">object_list</tt> value of the context (remember that this is added by the <tt class="docutils literal">MultipleObjectMixin</tt> and contains the
result of the <tt class="docutils literal">ListView</tt>). It will then use the object&#8217;s <tt class="docutils literal">__dict__</tt> attribute to write the headers (for the first time) and then
write the values of all&nbsp;objects.</p>
<p>As another simple example, let&#8217;s create a quick <span class="caps">JSON</span> output mixin for our&nbsp;DetailViews:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">JsonDetailMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)))</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">render_to_response</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">)</span>
</pre></div>
<p>If you add this to a view inheriting from <tt class="docutils literal">DetailView</tt> and pass it the <tt class="docutils literal"><span class="pre">?json=true</span></tt> query parameter
you&#8217;ll get a <span class="caps">JSON</span>&nbsp;response!</p>
</div>
<div class="section" id="use-one-templateview-for-multiple-html-templates">
<h3>Use one TemplateView for multiple html&nbsp;templates</h3>
<p>Using a <tt class="docutils literal">TemplateView</tt> you could display an html template without much problem just by
settings the <tt class="docutils literal">template</tt> attribute of your class. What if you wanted to have a single
<tt class="docutils literal">TemplateView</tt> that would display many templates based on the query path? Simple, just
override <tt class="docutils literal">get_template_names</tt> to return a different template based on the path. For example,
using this&nbsp;view:</p>
<div class="highlight"><pre><span></span>class DynamicTemplateView(TemplateView):
    def get_template_names(self):
        what = self.kwargs[&#39;what&#39;]
        return &#39;{0}.html&#39;.format(what)
</pre></div>
<p>You can render any template you have depending on the value of the <tt class="docutils literal">what</tt> kwarg. To allow
only specific template names you can either add a check to the above implementation (i.e that
what is <tt class="docutils literal">help</tt> or <tt class="docutils literal">about</tt>) or you may do it to the urls.py if you use a regular expression. Thus,
to only allow <tt class="docutils literal">help.html</tt> and <tt class="docutils literal">about.html</tt> to be rendered with this method add it to your urls like&nbsp;this:</p>
<div class="highlight"><pre><span></span>re_path(r&#39;^show/(?P<span class="p">&lt;</span><span class="nt">what</span><span class="p">&gt;</span>help|about)/&#39;, views.DynamicTemplateView.as_view(), name=&#39;template-show&#39;),
</pre></div>
<p>Finally, to use it to render the <tt class="docutils literal">help.html</tt> you&#8217;ll just call it like &lt;a href=&#8217;{% url &#8220;template-show&#8221; &#8220;help&#8221;&nbsp;%}&#8217;&gt;Help&lt;/a&gt;</p>
<p>Notice that of course instead of creating the <tt class="docutils literal">DynamicTemplateView</tt> you could just dump these html files in your
static folder and return them using the static files functionality. However the extra thing that the <tt class="docutils literal">DynamicTemplateView</tt>
brings to you is that this is a full Django template thus you can use template tags, filters, your context variables, inherit
from your site-base and even override <tt class="docutils literal">get_context_data</tt> to add extra info to the template! All this is not possible with
static&nbsp;files!</p>
</div>
<div class="section" id="implement-a-partial-ajax-view">
<h3>Implement a partial Ajax&nbsp;view</h3>
<p>Overriding <tt class="docutils literal">get_template_names</tt> can also be used to create a <span class="caps">DRY</span> Ajax view
of your data! For example, let&#8217;s say that you have a <tt class="docutils literal">DetailView</tt> for one of your models that
has overriden the <tt class="docutils literal">get_template_names</tt> like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_template_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ajax_partial&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;core/partial/data_ajax.html&#39;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()</span>
</pre></div>
<p>and you have also defined a normal template for classic request response viewing and an ajax template
that contains only the specific data for this instances (i.e it does not containg html body, headers, footers etc,
only a &lt;div&gt; with the instance&#8217;s data). Notice I&#8217;m using either the <tt class="docutils literal">is_ajax</tt> method or I directly passed <span class="caps">GET</span>
value (<tt class="docutils literal">ajax_partial</tt>) - this is needed because sometimes <tt class="docutils literal">is_ajax</tt> is not working as expected (depending on
how you&#8217;re going to do the request), also this way you can easily test the partial ajax view through your browser
by passing it <tt class="docutils literal"><span class="pre">?ajax_partia=true</span></tt>.</p>
<p>Using this technique you can create an Ajax view of your data just by requesting the DetailView through an
Ajax call and dumping the response you get to a modal dialog (for example)  - no need for fancy <span class="caps">REST</span> APIs. Also as
a bonus, the classic DetailView will work normally, so you can have the Ajax view to give a summary of the instance&#8217;s
data (i.e have a subset of the info on the Ajax template) and the normal view to display&nbsp;everything.</p>
</div>
<div class="section" id="add-a-dynamic-filter-and-or-table-to-the-context">
<h3>Add a dynamic filter and/or table to the&nbsp;context</h3>
<p>If you have a lot of similar models you can add a mixin that dynamically creates tables and a filters
for these models  - take a look at my <a class="reference external" href="https://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/">dynamic tables and filters for similar models</a>&nbsp;article!</p>
</div>
<div class="section" id="configure-forms-for-your-views">
<h3>Configure forms for your&nbsp;views</h3>
<p>As I&#8217;ve already explained if you are using a <tt class="docutils literal">FormView</tt> you&#8217;ll need to set a <tt class="docutils literal">form_class</tt> for
your view (needed by <tt class="docutils literal">FormMixin</tt>) while, for an Update or <tt class="docutils literal">CreateView</tt> which use the <tt class="docutils literal">ModelFormMixin</tt>
you can either set the <tt class="docutils literal"><span class="pre">form-class</span></tt> or directly configure the instance&#8217;s fields that will be displayed
to the form using the <tt class="docutils literal">fields</tt> attribute.</p>
<p>For example, let&#8217;s say that you have a rather generic <tt class="docutils literal">FormView</tt> that will display a different form
depending on the user permissions. Here&#8217;s how you could do this to return a <tt class="docutils literal">SuperForm</tt> if the
current user is a superuser and a <tt class="docutils literal">SimpleForm</tt> in other&nbsp;cases:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_form_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SuperForm</span>
    <span class="k">return</span> <span class="n">SimpleForm</span>
</pre></div>
</div>
<div class="section" id="display-a-different-form-for-create-and-update">
<h3>Display a different form for Create and&nbsp;Update</h3>
<p>There are various ways you can do this (for example you can just declare a different <tt class="docutils literal">form_class</tt> for your
<tt class="docutils literal">Create</tt> and <tt class="docutils literal">UpdateView</tt>) but I think that the most <span class="caps">DRY</span> one, especially if the create and update form are
similar is to pass an <tt class="docutils literal">is_create</tt> argument to the form which it will then be used to properly configure the&nbsp;form.</p>
<p>Thus, on your <tt class="docutils literal">CreateView</tt> you&#8217;ll add this <tt class="docutils literal">get_form_kwargs</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyCreateView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;is_create&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">kwargs</span>
</pre></div>
<p>while on your <tt class="docutils literal">UpdateView</tt> you&#8217;ll add&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MyUpdateView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">()</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;is_create&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">kwargs</span>
</pre></div>
<p>Please notice that the form has to properly handle the extra kwarg in its constructor as I&#8217;ve already explained&nbsp;previously.</p>
</div>
<div class="section" id="only-allow-specific-http-methods-for-a-view">
<h3>Only allow specific <span class="caps">HTTP</span> methods for a&nbsp;view</h3>
<p>Let&#8217;s say that you want to create an <tt class="docutils literal">UnpublishView</tt> i.e a view that will change the status of your content
to <tt class="docutils literal"><span class="caps">DRAFT</span></tt>. Since this view will change your model instance it must be called through <tt class="docutils literal"><span class="caps">POST</span></tt>, however
you may not want to display an individual form for this view, just a button that when called will display
a client-side (Javascript) prompt and if the user clicks it it will immediately do a <tt class="docutils literal"><span class="caps">POST</span></tt> request
by submitting the form. The best way to create this is to just implement an <tt class="docutils literal">UpdateView</tt> for your model
and change its form valid to change the status to <tt class="docutils literal"><span class="caps">DRAFT</span></tt>, something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;DRAFT&#39;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
</pre></div>
<p>Beyond this, you&#8217;ll need to add a <tt class="docutils literal">fields = []</tt> attribute to your <tt class="docutils literal">UpdateView</tt> to denote that you won&#8217;t
need to update any fields from the model (since you&#8217;ll update the status directly) and finally, to only allow
this view to be called through an http <tt class="docutils literal"><span class="caps">POST</span></tt> method add the following&nbsp;attribute:</p>
<div class="highlight"><pre><span></span><span class="n">http_method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">,]</span>
</pre></div>
</div>
<div class="section" id="create-an-umbrella-view-for-multiple-models">
<h3>Create an umbrella View for multiple&nbsp;models</h3>
<p>Let&#8217;s say that you have a couple of models (called <tt class="docutils literal">Type1</tt> and <tt class="docutils literal">Type2</tt> that are more or less the same and
you want to quickly create a <tt class="docutils literal">ListView</tt> for both of them but you&#8217;d like to create just one <tt class="docutils literal">ListView</tt> and
separate them by their url. Here&#8217;s how it could be&nbsp;done:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UmbrellaListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;umbrella_list.html&#39;</span>

    <span class="k">def</span> <span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;kind&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;type1&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Type1</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;type2&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Type2</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">UmbrellaListView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p>Notice that for this to work properly you must setup your urls like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^list/(?P&lt;kind&gt;type1|type2)/$&#39;</span><span class="p">,</span> <span class="n">UmbrellaListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span> <span class="p">)</span> <span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;umbrella_list&#39;</span> <span class="p">),</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="a-heavy-cbv-user-project">
<h2>A heavy <span class="caps">CBV</span> user&nbsp;project</h2>
<p>In this small chapter I&#8217;d like to present a bunch of mixins and views that I&#8217;ve defined to the
accompanying project (<a class="reference external" href="https://github.com/spapas/cbv-tutorial">https://github.com/spapas/cbv-tutorial</a>).</p>
<p>Let&#8217;s start with the mixins (I won&#8217;t show the mixins I&#8217;ve already talked about in the previous&nbsp;chapter):</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SetOwnerIfNeeded</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">owned_by_id</span><span class="p">:</span>
            <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">owned_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ChangeStatusMixin</span><span class="p">:</span>
    <span class="n">new_status</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_status</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Please define new_status when using ChangeStatusMixin&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">new_status</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ContentCreateMixin</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span>
                        <span class="n">AuditableMixin</span><span class="p">,</span>
                        <span class="n">SetOwnerIfNeeded</span><span class="p">,</span>
                        <span class="n">RequestArgMixin</span><span class="p">,</span>
                        <span class="n">SetInitialMixin</span><span class="p">,</span>
                        <span class="n">ModerationMixin</span><span class="p">,</span>
                        <span class="n">LoginRequiredMixin</span><span class="p">):</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Object successfully created!&#39;</span>


<span class="k">class</span> <span class="nc">ContentUpdateMixin</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span>
                        <span class="n">AuditableMixin</span><span class="p">,</span>
                        <span class="n">SetOwnerIfNeeded</span><span class="p">,</span>
                        <span class="n">RequestArgMixin</span><span class="p">,</span>
                        <span class="n">SetInitialMixin</span><span class="p">,</span>
                        <span class="n">ModerationMixin</span><span class="p">,</span>
                        <span class="n">LimitAccessMixin</span><span class="p">,</span>
                        <span class="n">LoginRequiredMixin</span><span class="p">):</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Object successfully updated!&#39;</span>


<span class="k">class</span> <span class="nc">ContentListMixin</span><span class="p">(</span><span class="n">ExportCsvMixin</span><span class="p">,</span> <span class="n">AddFilterMixin</span><span class="p">,</span> <span class="n">HideRemovedMixin</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ContentRemoveMixin</span><span class="p">(</span><span class="n">SuccessMessageMixin</span>
                         <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span>
                         <span class="n">AuditableMixin</span><span class="p">,</span>
                         <span class="n">HideRemovedMixin</span><span class="p">,</span>
                         <span class="n">ChangeStatusMixin</span><span class="p">,):</span>
    <span class="n">http_method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">,]</span>
    <span class="n">new_status</span> <span class="o">=</span> <span class="s1">&#39;REMOVED&#39;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Object successfully removed!&#39;</span>


<span class="k">class</span> <span class="nc">ContentUnpublishMixin</span><span class="p">(</span><span class="n">SuccessMessageMixin</span>
                            <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span>
                            <span class="n">AuditableMixin</span><span class="p">,</span>
                            <span class="n">UnpublishSuccessMessageMixin</span><span class="p">,</span>
                            <span class="n">ChangeStatusMixin</span><span class="p">,):</span>
    <span class="n">http_method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">,]</span>
    <span class="n">new_status</span> <span class="o">=</span> <span class="s1">&#39;DRAFT&#39;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Object successfully unpublished!&#39;</span>
</pre></div>
<p>The <tt class="docutils literal">SetOwnerIfNeeded</tt> and  <tt class="docutils literal">ChangeStatusMixin</tt> are simple mixins that override <tt class="docutils literal">form_valid</tt> to
introduce some functionality before saving the&nbsp;object).</p>
<p>The mixins that follow are used to group functionality of
other mixins together and will be inherited by the views. Thus, <tt class="docutils literal">ContentCreateMixin</tt> has the mixin functionality needed to create something (for example
an <tt class="docutils literal">Article</tt> or a <tt class="docutils literal">Document</tt>) i.e show a success message, add auditing information, set the object&#8217;s owner,
pass the request to the form, set the form&#8217;s initial values, do some moderation and only allow logged in users. On
a similar fashion, the <tt class="docutils literal">ContentUpdateMixin</tt> collects the functionality needed to update something and is similar to
<tt class="docutils literal">ContentCreateMixin</tt> (with the difference that it also as the <tt class="docutils literal">LimitAccessMixin</tt> to only allow simple users to
edit their own content). The <tt class="docutils literal">ContentListMixin</tt> adds functionality for export to <span class="caps">CSV</span>, simple filter and hiding removed&nbsp;things.</p>
<p>Finally, the <tt class="docutils literal">ContentRemoveMixin</tt> and <tt class="docutils literal">ContentUnpublishMixin</tt> are used to implement Views for removing and unpublishing
an object. Both of them inherit from <tt class="docutils literal">ChangeStatusMixin</tt> - one setting
the <tt class="docutils literal">new_status</tt> to <tt class="docutils literal"><span class="caps">REMOVED</span></tt> the other to <tt class="docutils literal"><span class="caps">DRAFT</span></tt>.</p>
<p>Notice that they share much functionality so I could
remove both <tt class="docutils literal">ContentRemoveMixin</tt> and <tt class="docutils literal">ContentUnpublishMixin</tt> and add a single <tt class="docutils literal">ContentChangeStatusMixin</tt> like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContentChangeStatusMixin</span><span class="p">(</span><span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span>
                            <span class="n">AuditableMixin</span><span class="p">,</span>
                            <span class="n">UnpublishSuccessMessageMixin</span><span class="p">,</span>
                            <span class="n">ChangeStatusMixin</span><span class="p">,):</span>
    <span class="n">http_method_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">,]</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
<p>Thus the <tt class="docutils literal">new_status</tt> attribute wouldn&#8217;t be there so the views inheriting from this <tt class="docutils literal">ContentChangeStatusMixin</tt>
(i.e <tt class="docutils literal">*RemoveView</tt> and <tt class="docutils literal">*UnpublishView</tt>) would need to define the <tt class="docutils literal">new_status</tt> field themselves.
This is definitely valid (and more <span class="caps">DRY</span>) but less explicit than the way I&#8217;ve implemented this - i.e you may
wanted to not allow publishers to remove objects, only admins (so you could implement that differently in the <tt class="docutils literal">get_queryset</tt>
or <tt class="docutils literal">dispatch</tt> method of <tt class="docutils literal">ContentRemoveMixin</tt> and <tt class="docutils literal">ContentUpdateMixin</tt>) this is easier if you have both the
<tt class="docutils literal">ContentRemoveMixin</tt> and <tt class="docutils literal">ContentUnpublishMixin</tt>.</p>
<p>Now let&#8217;s take a look at the&nbsp;views:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CategoryListView</span><span class="p">(</span><span class="n">ExportCsvMixin</span><span class="p">,</span> <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;categories&#39;</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qs</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">article_cnt</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;article&#39;</span><span class="p">),</span> <span class="n">document_cnt</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;document&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">CategoryCreateView</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Category created!&#39;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;category-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CategoryUpdateView</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span> <span class="n">AdminOrPublisherPermissionRequiredMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Category updated!&#39;</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;category-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CategoryDetailView</span><span class="p">(</span><span class="n">CategoriesContextMixin</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;category&#39;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;article_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;document_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ctx</span>


<span class="k">class</span> <span class="nc">ArticleListView</span><span class="p">(</span><span class="n">ContentListMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;articles&#39;</span>
    <span class="n">filter_class</span> <span class="o">=</span> <span class="n">ArticleFilter</span>


<span class="k">class</span> <span class="nc">ArticleCreateView</span><span class="p">(</span><span class="n">ContentCreateMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">ArticleForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;article-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ArticleUpdateView</span><span class="p">(</span><span class="n">ContentUpdateMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">ArticleForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;article-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ArticleDetailView</span><span class="p">(</span><span class="n">HideRemovedMixin</span><span class="p">,</span> <span class="n">JsonDetailMixin</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;article&#39;</span>

    <span class="k">def</span> <span class="nf">get_template_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">is_ajax</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;partial&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;djangocbv/_article_content_partial.html&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ArticleRemoveView</span><span class="p">(</span><span class="n">ContentRemoveMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;article-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ArticleUnpublishView</span><span class="p">(</span><span class="n">ContentUnpublishMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;article-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DocumentListView</span><span class="p">(</span><span class="n">ContentListMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;documents&#39;</span>
    <span class="n">filter_class</span> <span class="o">=</span> <span class="n">DocumentFilter</span>


<span class="k">class</span> <span class="nc">DocumentCreateView</span><span class="p">(</span><span class="n">ContentCreateMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">DocumentForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;document-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DocumentUpdateView</span><span class="p">(</span><span class="n">ContentUpdateMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">DocumentForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;document-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DocumentDetailView</span><span class="p">(</span><span class="n">HideRemovedMixin</span><span class="p">,</span> <span class="n">JsonDetailMixin</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;document&#39;</span>


<span class="k">class</span> <span class="nc">DocumentRemoveView</span><span class="p">(</span><span class="n">ContentRemoveMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;document-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DocumentUnpublishView</span><span class="p">(</span><span class="n">ContentUnpublishMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;document-list&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DynamicTemplateView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_template_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">what</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;what&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;{0}.html&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
</pre></div>
<p>As you will see there&nbsp;are</p>
<ul class="simple">
<li>4 views related to categories (Create, Detail, Update and&nbsp;List)</li>
<li>6 views related to articles (Create, Detail, Update, List, Unpublish and Remove)&nbsp;and</li>
<li>another 6 views related to documents (same as&nbsp;articles).</li>
</ul>
<p>The views for <tt class="docutils literal">Article</tt> and <tt class="docutils literal">Document</tt> are more or less the same: They inherit
from the corresponding mixin we defined previously (<tt class="docutils literal">CreateContentMixin</tt>, <tt class="docutils literal">UpdateContentMixin</tt> etc) add a
redirect to their corresponding list view (I am using <tt class="docutils literal">redirect_lazy</tt> there because <tt class="docutils literal">redirect</tt> wouldn&#8217;t work
because it will lead to a cyclic dependency between urls and views) and define their corresponding form and model.
For the the DetailViews I don&#8217;t use a group mixin like the others but I just add the <tt class="docutils literal">HideRemovedMixin</tt> and
<tt class="docutils literal">JsonDetailMixin</tt> directly to their ancestor list. This is to make clear that the group mixins (<tt class="docutils literal">ContentCreateMixin</tt> etc)
are optional and I could for example define <tt class="docutils literal">ArticleCreateView</tt> like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticleCreateView</span><span class="p">(</span><span class="n">SuccessMessageMixin</span><span class="p">,</span>
                    <span class="n">AuditableMixin</span><span class="p">,</span>
                    <span class="n">SetOwnerIfNeeded</span><span class="p">,</span>
                    <span class="n">RequestArgMixin</span><span class="p">,</span>
                    <span class="n">SetInitialMixin</span><span class="p">,</span>
                    <span class="n">ModerationMixin</span><span class="p">,</span>
                    <span class="n">LoginRequiredMixin</span><span class="p">,</span>
                    <span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">ArticleForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;article-list&#39;</span><span class="p">)</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s1">&#39;Object successfully created!&#39;</span>
</pre></div>
<p>What&#8217;s the advantage of using the  <tt class="docutils literal">ContentCreateMixin</tt>  then? Well since the same mixins are used from <tt class="docutils literal">DocumentCreateView</tt>
I won&#8217;t need to re-define this list there. Also if for example I want to allow users that have a specific permission to create
articles and document I will remove the <tt class="docutils literal">LoginRequireMixin</tt> and add the <tt class="docutils literal">AllowCreateContentMixin</tt> only to the <tt class="docutils literal">ContentCreateMixin</tt>
and not to both <tt class="docutils literal">ArticleCreateView</tt> and <tt class="docutils literal">DocumentCreateView</tt> (and I won&#8217;t be in danger of forgetting to change it somewhere).
Of course all this depends on your requirements and how <span class="caps">DRY</span> you need to&nbsp;be.</p>
<p>The category related views are simpler and override their mixins directly. Finally there&#8217;s a <tt class="docutils literal">DynamicTemplateView</tt> to
display templates based on their filename as discussed&nbsp;previously.</p>
<p>Before continuing, please try to understand how much more <span class="caps">DRY</span> this project is when compared to using a traditional
functional one (or if not using mixins). For example, there&#8217;s a <tt class="docutils literal">RequestArgMixin</tt> that is used by all views that create/update content. If <span class="caps">INHERITANCE</span>
didn&#8217;t use that mixin I&#8217;d need to re-define the same functionality (pass the current request to the form&#8217;s constructor) to
4 views (Article/Document Create/Update). Or for the <tt class="docutils literal">AuditableMixin</tt> I&#8217;d need to remember to upgrade the created/modified by
to 8 views (Article/Document&nbsp;Create/Update/Unpublish/Remove)!</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>The previous discussion should convince you how much more <span class="caps">DRY</span> your views will be when using CBVs and how
much quicker will be to create your views. Also, if
you followed closely the first and second chapters you should be able to understand everything that is
needed for CBVs and be able to properly understand which method or attribute you need to override to
implement some specific functionality. Finally, the list of examples in the third chapter should help
you get started in all your <span class="caps">CBV</span> needs - if you have some specific question about CBVs or you&#8217;d like
another use case added to the list feel free to ask and I&#8217;ll try to add&nbsp;it!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2018/03/06/easy-youtube-mp3-downloading/">Easy downloading youtube videos and mp3s using youtube-dl and python</a>
      </h1>
    <p class="meta">
<time datetime="2018-03-06T12:20:00+02:00" pubdate>Τρι 06 Μάρτιος 2018</time>    </p>
</header>

<div class="entry-content"><p>In this article I am going to present you with an easy (and advertisement/malware free) way to download
videos from youtube, converting them to mp3 if needed. Also, I will give some more useful hints, for
example how to download multiple mp3s using a script, how to break a long mp3 to same-length parts
so you could quickly skip tracks when you play it in your stereo&nbsp;etc.</p>
<p>I am going to give specific instructions for Windows users - however everything I&#8217;ll propose should also be applicable
to <span class="caps">OSX</span> or Linux users with minor&nbsp;modifications.</p>
<p>The tools we are going to use&nbsp;are:</p>
<ul class="simple">
<li><a class="reference external" href="https://rg3.github.io/youtube-dl/">youtube-dl</a> which is a python library for downloading videos from youtube (and some other&nbsp;sites)</li>
<li><a class="reference external" href="https://www.ffmpeg.org">ffmpeg</a> which is a passepartout video/audio editing&nbsp;library</li>
</ul>
<div class="section" id="installation">
<h2>Installation</h2>
<p>To install youtube-dl I recommend installing it in your global python (2 or 3) package list using pip. Please read my
<a class="reference external" href="https://spapas.github.io/2017/12/20/python-2-3-windows/">previous</a>&nbsp;article</p>
<p>to see how you should install and use Python 2 or 3
on Windows. Following the instructions from there, you can do the following to install youtube-dl in your global
Python 3&nbsp;packages:</p>
<pre class="code literal-block">
py -3 -m pip install youtube-dl
</pre>
<p>To run youtube-dl you&#8217;ll write something like <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span> youtube_dl url_or_video_id</tt> (notice the underscore instead of dash since
dashes are not supported in module names in python). For example try something like this <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span> youtube_dl YgtL4S7Hrwo</tt> and you&#8217;ll
be rewarded with the 2016 Pycon talk from Guido van Rossum! If you find this a little too much too type don&#8217;t be afraid, I will give
some hints later about how to improve&nbsp;this.</p>
<p>To upgrade your youtube-dl installation you should do something like&nbsp;this:</p>
<pre class="code literal-block">
py -3 -m pip install -U youtube-dl
</pre>
<p>Notice that you must frequently upgrade your youtube-dl installation because sometimes youtube changes the requirements
for viewing / downloading videos and your old version will not work. So if for some reason something is not correct when
you use youtube-dl always try updating&nbsp;first.</p>
<p>If you wanted you could also create a virtual environment (see instructions on previously mentioned article) and install youtube-dl locally there using <tt class="docutils literal">pip install <span class="pre">youtube-dl</span></tt>
however I prefer to install it on the global packages to be really easy for me to call it from a command prompt I open. Notice
that if you install youtube-dl in a virtualenv, after you activate that virtualenv you&#8217;ll be able to run it just by typing <tt class="docutils literal"><span class="pre">youtube-dl</span></tt>.</p>
<p>Finally, If for some reason you don&#8217;t want want to mess with python and all this (or it just seems greek to you) then you
may go on and directly download a <a class="reference external" href="https://yt-dl.org/latest/youtube-dl.exe">youtube-dl windows executable</a>. Just put it in your path and you should be good to&nbsp;go.</p>
<p>To install ffmpeg, I recommend <a class="reference external" href="https://ffmpeg.zeranoe.com/builds/">downloading the Windows build from here</a> (select the correct Windows architecture of your system and
always static linking - the version doesn&#8217;t matter). This will get you a zip - we are mainly interested to the three files under the
<tt class="docutils literal">bin</tt> folder of that zip which should be copied to a directory under your&nbsp;path:</p>
<ul class="simple">
<li>ffmpeg is the passepartout video converting toot that we are going to&nbsp;use</li>
<li>ffprobe will print some information about a file (about its container and video/audio&nbsp;streams)</li>
<li>ffplay will play the file &#8212; not really recommended there are better tools but it is invaluable
for testing; if it can be played be ffplay then ffmpeg will be able to properly read your&nbsp;file</li>
</ul>
<p>Notice I recommend copying things to a directory in your path. This is recommended and will save you from repeatedly typing the same things
over and over. Also, later I will propose a bunch of <span class="caps">DOS</span> batch (.bat) files that can also be copied to that directory and help you even
more in you youtube video downloading. To add a directory to the <span class="caps">PATH</span>, just press Windows+Pause Break, Advanced System Settings, Advanced,
Environment Variables, edit the &#8220;Path&#8221; User variable (for your user) and append the directory&nbsp;there.</p>
</div>
<div class="section" id="using-youtube-dl">
<h2>Using&nbsp;youtube-dl</h2>
<p>As I&#8217;ve already explained before, to run youtube-dl you&#8217;ll either write something like <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span> youtube_dl</tt> (if you&#8217;ve installed it
to your global python packages) or run youtube-dl if you&#8217;ve downloaded the pre-built exe or have installed it in a virtualenv. To save
you from some keystrokes, you can create a batch file that will run and pass any more parameters to it, something like&nbsp;this:</p>
<pre class="code literal-block">
py -3 -m youtube_dl %*
</pre>
<p>(the %* will capture the remaining command line) so to get the previous video just run <tt class="docutils literal">getvideo YgtL4S7Hrwo</tt>
(or getvideo <a class="reference external" href="https://www.youtube.com/watch?v=YgtL4S7Hrwo">https://www.youtube.com/watch?v=YgtL4S7Hrwo</a> - works the same with the video id or the complete&nbsp;url).</p>
<p>One thing I&#8217;d like to mention here is that youtube-dl works fine with playlists and even channels. For example,
to download all videos from PyCon 2017 just do&nbsp;this:</p>
<p><tt class="docutils literal">getvideo <span class="pre">https://www.youtube.com/channel/UCrJhliKNQ8g0qoE_zvL8eVg/feed</span></tt> and you should see something&nbsp;like:</p>
<pre class="code literal-block">
E:\&gt;py -3 -m youtube_dl https://www.youtube.com/channel/UCrJhliKNQ8g0qoE_zvL8eVg/feed
[youtube:channel] UCrJhliKNQ8g0qoE_zvL8eVg: Downloading channel page
[youtube:playlist] UUrJhliKNQ8g0qoE_zvL8eVg: Downloading webpage
[download] Downloading playlist: Uploads from PyCon 2017
[youtube:playlist] UUrJhliKNQ8g0qoE_zvL8eVg: Downloading page #1
[youtube:playlist] playlist Uploads from PyCon 2017: Downloading 143 videos
[download] Downloading video 1 of 143
[youtube] AjFfsOA7AQI: Downloading webpage
[youtube] AjFfsOA7AQI: Downloading video info webpage
[youtube] AjFfsOA7AQI: Extracting video information
WARNING: Requested formats are incompatible for merge and will be merged into mkv.
[download] Destination: Final remarks and conference close  - Pycon 2017-AjFfsOA7AQI.f137.mp4
[download]   2.9% of 34.49MiB at 940.52KiB/s ETA 00:36
</pre>
<p>This is gonna take some time&nbsp;&#8230;</p>
<p>Now, youtube-dl has <a class="reference external" href="https://github.com/rg3/youtube-dl/blob/master/README.md#options">many options</a> and can be configured with <a class="reference external" href="https://github.com/rg3/youtube-dl/blob/master/README.md#configuration">default values</a> depending on your
requirements. I won&#8217;t go into detail about these except on some things I usually use, if you
need some help feel free to ask&nbsp;me.</p>
<p>When you download a video, youtube-dl will try to download the best quality possible for that video,
however a video may have various different formats that can be queries by passing the option <tt class="docutils literal"><span class="pre">--list-formats</span></tt>
to ffmpeg, for example here&#8217;s the output from the previously mentioned&nbsp;video:</p>
<pre class="code literal-block">
E:\&gt;getvideo YgtL4S7Hrwo --list-formats
[youtube] YgtL4S7Hrwo: Downloading webpage
[youtube] YgtL4S7Hrwo: Downloading video info webpage
[youtube] YgtL4S7Hrwo: Extracting video information
[info] Available formats for YgtL4S7Hrwo:
format code  extension  resolution note
249          webm       audio only DASH audio   53k , opus &#64; 50k, 15.14MiB
250          webm       audio only DASH audio   72k , opus &#64; 70k, 20.29MiB
171          webm       audio only DASH audio  111k , vorbis&#64;128k, 29.42MiB
140          m4a        audio only DASH audio  130k , m4a_dash container, mp4a.40.2&#64;128k, 38.38MiB
251          webm       audio only DASH audio  130k , opus &#64;160k, 36.94MiB
278          webm       256x144    144p   58k , webm container, vp9, 30fps, video only, 11.01MiB
242          webm       426x240    240p   88k , vp9, 30fps, video only, 12.40MiB
160          mp4        256x144    144p  120k , avc1.4d400c, 30fps, video only, 33.64MiB
243          webm       640x360    360p  153k , vp9, 30fps, video only, 23.48MiB
134          mp4        640x360    360p  230k , avc1.4d401e, 30fps, video only, 28.91MiB
133          mp4        426x240    240p  260k , avc1.4d4015, 30fps, video only, 74.75MiB
244          webm       854x480    480p  289k , vp9, 30fps, video only, 39.31MiB
135          mp4        854x480    480p  488k , avc1.4d401f, 30fps, video only, 56.43MiB
247          webm       1280x720   720p  945k , vp9, 30fps, video only, 102.45MiB
136          mp4        1280x720   720p 1074k , avc1.4d401f, 30fps, video only, 116.72MiB
17           3gp        176x144    small , mp4v.20.3, mp4a.40.2&#64; 24k
36           3gp        320x180    small , mp4v.20.3, mp4a.40.2
43           webm       640x360    medium , vp8.0, vorbis&#64;128k
18           mp4        640x360    medium , avc1.42001E, mp4a.40.2&#64; 96k
22           mp4        1280x720   hd720 , avc1.64001F, mp4a.40.2&#64;192k (best)
</pre>
<p>As you can see, each has an id and defines an extension (container)  and info about its video and audio stream.
You can download a <em>specific</em> format by using the -f command line otpion. For example , to download the audio-only
format with the worst audio quality use <tt class="docutils literal"><span class="pre">C:\Users\serafeim&gt;getvideo</span> YgtL4S7Hrwo <span class="pre">-f</span> 249</tt>. Notice that there are
formats with audio ony and other formats with vide only. To download the worst format possible (resulting in the
smallest file size of course ) you can pass the <tt class="docutils literal"><span class="pre">-f</span> worst</tt> command line (there&#8217;s also a <tt class="docutils literal"><span class="pre">-f</span> best</tt> command line
which is used by&nbsp;default).</p>
<p>Another thing I&#8217;d like to point out here is that you can define an <a class="reference external" href="https://github.com/rg3/youtube-dl/blob/master/README.md#output-template">output template</a> using the <tt class="docutils literal"><span class="pre">-o</span></tt> option that
will format the name of the output file of your video using the provided options. There are  <a class="reference external" href="https://github.com/rg3/youtube-dl/blob/master/README.md#output-template-examples">many examples in the docs</a>
so I won&#8217;t go into any more details&nbsp;here.</p>
<p>Another cool option is the -a that will help you download all videos from a file. For example, if you have a file
named <tt class="docutils literal">videos.txt</tt> with the following&nbsp;contsnts:</p>
<pre class="code literal-block">
AjFfsOA7AQI
3dDtACSYVx0
G17E4Muylis
</pre>
<p>running <tt class="docutils literal">getvideo <span class="pre">-a</span> videos.txt <span class="pre">-f</span> worst</tt></p>
<p>will get you all three videos in their worst quality. If you don&#8217;t want to create files then you can use something
like&nbsp;this:</p>
<pre class="code literal-block">
for %i in (AjFfsOA7AQI 3dDtACSYVx0 G17E4Muylis) do getvideo %i -f worst
</pre>
<p>and it will run  getvideo for all three&nbsp;files.</p>
<p>Some more options I&#8217;d like to recommend using&nbsp;are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">--restrict-filenames</span></tt> to avoid strange&nbsp;filenames</li>
<li><tt class="docutils literal"><span class="pre">--ignore-errors</span></tt> to ignore errors when download multiple files (from a playlist or a channel) - this is really
useful because if you have a play with missing items youtube-dl will stop downloading the remaining files when it
encounters the missing&nbsp;one</li>
</ul>
<p>If you want to always use these options you may add them to your configuration file (<tt class="docutils literal"><span class="pre">C:\Users\&lt;user</span> <span class="pre">name&gt;\youtube-dl.conf</span></tt>)
or to the getvideo.bat defined above i.e getvideo.bat will&nbsp;be:</p>
<pre class="code literal-block">
py -3 -m youtube_dl --restrict-filenames --ignore-errors %*
</pre>
</div>
<div class="section" id="extracting-mp3s">
<h2>Extracting&nbsp;mp3s</h2>
<p>The next step in this trip is to understand how to extract mp3s from videos that are downloaded from youtube. If you&#8217;ve
payed attention you&#8217;d know that by now you can download audio-only formats from youtube - however they are in a format
called <a class="reference external" href="https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP"><span class="caps">DASH</span></a> which most probably is <em>not</em> playable by your car stereo (<span class="caps">DASH</span> is specialized for streaming audio through <span class="caps">HTTP</span>).</p>
<p>Thus, the proper way to get mp3s is to post-process
the downloaded file using ffmpeg to convert it to mp3. This could be done manually (by doing something
<tt class="docutils literal">ffmpeg <span class="pre">-i</span> input out.mp3</tt> &#8212; ffmpeg is smart enough to know how to convert per extension)
but thankfully youtube-dl offers the <tt class="docutils literal"><span class="pre">-x</span></tt> (and friend) parameters to make this automatic. Using <tt class="docutils literal"><span class="pre">-x</span></tt> tells
youtube-dl to extract the audio from the video (notice that youtube-dl is smart enough to download one of the audio-only
formats so you don&#8217;t have ). Using -x alone may result in a different audio format (for example .ogg) so to force conversion to mp3
you should also add the  <tt class="docutils literal"><span class="pre">--audio-format</span> mp3</tt> parameter. Thus, to download an mp3 you can use the following command
line (continuing from the previous&nbsp;examples):</p>
<pre class="code literal-block">
py -3 -m youtube_dl --restrict-filenames --ignore-errors -x --audio-format mp3  AjFfsOA7AQI
</pre>
<p>or even better, create a <tt class="docutils literal">getmp3.bat</tt> batch file that will be used to retrieve an&nbsp;mp3:</p>
<pre class="code literal-block">
py -3 -m youtube_dl --restrict-filenames --ignore-errors -x --audio-format mp3 %1
</pre>
<p>Please notice that also in this case youtube-dl is smart enough to download an audio-only format thus
you won&#8217;t need to select it by hand using <tt class="docutils literal"><span class="pre">-f</span></tt> to save&nbsp;bandwith.</p>
</div>
<div class="section" id="splitting-the-mp3-file-to-parts">
<h2>Splitting the mp3 file to&nbsp;parts</h2>
<p>Some people would like to split their large mp3 files to same-length segments. Of course it would be better
for the file to be split by silence to individual songs (if the file contains songs) but these methods usually
don&#8217;t work that good so I prefer the same length segments. To do that using ffmpeg you just need to add the
following&nbsp;parameters:</p>
<pre class="code literal-block">
ffmpeg -i input.mp3 -segment_time 180 -f segment out.%03d.mp3&quot;
</pre>
<p>The segment time is in seconds (so each segment will be 3 minutes) while the output files will have a name like
<tt class="docutils literal">out.001.mp3, out.002.mp3</tt> etc.</p>
<p>What if you&#8217;d like to make the segmentation automatic? For this, I recommend writing a batch file with two
commands - one to download the mp3 and a second one to call ffmpeg to segment the file. Notice that you
could use the <tt class="docutils literal"><span class="pre">--postprocessor-args</span> <span class="caps">ARGS</span></tt> command line parameter to pass the required arguments to youtube-dl
so it will be done in one command however I&#8217;d like to have a little more control thus I prefer two commands (if
you decide to use <tt class="docutils literal"><span class="pre">--postprocessor-args</span> <span class="caps">ARGS</span></tt> keep in mind that args must be inside double quotes&nbsp;&#8220;&#8221;).</p>
<p>Since we are going to use two commands, we need to feed the output file of youtube-dl to ffmpeg and specify a
name for the ffmpeg output file-segments. The easiest way to do that is to just pass two parameters to the batch
file - one for the video to download and one for its name. Copy the following to a file named <tt class="docutils literal">getmp3seg.bat</tt>:</p>
<pre class="code literal-block">
py -3 -m youtube_dl %1 -x --audio-format mp3 --audio-quality 128k -o %2.%%(ext)s&quot;
ffmpeg -i %2.mp3 -segment_time 180 -f segment %2.%%03d.mp3
del %2.mp3
</pre>
<p>You can then call it like this: <tt class="docutils literal">getmp3seg AjFfsOA7AQI test</tt>. The first line will download and covert
the video to mp3 and put it in a file named <tt class="docutils literal">test.mp3</tt> (the %2 is the test, the %% is used to
escape the % and the %(ext)s is the extensions - this is needed if you use something like -o %2.mp3
youtube-dl will be confused when trying to convert the file to mp3 and will not work). The 2nd line
will segment the file to 180 second seconds (notice that here also we need to escape %) and the third
line will delete the original mp3. This leaves us with the following 4 files (the video was around 10 minutes): <tt class="docutils literal">test.000.mp3,
test.001.mp3, test.002.mp3, test.003.mp3</tt>.</p>
<p>One final thing I&#8217;d like to present here is a (more complex) script that you can use to download a video
and segmentize it only if it is more than 360 seconds. For this, we will also use the <a class="reference external" href="http://ibiblio.org/mp3info/">mp3info</a> util which can
be downloaded directly from the homepage and copied to the path. So copy the following to a script named <tt class="docutils literal">getmp3seg2.bat</tt>:</p>
<pre class="code literal-block">
&#64;echo off

IF &quot;%2&quot;==&quot;&quot; GOTO HAVE_1

py -3 -m youtube_dl %1 -x --audio-format mp3 -o %2.%%(ext)s&quot;

FOR /f %%i IN ('mp3info -p &quot;%%S&quot; %2.mp3') DO SET koko=%%i

IF %koko%  GTR 360 (
        ECHO greater than or equal to 360
        ffmpeg -i %2.mp3 -segment_time 180 -f segment %2.%%03d.mp3
        del %2.mp3
)  else (
   ECHO less than 360
)

GOTO :eof

:HAVE_1
ECHO Please call this file with video id and title
</pre>
<p>This is a little more complex - I&#8217;ll explain it quickly: <tt class="docutils literal">&#64;echo off</tt> is used to suppress non needed output.
The <tt class="docutils literal"><span class="caps">IF</span></tt> following makes sure that you have two parameters. The next line downloads the file and converts it to mp3. The <tt class="docutils literal"><span class="caps">FOR</span></tt>
loop is a little strange but it&#8217;s result will be to retrieve the output of <tt class="docutils literal">mp3info <span class="pre">-o</span> &quot;%S&quot; title.mp3</tt> (which is the
duration in seconds of that mp3) and assign it to the <tt class="docutils literal">koko</tt> variable. The next <tt class="docutils literal"><span class="caps">IF</span></tt> checks if <tt class="docutils literal">koko</tt> is greater than (<tt class="docutils literal"><span class="caps">GTR</span></tt>)
360 seconds and if yes will run the conversion code we discussed before - else it will just output that it is less than 360&nbsp;seconds.</p>
<p>Finally, there&#8217;s a <tt class="docutils literal"><span class="caps">GOTO</span>: eof</tt> line to skip printing the error message when the batch is called with less than two&nbsp;parameters.</p>
</div>
<div class="section" id="using-youtube-dl-from-python">
<h2>Using youtube-dl from&nbsp;python</h2>
<p>Integrating with youtube-dl from python is easy. Of course, you could just go on and directly call the command line
however you can have more control. The most important class is <tt class="docutils literal">youtube_dl.YoutubeDL.YoutubeDL</tt>. You instantiate
an object of this class class passing the parameters you&#8217;d like and call its <tt class="docutils literal">download()</tt> instance method passing
a list of urls. Here&#8217;s a small script that downloads the input video&nbsp;ids:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">youtube_dl</span> <span class="kn">import</span> <span class="n">YoutubeDL</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ydl_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ydl</span> <span class="o">=</span> <span class="n">YoutubeDL</span><span class="p">(</span><span class="n">ydl_opts</span><span class="p">)</span>
        <span class="n">ydl</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Enter list of urls to download&quot;</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
<p>Save it in a file named getvideo.py and run it like <tt class="docutils literal">py <span class="pre">-3</span> getvideo.py AjFfsOA7AQI 3dDtACSYVx0 G17E4Muylis</tt> to download all three&nbsp;videos!</p>
</div>
<div class="section" id="fixing-your-unicode-names">
<h2>Fixing your unicode&nbsp;names</h2>
<p>The last thing I&#8217;d like to talk about concerns people that want to download videos with Unicode characters in their titles (for example&nbsp;Greek).</p>
<p>Let&#8217;s suppose that you want to download the file vFVNOaUPRow which is piano music from a well-know greek composer. If you get it without parameters
(for example <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span> youtube_dl <span class="pre">-x</span> <span class="pre">--audio-format</span> mp3 vFVNOaUPRow</tt>)
you&#8217;ll get the following output file: <tt class="docutils literal">Ο Μάνος Χατζιδάκις. παίζει 11 κομμάτια στο <span class="pre">πιάνο-vFVNOaUPRow.f247.mp3</span></tt> (notice the greek characters) while, if
you add the <tt class="docutils literal"><span class="pre">--restrict-filenames</span></tt> I mentioned before you&#8217;ll get <tt class="docutils literal"><span class="pre">_11-vFVNOaUPRow.f247.mp3</span></tt> (notice that the greek characters have been removed
since they are not&nbsp;safe).</p>
<p>So if you use the <tt class="docutils literal"><span class="pre">--restrict-filenames</span></tt> parameter you&#8217;ll get an output that contains <em>only</em> the video id (and any safe characters it may find) while
if you don&#8217;t use it you&#8217;ll get the normal title of the video. However, most stereos <em>do not</em> display unicode characters properly so if I get this
file to my car I&#8217;ll see garbage and I won&#8217;t be able to identify it &#8212; I will be able to listen it but not see its&nbsp;name!</p>
<p>To fix that, I propose transliterating the unicode characters using the <a class="reference external" href="https://pypi.python.org/pypi/Unidecode">unidecode</a> library. Just install it using <tt class="docutils literal">pip</tt>. Then you can the following
script to rename all mp3 files in a directory to using english characters&nbsp;only:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">unidecode</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;mp3&#39;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Renaming {0} to {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">unidecode</span><span class="o">.</span><span class="n">unidecode</span><span class="p">(</span><span class="nb">file</span><span class="p">)))</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">unidecode</span><span class="o">.</span><span class="n">unidecode</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>
</pre></div>
<p>Copy this to a file named transliterate.py and run it in a directory containing mp3 files (<tt class="docutils literal">py <span class="pre">-3</span> transliterate.py</tt>) to rename them to non-unicode&nbsp;characters.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2018/03/01/django-rest-auth/">Authentication for django-rest-framework with django-rest-auth</a>
      </h1>
    <p class="meta">
<time datetime="2018-03-01T22:40:00+02:00" pubdate>Πεμ 01 Μάρτιος 2018</time>    </p>
</header>

<div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p>Most of the times I need authentication with any <span class="caps">REST</span> APIs defined through <a class="reference external" href="http://www.django-rest-framework.org">django-rest-framework</a>
I will use  <a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/#sessionauthentication">SessionAuthentication</a> method. This method uses the session cookie (which is set through the
normal Django login and logout views)
to check out if there&#8217;s an authenticated user and get his username. This method works only in the
same session (browser window) as the one that actually did the login but this should be enough for most&nbsp;cases.</p>
<p>However, sometimes instead of using the normal Django login/logout views, you&#8217;ll want
to authentication through <span class="caps">REST</span> end-points, for example for using them with SPAs (where
you don&#8217;t want to use the traditional views for authentication but through <span class="caps">REST</span> end-points) or
because you have implemented a mobile (or desktop) application that needs to authenticate with
your&nbsp;script.</p>
<p>There are various ways this could be done but one of the simplest is using <a class="reference external" href="https://github.com/Tivix/django-rest-auth">django-rest-auth</a>.
This project adds a number of <span class="caps">REST</span> end-points to your project that can be used for user login
and registration (and even social login when combined with <a class="reference external" href="https://github.com/pennersr/django-allauth">django-allauth</a>).
In the following I am going to write a simple tutorial on how to actually use django-rest-auth to
authenticate with django-rest-framework using the provided <span class="caps">REST</span> end points and how to call a
<span class="caps">REST</span> <span class="caps">API</span> as an authenticated&nbsp;user.</p>
<p>Before continuing with the tutorial, let&#8217;s take a look at what we&#8217;ll build&nbsp;here:</p>
<img alt="Our project" src="/images/rest-auth.gif" style="width: 640px;" />
<p>This is a single html page (styled with <a class="reference external" href="https://picturepan2.github.io/spectre/">spectre.css</a>) that checks if the user is logged in
and either displays the login or logout button (using javascript). When you click the login you&#8217;ll get a modal in which you
can enter your credentials which will be submitted through <span class="caps">REST</span> to the django-rest-auth endpoint and
depending on the response will set a javascript variable (and a corresponding session/local storage key).
Then you can use the &#8220;Test auth&#8221; button that works only on authenticated users and returns their username.
Finally, notice that after you log out the &#8220;test auth&#8221; button returns a 403 access&nbsp;denied.</p>
<p>If you want to play with this project yourself, you can clone it here <a class="reference external" href="https://github.com/spapas/rest_authenticate">https://github.com/spapas/rest_authenticate</a>.
Just create a venv, install requirements, create a superuser and you should be good to&nbsp;go!</p>
</div>
<div class="section" id="some-theory">
<h2>Some&nbsp;theory</h2>
<p>After you log in with Django, your authentication information is saved to the &#8220;session&#8221;_. The session is a bucket of information
that the Django application saves about your visit &#8212; to distinguish between different visitors a cookie with a unique
value named <tt class="docutils literal">sessionid</tt> will be used. So, your web browser will send this cookie with each page request thus allowing Django
to know which bucket of information is yours (and if you&#8217;ve authenticated know who are you). This is not a Django
related concept but a general one (supported by most if not all <span class="caps">HTTP</span> frameworks) and is used to add state to an otherwise
stateless medium (<span class="caps">HTTP</span>).</p>
<p>Since the <tt class="docutils literal">sessionid</tt> cookie is sent not only with traditional but also with Ajax request it can be used to authenticate
<span class="caps">REST</span> requests after you&#8217;ve logged in. This is what is used by default in django-rest-framework and as I said in the
introduction it is a very good solution for most use cases: You login to django and you can go ahead and call the <span class="caps">REST</span>
<span class="caps">API</span> through Ajax; the <tt class="docutils literal">sessionid</tt> cookie will be sent along with the request and you&#8217;ll be&nbsp;authenticated.</p>
<p>Now, although the session authentication is nice for using in browsers, you may need to access your <span class="caps">API</span> through a desktop
or a mobile application where, setting the cookies yourself is not the optimal solution. Also, you may have an <span class="caps">SPA</span> that needs
to access an <span class="caps">API</span> in a different domain; using <a class="reference external" href="https://stackoverflow.com/questions/3342140/cross-domain-cookies">using cookies for this is not easy</a> - if possible at&nbsp;all.</p>
<p>For such cases, django-rest-framework
offers a different authentication method called <tt class="docutils literal">TokenAuthentication_</tt>. Using this method, each user of the Django application
is correlated with a random string (Token) which is passed along with the request at its header thus the Django app can authenticate
the user using this token! One thing that may seem strange is that since both the session cookie and a token are
set through <span class="caps">HTTP</span> Headers why all the fuss about tokens? Why not just use the session cookie and be done with it. Well, there are
various reasons - here&#8217;s a <cite>rather extensive article</cite> explaining some. Some of the reasons are that a token can be valid forever
while the session is something ephemeral - beyond authorization information, sessions may keep various other data for a web
application and are expired after some time to save space. Also, since tokens are used for exactly this (authentication) they
are much easier to use and reason about. Finally, as I&#8217;ve already explained, sharing cookies by multiple sites is not something
you&#8217;d like to&nbsp;do.</p>
</div>
<div class="section" id="installation-configuration">
<h2>Installation <span class="amp">&amp;</span>&nbsp;configuration</h2>
<p>To install django-rest-auth just follow <a class="reference external" href="http://django-rest-auth.readthedocs.io/en/latest/installation.html#installation">the instructions here</a> i.e just add
<tt class="docutils literal">'rest_framework', 'rest_framework.authtoken'</tt> and <tt class="docutils literal">'rest_auth'</tt> to your <cite>INSTALLED_APPS</cite> in
<tt class="docutils literal">settings.py</tt> and run&nbsp;migrate.</p>
<p>Since I won&#8217;t be adding any other apps to this project (no models are actually needed), I&#8217;ve added
two directories <tt class="docutils literal">static</tt> and <tt class="docutils literal">templates</tt> to put static files and templates there. This is configured
by adding the <tt class="docutils literal">'<span class="caps">DIRS</span>'</tt> attribte to <tt class="docutils literal"><span class="caps">TEMPLATES</span></tt>, like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="o">//</span> <span class="o">...</span>
</pre></div>
<p>and adding the <cite>STATICFILES_DIRS</cite> setting:</p>
<div class="highlight"><pre><span></span><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s2">&quot;static&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
<p>The remaining setting are the default as were created by <tt class="docutils literal"><span class="pre">django-admin</span> startproject</tt>.</p>
<p>I have included the the following urls to <tt class="docutils literal">urls.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;test_auth/&#39;</span><span class="p">,</span> <span class="n">TestAuthView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test_auth&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;rest-auth/logout/&#39;</span><span class="p">,</span> <span class="n">LogoutViewEx</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rest_logout&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;rest-auth/login/&#39;</span><span class="p">,</span> <span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rest_login&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">HomeTemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="p">),</span>
<span class="p">]</span> <span class="o">+</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span><span class="p">)</span>
</pre></div>
<p>These are: The django-admin, a test_auth view (that works only for authenticated users and returns their username),
<em>a view (LogoutViewEx) that overrides the rest-auth <span class="caps">REST</span> logout-view</em> (I&#8217;ll explain why this is needed in a minute),
the rest-auth <span class="caps">REST</span> login-view, the home template view (which is the only view implemented) and finally a mapping
of your static files to the <tt class="docutils literal">STATIC_URL</tt>.</p>
</div>
<div class="section" id="the-views">
<h2>The&nbsp;views</h2>
<p>There are three views in this application - the <tt class="docutils literal">HomeTemplateView</tt>, the <tt class="docutils literal">TestAuthView</tt>
and the <tt class="docutils literal">LogoutViewEx</tt> view that overrides the normal <tt class="docutils literal">LogoutView</tt> of <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt>.
The first one is
a simple <tt class="docutils literal">TemplateView</tt> that just
displays an html page and loads the client side code - we&#8217;ll talk about it later in the front-side&nbsp;section.</p>
<p>The <tt class="docutils literal">TestAuthView</tt> is implemented like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestAuthView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">TokenAuthentication</span><span class="p">,)</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Hello {0}!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">))</span>
</pre></div>
<p>This is very simple however I&#8217;d like to make a few comments about the above. First of all you see that
I&#8217;ve defined <tt class="docutils literal">authentication_classes</tt> and <tt class="docutils literal">permission_classes</tt>. These options&nbsp;define</p>
<ul class="simple">
<li>which method will be used for authenticating access to the <span class="caps">REST</span> view i.e finding out if the user
requesting access has logged in and if yes what&#8217;s his username (in our case the <tt class="docutils literal">TokenAuthentication</tt> will be&nbsp;used)</li>
<li>if the user is authorized (has permission) to call this <span class="caps">REST</span> view (in our case only authenticated users will be&nbsp;allowed)</li>
</ul>
<p>The authentication and permission clases can be set globally
in your <tt class="docutils literal">settings.py</tt> using <tt class="docutils literal"><span class="pre">REST_FRAMEWORK['DEFAULT_AUTHENTICATION_CLASSES']</span></tt> and
<tt class="docutils literal"><span class="pre">REST_FRAMEWORK['DEFAULT_PERMISSION_CLASSES']</span></tt>
or defined per-class like this. If I wanted to have the same authentication and permission classes defined
in my <tt class="docutils literal">settings.py</tt> so I wouldn&#8217;t need to set these options per-class I&#8217;d add the following to my <tt class="docutils literal">settings.py</tt>:</p>
<div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.TokenAuthentication&#39;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.permissions.IsAuthenticated&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
<p>Finally, keep in mind that you haven&#8217;t defined these in your views or your settings, they will have the
following <a class="reference external" href="http://www.django-rest-framework.org/api-guide/settings/#default_authentication_classes">default</a> <a class="reference external" href="http://www.django-rest-framework.org/api-guide/settings/#default_permission_classes">values</a>:</p>
<div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.authentication.SessionAuthentication&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rest_framework.authentication.BasicAuthentication&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;DEFAULT_PERMISSION_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>
        <span class="s1">&#39;rest_framework.permissions.AllowAny&#39;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></div>
<p>The above mean that if you don&#8217;t define authentication and permission classes anywhere then the <span class="caps">REST</span>
views will use either session authentication (i.e the user has logged in normally using
the Django login views as explained before) or basic authentication
(the request provides the credentials in the header using traditional <span class="caps">HTTP</span> Basic authentication)
and also that all users (logged in or not) will be allowed to call all APIs (this is
probably not something you&nbsp;want).</p>
<p>The <tt class="docutils literal">TokenAuthentication</tt> that we are using instead means that for every user there must be a valid token which will be provided
for each request he does. The tokens are normal object instances of <tt class="docutils literal">rest_framework.authtoken.models.Token</tt>
and you can take a look at them (or even add one) through the Django admin (auth token - tokens). You can also
even do whatever you normally would do to an object instance, for&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Token</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<span class="p">[(</span><span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">root</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;db4dcc1b9d00d1af74fb3cb41e1f9e673208485b&#39;</span><span class="p">)]</span>
</pre></div>
<p>To authenticate with a token (using <a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication">TokenAuthentication</a>), you must add an extra header to your request with the format
<tt class="docutils literal">Authorization: Token token</tt> for example in the previous case <tt class="docutils literal">root</tt> would add
<tt class="docutils literal">Authorization: Token db4dcc1b9d00d1af74fb3cb41e1f9e673208485b</tt>. To do this you&#8217;ll need something
client-side code which we&#8217;ll see in the next&nbsp;section.</p>
<p>To do it with <a class="reference external" href="https://curl.haxx.se">curl</a> you can just do something like&nbsp;this:</p>
<div class="highlight"><pre><span></span>curl http://127.0.0.1:8000/test_auth/ -H <span class="s2">&quot;Authorization:Token db4dcc1b9d00d1af74fb3cb41e1f9e673208485b&quot;</span>
</pre></div>
<p>Try it with a valid and invalid token and without providing a token at all and see the response each&nbsp;time.</p>
<p>So, django-rest-framework provides the model (Token) and the mechanism (add the extra Authentication header) for
authentication with Tokens. What it does not provide is a simple way to create/remove tokens for users: This
is where <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt> comes to the rescue! Its login and logout <span class="caps">REST</span> views will automatically
create (and delete) tokens for the users that are logging in. They will also authenticate the user
normally (using sessions) - this means that if a user logs in using the login <span class="caps">REST</span> endpoint he&#8217;ll then
be logged in normally to the site and be able to access non-<span class="caps">REST</span> parts of the site (for example the django-admin).
Also, if the user logs in through the django-rest-auth <span class="caps">REST</span> end point and if you have are using <tt class="docutils literal">SessionAuthentication</tt>
to one of your views then he&#8217;ll be able to authenticate to these views <em>without</em> the need to pass the token (can
you understand&nbsp;why?).</p>
<p>Finally, let&#8217;s take a look at the <tt class="docutils literal">LogoutViewEx</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LogoutViewEx</span><span class="p">(</span><span class="n">LogoutView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">TokenAuthentication</span><span class="p">,)</span>
</pre></div>
<p>This class only defines the authentication_classes attribute. Is this really needed? Well, it depends on
you project. If you take a look at the source code of <tt class="docutils literal">LogoutView</tt> (<a class="reference external" href="https://github.com/Tivix/django-rest-auth/blob/master/rest_auth/views.py#L99">https://github.com/Tivix/django-rest-auth/blob/master/rest_auth/views.py#L99</a>)
you&#8217;ll see that it does not define <tt class="docutils literal">authentication_classes</tt>. This, as we&#8217;ve already discussed, means that it will
fall-back to whatever you have defined in the settings (or the defaults of django-rest-framework). So, if you haven&#8217;t
defined anything in the settings then you&#8217;ll get the by default the
SessionAuthentication and BasicAuthentication methods (hint: <em>not</em> the <tt class="docutils literal">TokenAuthentication</tt>). This means that you won&#8217;t be able to
logout when you pass the token (but <em>will</em> be able to logout from the web-app after you login - why?). So to make everything
crystal and be able to reason better about the behavior I specifically define the <tt class="docutils literal">LogoutViewEx</tt> to use the <tt class="docutils literal">TokenAuthentication</tt> - that&#8217;s
what you&#8217;d use if you developed a mobile or desktop app&nbsp;anyway.</p>
</div>
<div class="section" id="the-client-side-scripts">
<h2>The client side&nbsp;scripts</h2>
<p>I&#8217;ve included all client-side code to a <tt class="docutils literal">home.html</tt> template that is loaded
from the <tt class="docutils literal">HomeTemplateView</tt>. The client-side code has been implemented only with jQuery because I think
this is the library that most people are familiar with - and is really easy to be understood even if you
are not familiar with it. It more or less consists of four sections in&nbsp;html:</p>
<ul class="simple">
<li>A user-is-logged-in section that displays the username and the logout&nbsp;button</li>
<li>A user-is-not-logged-in section that displays a message and the login&nbsp;button</li>
<li>A test-auth section that displays a button for calling the <tt class="docutils literal">TestAuthView</tt> defined previously and outputs its&nbsp;response</li>
<li>The login&nbsp;modal</li>
</ul>
<p>Here&#8217;s the html (using spectre.css for&nbsp;styling):</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container grid-lg&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Test<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;non-logged-in&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            You have to log-in!
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;loginButton&#39;</span><span class="p">&gt;</span>Login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;logged-in&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            Welcome <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;span-username&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>!
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;logoutButton&#39;</span><span class="p">&gt;</span>Logout<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;columns&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-3&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&#39;testAuthButton&#39;</span><span class="p">&gt;</span>Test auth<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;column col-9&#39;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;test-auth-response&#39;</span> <span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;login-modal&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-overlay close-modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-container&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-header&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-clear float-right close-modal&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Close&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-title h5&quot;</span><span class="p">&gt;</span>Please login<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-body&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
                    {% csrf_token %}
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-username&quot;</span><span class="p">&gt;</span>Username<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-username&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Name&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-label&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-password&quot;</span><span class="p">&gt;</span>Password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Password&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-group&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-checkbox&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;input-local-storage&quot;</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;input-local-storage&quot;</span> <span class="p">/&gt;</span> <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>  Use local storage (remember me)
                        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#39;label label-error mt-1 d-invisible&#39;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;modal-error&#39;</span><span class="p">&gt;</span>
                    Unable to login!
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;modal-footer&quot;</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;loginOkButton&#39;</span> <span class="p">&gt;</span>Ok<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#close&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn close-modal&quot;</span> <span class="p">&gt;</span>Close<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>The html is very simple and I don&#8217;t think I need to explain much  - notice that the <cite>#logged-in</cite> and
<cite>#non-logged-in</cite> sections are mutually exclusive (I use <tt class="docutils literal">$.show()</tt> and <tt class="docutils literal">$.hide()</tt> to show and hide them) but the <cite>#test</cite> section is always displayed
so you&#8217;ll be able to call the test <span class="caps">REST</span> <span class="caps">API</span> when you are and are not authenticated. For the modal
to be displayed you need to add an <tt class="docutils literal">active</tt> class to its <tt class="docutils literal">#modal</tt> container.</p>
<p>For the javascript, let&#8217;s take a look at some initialization&nbsp;stuff:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">g_urls</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;login&#39;</span><span class="o">:</span> <span class="s1">&#39;{% url &quot;rest_login&quot; %}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logout&#39;</span><span class="o">:</span> <span class="s1">&#39;{% url &quot;rest_logout&quot; %}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;test_auth&#39;</span><span class="o">:</span> <span class="s1">&#39;{% url &quot;test_auth&quot; %}&#39;</span><span class="p">,</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">g_auth</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">g_auth</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">g_auth</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">g_auth</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">getCookie</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cookieValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cookies</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">cookies</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="c1">// Does this cookie string begin with the name we want?</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">cookieValue</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">cookieValue</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">g_csrftoken</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="s1">&#39;csrftoken&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">initLogin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#non-logged-in&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logged-in&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#span-username&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">.</span><span class="nx">remember_me</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#non-logged-in&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logged-in&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#span-username&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
        <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
<p>First of all, I define a <tt class="docutils literal">g_urls</tt> window/global object that will keep the required <span class="caps">REST</span> <span class="caps">URLS</span> (login/logout and test auth). These
are retrieved from Django using the <tt class="docutils literal">{% url %}</tt> template tag and are not hard-coded.
After that, I check to see if the user has authenticated before. Notice that because
this is client-side code, I need to do that every time the page loads or else the <span class="caps">JS</span> won&#8217;t be initialized properly! The user login
information is stored to an object named <tt class="docutils literal">g_auth</tt> and contains two attributes: <tt class="docutils literal">username</tt>, <tt class="docutils literal">key</tt> (token) and <tt class="docutils literal">remember_me</tt>.</p>
<p>To keep the login information I use either a key named <tt class="docutils literal">auth</tt> to either the <tt class="docutils literal">localStorage</tt> or the <tt class="docutils literal">sessionStorage</tt>. The <tt class="docutils literal">sessionStorage</tt> is used to save
info for the current browser tab (<em>not</em> window) while the <tt class="docutils literal">localStorage</tt> saves info for ever (until somebody deletes it). Thus,
<tt class="docutils literal">localStorage</tt> can be used for implementing a &#8220;remember me&#8221; functionality. Notice that instead of using the session/local storage
I could instead integrate the user login information with the Django back-end. To do this I&#8217;d need to see if the current user has
a session login and if yes pass his username and token to  Javascript. These values would then be read by the login initialization
code. I&#8217;m leaving this as an exercise for attentive&nbsp;readers.</p>
<p>Getting the login information from the session probably is a better solution for web-apps however I think that using the local or session storage emulate better a more
general (and completely stateless) behaviour especially considering that the <span class="caps">API</span> may be used for mobible/desktop&nbsp;apps.</p>
<p>In any case, after you&#8217;ve initialized the <tt class="docutils literal">g_auth</tt> object you&#8217;ll need to read the <span class="caps">CSRF</span> cookie. By default Django requires
<a class="reference external" href="https://docs.djangoproject.com/en/2.0/ref/csrf/"><span class="caps">CSRF</span> protection</a> for all <tt class="docutils literal"><span class="caps">POST</span></tt> requests (we do a <span class="caps">POST</span> request for login and logout). What happens here is that for pages that may
need to do a <tt class="docutils literal"><span class="caps">POST</span></tt> request, Django will set a cookie (<span class="caps">CSRF</span> cookie) in its initial response. You&#8217;ll need to read that cookie and submit its
value along with the rest of your form fields when you do the <span class="caps">POST</span>. So the <tt class="docutils literal">getCookie</tt> function is just used to set the <tt class="docutils literal">g_csrftoken</tt> with the value
of the <span class="caps">CSRF</span>&nbsp;cookie.</p>
<p>The final function we define here (which is called a little later) checks to see if there is login information and hides/displays the correct
things in html. It will also set the local or session storage (depending on remember me&nbsp;value).</p>
<p>After that, we have some client side code that is inside the <tt class="docutils literal">$()</tt> function which will be called after the page has completely&nbsp;loaded:</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">initLogin</span><span class="p">();</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loginButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.close-modal&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#testAuthButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">g_urls</span><span class="p">.</span><span class="nx">test_auth</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Token &quot;</span> <span class="o">+</span> <span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;label label-success&#39;&gt;Ok! Response: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#test-auth-response&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;label label-error&#39;&gt;Fail! Response: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">responseText</span> <span class="o">+</span> <span class="s2">&quot; (status: &quot;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="o">+</span><span class="s2">&quot;)&lt;/span&gt;&quot;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>


    <span class="c1">// continuing below ...</span>
</pre></div>
<p>The first thing happening here is to call the <tt class="docutils literal">initLogin</tt> function to properly intiialize the page and then we add a couple of
handlers to the click buttons of the <tt class="docutils literal">#loginButton</tt> (which just displays the modal by adding the <tt class="docutils literal">active</tt> class ),
<tt class="docutils literal"><span class="pre">.close-modal</span></tt> class (there are multiple
ways to close the modal thus I use a class which just removes that <tt class="docutils literal">active</tt> class) and finally to the <tt class="docutils literal">#testAuthButton</tt>. This
button will do a <tt class="docutils literal"><span class="caps">GET</span></tt> request to the <tt class="docutils literal">g_urls.test_auth</tt> we defined before. The important thing to notice here is that we add
a <tt class="docutils literal">beforeSend</tt> attribute to the <tt class="docutils literal">$.ajax</tt> request which, if <tt class="docutils literal">g_auth</tt> is defined adds an <tt class="docutils literal">Authorization</tt> header with the token
in the form that django-rest-framework <tt class="docutils literal">TokenAuthentication</tt> expects and as we&#8217;ve already discussed&nbsp;above:</p>
<div class="highlight"><pre><span></span><span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">g_auth</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Token &quot;</span> <span class="o">+</span> <span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>If this ajax call returns ok (<tt class="docutils literal">done</tt> part) we just add the <tt class="docutils literal">Ok</tt> to a green label else if there&#8217;s an error (<tt class="docutils literal">fail</tt> part)
we add the response text and status to a red label. You can try clicking the button and you see that only if you&#8217;ve logged in
you will succeed in this&nbsp;call.</p>
<p>Let&#8217;s now take a look at the <tt class="docutils literal">#loginOkbutton</tt> click handler (inside the&nbsp;modal):</p>
<div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#loginOkButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-username&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">remember_me</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#input-local-storage&#39;</span><span class="p">).</span><span class="nx">prop</span><span class="p">(</span><span class="s1">&#39;checked&#39;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">username</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Will try to login with &quot;</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">g_urls</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span>
                <span class="nx">password</span><span class="o">:</span> <span class="nx">password</span><span class="p">,</span>
                <span class="nx">csrfmiddlewaretoken</span><span class="o">:</span> <span class="nx">g_csrftoken</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DONE: &quot;</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
            <span class="nx">g_auth</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span>
                <span class="nx">key</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
                <span class="nx">remember_me</span><span class="o">:</span> <span class="nx">remember_me</span>
            <span class="p">};</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#login-modal&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
            <span class="nx">initLogin</span><span class="p">();</span>
            <span class="c1">// CAREFUL! csrf token is rotated after login: https://docs.djangoproject.com/en/1.7/releases/1.5.2/#bugfixes</span>
            <span class="nx">g_csrftoken</span> <span class="o">=</span> <span class="nx">getCookie</span><span class="p">(</span><span class="s1">&#39;csrftoken&#39;</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FAIL&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#modal-error&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;d-invisible&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
<p>All three user inputs (<tt class="docutils literal">username, password, remember_me</tt>) are read from the form and if both username and
password have been defined an Ajax request will be done to the <tt class="docutils literal">g_urls.login</tt> url. We pass
<tt class="docutils literal">username, password</tt> <em>and</em> <tt class="docutils literal">g_csrftoken</tt> (as discussed before) as the request data. Now, if there&#8217;s an
error (<tt class="docutils literal">fail</tt>) I just display a generic message (by removing it&#8217;s <cite>d-invisible</cite> class) while, if the
request was Ok I retrieve the <tt class="docutils literal">key</tt> (token) from the response, initialize the <tt class="docutils literal">g_auth</tt> object with the
<tt class="docutils literal">username</tt>, <tt class="docutils literal">key</tt> and <tt class="docutils literal">remember_me</tt> values and call <tt class="docutils literal">initLogin</tt> to show the correct divs and save
to the session/local&nbsp;storage.</p>
<p>It is important to keep in mind that with the line <tt class="docutils literal">g_csrftoken = <span class="pre">getCookie('csrftoken')</span></tt>
we re-read the <span class="caps">CSRF</span> cookie. This is needed because, as you can see in the mentioned link in the comment,
after Django logs in, the csrf cookie value is rotated for security reasons so it must be re-read here (or else
the <tt class="docutils literal">logout</tt> that is also a <span class="caps">POST</span> request will not&nbsp;work).</p>
<p>Finally, here&#8217;s the code for logout (still inside the <tt class="docutils literal">$(function () {</tt>):</p>
<div class="highlight"><pre><span></span>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#logoutButton&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Trying to logout&quot;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">g_urls</span><span class="p">.</span><span class="nx">logout</span><span class="p">,</span>
            <span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">beforeSend</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">request</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span> <span class="s2">&quot;Token &quot;</span> <span class="o">+</span> <span class="nx">g_auth</span><span class="p">.</span><span class="nx">key</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">csrfmiddlewaretoken</span><span class="o">:</span> <span class="nx">g_csrftoken</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;DONE: &quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
            <span class="nx">g_auth</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">initLogin</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;FAIL: &quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>

<span class="p">});</span> <span class="c1">// End of $(function () {</span>
</pre></div>
<p>The code here is very simple - just do a <tt class="docutils literal"><span class="caps">POST</span></tt> to the <tt class="docutils literal">g_urls.logout</tt>  and if everything is ok delete the <tt class="docutils literal">g_auth</tt> values
and call <tt class="docutils literal">initLogin()</tt> to show the correct divs and remove the <tt class="docutils literal">auth</tt> key from local/session storage. Notice that when
you <tt class="docutils literal"><span class="caps">POST</span></tt> to the <tt class="docutils literal">logout</tt> <span class="caps">REST</span> end-point, you need to also add the <tt class="docutils literal">Authorization</tt> header with the token or else
(since we&#8217;ve defined only <tt class="docutils literal">TokenAuthentication</tt> for the <tt class="docutils literal">authentication_classes</tt> for the <tt class="docutils literal">LogoutViewEx</tt> class)
there won&#8217;t be any way to correlate the request with the user and log him&nbsp;out!</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Using the info presented on this article you should be able to properly login and logout to Django using <span class="caps">REST</span> and
also call <span class="caps">REST</span> end-points as an authenticated used. I recommend using the <tt class="docutils literal">curl</tt> utility to try to call the rest
end point with various parameters to see the response. Also, you change the <tt class="docutils literal">LogoutViewEx</tt> with the
default django-rest-auth <tt class="docutils literal">LogoutView</tt> and then try logging out through the web-app <em>and</em> through curl and see
what happens when you try to access the test-auth&nbsp;end-point.</p>
<p>Finally, the above project can be easily modified to use
<tt class="docutils literal">SessionAuthentication</tt> instead of <tt class="docutils literal">TokenAuthentication</tt> (so you won&#8217;t need <tt class="docutils literal"><span class="pre">django-rest-auth</span></tt> at all) - I&#8217;m
leaving it as an exercise to the&nbsp;reader.</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2017/12/20/python-2-3-windows/">Using both Python 2 and 3 in Windows</a>
      </h1>
    <p class="meta">
<time datetime="2017-12-20T11:20:00+02:00" pubdate>Τετ 20 Δεκέμβριος 2017</time>    </p>
</header>

<div class="entry-content"><p>The release of Django 2.0 was a milestone in the history of Python since it
completely dropped support for Python 2.x. I am a long time user of Django
and, loyal to the philosophy of &#8220;if it is working don&#8217;t change&#8221; I was always
using Python&nbsp;2.x.</p>
<p>Of course right now this needs to change since new applications will need to
be developed to the latest version of Django (and Python). I am using
Windows for development (almost exclusively) and what I wanted was to
be able to create and use virtual environments for both my old projects
(using Python 2) and new projects (using Python&nbsp;3).</p>
<p>The above requirement is not as straight-forward as I&#8217;d like - actually it is
if you know what you need to do and which tools you must use. That&#8217;s why I
decided to write a quick step by step tutorial on how to use both versions
of Python in your Windows environment. Notice that I am using Windows 10,
Python 2.7.14 an Python&nbsp;3.6.4.</p>
<p>First of all, let&#8217;s download both versions of Python
from the <a class="reference external" href="https://www.python.org/downloads/">Python download page</a>. I downloaded the files
python-2.7.14.msi and python-3.6.4.exe (not sure why the one is .msi and the other
is .exe it doesn&#8217;t matter&nbsp;anyway).</p>
<p>Firstly I am installing Python 2.7.14 and&nbsp;selecting:</p>
<ul class="simple">
<li>Install for all&nbsp;users</li>
<li>Install to default&nbsp;folder</li>
<li>Press next to following screen (install default&nbsp;customizations)</li>
<li>This won&#8217;t add the python.exe of Python 2.7 to&nbsp;path</li>
</ul>
<p>Next I am install Python&nbsp;3.6.4:</p>
<ul class="simple">
<li>Make sure to click &#8220;Install launcher for all users&nbsp;(recommended)&#8221;</li>
<li>I also check &#8220;Add Python 3.6to <span class="caps">PATH</span>&#8221; (to add the Python 3.6 executable to&nbsp;path)</li>
<li>I then just click &#8220;Install Now&#8221; (this will put Python 3.6 to&nbsp;c:)</li>
</ul>
<p>Right now if you open a terminal window (Windows+r, cmd.exe) and run Python you will
initiate the Python 3.6 interpreter. This is useful for just dropping in a Python&nbsp;interpreter.</p>
<p>Remember the &#8220;Install launcher for all users (recommended)&#8221; we clicked before? This installs
the python launcher which is used to select between Python versions.
If you run it without parameters the Python 3.6 interpreter will by started. You can pass
the -2 parameter to start the python 2.x interpreter or -3 to explicitly declare the
python 3.x&nbsp;interpreter:</p>
<pre class="code literal-block">
C:\Users\Serafeim&gt;py -2
Python 2.7.14 (v2.7.14:84471935ed, Sep 16 2017, 20:19:30) [MSC v.1500 32 bit (Intel)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^Z


C:\Users\Serafeim&gt;py -3
Python 3.6.4 (v3.6.4:d48eceb, Dec 19 2017, 06:04:45) [MSC v.1900 32 bit (Intel)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^Z
</pre>
<p>With py we can easily start the Python interpreter we want. This is not enough though - we
need to use virtualenv and create proper virtual environments for our projects. To do this
you can add the -m option to py to run a module with the proper python version. For example,
to start an http server with Python 2 you would use the module <tt class="docutils literal">SimpleHTTPServer</tt> while
for python 3 you would use <tt class="docutils literal">http.server</tt> (<a class="reference external" href="https://stackoverflow.com/questions/7943751/what-is-the-python-3-equivalent-of-python-m-simplehttpserver">as per this</a>):</p>
<pre class="code literal-block">
C:\progr\py\pelican\spapas.github.io&gt;py -2 -m SimpleHTTPServer
Serving HTTP on 0.0.0.0 port 8000 ...

C:\progr\py\pelican\spapas.github.io&gt;py -3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</pre>
<p>Now, to create the virtual environments we&#8217;ll use the virtualenv module which is installed
by default in Python 2.x (try running <tt class="docutils literal">py <span class="pre">-2</span> <span class="pre">-m</span> pip freeze</tt> to see the list of installed
packages for Python 2.x) and the venv module which is included in the Python 3.x core. So
to create a virtualenv for Python 2 we&#8217;ll run <tt class="docutils literal">py <span class="pre">-2</span> <span class="pre">-m</span> virtualenv <span class="pre">name-of-virtualenv</span></tt>
and for Python 3 <tt class="docutils literal">py <span class="pre">-3</span> <span class="pre">-m</span> venv <span class="pre">name-of-virtualenv</span></tt>.</p>
<pre class="code literal-block">
C:\progr\py&gt;py -2 -m virtualenv venv-2
New python executable in C:\progr\py\venv-2\Scripts\python.exe
Installing setuptools, pip, wheel...done.

C:\progr\py&gt;py -3 -m venv venv-3

C:\progr\py&gt;venv-2\Scripts\activate

(venv-2) C:\progr\py&gt;python -V
Python 2.7.14

(venv-2) C:\progr\py&gt;deactivate

C:\progr\py&gt;venv-3\Scripts\activate

(venv-3) C:\progr\py&gt;python -V
Python 3.6.4
</pre>
<p>That&#8217;s how easy it is to have both Python 2.7 and Python 3.6 in your&nbsp;Windows!</p>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2017/10/11/essential-django-packages/">My essential django package list</a>
      </h1>
    <p class="meta">
<time datetime="2017-10-11T14:20:00+03:00" pubdate>Τετ 11 Οκτώβριος 2017</time>    </p>
</header>

<div class="entry-content"><p>In this article I&#8217;d like to present a list of django packages (add-ons) that I use
in most of my projects. I am using django for more than 5 years as my day to
day work tool to develop applications for the public sector organization I work for.
So please keep in mind that these packages are targeted to the &#8220;enterpripse&#8221;
audience and some things that target public (open access) web apps may be&nbsp;missing.</p>
<p>Some of these packages are included in
<a class="reference external" href="https://github.com/spapas/cookiecutter-django-starter">a django cookiecutter</a> I am using to start new projects and also you can find
example usage of some of these packages in my <a class="reference external" href="https://github.com/spapas/mailer_server">Mailer Server</a> project.
I&#8217;ll also be happy to answer any
questions about these, preferably in <a class="reference external" href="https://stackoverflow.com">stackoverflow</a> if the questions are fit for that&nbsp;site.</p>
<p>Finally, before going to the package list, notice that most of the following are django-related and I won&#8217;t include any
generic python packages (with the exception of xhtml2pdf which I discuss later). There
are a bunch of python-generic packages that I usually use (xlrd, xlwt, requests, raven, unidecode,
database connectors etc) but these won&#8217;t be discussed&nbsp;here.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#packages-i-use-in-all-my-projects" id="id30">Packages I use in all my projects</a><ul>
<li><a class="reference internal" href="#django-tables2" id="id31">django-tables2</a></li>
<li><a class="reference internal" href="#django-filter" id="id32">django-filter</a></li>
<li><a class="reference internal" href="#django-crispy-forms" id="id33">django-crispy-forms</a></li>
<li><a class="reference internal" href="#django-extensions" id="id34">django-extensions</a></li>
<li><a class="reference internal" href="#django-autocomplete-light" id="id35">django-autocomplete-light</a></li>
<li><a class="reference internal" href="#django-reversion" id="id36">django-reversion</a></li>
<li><a class="reference internal" href="#django-compressor" id="id37">django-compressor</a></li>
<li><a class="reference internal" href="#django-debug-toolbar" id="id38">django-debug-toolbar</a></li>
</ul>
</li>
<li><a class="reference internal" href="#packages-i-use-when-i-need-their-functionality" id="id39">Packages I use when I need their functionality</a><ul>
<li><a class="reference internal" href="#xhtml2pdf" id="id40">xhtml2pdf</a></li>
<li><a class="reference internal" href="#django-auth-ldap" id="id41">django-auth-ldap</a></li>
<li><a class="reference internal" href="#django-localflavor" id="id42">django-localflavor</a></li>
<li><a class="reference internal" href="#django-constance" id="id43">django-constance</a></li>
<li><a class="reference internal" href="#django-rq" id="id44">django-rq</a></li>
<li><a class="reference internal" href="#django-rules-light" id="id45">django-rules-light</a></li>
<li><a class="reference internal" href="#django-generic-scaffold" id="id46">django-generic-scaffold</a></li>
<li><a class="reference internal" href="#django-taggit" id="id47">django-taggit</a></li>
<li><a class="reference internal" href="#django-sendfile" id="id48">django-sendfile</a></li>
<li><a class="reference internal" href="#django-reversion-compare" id="id49">django-reversion-compare</a></li>
<li><a class="reference internal" href="#django-simple-history" id="id50">django-simple-history</a></li>
<li><a class="reference internal" href="#django-import-export" id="id51">django-import-export</a></li>
<li><a class="reference internal" href="#django-extra-views" id="id52">django-extra-views</a></li>
<li><a class="reference internal" href="#easy-thumbnails" id="id53">easy-thumbnails</a></li>
<li><a class="reference internal" href="#django-rest-framework" id="id54">django-rest-framework</a></li>
<li><a class="reference internal" href="#django-waffle" id="id55">django-waffle</a></li>
<li><a class="reference internal" href="#django-allauth" id="id56">django-allauth</a></li>
<li><a class="reference internal" href="#django-modeltranslation" id="id57">django-modeltranslation</a></li>
<li><a class="reference internal" href="#django-widget-tweaks" id="id58">django-widget-tweaks</a></li>
<li><a class="reference internal" href="#django-simple-captcha" id="id59">django-simple-captcha</a></li>
<li><a class="reference internal" href="#wagtail" id="id60">wagtail</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id61">Conclusion</a></li>
</ul>
</div>
<div class="section" id="packages-i-use-in-all-my-projects">
<h2>Packages I use in all my&nbsp;projects</h2>
<p>These packages are used more or less in all my projects - I just install them when I
create a new project (or create the project through the cookiecutter I mention&nbsp;above)/</p>
<div class="section" id="django-tables2">
<h3>django-tables2</h3>
<p><a class="reference external" href="https://github.com/bradleyayers/django-tables2">django-tables2</a>, along with django-filter (following) are the two packages
I always use in my projets. You create a <cite>tables.py</cite> module inside your applications
where you define a bunch of tables using more or less the same methodology as with
django-forms: For a <cite>Book</cite> model, Create a <cite>BookTable</cite> class, relate it with the model
and, if needed override some of the columns it automatically generates. For example you
can configure a column that will behave as a link to a detail view of the book, a column
that will behave as a date (with the proper formatting) or even a column that will display
a custom django template&nbsp;snippet.</p>
<p>You&#8217;ll then be
able to configure the data (queryset) of this table and pass it your views context. Finally
use <tt class="docutils literal">{% render_table table %}</tt> to actually display your table. What
you&#8217;ll get? The actual html table (with a nice style that can be configured if needed),
free pagination and free column-header sorting. After you get the hang of it, you&#8217;ll be
able to add tables for your models in a couple of minutes - this is <span class="caps">DRY</span> for me. It also
offers some <a class="reference external" href="http://django-tables2.readthedocs.io/en/latest/pages/generic-mixins.html">class based views and mixins</a> for even more <span class="caps">DRY</span> adding tables to your&nbsp;views.</p>
<p>Finally, please notice that since version 1.8,
django-tables2 <a class="reference external" href="https://django-tables2.readthedocs.io/en/latest/pages/export.html">supports exporting data</a> using <a class="reference external" href="https://github.com/kennethreitz/tablib">tablib</a>, an old requirement of most users
of this&nbsp;library.</p>
</div>
<div class="section" id="django-filter">
<h3>django-filter</h3>
<p><a class="reference external" href="https://github.com/carltongibson/django-filter">django-filter</a> is used to create filters for your data. It plays well with
django-tables2 but you can use it to create filters for any kind of listing you want. It
works similar to django-tables2: Create a <tt class="docutils literal">filters.py</tt> module in your application and define
the a <cite>BookFilter</cite> class there by relating it with the <cite>Book</cite> model, specifying the fields
of the model you want to filter with and maybe override some of the default options. New versions
have some great built-in configuration functionality by customizing which method will be used for
filtering or even adding multiple filter methods - for example you could define your
<tt class="docutils literal">BookFilter</tt> like&nbsp;this:</p>
<pre class="code literal-block">
class BookFilter(django_filters.FilterSet):
    class Meta:
        model = Book
        fields = {
            'name': ['icontains'],
            'author__last_name': ['icontains', 'startswith'],
            'publication_date': ['year', 'month', ],
        }
</pre>
<p>which will give you the following filter form&nbsp;fields:</p>
<ul class="simple">
<li>an ilike &#8216;%value%&#8217; for the book&nbsp;name</li>
<li>an ilike &#8216;%value%&#8217; for the author&nbsp;name</li>
<li>a like &#8216;value%&#8217; for the author&nbsp;name</li>
<li>a year(publication_date) = value for the&nbsp;publication_date</li>
<li>a month(publication_date) = value for the&nbsp;publication_date</li>
</ul>
<p>and their (<span class="caps">AND</span>)&nbsp;combinations!</p>
<p>The <cite>BookFilter</cite> can be used to create a filter form in your template and then in your views
pass to it the initial queryset along with <cite>request.<span class="caps">GET</span></cite> (which will contain the filter values)
to return the filtered data (and usually pass it to the table). I&#8217;ve created a sample project that
uses both django-tables2 and django-filters for you to use: <a class="reference external" href="https://github.com/spapas/django_table_filtering">https://github.com/spapas/django_table_filtering</a>.
Also, I&#8217;ve written an article which describes a technique for <a class="reference external" href="https://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/">automatically creating a filter-table view</a>.</p>
</div>
<div class="section" id="django-crispy-forms">
<h3>django-crispy-forms</h3>
<p>The forms that are created by default by django-forms are very basic and not styled properly.
To overcome this and have better styles for my forms, I always use <a class="reference external" href="https://github.com/django-crispy-forms/django-crispy-forms">django-crispy-forms</a>. It actually has two modes: Using the crispy template filter and using
the crispy template tag. Using the crispy template filter is very simple - just take a plain old django form and
render it in your template like this <cite>{{ form|crispy }}</cite>. If the django-crispy-forms has been configured correctly
(with the correct template pack) the form you&#8217;ll get will be much nicer than the django-default one. This is completely
automatic, you don&#8217;t need to do anything&nbsp;else!</p>
<p>Now, if you have some special requirements from a form, for example
multi-column rendering, adding tabs, accordions etc then you&#8217;ll need to use the <cite>{% crispy %}</cite> template tag. To use this
you must create the layout of your form in the form&#8217;s costructor using the FormHelper django-crispy-forms <span class="caps">API</span>. This may seem cumbersome
at first (why not just create the form&#8217;s layout in the django template) but using a class to define your form&#8217;s layout
has other advantages, for example all the form layout is in the actual form (not in the template) you can control
programatically the layout of the form (f.e display some fields only for administrators), you can use inheritance and
virtual methods to override how a form is rendered&nbsp;etc.</p>
<p>To help you understand how a <tt class="docutils literal">FormHelper</tt> looks like, here&#8217;s a form that is used to edit an access Card for visitors that
displays all fields horizontally inside a panel (I am using Bootstrap for all styling and layout&nbsp;purposes):</p>
<pre class="code literal-block">
class CardForm(ModelForm):
    class Meta:
        model = Card
        fields = ['card_number', 'card_text', 'enabled']

    def __init__(self, *args, **kwargs):
        self.helper = FormHelper()
        self.helper.form_method = 'post'
        self.helper.layout = Layout(
            Fieldset(
                '',
                HTML(u&quot;&quot;&quot;&lt;div class=&quot;panel panel-primary&quot;&gt;
                   &lt;div class=&quot;panel-heading&quot;&gt;
                       &lt;h3 class=&quot;panel-title&quot;&gt;Add card&lt;/h3&gt;
                   &lt;/div&gt;
                   &lt;div class=&quot;panel-body&quot;&gt;&quot;&quot;&quot;),
                Div(
                   Div('card_number', css_class='col-md-4'),
                   Div('card_text', css_class='col-md-4'),
                   Div('enable',css_class='col-md-4'),
                   css_class='row'
                ),
            ),

            FormActions(
                Submit('submit', u'Save', css_class='btn btn-success'),
                HTML(u&quot;&lt;a class='btn btn-primary' href='{% url \&quot;card_list\&quot; %}'&gt;Return&lt;/a&gt;&quot; ),
            ),
            HTML(u&quot;&lt;/div&gt;&lt;/div&gt;&quot;),
        )

        super(CardForm, self).__init__(*args, **kwargs)
</pre>
<p>Notice that forms that will be rendered with a <tt class="docutils literal">FormHelper</tt> actually contain their &lt;form&gt; tag (you don&#8217;t need
to write it yourself like with plain django forms) so you have to define their method (post in this example) and submit&nbsp;button.</p>
</div>
<div class="section" id="django-extensions">
<h3>django-extensions</h3>
<p><a class="reference external" href="https://github.com/django-extensions/django-extensions">django-extensions</a> is a swiss-army-knife of django tools. I use it <em>always</em> in my projects because of the <cite>runserver_plus</cite>
and <cite>shell_plus</cite> commands. The first uses the <a class="reference external" href="https://spapas.github.io/2016/06/07/django-werkzeug-debugger/">Werkzeug debugger with django</a> which makes django development an absolute joy
(open a python shell wherever you want in your code and start writing commands)!
The second opens a <em>better</em> shell (your models and a bunch of django stuff are auto-imported, a better shall will be used if found&nbsp;etc).</p>
<p>The
<cite>runserver_plus</cite> and <cite>shell_plus</cite> alone will be more than enough for me to use this however it adds some more usefull management
commands like: <cite>admin_generator</cite> to quickly create an admin.py for your app, <cite>graph_models</cite> to generate a graphviz dot file of your models,
<cite>update_permissions</cite> to synchronize the list of permissions if you have added one to an existing model and <a class="reference external" href="http://django-extensions.readthedocs.io/en/latest/command_extensions.html">many, many others</a>. Take a look
at them and you&#8217;ll probably find more useful&nbsp;things!</p>
</div>
<div class="section" id="django-autocomplete-light">
<h3>django-autocomplete-light</h3>
<p><a class="reference external" href="https://github.com/yourlabs/django-autocomplete-light">django-autocomplete-light</a> is the best auto-complete library for django, especially after v3 was released (which greatly reduces the magic and
uses normal CBVs for configuring the querysets). You will create
an AutocompleteView for a model (similar to your other class based views) and then automatically use this view through a widget in the admin
or in your own forms. It is fully configurable (both the results and the selection templates), supports many to many fields, creating new instances
and even autocompleteing django-taggit tags! If for some reason it seems that it is not working please keep in mind that you need to includ
jquery <em>and</em> <tt class="docutils literal">{{ form.media }}</tt> to your templates or else the required client side code won&#8217;t be&nbsp;executed.</p>
<p>I think it is an essential for all cases because dropdowns with lots of choices have a very bad user experience - and the same is true with
many to many fields (you could use the checkboxes widget to improve their behavior a little but you will have bad behavior when there are many&nbsp;choices).</p>
</div>
<div class="section" id="django-reversion">
<h3>django-reversion</h3>
<p><a class="reference external" href="https://github.com/etianen/django-reversion">django-reversion</a> is a really important package for my projects. When it is configured properly (by adding a a reversion-middleware), it offers full auditing
for all changes in the your model instances you select (and properly groups them in case of changes to multiple instances in a simple request).
It saves a <span class="caps">JSON</span> representation
of all the versions of an instance in your database. Keep in mind that this may increase your database size  but if you need full auditing
then is is probably the best way to do it. I have written an article about <a class="reference external" href="https://spapas.github.io/2015/01/21/django-model-auditing/">django model auditing</a> that discusses this package and django-simple-history
(following)&nbsp;more.</p>
</div>
<div class="section" id="django-compressor">
<h3>django-compressor</h3>
<p><a class="reference external" href="https://github.com/django-compressor/django-compressor/">django-compressor</a> is package that combines and minifies your css and javascript (both files and line snippets) into static files. There are
other tools for this but I have never used them since django-compressor satisfies my needs. Although I&#8217;ve
<a class="reference external" href="https://spapas.github.io/2015/05/27/using-browserify-watchify/">written about browserify</a> and friends from the node-js world I don&#8217;t recommend using such tools in django to combine and minify your
javascript and css <em>unless</em> you specifically require&nbsp;them.</p>
<p>It has an online and an offline mode. For the online mode, when a request is done it will check if the compressed file exist and if not it will
create it. This may lead to problems with permissions if your application server user cannot write to your static folders and also
your users will see exceptions if for some reason you have included a file that cannot be found. For the
offline mode, you need to run a management command that will create the static files <em>while deploying</em> the applications - this mode is
recommended because any missing files problems etc will be resolved while deploying the&nbsp;app.</p>
</div>
<div class="section" id="django-debug-toolbar">
<h3>django-debug-toolbar</h3>
<p><a class="reference external" href="https://github.com/jazzband/django-debug-toolbar">django-debug-toolbar</a>: This is a well known package for debugging django apps that is always included in the development configuration of my projects.
It has various panels that help you debug your application but, at least for me, the most helpful is the one that displays you all <span class="caps">SQL</span> queries that
are executed for a page load. Because of how the django orm is working it will go on and follow all relations something that will lead to
hundreds of queries. For example, let&#8217;s say that you have simple Book model with a foreign key to an Author model that has N instances in your
database. If you do a <tt class="docutils literal">Book.objects.all()</tt>
and want display the author name for each book in a template then you&#8217;ll always do <tt class="docutils literal">N+1</tt> queries to the database! This is really easy to miss because
in the django you&#8217;ll just do <tt class="docutils literal">{% for book in books <span class="pre">%}{{</span> <span class="pre">book.name}},</span> {{ book.author.name <span class="pre">}}{%</span> endif %}</tt> &#8212; however the <tt class="docutils literal">{{ book.author.name }}</tt> will go
on and do an extra <span class="caps">SQL</span> query!!! Such cases are easily resolved by using <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#select-related">select_related</a> (and <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/models/querysets/#prefetch-related">prefetch_related</a>) but you must be sure to use select_related
for all your queries (and if you add some extra things to your template you must remember to also add them to your select_related clause for the&nbsp;query).</p>
<p>So, what I recommend before going to production is to visit all your pages using django-debug-toolbar and take a quick look at the number of <span class="caps">SQL</span>
queries. If you see something that does not make sense (for example you see more than 10 queries) then you&#8217;ll need to think about the problem I just
mentioned. Please notice that this, at least for me, is not premature optimization - this is not actually optimization! This is about writing correct
code. Let&#8217;s suppose that you could not use the django orm anymore and you had to use plain old <span class="caps">SQL</span> queries. Would you write <tt class="docutils literal"><span class="caps">SELECT</span> * <span class="caps">FROM</span> books</tt> and
then for each row do another <tt class="docutils literal"><span class="caps">SELECT</span> * <span class="caps">FROM</span> authors <span class="caps">WHERE</span> id=?</tt> passing the author of each book <em>or</em> do only <tt class="docutils literal">select * from books b <span class="caps">LEFT</span> <span class="caps">JOIN</span>
authors a on b.author_id = a.id</tt>?</p>
</div>
</div>
<div class="section" id="packages-i-use-when-i-need-their-functionality">
<h2>Packages I use when I need their&nbsp;functionality</h2>
<p>The packages following are also essential to me but only when I need their functionality. I don&#8217;t use them in all my projects
but, when I need the capabilities they offer then I will use these packages (and not some others). For example, if I need to
render PDFs in my applications then I will use the xhtml2pdf, if I need to login through <span class="caps">LDAP</span> I will use django-auth-ldap&nbsp;etc.</p>
<div class="section" id="xhtml2pdf">
<h3>xhtml2pdf</h3>
<p><a class="reference external" href="https://github.com/xhtml2pdf/xhtml2pdf">xhtml2pdf</a> is the package I use for creating <span class="caps">PDF</span>&#8217;s with django as I&#8217;ve alreadly discussed in the <a class="reference external" href="https://spapas.github.io/2015/11/27/pdf-in-django/">PDFs in Django</a> article (this is not
a django-specific package like most others I discuss here but it plays really good with django). You create a
normal django template, add some styling to it and dump it to html. Notice that there&#8217;s a <a class="reference external" href="https://github.com/chrisglass/django-xhtml2pdf">django-xhtml2pdf</a> project but has not been recently updated
and after all as you can see in my article it is easy to just call xhtml2pdf directly. The xhtml2pdf library is actually a wrapper around the
excellent <a class="reference external" href="http://www.reportlab.com">reportlab</a> library which does the low-level pdf&nbsp;output.</p>
<p>Notice that the xhtml2pdf library had some maintenance problems
(that&#8217;s why some people are suggesting other <span class="caps">PDF</span> solutions like WeasyPrint) however they seem to have been fixed now. Also,
I have found out that, at least for my needs (using Windows as my development environment), other soltuons are much inferior to xhtml2pdf.
I urge you to try xhtml2pdf first and only if you find that it does not cover your needs (and have asked
me about your problem) try the other&nbsp;solutions.</p>
</div>
<div class="section" id="django-auth-ldap">
<h3>django-auth-ldap</h3>
<p><a class="reference external" href="https://bitbucket.org/psagers/django-auth-ldap/">django-auth-ldap</a> is the package you&#8217;ll want to use if your organization uses <span class="caps">LDAP</span> (or Active Directory) and you want to use it for
logging in. Just configure your <span class="caps">LDAP</span> server settings,
add the ldap authenticator and you&#8217;ll be ready to go. Please notice that this package is a django wrapper of the python-ldap package
which actually provides the <span class="caps">LDAP</span>&nbsp;connection.</p>
</div>
<div class="section" id="django-localflavor">
<h3>django-localflavor</h3>
<p><a class="reference external" href="https://github.com/django/django-localflavor">django-localflavor</a> offers useful stuff for various countries, mainly form fields with the correct validation and lists of choices.
For example, for my country (Greece) you&#8217;ll get a <tt class="docutils literal">GRPhoneNumberField</tt>, a <tt class="docutils literal">GRPostalCodeField</tt> and a <tt class="docutils literal">GRTaxNumberCodeField</tt>. Use it instead of re-implementing
the&nbsp;behavior.</p>
</div>
<div class="section" id="django-constance">
<h3>django-constance</h3>
<p><a class="reference external" href="https://github.com/jazzband/django-constance">django-constance</a> is a simple package that enables you to add quick-configurable settings in your application. To change the settings.py file
you need to edit the source and restart the application - for most installations this is a full re-deployment of the application. Fully
re-deploying the app just to change a setting is not very good practice (depending on the setting of course but if it is a business setting
it usually should be done by business users and not by&nbsp;administrators).</p>
<p>That&#8217;s where django-constance comes to help you. You can define some
extra settings which can be changed through the django admin and their new value will be available immediately. Also you can configure where
these settings will be saved. One option is the database but this is not recommended - instead you can use redis so that the settings values will be
available much&nbsp;quicker!</p>
</div>
<div class="section" id="django-rq">
<h3>django-rq</h3>
<p><a class="reference external" href="https://github.com/ui/django-rq">django-rq</a> is a django wrapper for the <a class="reference external" href="https://github.com/nvie/rq">rq</a> library. I use it when I need asynchronous tasks (which is on almost all of my projects). More
info can be found on the two articles I have writtten about django rq (<a class="reference external" href="https://spapas.github.io/2015/01/27/async-tasks-with-django-rq/">asynchronous tasks in django</a> and <a class="reference external" href="https://spapas.github.io/2015/09/01/django-rq-redux/">django-rq redux</a>).</p>
</div>
<div class="section" id="django-rules-light">
<h3>django-rules-light</h3>
<p>One of the least known packages from those I discuss here, <a class="reference external" href="https://github.com/yourlabs/django-rules-light">django-rules-light</a> is one of the most useful when is needed. This package
allows you to define complex rules for doing actions on model instances. Each rule is a function that gets the user that wants to do the action
and the object that the user wants to action on. The function returns True or False to allow or not allow the action. You can then use these in
both your code to programatically check if the user can do the the action and your templates to decide what buttons and options you will display.
There are also various helper methods for CBVs that make everything&nbsp;easier.</p>
<p>To properly understand the value of django-rules-light you need to have some more complex than usual action rules. For example if your actions
for an object are view / edit and all your users can view and edit their own objects then you don&#8217;t really need this package. However, if your administrators
can view all objects and your object can be finalized so no changes are allowed unless an administrator tries to change it then you&#8217;ll greatly benefit
from using&nbsp;it!</p>
</div>
<div class="section" id="django-generic-scaffold">
<h3>django-generic-scaffold</h3>
<p><a class="reference external" href="https://github.com/spapas/django-generic-scaffold">django-generic-scaffold</a> is a package I have created that can be used to quickly (and DRYly) create <span class="caps">CRUD</span> CBVs for your models. I usually don&#8217;t want to
give access to the django-admin to non-technical users however sometimes I want to quickly create the required CBVs for them (list, detail, create, edit
delete). Using django-generic-scaffold you can just create a scaffold which is related with a Model and all the views will be automagically created -
you only need to link them to your urls.py. The created CBVs are fully configurable by adding extra mixins or even changing the parent class of each <span class="caps">CBV</span>.</p>
<p>Notice that this package does not create any source files - instead all CBVs are created on-the-fly using <tt class="docutils literal">type</tt>. For example, to create <span class="caps">CRUD</span> CBVs for
a Book model you&#8217;ll do this in&nbsp;scaffolding.py:</p>
<pre class="code literal-block">
class BookCrudManager(CrudManager):
    model = models.Book
    prefix = 'books'
</pre>
<p>and then in your urls.py you&#8217;ll just append the generated urls to your url&nbsp;list:</p>
<pre class="code literal-block">
book_crud = BookCrudManager()
urlpatterns += book_crud.get_url_patterns()
</pre>
<p>Now you can visit the corresponding views (for example /books or /bookscreate - depends on the prefix) to add/view/edit etc your&nbsp;books!</p>
</div>
<div class="section" id="django-taggit">
<h3>django-taggit</h3>
<p><a class="reference external" href="https://github.com/alex/django-taggit">django-taggit</a> is the library you&#8217;ll want to use if you have to use tags with your models. A tag is a synonym for keyword, i.e adding some
words/phrases to your instances that are used to categorise and desribe em. The relation between your to-be-tagged-model and your tags is
many to many. To use it, you just add <cite>tags = TaggableManager()</cite> to your
model and you are ready to go! Of course it will need some more configuration to be included in django admin and django forms but thankfully,
autocomplete-lights can be <a class="reference external" href="https://django-autocomplete-light.readthedocs.io/en/master/taggit.html">integrated with django-taggit</a>!</p>
</div>
<div class="section" id="django-sendfile">
<h3>django-sendfile</h3>
<p><a class="reference external" href="https://github.com/johnsensible/django-sendfile">django-sendfile</a> is a very important - at least to - me library. Sometimes, user uploaded files (media in django) should not be visible to all users
so you&#8217;ll need to implement some access control through your django app. However, it is important to <em>not</em> serve these media files through your application
server (uwsi, gunicorn etc) but use a web server (nginx, apache ect) for serving them. This is needed because your application server&#8217;s purpose is
not serving files from the disk - keep in mind that the application server usually has a specified amount of workers (usually analogous to the number
of CPUs of your server, for example 4 workers ) - think what will happen if some large media files are server through these workers to users with
a slow connection! With 4 such concurrent connections your application won&#8217;t be able to serve any other&nbsp;content!</p>
<p>So this package (along with the support of X-Sendfile from the web servers) helps you fulfill the above requirements:
It allowes you to check permissions to your media through your django application <em>but</em> then offload the serving of your media files to the web server.
More info about
<a class="reference external" href="https://stackoverflow.com/q/7296642/119071">django-sendfile can be found on this <span class="caps">SO</span> answer</a> but with a few words, with django-sendfile you create a view that checks if a file is allowed to be served
and, if yes, instruct the web server to actually serve that file by appending a specific header to the&nbsp;response.</p>
</div>
<div class="section" id="django-reversion-compare">
<h3>django-reversion-compare</h3>
<p><a class="reference external" href="https://github.com/jedie/django-reversion-compare">django-reversion-compare</a> is an addon to django-reversion. It allows you to compare two different versions of a model instance
and highlights their differences using various smart algorithms (so if you have a long text field you won&#8217;t only see that these are different but
you&#8217;ll also see where exactly they differ, with output similar to the one you get when using&nbsp;diff).</p>
</div>
<div class="section" id="django-simple-history">
<h3>django-simple-history</h3>
<p><a class="reference external" href="https://github.com/treyhunner/django-simple-history">django-simple-history</a> has similar capabilities with django-reversion - (auditing and keeping versions of models) with a very important
difference: While django-reversion keeps a <span class="caps">JSON</span> representation of each version in the database (making querying very difficult), django-simple-history
creates an extra, history table for each model instance you want to track and adds each change as a new row to that table. As can be understood this
will make the history table really huge but has the advantage that you can easily query for old values. I usually use django-reversion unless I know
that I will need the history&nbsp;querying.</p>
</div>
<div class="section" id="django-import-export">
<h3>django-import-export</h3>
<p><a class="reference external" href="https://github.com/django-import-export/django-import-export">django-import-export</a> can be used to enchance your models with mass import and export capabilities (from example from/to <span class="caps">CSV</span>).
You will add an ModelResource class that describes (and configures) how your Model should be imported/exported. The ModelResource class can
then be easily used in your views and, more importantly, it is integrated to the django-admin. I have to confess that I have not used django-import-export
for <em>importing</em> data because I prefer implementing my own views for that (to have better control over the whole process and because the data
I usually need to import does not usually map 1 to 1 with a model but I need to create more model instances etc). However I am using the export
capabilities of django-import-export in various projects with great success, especially the admin integration which easily fulfills the exporting
data capabilities of most&nbsp;users.</p>
</div>
<div class="section" id="django-extra-views">
<h3>django-extra-views</h3>
<p>Beyond django-forms, django supports a feature called <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/formsets/">Formsets</a> which allows you to add/edit multiple object instances in
a single view (by displaying all instances one after the other). The classic request/response cycle of django is preserved in Formsets, so
your form instances will be submitted all together when you submit the form. The logic extension to the Formset is the <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/modelforms/#model-formsets">ModelFormset</a> i.e each form
in a Formset is a ModelForm and <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/forms/modelforms/#inline-formsets">InlineFormSet</a> where you have a Parent model that has a bunch of children and you are editing the Parent <em>and</em>
its children in a single Form. For example, you have a School and a Student model where each Student has a ForeignKey to School. The usual case
would be to edit the Student model and select her school (through a drop down or even-better if you use django-autocomplete-light through a proper
autocompelte widget). However, you may for some reason want to edit the School and display (and edit) the list of its Students &#8212; that&#8217;s where you&#8217;ll
use an&nbsp;InlineFormSet!</p>
<p>The above features (Formsets, Modelformsets and Inlineformsets) are not supported natively by django CBVs &#8212; that&#8217;s where <a class="reference external" href="https://github.com/AndrewIngram/django-extra-views">django-extra-views</a> comes
to the foreground. You can use the corresponding CBVs of django-extra-views to support the multiple-form workflows described above. Using these CBVs
are more or less similar to using the good-old django&nbsp;FormView.</p>
</div>
<div class="section" id="easy-thumbnails">
<h3>easy-thumbnails</h3>
<p><a class="reference external" href="https://github.com/SmileyChris/easy-thumbnails">easy-thumbnails</a> is a great library if you want to support thumbnails. Actually, thumbnails is not 100% correct - this package can be used to
generate and manage various versions of your original images, for example you may have a small version of the image that will be used as a thumbnail,
a larger version that will be used in a gallery-carousel view and an even larger version (but not the original one which could be huge) that will be used when
the user clicks on the gallery to view a larger version of the image. To do that you define the image configurations you support in your settings.py and then
you have access
to your thumbnails both in your templates and in your views. Notice that a specific thumbnail congfiguration for an image will be created only once since
the generated images are saved so each thumbnail will be generated on the first request it contains it and will be reused in the following such&nbsp;requests.</p>
</div>
<div class="section" id="django-rest-framework">
<h3>django-rest-framework</h3>
<p><a class="reference external" href="https://github.com/encode/django-rest-framework">django-rest-framework</a> is definitely the best package for creating web APIs with django. I don&#8217;t recommend using it if you want to create a quick <span class="caps">JSON</span> search
<span class="caps">API</span> (take a look at <a class="reference external" href="https://spapas.github.io/2014/09/15/django-non-html-responses/">django non-<span class="caps">HTML</span> responses</a>) but if you want to go the <span class="caps">SPA</span> way or if you want to create multiple APIs for various models then
this is the way to go. Integrating it to your project will need some effort (that&#8217;s why I don&#8217;t recommend it for quick and dirty APIs) because you&#8217;ll
need to create a serializers.py which will define the serializers (more or less the fields) for the models you&#8217;ll want to expose through your <span class="caps">API</span> and
then create the views (or the viewsets which are families of views for example list, detail, delete, update, create) and add them to your urls.py. You&#8217;ll
also need to configure authentication, authorization and probably filtering and pagination. This may seem like a lot of work but the result are
excellent - you&#8217;ll get a full <span class="caps">REST</span> <span class="caps">API</span> supporting create, list, detail, update, delete for any complex configuration of your models.
You can take a look at a sample application in my <a class="reference external" href="https://github.com/spapas/react-tutorial">React tutorial</a> repository (yes this is a repository that has a tutorial for React and
friends but the back-end is in django and&nbsp;django-rest-framework).</p>
<p>django-rest-framework integrates nicely with django-filter (mentioned above) to re-use the filters you have created for your model listings
in your <span class="caps">REST</span> APIs - <span class="caps">DRY</span> at its&nbsp;best!</p>
</div>
<div class="section" id="django-waffle">
<h3>django-waffle</h3>
<p><a class="reference external" href="https://github.com/jsocol/django-waffle">django-waffle</a> is described as a feature flipper. What does this mean? Let&#8217;s say that you want to control at will when a specific view will be enabled
- this is the library you&#8217;ll want to use. Or you have developed a new feature and you want to give access to it only on a subset of users for a pilot run of
the feature - once again you should use django flipper. It offers a nice admin interface where you can configure the flags that will be used for the various
feature enabling/disabling (and if they are active or not) and various template tags and functions that you can use to test if the features should be activated
or&nbsp;not.</p>
</div>
<div class="section" id="django-allauth">
<h3>django-allauth</h3>
<p><a class="reference external" href="https://github.com/pennersr/django-allauth">django-allauth</a> should be used in two cases: When you want a <em>better</em> user registration workflow than the default (non-existant) one or you want
to integrate your application with an external OAuth provider (i.e allow your users to login through their facebook, google, twitter, github etc accounts). I
have mainly used this package for the first case and I can confirm that it works great and you can create as complex flows as you want (for example, in
one of my projects I have the following user registration-activation flow: A user registers using a custom form and using his email as username, he receives
an email with a confirmation link,
after he has confirmed his email he receivs a custom message to wait for his account activation and the administrators of the application are notified,
the administrators enable the new user&#8217;s account after checking some things and only then he&#8217;ll be able to log-in). One thing that must be noticed about
django-allauth is that it (in my opition) does not have very good documentation but there are lots of answers about <a class="reference external" href="https://stackoverflow.com/questions/tagged/django-allauth">django-allauth in stackoverflow</a> and the source code
is very clear so you can always use the source as documentation for this&nbsp;package.</p>
</div>
<div class="section" id="django-modeltranslation">
<h3>django-modeltranslation</h3>
<p>The <a class="reference external" href="https://github.com/deschler/django-modeltranslation">django-modeltranslation</a> library is the library I recommend for when you want to have translations to your models. To use it
you add a translation.py file where you declare the models and their fields that should be translated. The, depending on which languages you have configured
in your settings.py after you run makemigrations and migrate you&#8217;ll see that django-modeltranslation will have included extra fields to the database, each one
with the corresponding language name (for example if you have added a field <tt class="docutils literal">name</tt> to the translations and have english and greek as language,
django-modeltranslation will add the fields <tt class="docutils literal">name_en</tt> and <tt class="docutils literal">name_el</tt> to your table). You can the edit the i18n fields (using forms or the django admin) and
depending on the current language of your site when you use <tt class="docutils literal">name</tt> you&#8217;ll get either <tt class="docutils literal">name_el</tt> or <tt class="docutils literal">name_en</tt>.</p>
</div>
<div class="section" id="django-widget-tweaks">
<h3>django-widget-tweaks</h3>
<p>If for some reason you don&#8217;t want to do django-crispy-forms, or you have a form in which you want to do a specific layout change but without
fully implementing the FormHelper then you can actually render the form in <span class="caps">HTML</span> and output the fields one by one. One thing that cannot
be done though is passing custom options to the rendered form field. When you do a <tt class="docutils literal">{{ form.field }}</tt> to your template django will render
the form field using its default options - yes this can be overriden using <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/forms/widgets/#base-widget-classes">custom widgets</a> but I don&#8217;t recommend it for example if you only
want to add a class to the rendered <tt class="docutils literal">&lt;input&gt;</tt>!</p>
<p>Instead, you can use <a class="reference external" href="https://github.com/jazzband/django-widget-tweaks">django-widget-tweaks</a> to pass some specific class names or attributes to
the rendered form fields - so if you use <tt class="docutils literal">{{ <span class="pre">form.field|add_class:&quot;myclass&quot;</span> }}</tt> the rendered <tt class="docutils literal">&lt;input&gt;</tt> will have a <tt class="docutils literal">myclass</tt> css&nbsp;class.</p>
</div>
<div class="section" id="django-simple-captcha">
<h3>django-simple-captcha</h3>
<p>Use <a class="reference external" href="https://github.com/mbi/django-simple-captcha">django-simple-captcha</a> to add (configurable) captchas to your django forms. This is a very simple package that does not have any requirements
beyond the Pillow library for the captcha image generator. The generated captchas are simple images with some added noise so it won&#8217;t integrate
<a class="reference external" href="https://www.google.com/recaptcha/intro/">reCAPTCHA</a> with which you may be more familiar. I deliberatly propose this package for captchas so you won&#8217;t need to integrate with Google&nbsp;services.</p>
</div>
<div class="section" id="wagtail">
<h3>wagtail</h3>
<p><a class="reference external" href="https://github.com/wagtail/wagtail">wagtail</a> is a great django <span class="caps">CMS</span>. I use it when I need to create a <span class="caps">CMS</span> or I need to add <span class="caps">CMS</span> like capabilities to a project. It has many
capabilities, too many to be listed here. I urge you to try it if you need a <span class="caps">CMS</span>!</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>The above packages should cover most of your django needs. I have listed only packages with good documentation,
that have been recently updated
and work with new django versions and should be fairly easy to integrate with your projects. If you need anything more or want to take a general
look at some of the packages that have are availablie I recommend starting
with the <a class="reference external" href="https://djangopackages.org">django packages</a>&nbsp;site.</p>
<p>One important thing to notice here is that some of the above packages are not really complex and their functionality can be re-implemented
by you in a couple of hours. For example, you could replicate the functionality of django-constance by adding a config dict and
a couple of methods (and template tags) of storing and retrieving the keys of that dict with redis. Or add some custom clean methods to your
forms instead of using the form fields from django-localflavor. Also, some of these packages have similar functionality and can be used (along
with a little custom code) to replicate the functionality of other packages, for exmaple instead of using django-waffle you could use
django-constance to configure if the features should be enabled or disabled and django-rules-light to control if the users have access to the feature.
Also, you could probably use django-waffle for access control, i.e allow only admins to access a specific&nbsp;views.</p>
<p>Please don&#8217;t do this. This violates <span class="caps">DRY</span> and violates being disciplined.
Each package has its purpose and being <span class="caps">DRY</span> means that you use it for its purpose, <em>not</em> re-implementing it and <em>not</em> re-using it for other purposes.
When somebody (or you after some months) sees that package in requirements or INSTALLED_APPS he will conclude that you are using it for
its intented purpose and thank you because you have saved him some time - please don&#8217;t make him waste his time by needing to read your source code to understand
any smart tricks or reinventing the&nbsp;wheel.</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://spapas.github.io/index4.html">&larr; Older</a>

    <a class="next" href="https://spapas.github.io/index2.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>

  <style>
    .bmc-button img {
      width: 27px !important;
      margin-bottom: 3px !important;
      box-shadow: none !important;
      border: none !important;
      vertical-align: middle !important;
    }

    .bmc-button {
      line-height: 36px !important;
      height: 37px !important;
      text-decoration: none !important;
      display: inline-block !important;
      color: #ffffff !important;
      background-color: #000000 !important;
      border-radius: 3px !important;
      border: 1px solid transparent !important;
      padding: 1px 9px !important;
      font-size: 23px !important;
      letter-spacing: 0.6px !important;
      ;
      box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
      -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      margin: 0 auto !important;
      font-family: 'Cookie', cursive !important;
      -webkit-box-sizing: border-box !important;
      box-sizing: border-box !important;
      -o-transition: 0.3s all linear !important;
      -webkit-transition: 0.3s all linear !important;
      -moz-transition: 0.3s all linear !important;
      -ms-transition: 0.3s all linear !important;
      transition: 0.3s all linear !important;
    }

    .bmc-button:hover,
    .bmc-button:active,
    .bmc-button:focus {
      -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      text-decoration: none !important;
      box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      opacity: 0.85 !important;
      color: #ffffff !important;
    }
  </style>
  <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://spapas.github.io/2020/03/18/django-crispy-form-quick-easy-layout/">Quick and easy layout of django forms using django-crispy-forms and django-widget-tweaks</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/10/17/declarative-ecto-query-sorting/">Declarative Ecto query sorting</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/10/03/html-form-submit-php/">How to properly handle an HTML form</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/07/25/declarative-ecto-query-filters/">Declarative Ecto query filters</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/06/04/phoenix-form-select2-ajax/">Phoenix forms integration with select2 and ajax</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://spapas.github.io/category/android.html">android</a></li>
      <li><a href="https://spapas.github.io/category/css.html">css</a></li>
      <li><a href="https://spapas.github.io/category/django.html">django</a></li>
      <li><a href="https://spapas.github.io/category/elixir.html">elixir</a></li>
      <li><a href="https://spapas.github.io/category/flask.html">flask</a></li>
      <li><a href="https://spapas.github.io/category/git.html">git</a></li>
      <li><a href="https://spapas.github.io/category/html.html">html</a></li>
      <li><a href="https://spapas.github.io/category/javascript.html">javascript</a></li>
      <li><a href="https://spapas.github.io/category/pelican.html">pelican</a></li>
      <li><a href="https://spapas.github.io/category/postgresql.html">postgresql</a></li>
      <li><a href="https://spapas.github.io/category/python.html">python</a></li>
      <li><a href="https://spapas.github.io/category/spring.html">spring</a></li>
      <li><a href="https://spapas.github.io/category/unix.html">unix</a></li>
      <li><a href="https://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://spapas.github.io/tag/less.html">less</a>,    <a href="https://spapas.github.io/tag/django-crispy-forms.html">django-crispy-forms</a>,    <a href="https://spapas.github.io/tag/rest.html">rest</a>,    <a href="https://spapas.github.io/tag/query.html">query</a>,    <a href="https://spapas.github.io/tag/ecto.html">ecto</a>,    <a href="https://spapas.github.io/tag/tables.html">tables</a>,    <a href="https://spapas.github.io/tag/pivot_table.html">pivot_table</a>,    <a href="https://spapas.github.io/tag/console.html">console</a>,    <a href="https://spapas.github.io/tag/async.html">async</a>,    <a href="https://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="https://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="https://spapas.github.io/tag/forms.html">forms</a>,    <a href="https://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="https://spapas.github.io/tag/404.html">404</a>,    <a href="https://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="https://spapas.github.io/tag/immutable.html">immutable</a>,    <a href="https://spapas.github.io/tag/initd.html">init.d</a>,    <a href="https://spapas.github.io/tag/django-widget-tweaks.html">django-widget-tweaks</a>,    <a href="https://spapas.github.io/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://spapas.github.io/tag/python.html">python</a>,    <a href="https://spapas.github.io/tag/django-extensions.html">django-extensions</a>,    <a href="https://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="https://spapas.github.io/tag/scipy.html">scipy</a>,    <a href="https://spapas.github.io/tag/grid.html">grid</a>,    <a href="https://spapas.github.io/tag/ag-grid.html">ag-grid</a>,    <a href="https://spapas.github.io/tag/du.html">du</a>,    <a href="https://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="https://spapas.github.io/tag/settings.html">settings</a>,    <a href="https://spapas.github.io/tag/flux.html">flux</a>,    <a href="https://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://spapas.github.io/tag/queries.html">queries</a>,    <a href="https://spapas.github.io/tag/debug.html">debug</a>,    <a href="https://spapas.github.io/tag/imgur.html">imgur</a>,    <a href="https://spapas.github.io/tag/security.html">security</a>,    <a href="https://spapas.github.io/tag/npm.html">npm</a>,    <a href="https://spapas.github.io/tag/hyperapp.html">hyperapp</a>,    <a href="https://spapas.github.io/tag/spring.html">spring</a>,    <a href="https://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="https://spapas.github.io/tag/cron.html">cron</a>,    <a href="https://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="https://spapas.github.io/tag/design.html">design</a>,    <a href="https://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="https://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="https://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="https://spapas.github.io/tag/rq.html">rq</a>,    <a href="https://spapas.github.io/tag/redis.html">redis</a>,    <a href="https://spapas.github.io/tag/python-3.html">python-3</a>,    <a href="https://spapas.github.io/tag/research.html">research</a>,    <a href="https://spapas.github.io/tag/werkzeug.html">werkzeug</a>,    <a href="https://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="https://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://spapas.github.io/tag/disk-usage.html">disk-usage</a>,    <a href="https://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="https://spapas.github.io/tag/component.html">component</a>,    <a href="https://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="https://spapas.github.io/tag/elixir.html">elixir</a>,    <a href="https://spapas.github.io/tag/ipython.html">ipython</a>,    <a href="https://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="https://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="https://spapas.github.io/tag/properties.html">properties</a>,    <a href="https://spapas.github.io/tag/bash.html">bash</a>,    <a href="https://spapas.github.io/tag/es6.html">es6</a>,    <a href="https://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="https://spapas.github.io/tag/postgresql.html">postgresql</a>,    <a href="https://spapas.github.io/tag/kotlin.html">kotlin</a>,    <a href="https://spapas.github.io/tag/adapter.html">adapter</a>,    <a href="https://spapas.github.io/tag/filter.html">filter</a>,    <a href="https://spapas.github.io/tag/flask.html">flask</a>,    <a href="https://spapas.github.io/tag/notebook.html">notebook</a>,    <a href="https://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="https://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="https://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="https://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="https://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="https://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="https://spapas.github.io/tag/unix.html">unix</a>,    <a href="https://spapas.github.io/tag/google.html">google</a>,    <a href="https://spapas.github.io/tag/linux.html">linux</a>,    <a href="https://spapas.github.io/tag/pivot.html">pivot</a>,    <a href="https://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="https://spapas.github.io/tag/git.html">git</a>,    <a href="https://spapas.github.io/tag/java.html">java</a>,    <a href="https://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="https://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="https://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="https://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://spapas.github.io/tag/numpy.html">numpy</a>,    <a href="https://spapas.github.io/tag/form.html">form</a>,    <a href="https://spapas.github.io/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="https://spapas.github.io/tag/rst.html">rst</a>,    <a href="https://spapas.github.io/tag/python-2.html">python-2</a>,    <a href="https://spapas.github.io/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://spapas.github.io/tag/middleware.html">middleware</a>,    <a href="https://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="https://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="https://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="https://spapas.github.io/tag/error.html">error</a>,    <a href="https://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="https://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://spapas.github.io/tag/select2.html">select2</a>,    <a href="https://spapas.github.io/tag/history.html">history</a>,    <a href="https://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="https://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="https://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="https://spapas.github.io/tag/plpgsql.html">plpgsql</a>,    <a href="https://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="https://spapas.github.io/tag/generic.html">generic</a>,    <a href="https://spapas.github.io/tag/babel.html">babel</a>,    <a href="https://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="https://spapas.github.io/tag/html.html">html</a>,    <a href="https://spapas.github.io/tag/android.html">android</a>,    <a href="https://spapas.github.io/tag/pandas.html">pandas</a>,    <a href="https://spapas.github.io/tag/css.html">css</a>,    <a href="https://spapas.github.io/tag/node.html">node</a>,    <a href="https://spapas.github.io/tag/phoenix.html">phoenix</a>,    <a href="https://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="https://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="https://spapas.github.io/tag/react.html">react</a>,    <a href="https://spapas.github.io/tag/autocompelte.html">autocompelte</a>,    <a href="https://spapas.github.io/tag/declarative.html">declarative</a>,    <a href="https://spapas.github.io/tag/php.html">php</a>,    <a href="https://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="https://spapas.github.io/tag/branching.html">branching</a>,    <a href="https://spapas.github.io/tag/github.html">github</a>,    <a href="https://spapas.github.io/tag/jupyter.html">jupyter</a>,    <a href="https://spapas.github.io/tag/windows.html">windows</a>,    <a href="https://spapas.github.io/tag/youtube.html">youtube</a>,    <a href="https://spapas.github.io/tag/django.html">django</a>,    <a href="https://spapas.github.io/tag/q.html">q</a>,    <a href="https://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="https://spapas.github.io/tag/redux.html">redux</a>,    <a href="https://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://spapas.github.io/posts/2013/">2013</a>,    <a href="https://spapas.github.io/posts/2014/">2014</a>,    <a href="https://spapas.github.io/posts/2015/">2015</a>,    <a href="https://spapas.github.io/posts/2016/">2016</a>,    <a href="https://spapas.github.io/posts/2017/">2017</a>,    <a href="https://spapas.github.io/posts/2018/">2018</a>,    <a href="https://spapas.github.io/posts/2019/">2019</a>,    <a href="https://spapas.github.io/posts/2020/">2020</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://spapas.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://spapas.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2020  Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="https://spapas.github.io/theme/js/ender.js"></script>
  <script src="https://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
  <script src="https://spapas.github.io/theme/js/ads.js"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
  <script>
    if( window.canRunAds === undefined ){
        // adblocker detected, show fallback
        console.log("CANNOT RUN ADS");
        document.getElementById('gHPzseYvFrhZ123').style.display='block';
      }
  </script>
</body>

</html>