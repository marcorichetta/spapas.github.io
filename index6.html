<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="5_8DTmIiEq4gFvNAfxAD6TsGOgrMAjp8lQFQvfA6zZc" />
    <title>/var/</title>
    <meta name="author" content="Serafeim Papastefanos">




    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="https://spapas.github.io/favicon.png" rel="icon">

    <link href="https://spapas.github.io/theme/css/main.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://spapas.github.io/theme/css/extra_style.css" media="screen, projection" rel="stylesheet"
      type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans:400,700&amp;subset=greek" rel="stylesheet">


    <script data-ad-client="ca-pub-7673322832689008" async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://spapas.github.io/">/var/</a></h1>
    <h2>Various programming stuff</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li >
        <a href="https://spapas.github.io/category/android.html">Android</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/css.html">Css</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/django.html">Django</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/elixir.html">Elixir</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/flask.html">Flask</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/git.html">Git</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/html.html">Html</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/javascript.html">Javascript</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/pelican.html">Pelican</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/postgresql.html">Postgresql</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/python.html">Python</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/spring.html">Spring</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/unix.html">Unix</a>
      </li>
      <li >
        <a href="https://spapas.github.io/category/wagtail.html">Wagtail</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2015/11/27/pdf-in-django/">PDFs in Django: The essential guide</a>
      </h1>
    <p class="meta">
<time datetime="2015-11-27T10:20:00+02:00" pubdate>Παρ 27 Νοέμβριος 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id4">Introduction</a></li>
<li><a class="reference internal" href="#the-players" id="id5">The players</a><ul>
<li><a class="reference internal" href="#reportlab" id="id6">ReportLab</a></li>
<li><a class="reference internal" href="#xhtml2pdf" id="id7">xhtml2pdf</a></li>
<li><a class="reference internal" href="#pypdf2" id="id8">PyPDF2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#django-integration" id="id9">Django integration</a><ul>
<li><a class="reference internal" href="#using-a-plain-old-view" id="id10">Using a plain old&nbsp;view</a></li>
<li><a class="reference internal" href="#using-a-cbv" id="id11">Using a <span class="caps">CBV</span></a></li>
<li><a class="reference internal" href="#how-does-django-xhtml2pdf-loads-resources" id="id12">How does django-xhtml2pdf loads&nbsp;resources</a></li>
<li><a class="reference internal" href="#using-a-common-style-for-your-pdfs" id="id13">Using a common style for your&nbsp;PDFs</a></li>
<li><a class="reference internal" href="#changing-the-font-to-a-unicode-enabled-one" id="id14">Changing the font (to a Unicode enabled&nbsp;one)</a></li>
<li><a class="reference internal" href="#configure-django-for-debugging-pdf-creation" id="id15">Configure Django for debugging <span class="caps">PDF</span>&nbsp;creation</a></li>
<li><a class="reference internal" href="#concatenating-pdfs-in-django" id="id16">Concatenating PDFs in&nbsp;Django</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-advanced-xhtml2pdf-features" id="id17">More advanced xhtml2pdf features</a><ul>
<li><a class="reference internal" href="#laying-out" id="id18">Laying&nbsp;out</a></li>
<li><a class="reference internal" href="#extra-stuff" id="id19">Extra&nbsp;stuff</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id20">Conclusion</a></li>
</ul>
</div>
<p><strong>Upgrade 23/05/2018</strong> I&#8217;ve upgraded the sample project (<a class="reference external" href="https://github.com/spapas/django-pdf-guide">https://github.com/spapas/django-pdf-guide</a>) for usage with Django 2.0 and Python 3.x.
There were very few changes between the old, Django 1.8 compatible project and the new one. To see the differences, you can just clone it
and do a <tt class="docutils literal">git diff <span class="pre">django-1.8</span> <span class="pre">django-2.0</span></tt>: Most are related to changes between django 1.8 and django 2.0 (in the <span class="caps">URL</span> configuration use <tt class="docutils literal">path</tt> instead of <tt class="docutils literal">url</tt>,
use new style middleware etc) and between python 2.7 and 3.x (small changes in import syntax, <tt class="docutils literal">StringIO</tt> has been moved to the <tt class="docutils literal">io</tt> package). There&#8217;s also
a couple of requirement upgrades, the most important are the upgrade to <tt class="docutils literal">xhtml2pdf 0.2.2</tt> and using my own fork of <tt class="docutils literal">django_xhtml2pdf</tt> since django_xhtml2pdf
does not seem to be maintained&nbsp;anymore.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id4">Introduction</a></h2>
<p>I&#8217;ve noticed that although it is easy to create PDFs with
Python, there&#8217;s no complete guide on how to
integrate these tools with Django and resolve the problems
that you&#8217;ll encounter when trying to actually create PDFs
from your Django web&nbsp;application.</p>
<p>In this article I will present the solution I use for
creating PDFs with Django, along with various tips on how to
solve most of your common requirements. Specifically, here
are some things that we&#8217;ll&nbsp;cover:</p>
<ul class="simple">
<li>Learn how to create PDFs &#8220;by&nbsp;hand&#8221;</li>
<li>Create PDFs with Django using a normal Djang Template (similar to an <span class="caps">HTML</span>&nbsp;page)</li>
<li>Change the fonts of your&nbsp;PDFs</li>
<li>Use styling in your&nbsp;output</li>
<li>Create&nbsp;layouts</li>
<li>Embed images to your&nbsp;PDFs</li>
<li>Add page&nbsp;numbers</li>
<li>Merge (concatenate)&nbsp;PDFs</li>
</ul>
</div>
<div class="section" id="the-players">
<h2><a class="toc-backref" href="#id5">The&nbsp;players</a></h2>
<p>We are going to use the following main&nbsp;tools:</p>
<ul class="simple">
<li><a class="reference external" href="https://bitbucket.org/rptlab/reportlab">ReportLab</a> is an open source python library for creating PDFs. It uses a low-level <span class="caps">API</span> that allows &#8220;drawing&#8221; strings on specific coordinates  on the <span class="caps">PDF</span> - for people familiar with creating PDFs in Java it is more or less <a class="reference external" href="http://itextpdf.com/">iText</a> for&nbsp;python.</li>
<li><a class="reference external" href="https://github.com/chrisglass/xhtml2pdf">xhtml2pdf</a> (formerly named <em>pisa</em>) is an open source library that can convert <span class="caps">HTML</span>/<span class="caps">CSS</span> pages to <span class="caps">PDF</span> using&nbsp;ReportLab.</li>
<li><a class="reference external" href="https://github.com/chrisglass/django-xhtml2pdf">django-xhtml2pdf</a> is a wrapper around xhtml2pdf that makes integration with Django&nbsp;easier.</li>
<li><a class="reference external" href="https://github.com/mstamy2/PyPDF2">PyPDF2</a> is an open source tool of that can split, merge and transform pages of <span class="caps">PDF</span>&nbsp;files.</li>
</ul>
<p>I&#8217;ve created a <a class="reference external" href="https://github.com/spapas/django-pdf-guide">django project</a> <a class="reference external" href="https://github.com/spapas/django-pdf-guide">https://github.com/spapas/django-pdf-guide</a> with everything covered here. Please clone it,
install its requirements and play with it to see how everything works&nbsp;!</p>
<p>Before integrating the above tools to a Django project, I&#8217;d like to describe them individually a bit more. Any files
I mention below will be included in this&nbsp;project.</p>
<div class="section" id="reportlab">
<h3><a class="toc-backref" href="#id6">ReportLab</a></h3>
<p>ReportLab offers a really low <span class="caps">API</span> for creating PDFs. It is something like having a <tt class="docutils literal">canvas.drawString()</tt> method (for
people familiar with drawing APIs) for your <span class="caps">PDF</span> page. Let&#8217;s take a look at an example, creating a <span class="caps">PDF</span> with a simple&nbsp;string:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">reportlab.pdfgen</span> <span class="kn">import</span> <span class="n">canvas</span>
<span class="kn">import</span> <span class="nn">reportlab.rl_config</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">reportlab</span><span class="o">.</span><span class="n">rl_config</span><span class="o">.</span><span class="n">warnOnMissingFontGlyphs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="s2">&quot;./hello1.pdf&quot;</span><span class="p">,)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
<p>Save the above in a file named testreportlab1.py. If you run python testreportlab1.py (in an environment that has
reportlab of cours) you should see no errors and a pdf named <tt class="docutils literal">hello1.pdf</tt> created. If you open it in your <span class="caps">PDF</span>
reader you&#8217;ll see a blank page with &#8220;Hello World&#8221; written in its lower right&nbsp;corner.</p>
<p>If you try to add a unicode text, for example &#8220;Καλημέρα ελλάδα&#8221;, you should see something like the&nbsp;following:</p>
<img alt="Hello PDF" src="/images/hellopdf2.png" style="width: 280px;" />
<p>It seems that the default font that ReportLab uses does not have a good support for accented greek characters
since they are missing  (and probably for various other&nbsp;characters).</p>
<p>To resolve this, we could try changing the font to one that contains the missing symbols. You can find free
fonts on the internet (for example the <cite>DejaVu</cite> font), or even grab one from your system fonts (in windows,
check out <tt class="docutils literal"><span class="pre">c:\windows\fonts\</span></tt>). In any case, just copy the ttf file of your font inside the folder of
your project and crate a file named testreportlab2.py with the following (I am using the DejaVuSans&nbsp;font):</p>
<div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">reportlab.rl_config</span>
<span class="kn">from</span> <span class="nn">reportlab.pdfbase</span> <span class="kn">import</span> <span class="n">pdfmetrics</span>
<span class="kn">from</span> <span class="nn">reportlab.pdfbase.ttfonts</span> <span class="kn">import</span> <span class="n">TTFont</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="s2">&quot;./hello2.pdf&quot;</span><span class="p">,)</span>
    <span class="n">reportlab</span><span class="o">.</span><span class="n">rl_config</span><span class="o">.</span><span class="n">warnOnMissingFontGlyphs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pdfmetrics</span><span class="o">.</span><span class="n">registerFont</span><span class="p">(</span><span class="n">TTFont</span><span class="p">(</span><span class="s1">&#39;DejaVuSans&#39;</span><span class="p">,</span> <span class="s1">&#39;DejaVuSans.ttf&#39;</span><span class="p">))</span>

    <span class="n">c</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s1">&#39;DejaVuSans&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Καλημέρα ελλάδα.&quot;</span><span class="p">)</span>

    <span class="n">c</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
<p>The above was just a scratch on the surface of ReportLab, mainly to be confident that
everything <em>will</em> work fine for non-english speaking people! To find out more, you should check the  <a class="reference external" href="http://www.reportlab.com/docs/reportlab-userguide.pdf">ReportLab open-source User Guide</a>.</p>
<p>I also have to mention that
<a class="reference external" href="http://reportlab.com/">the company behind ReportLab</a> offers some great commercial solutions based on ReportLab for creating PDFs (similar to <a class="reference external" href="http://community.jaspersoft.com/project/jasperreports-library">JasperReports</a>) - check it out
if you need support or advanced&nbsp;capabilities.</p>
</div>
<div class="section" id="xhtml2pdf">
<h3><a class="toc-backref" href="#id7">xhtml2pdf</a></h3>
<p>The xhtml2pdf is a really great library that allows you to use html files as a template
to a <span class="caps">PDF</span>. Of course, an html cannot always be converted to a <span class="caps">PDF</span> since,
unfortunately, PDFs <em>do</em> have&nbsp;pages.</p>
<p>xhtml2pdf has a nice executable script that can be used to test its capabilities. After
you install it (either globally or to a virtual environment) you should be able to find
out the executable <tt class="docutils literal">$<span class="caps">PYTHON</span>/scripts/xhtml2pdf</tt> (or <tt class="docutils literal">xhtml2pdf.exe</tt> if you are in
Windows) and a corresponding python script &#64; <tt class="docutils literal"><span class="pre">$<span class="caps">PYTHON</span>/scripts/xhtml2pdf-script.py</span></tt>.</p>
<p>Let&#8217;s try to use xhtml2pdf to explore some of its capabilities. Create a file named
testxhtml2pdf.html with the following contents and run <tt class="docutils literal">xhtml2pdf testxhtml2pdf.html</tt>:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Testing xhtml2pdf <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">i</span><span class="p">&gt;</span>Hello, italics<span class="p">&lt;/</span><span class="nt">i</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Καλημέρα Ελλάδα!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nulla erat, porttitor ut venenatis eget,
    tempor et purus. Nullam nec erat vel enim euismod auctor et at nisl. Integer posuere bibendum condimentum. Ut
    euismod velit ut porttitor condimentum. In ullamcorper nulla at lectus fermentum aliquam. Nunc elementum commodo
    dui, id pulvinar ex viverra id. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos
    himenaeos.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Interdum et malesuada fames ac ante ipsum primis in faucibus. Sed aliquam vitae lectus sit amet accumsan. Morbi
    nibh urna, condimentum nec volutpat at, lobortis sit amet odio. Etiam quis neque interdum sapien cursus ornare. Cras
    commodo lacinia sapien nec porta. Suspendisse potenti. Nulla hendrerit dolor et rutrum consectetur.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span>  <span class="na">width</span><span class="o">=</span><span class="s">&quot;26&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;20&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;data:image/gif;base64,R0lGODlhEAAOALMAAOazToeHh0tLS/7LZv/0jvb29t/f3//Ub//ge8WSLf/</span>
<span class="s">    rhf/3kdbW1mxsbP//mf///yH5BAAAAAAALAAAAAAQAA4AAARe8L1Ekyky67QZ1hLnjM5UUde0ECwLJoExKcppV0aCcGCmTIHEIUEqjgaORCMxIC6e0C</span>
<span class="s">    cguWw6aFjsVMkkIr7g77ZKPJjPZqIyd7sJAgVGoEGv2xsBxqNgYPj/gAwXEQA7&quot;</span>  <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header0<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header1<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header2<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header3<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header4<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>header5<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>Hello World!!!<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Please notice the <tt class="docutils literal">&lt;meta <span class="pre">http-equiv=&quot;Content-Type&quot;</span> <span class="pre">content=&quot;text/html;</span> <span class="pre">charset=utf-8&quot;</span> /&gt;</tt> in the above <span class="caps">HTML</span> &#8212; also it is saved as
Unicode (Encoding - Covert to <span class="caps">UTF</span>-8 in Notepad++). The result (<tt class="docutils literal">testxhtml2pdf.pdf</tt>) should&nbsp;have:</p>
<ul class="simple">
<li>A nice header&nbsp;(h1)</li>
<li>Paragraphs</li>
<li>Horizontal&nbsp;lines</li>
<li>No support for greek characters (same problem as with&nbsp;reportlab)</li>
<li>Images (I am inlining it as a base 64&nbsp;image)</li>
<li>A&nbsp;list</li>
<li>A&nbsp;table</li>
</ul>
<p>Before moving on, I&#8217;d like to fix the problem with the greek characters. You should
set the font to one supporting greek characters, just like you did with ReportLab before.
This can be done with the help of the <tt class="docutils literal"><span class="pre">&#64;font-face</span></tt> <a class="reference external" href="https://github.com/xhtml2pdf/xhtml2pdf/blob/master/doc/usage.rst#fonts">css directive</a>. So, let&#8217;s create
a file named <tt class="docutils literal">testxhtml2pdf2.html</tt> with the following&nbsp;contents:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>

    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="p">@</span><span class="k">font-face</span> <span class="p">{</span>
            <span class="nt">font-family</span><span class="o">:</span> <span class="nt">DejaVuSans</span><span class="o">;</span>
            <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="s2">&quot;c:/progr/py/django-pdf-guide/django_pdf_guide/DejaVuSans.ttf&quot;</span><span class="o">);</span>
        <span class="p">}</span>

        <span class="nt">body</span> <span class="p">{</span>
            <span class="k">font-family</span><span class="p">:</span> <span class="n">DejaVuSans</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Δοκιμή του xhtml2pdf <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Καλημέρα Ελλάδα!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Before running <tt class="docutils literal">xhtml2pdf testxhtml2pdf2.html</tt>, please make
sure to change the url of the font file above to the absolute path of that font in your
local system . As a result, after running xhhtml2pdf
you
should see the unicode characters without&nbsp;problems.</p>
<p>I have to mention here that I wasn&#8217;t able to use the font from a relative path, that&#8217;s
why I used the absolute one. In case something is not right, try
running it with the <tt class="docutils literal"><span class="pre">-d</span></tt> option to output debugging information (something like
<tt class="docutils literal">xhtml2pdf <span class="pre">-d</span> testxhtml2pdf2.html</tt>). You must see a line like this&nbsp;one:</p>
<pre class="code literal-block">
DEBUG [xhtml2pdf] C:\progr\py\django-pdf-guide\venv\lib\site-packages\xhtml2pdf\context.py line 857: Load font 'c:\\progr\\py\\django-pdf-guide\\django_pdf_guide\\DejaVuSans.ttf'
</pre>
<p>to make sure that the font is actually&nbsp;loaded!</p>
</div>
<div class="section" id="pypdf2">
<h3><a class="toc-backref" href="#id8">PyPDF2</a></h3>
<p>The PyPDF2 library can be used to extract pages from a <span class="caps">PDF</span> to a new one
or combine pages from different PDFs to a a new one. A common requirement is
to have the first and page of a report as static PDFs, create the contents
of this report through your app as a <span class="caps">PDF</span> and combine all three PDFs (front page,
content and back page) to the resulting <span class="caps">PDF</span>.</p>
<p>Let&#8217;s see a quick example of combining two&nbsp;PDFs:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PyPDF2</span> <span class="kn">import</span> <span class="n">PdfFileMerger</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">pdfs</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pdfs</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdfs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Please enter at least two pdfs for merging!&quot;</span><span class="p">)</span>

    <span class="n">merger</span> <span class="o">=</span> <span class="n">PdfFileMerger</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">pdf</span> <span class="ow">in</span> <span class="n">pdfs</span><span class="p">:</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
    <span class="n">merger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
<p>The above will try to open all input parameters (as files) and append them to a the&nbsp;output.pdf.</p>
</div>
</div>
<div class="section" id="django-integration">
<h2><a class="toc-backref" href="#id9">Django&nbsp;integration</a></h2>
<p>To integrate the <span class="caps">PDF</span> creation process with django we&#8217;ll use a simple app with only one model about books. We are
going to use the django-xhtml2pdf library &#8212; I recommend installing the latest version (from github
using something like <tt class="docutils literal">pip install <span class="pre">-e</span> <span class="pre">git+https://github.com/chrisglass/django-xhtml2pdf.git#egg=django-xhtml2pdf</span></tt>
) since the pip package has not been updated in a long&nbsp;time!</p>
<div class="section" id="using-a-plain-old-view">
<h3><a class="toc-backref" href="#id10">Using a plain old&nbsp;view</a></h3>
<p>The simplest case is to just create plain old view to display the <span class="caps">PDF</span>. We&#8217;ll use django-xhtml2pdf along with the
followig django&nbsp;template:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Books<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% for book in books %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ book.id }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ book.title }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Name it as <tt class="docutils literal">books_plain_old_view.html</tt> and put it on <tt class="docutils literal">books/templates</tt> directory. The view that
returns the above template as <span class="caps">PDF</span> is the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django_xhtml2pdf.utils</span> <span class="kn">import</span> <span class="n">generate_pdf</span>


<span class="k">def</span> <span class="nf">books_plain_old_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;books&#39;</span><span class="p">:</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">generate_pdf</span><span class="p">(</span><span class="s1">&#39;books_plain_old_view.html&#39;</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>We just use the <tt class="docutils literal">generate_pdf</tt> method of django-xhtml2pdf to help us generate the <span class="caps">PDF</span>, passing it
our response object and a context dictionary (containing all&nbsp;books).</p>
<p>Instead of the simple <span class="caps">HTTP</span> response above, we could add a &#8216;Content Disposition&#8217; <span class="caps">HTTP</span> header to
our response
(or use the django-xhtml2pdf method <tt class="docutils literal">render_to_pdf_response</tt> instead of <tt class="docutils literal">generate_pdf</tt>)
to suggest a default filename for the file to be saved by adding the&nbsp;line</p>
<pre class="code literal-block">
resp['Content-Disposition'] = 'attachment; filename=&quot;output.pdf&quot;'
</pre>
<p>after the definition of <tt class="docutils literal">resp</tt>.</p>
<p>This will have the extra effect, at least in Chrome and Firefox to show the &#8220;Save File&#8221; dialog
when clicking on the link instead of retrieving the <span class="caps">PDF</span> and displaying it inside* the browser&nbsp;window.</p>
</div>
<div class="section" id="using-a-cbv">
<h3><a class="toc-backref" href="#id11">Using a <span class="caps">CBV</span></a></h3>
<p>I don&#8217;t really recommend using plain old Django views - instead I propose to always use Class Based Views
for their DRYness. The best approach is to create a mixin that would allow any kind of <span class="caps">CBV</span> (at least any
kind of <span class="caps">CBV</span> that uses a template) to be rendered in <span class="caps">PDF</span>. Here&#8217;s how we could implement a <tt class="docutils literal">PdfResponseMixin</tt>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PdfResponseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generate_pdf</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>Now, we could use this mixin to create <span class="caps">PDF</span> outputting views from any other view! For example, here&#8217;s how
we could create a book list in&nbsp;pdf:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookPdfListView</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre></div>
<p>To display it, you could use the same template as <tt class="docutils literal">books_plain_old_view.html</tt> (so either add a <tt class="docutils literal"><span class="pre">template_name='books_plain_old_view.html'</span></tt>
property to the class or copy <tt class="docutils literal">books_plain_old_view.html</tt> to <tt class="docutils literal">books/book_list.html</tt>).</p>
<p>Also, as another example, here&#8217;s a <tt class="docutils literal">BookPdfDetailView</tt> that outputs <span class="caps">PDF</span>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookPdfDetailView</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="n">DetailView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;book&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre></div>
<p>and a corresponding template (name it <tt class="docutils literal">books/book_detail.html</tt>):</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Book Detail<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>: <span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span> <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>: <span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span> <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>To add the content-disposition header and a name for your <span class="caps">PDF</span>, you can use the following&nbsp;mixin:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PdfResponseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">pdf_name</span> <span class="o">=</span> <span class="s2">&quot;output&quot;</span>

    <span class="k">def</span> <span class="nf">get_pdf_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf_name</span>

    <span class="k">def</span> <span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{0}</span><span class="s1">.pdf&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pdf_name</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">generate_pdf</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">resp</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>You see that, in order to havea configurable output name for our <span class="caps">PDF</span> and be consistent with the other
django CBVs, a <tt class="docutils literal">pdf_name</tt> class attribute and a <tt class="docutils literal">get_pdf_name</tt> instance method are added. When
using the above mixin in your classes you can either provide a value for <tt class="docutils literal">pdf_name</tt> (to use the same for all
your instances), or override <tt class="docutils literal">get_pdf_name</tt> to have a dynamic&nbsp;value!</p>
</div>
<div class="section" id="how-does-django-xhtml2pdf-loads-resources">
<h3><a class="toc-backref" href="#id12">How does django-xhtml2pdf loads&nbsp;resources</a></h3>
<p>Before doing more advanced things, we need to understand how <tt class="docutils literal"><span class="pre">django-xhtml2pdf</span></tt> works and specifically
how we can refer to things like css, images, fonts etc from our <span class="caps">PDF</span> templates.
If you check the <a class="reference external" href="https://github.com/chrisglass/django-xhtml2pdf/blob/master/django_xhtml2pdf/utils.py">utils.py of django-xhtml2pdf</a> you&#8217;ll see that it uses a function named <tt class="docutils literal">fetch_resources</tt>
for loading these resources. This function checks to see if the resource starts with <tt class="docutils literal">/MEDIA_URL</tt> or
<tt class="docutils literal">/STATIC_URL</tt> and converts it to a local (filesystem) path. For example, if you refer to a font like
<tt class="docutils literal">/static/font1.ttf</tt> in your <span class="caps">PDF</span> template, <tt class="docutils literal">xhtml2pdf</tt> will try to load the file <tt class="docutils literal">STATIC_ROOT + /font1.ttf</tt>
(and if it does not find the file you want to refer to there it will check all <tt class="docutils literal">STATICFILES_DIRS</tt> entries).</p>
<p>Thus, you can just put your resources into your <tt class="docutils literal">STATIC_ROOT</tt> directory and use the <tt class="docutils literal">{% static %}</tt>
template tag to create <span class="caps">URL</span> paths for them &#8212; django-xhtml2pdf will convert these to local paths and
everything will work&nbsp;fine.</p>
<p><strong>Please notice that you *need* to have configured &#8220;STATIC_ROOT&#8220; for this to work</strong> &#8212; if <tt class="docutils literal">STATIC_ROOT</tt> is
empty (and, for example you use <tt class="docutils literal">static</tt> directories in your apps) then the described substitution
mechanism will <em>not</em> work. Also, notice that the <tt class="docutils literal">/static</tt> directory inside your apps <em>cannot be used</em>
for fetch resources like this
(due to how <tt class="docutils literal">fetch_resources</tt> is implemented it only checks if the static resource is contained inside
the <tt class="docutils literal">STATIC_ROOT</tt> or in one of the the <tt class="docutils literal">STATICFILES_DIRS</tt>) so be careful to either put the static files
you need to load from PDFs (fonts, styles and possibly images) to either the <tt class="docutils literal">STATIC_ROOT</tt> or the
one of the <tt class="docutils literal">STATICFILES_DIRS</tt>.</p>
</div>
<div class="section" id="using-a-common-style-for-your-pdfs">
<h3><a class="toc-backref" href="#id13">Using a common style for your&nbsp;PDFs</a></h3>
<p>If you need to create a lot of similar PDFs then you&#8217;ll probably want to
use a bunch of common styles for them (same fonts, headers etc). This could be done using
the <tt class="docutils literal">{% static %}</tt> trick we saw on the previous section. However, if we include the
styling css as a static file then we won&#8217;t be able to use the static-file-uri-to-local-path
mechanism described above (since the <tt class="docutils literal">{% static %}</tt> template tag won&#8217;t work in static&nbsp;files).</p>
<p>Thankfully, not everything is lost &#8212; Django comes to the rescue!!! We can create a single <span class="caps">CSS</span> file
that would be used by all our <span class="caps">PDF</span> templates and <em>include</em> it in the templates using the <tt class="docutils literal">{% include %}</tt> Django
template tag! Django will think that this will be a normal template and paste its contents where we wanted and
also execute the templates&nbsp;tags!</p>
<p>We&#8217;ll see an example of all this in the next&nbsp;section.</p>
</div>
<div class="section" id="changing-the-font-to-a-unicode-enabled-one">
<h3><a class="toc-backref" href="#id14">Changing the font (to a Unicode enabled&nbsp;one)</a></h3>
<p>The time has finally arrived to change the font! It&#8217;s easy if you know exactly what to do. First of all
configure your <tt class="docutils literal">STATIC_ROOT</tt> and <tt class="docutils literal">STATIC_URL</tt> setting, for example <tt class="docutils literal">STATIC_ROOT = <span class="pre">os.path.join(BASE_DIR,'static')</span></tt>
and <tt class="docutils literal">STATIC_URL = '/static/'</tt>.</p>
<p>Then, add a template-css file for your fonts in one of your templates directories. I am naming the
file <tt class="docutils literal">pdfstylefonts.css</tt> and I&#8217;ve put it to <tt class="docutils literal">books/templates</tt>:</p>
<div class="highlight"><pre><span></span><span class="p">{</span><span class="err">%</span> <span class="err">load</span> <span class="err">static</span> <span class="err">%</span><span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span> <span class="p">{</span>
    <span class="nt">font-family</span><span class="o">:</span> <span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
    <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span> <span class="err">static</span> <span class="err">&quot;fonts/calibri.ttf&quot;</span> <span class="err">%</span><span class="p">}</span><span class="o">);</span>
<span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span> <span class="p">{</span>
    <span class="nt">font-family</span><span class="o">:</span> <span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
    <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span> <span class="err">static</span> <span class="err">&quot;fonts/calibrib.ttf&quot;</span> <span class="err">%</span><span class="p">}</span><span class="o">);</span>
    <span class="nt">font-weight</span><span class="o">:</span> <span class="nt">bold</span><span class="o">;</span>
<span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span> <span class="p">{</span>
    <span class="nt">font-family</span><span class="o">:</span> <span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
    <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span> <span class="err">static</span> <span class="err">&quot;fonts/calibrii.ttf&quot;</span> <span class="err">%</span><span class="p">}</span><span class="o">);</span>
    <span class="nt">font-style</span><span class="o">:</span> <span class="nt">italic</span><span class="o">,</span> <span class="nt">oblique</span><span class="o">;</span>
<span class="p">}</span>
<span class="p">@</span><span class="k">font-face</span> <span class="p">{</span>
    <span class="nt">font-family</span><span class="o">:</span> <span class="s2">&quot;Calibri&quot;</span><span class="o">;</span>
    <span class="nt">src</span><span class="o">:</span> <span class="nt">url</span><span class="o">(</span><span class="p">{</span><span class="err">%</span> <span class="err">static</span> <span class="err">&quot;fonts/calibriz.ttf&quot;</span> <span class="err">%</span><span class="p">}</span><span class="o">);</span>
    <span class="nt">font-weight</span><span class="o">:</span> <span class="nt">bold</span><span class="o">;</span>
    <span class="nt">font-style</span><span class="o">:</span> <span class="nt">italic</span><span class="o">,</span> <span class="nt">oblique</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
<p>I am using Calibri family of fonts (copied from <tt class="docutils literal"><span class="pre">c:\windows\fonts</span></tt>) for this &#8212; I&#8217;ve also configured
all styles (bold, italic, bold-italic) of this font family to use the correct ttf files. All the
ttf files have been copied to the directory <tt class="docutils literal">static/fonts/</tt>.</p>
<p>Now, add another css file that will be your global <span class="caps">PDF</span> styles. This should be put to the <tt class="docutils literal">static</tt> directory
and could be named <tt class="docutils literal">pdfstyle.css</tt>:</p>
<div class="highlight"><pre><span></span><span class="nt">h1</span> <span class="p">{</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">blue</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">*,</span> <span class="nt">html</span> <span class="p">{</span>
    <span class="k">font-family</span><span class="p">:</span> <span class="s2">&quot;Calibri&quot;</span><span class="p">;</span>
    <span class="k">font-size</span><span class="p">:</span><span class="mi">11</span><span class="kt">pt</span><span class="p">;</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">red</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>Next, here&#8217;s a template that lists all books (and contain some greek characters &#8212; the title of the books also contain
greek characters) &#8212; I&#8217;ve named it <tt class="docutils literal">book_list_ex.html</tt>:</p>
<div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;pdfstylefonts.css&quot;</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s2">&quot;pdfstyle.css&quot;</span> <span class="cp">%}</span><span class="s">&#39;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Λίστα βιβλίων<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{%</span> <span class="k">static</span> <span class="s2">&quot;pony.png&quot;</span> <span class="cp">%}</span><span class="s">&#39;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>ID<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Cover<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="k">in</span> <span class="nv">books</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">book.cover.url</span> <span class="cp">}}</span><span class="s">&#39;</span> <span class="p">/&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>You&#8217;ll see that the <tt class="docutils literal">pdfstylefonts.css</tt> is included as a Django template (so that <tt class="docutils literal">{% static %}</tt> will
work in that file) while <tt class="docutils literal">pdfstyle.css</tt> is included using <tt class="docutils literal">{% static %}</tt>.
Als, notice that I&#8217;ve also added a static image (using the <tt class="docutils literal">{% static %}</tt> tag) and a dynamic (media)
file to show off how great the url-to-local-path mechanism works. Please notice that for the
media files to work fine in your development environment you need to configure the
<tt class="docutils literal">MEDIA_URL</tt> and <tt class="docutils literal">MEDIA_ROOT</tt> settigns (similar to <tt class="docutils literal">STATIC_URL</tt> and <tt class="docutils literal">STATIC_ROOT</tt>) and follow the
<a class="reference external" href="https://docs.djangoproject.com/en/1.8/howto/static-files/#serving-files-uploaded-by-a-user-during-development">serve files uploaded by a user during development</a> tutorial on Django&nbsp;docs.</p>
<p>Finally, if you configure a PdfResponseMixin ListView like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookExPdfListView</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;books&#39;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;books/book_list_ex.html&#39;</span>
</pre></div>
<p>you should see be able to see the correct (calibri) font (defined in <tt class="docutils literal">pdfstylefonts.css</tt>), with unicode characters without problems
including both the static and user uploaded images and with the styles defined in the pdf stylesheet (<tt class="docutils literal">pdfstyle.css</tt>).</p>
</div>
<div class="section" id="configure-django-for-debugging-pdf-creation">
<h3><a class="toc-backref" href="#id15">Configure Django for debugging <span class="caps">PDF</span>&nbsp;creation</a></h3>
<p>If you experience any problems, you can configure xhtml2pdf to output <span class="caps">DEBUG</span> information. To do this,
you may change your django logging configuration like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;xhtml2pdf&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>This configuration will keep existing loggers (<tt class="docutils literal">'disable_existing_loggers': False,</tt>) and will configure
<tt class="docutils literal">xhtml2pdf</tt> to log its output to the console, helping us find out why some things won&#8217;t be&nbsp;working.</p>
</div>
<div class="section" id="concatenating-pdfs-in-django">
<h3><a class="toc-backref" href="#id16">Concatenating PDFs in&nbsp;Django</a></h3>
<p>The final section of the <span class="caps">PDF</span>-Django-integration is to explain how we can concatenate PDFs in django using PyPDF2. There may be
some other requirements like extracting pages from PDFs however the most common one as explained before is to just append
the pages of one <span class="caps">PDF</span> after the other &#8212; after all using PyPDF2 is really easy after you get the hang of&nbsp;it.</p>
<p>To be more <span class="caps">DRY</span>, I will create a <tt class="docutils literal">CoverPdfResponseMixin</tt> that will output a <span class="caps">PDF</span> <em>with</em> a cover. To be <em>even more</em> <span class="caps">DRY</span>,
I will refactor <tt class="docutils literal">PdfResponseMixin</tt> to put some common code in an extra method so that <tt class="docutils literal">CoverPdfResponseMixin</tt> could inherit from&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PdfResponseMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">write_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_object</span><span class="p">,</span> <span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">()</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_template_names</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">generate_pdf</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">file_object</span><span class="o">=</span><span class="n">file_object</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_pdf</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>


<span class="k">class</span> <span class="nc">CoverPdfResponseMixin</span><span class="p">(</span><span class="n">PdfResponseMixin</span><span class="p">,</span> <span class="p">):</span>
    <span class="n">cover_pdf</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">render_to_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
        <span class="n">merger</span> <span class="o">=</span> <span class="n">PdfFileMerger</span><span class="p">()</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cover_pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

        <span class="n">pdf_fo</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_pdf</span><span class="p">(</span><span class="n">pdf_fo</span><span class="p">)</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdf_fo</span><span class="p">)</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
        <span class="n">merger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>
</pre></div>
<p>So, <tt class="docutils literal">PdfResponseMixin</tt> now has a <tt class="docutils literal">write_pdf</tt> method that gets a file-like object and outputs the <span class="caps">PDF</span> there.
The new mixin, <tt class="docutils literal">CoverPdfResponseMixin</tt> has a <tt class="docutils literal">cover_pdf</tt> attribute that should be configured with the filesystem
path of the cover file. The <tt class="docutils literal">render_to_response</tt> method now will create a <tt class="docutils literal">PdfFileMerger</tt> (which is empty
initially) to which it appends the contents <tt class="docutils literal">cover_pdf</tt>. After that, it creates a file-stream (using StreamIO)
and uses <tt class="docutils literal">write_pdf</tt> to create the <span class="caps">PDF</span> there and appends that file-stream to the merger. Finally, it writes
the merger contents to the <tt class="docutils literal">HttpResponse</tt>.</p>
<p>One thing that I&#8217;ve seen is that if you want to concatenate many PDFs with many pages sometimes you&#8217;ll get
a strange an error when using <tt class="docutils literal">PdfFileMerger</tt>. I was able to overcome this by reading and appending the pages of each
<span class="caps">PDF</span> to-be-appended one by one using the <tt class="docutils literal">PdfFileReader</tt> and <tt class="docutils literal">PdfFileWriter</tt> objects. Here&#8217;s a small snippet of how
this could be&nbsp;done:</p>
<div class="highlight"><pre><span></span><span class="n">pdfs</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List of pdfs to be concatenated</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">PdfFileWriter</span><span class="p">()</span>

<span class="k">for</span> <span class="n">pdf</span> <span class="ow">in</span> <span class="n">pdfs</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">PdfFileReader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">getNumPages</span><span class="p">()):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">addPage</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
<span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
</div>
<div class="section" id="more-advanced-xhtml2pdf-features">
<h2><a class="toc-backref" href="#id17">More advanced xhtml2pdf&nbsp;features</a></h2>
<p>In this section I will present some information on how to use various xhtml2pdf features
to create the most common required printed document features, for example adding page
numbers, adding headers and footers&nbsp;etc.</p>
<div class="section" id="laying-out">
<h3><a class="toc-backref" href="#id18">Laying&nbsp;out</a></h3>
<p>To find out how you can create your pages you should read the
<a class="reference external" href="https://github.com/xhtml2pdf/xhtml2pdf/blob/master/doc/usage.rst#defining-page-layouts">defining page layouts</a> section of the xhtml2pdf manual. There
you&#8217;ll see that the basic components of laying out in xhtml2pdf is
&#64;page to create pages and &#64;frames to create rectangular components
inside these pages. So each page will have a number of frames
inside it. These frames are seperated to static and dynamic. Staticsome
should be used for things like headers
and footers (so they&#8217;ll be the same across all pages) and dynamic will
contain the main content of the&nbsp;report.</p>
<p>For pages you can use any page size you want, not just the specified ones. For example, in one of my
projects I wanted to create a <span class="caps">PDF</span> print on a normal plastic card, so I&#8217;d used the
following <tt class="docutils literal">size: 8.56cm 5.398cm;</tt>. Also, page templates can be named
and you can use different ones in the same <span class="caps">PDF</span> (so you could create
a cover page with a different page template, use it first and then continue
with the normal pages). To name a tempalte you just use &#64;page template_name {}
and to change the template use the combination of the following two xhtml2pdf&nbsp;tags:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">pdf:nexttemplate</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;back_page&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">pdf:nextpage</span> <span class="p">/&gt;</span>
</pre></div>
<p>Now, one thing I&#8217;ve noticed is that you are not able to use a named template for the first
page of your <span class="caps">PDF</span>. So, what I&#8217;ve done is that I create an anonymous (default) page for the
first page of the report. If I want to <em>reuse</em> it in another page, I copy it and name it
accordingly. I will give an example&nbsp;shortly.</p>
<p>Now, for frames, I recommend using the <tt class="docutils literal"><span class="pre">-pdf-frame-border:</span> 1;</tt> command for debugging where
they are actually printed. Also, I recommend using a normal ruler and measuring completely
where you want them to be. For example, for the following&nbsp;frame:</p>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="k">frame</span> <span class="nt">photo_frame</span> <span class="p">{</span>
        <span class="nt">-pdf-frame-border</span><span class="o">:</span> <span class="nt">1</span><span class="o">;</span>
        <span class="nt">top</span><span class="o">:</span>  <span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
        <span class="nt">left</span><span class="o">:</span> <span class="nt">6</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
        <span class="nt">width</span><span class="o">:</span> <span class="nt">1</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
        <span class="nt">height</span><span class="o">:</span> <span class="nt">2</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
<p>I&#8217;d used a ruler to find out that I want it to start 2.4 cm from the top of my page (actually a credit card)
and 6.2 cm from the left and have a width and height of 1.9 and 2.2&nbsp;cm.</p>
<p>I recommend naming all frames to be able to distinguish them however I don&#8217;t think that their name plays
any other role. However, for static frames you must define the id of the content they will contain using <tt class="docutils literal"><span class="pre">-pdf-frame-content</span></tt>
in the css and a div with the corresponding id in the <span class="caps">PDF</span> template. For example, you could define a frame header like&nbsp;this</p>
<div class="highlight"><pre><span></span><span class="p">@</span><span class="k">frame</span> <span class="nt">header</span> <span class="p">{</span>
  <span class="nt">-pdf-frame-content</span><span class="o">:</span> <span class="nt">headerContent</span><span class="o">;</span>
  <span class="nt">width</span><span class="o">:</span> <span class="nt">8in</span><span class="o">;</span>
  <span class="nt">top</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
  <span class="nt">margin-left</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
  <span class="nt">margin-right</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
  <span class="nt">height</span><span class="o">:</span> <span class="nt">2cm</span><span class="o">;</span>
<span class="p">}</span>
</pre></div>
<p>and its content like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;headerContent&#39;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span> <span class="p">&gt;</span>
    Header !
  <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>Please notice that if for some reason the stuff you want to put in your static frames does not fit there the frame will
be totally empty. This means that if you have size for three lines but you want to output five lines in a static frame
then you&#8217;ll see no&nbsp;lines!</p>
<p>Now, for dynamic content you can expect the opposite behavior:
You <em>cannot</em> select to which dynamic frame your content goes, instead the content just just flows to the first dynamic frame it
fits! If it does not fit in any dynamic frames in the current page then a new page will be&nbsp;created.</p>
<p>I&#8217;d like to present a full example here on the already mentioned project of printing a plastic card for the books. I had two page layouts,
one for the front page having a frame with the owner&#8217;s data and another frame with his photo and one for the back page having
a barcode. This is a Django template that is used to print not only but a <span class="caps">PDF</span> with a group of these&nbsp;cards:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;pdfstylefonts.css&quot;</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;text/css&#39;</span><span class="p">&gt;</span>
    <span class="p">@</span><span class="k">page</span> <span class="p">{</span>
        <span class="nt">size</span><span class="o">:</span> <span class="nt">8</span><span class="p">.</span><span class="nc">56cm</span> <span class="nt">5</span><span class="p">.</span><span class="nc">398cm</span><span class="o">;</span>
        <span class="nt">margin</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="o">;</span>
        <span class="nt">padding</span><span class="o">:</span> <span class="nt">0</span><span class="o">;</span>

        <span class="p">@</span><span class="k">frame</span> <span class="nt">table_frame</span> <span class="p">{</span>
            <span class="c">/* -pdf-frame-border: 1; */</span>
            <span class="nt">top</span><span class="o">:</span>  <span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
            <span class="nt">left</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
            <span class="nt">width</span><span class="o">:</span> <span class="nt">5</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
            <span class="nt">height</span><span class="o">:</span> <span class="nt">3cm</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="p">@</span><span class="k">frame</span> <span class="nt">photo_frame</span> <span class="p">{</span>
            <span class="c">/* -pdf-frame-border: 1; */</span>
            <span class="nt">top</span><span class="o">:</span>  <span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
            <span class="nt">left</span><span class="o">:</span> <span class="nt">6</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
            <span class="nt">width</span><span class="o">:</span> <span class="nt">1</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
            <span class="nt">height</span><span class="o">:</span> <span class="nt">2</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="k">page</span> <span class="nt">front_page</span> <span class="p">{</span>
        <span class="nt">size</span><span class="o">:</span> <span class="nt">8</span><span class="p">.</span><span class="nc">56cm</span> <span class="nt">5</span><span class="p">.</span><span class="nc">398cm</span><span class="o">;</span>
        <span class="nt">margin</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="o">;</span>
        <span class="nt">padding</span><span class="o">:</span> <span class="nt">0</span><span class="o">;</span>

        <span class="p">@</span><span class="k">frame</span> <span class="nt">table_frame</span> <span class="p">{</span>
            <span class="c">/* -pdf-frame-border: 1; */</span>
            <span class="nt">top</span><span class="o">:</span>  <span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
            <span class="nt">left</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
            <span class="nt">width</span><span class="o">:</span> <span class="nt">5</span><span class="p">.</span><span class="nc">5cm</span><span class="o">;</span>
            <span class="nt">height</span><span class="o">:</span> <span class="nt">3cm</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="p">@</span><span class="k">frame</span> <span class="nt">photo_frame</span> <span class="p">{</span>
            <span class="c">/* -pdf-frame-border: 1; */</span>
            <span class="nt">top</span><span class="o">:</span>  <span class="nt">2</span><span class="p">.</span><span class="nc">4cm</span><span class="o">;</span>
            <span class="nt">left</span><span class="o">:</span> <span class="nt">6</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
            <span class="nt">width</span><span class="o">:</span> <span class="nt">1</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
            <span class="nt">height</span><span class="o">:</span> <span class="nt">2</span><span class="p">.</span><span class="nc">2cm</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="k">page</span> <span class="nt">back_page</span> <span class="p">{</span>
        <span class="nt">size</span><span class="o">:</span> <span class="nt">8</span><span class="p">.</span><span class="nc">56cm</span> <span class="nt">5</span><span class="p">.</span><span class="nc">398cm</span><span class="o">;</span>
        <span class="nt">margin</span><span class="o">:</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span> <span class="nt">0</span><span class="p">.</span><span class="nc">0cm</span><span class="o">;</span>
        <span class="nt">padding</span><span class="o">:</span> <span class="nt">0</span><span class="o">;</span>

        <span class="p">@</span><span class="k">frame</span> <span class="nt">barcode_frame</span> <span class="p">{</span>
            <span class="c">/* -pdf-frame-border: 1; */</span>
            <span class="nt">top</span><span class="o">:</span>  <span class="nt">3</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
            <span class="nt">left</span><span class="o">:</span> <span class="nt">1</span><span class="p">.</span><span class="nc">8cm</span><span class="o">;</span>
            <span class="nt">width</span><span class="o">:</span> <span class="nt">4</span><span class="p">.</span><span class="nc">9cm</span><span class="o">;</span>
            <span class="nt">height</span><span class="o">:</span> <span class="nt">1</span><span class="p">.</span><span class="nc">1cm</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">*,</span> <span class="nt">html</span> <span class="p">{</span>
        <span class="k">font-family</span><span class="p">:</span> <span class="s2">&quot;Calibri&quot;</span><span class="p">;</span>
        <span class="k">font-size</span><span class="p">:</span> <span class="mi">8</span><span class="kt">pt</span><span class="p">;</span>
        <span class="k">line-height</span><span class="p">:</span> <span class="mi">80</span><span class="kt">%</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">.</span><span class="nc">bigger</span> <span class="p">{</span>
        <span class="k">font-size</span><span class="p">:</span><span class="mi">9</span><span class="kt">pt</span><span class="p">;</span>
        <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">book</span> <span class="k">in</span> <span class="nv">books</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cp">&lt;! -- Here I print the card data. It fits exactly in the table_frame so ... -&gt;</span>
            <span class="cp">{{</span> <span class="nv">book.title</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 2<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 3<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 4<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 5<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 6<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 7<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 8<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 9<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
            Data line 10<span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="cp">&lt;! -- This photo here will be outputted to the photo_frame --&gt;</span>
            <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">book.cover.url</span> <span class="cp">}}</span><span class="s">&#39;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#39;width:1.9cm ; height: 2.2cm ; &#39;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="cp">&lt;! -- Now the template is chaned to print the back of the card --&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nexttemplate</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;back_page&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nextpage</span> <span class="p">/&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">center</span><span class="p">&gt;</span>
                <span class="cp">&lt;! -- Print the barcode to the barcode_frame --&gt;</span>
                <span class="p">&lt;</span><span class="nt">pdf:barcode</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">book.id</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;code128&quot;</span> <span class="na">humanreadable</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">barwidth</span><span class="o">=</span><span class="s">&quot;0.43mm&quot;</span> <span class="na">barheight</span><span class="o">=</span><span class="s">&quot;0.6cm&quot;</span> <span class="na">align</span><span class="o">=</span><span class="s">&quot;middle&quot;</span> <span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="nt">center</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="c">&lt;!-- Use the front_page template again for the next card --&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nexttemplate</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;front_page&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">pdf:nextpage</span> <span class="p">/&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>Notice that I want to print exactly 10 lines in the <tt class="docutils literal">table_frame</tt> (that&#8217;s why I use &lt;br /&gt; to go to next line) &#8212; if I had printed
3-4 lines (for example) then the photo <em>would fit</em> in the <tt class="docutils literal">table_frame</tt> and would be printed there and <em>not</em> in the <tt class="docutils literal">photo_frame</tt>! Also,
another interesting thing is that if I had
outputed 8-9 lines then the photo wouldn&#8217;t fit in that small space and would also be printed to the <tt class="docutils literal">photo_frame</tt>.</p>
</div>
<div class="section" id="extra-stuff">
<h3><a class="toc-backref" href="#id19">Extra&nbsp;stuff</a></h3>
<p>Some extra things I want to mention concerning&nbsp;xhtml2pdf:</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;pdf:pagenumber&gt;</tt> to output the current page number (please end the line after this&nbsp;tag)</li>
<li><tt class="docutils literal">&lt;pdf:pagecount&gt;</tt> to output the total page number (please end the line after this&nbsp;tag)</li>
</ul>
<p>So if you want to print a footer with the pages, I recommend something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;footerContent&#39;</span><span class="p">&gt;</span>
  Page <span class="p">&lt;</span><span class="nt">pdf:pagenumber</span><span class="p">&gt;</span>
  from <span class="p">&lt;</span><span class="nt">pdf:pagecount</span><span class="p">&gt;</span>
  total
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
<p>Notice how the lines end after the&nbsp;tags.</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;pdf:barcode&gt;</tt>: Output a barcode in your <span class="caps">PDF</span>. Here are the possible barcode types: I2of5, Standard39, Extended39, Standard93, Extended93, <span class="caps">MSI</span>, Codabar, Code11, <span class="caps">FIM</span>, <span class="caps">POSTNET</span>, USPS_4State, Code128, <span class="caps">EAN13</span>, <span class="caps">EAN8</span>, <span class="caps">QR</span>.</li>
<li>You may add a page background image using  the <tt class="docutils literal"><span class="pre">background-image</span></tt> property of <tt class="docutils literal">&#64;page</tt>.</li>
</ul>
<p>For example, if you want the templates you create from your development/<span class="caps">UAT</span> systems to be different
than the production ones you could do something like&nbsp;this:</p>
<pre class="code literal-block">
&#64;page {
    {% if DEBUG %}
        background-image: url({% static &quot;debug.png&quot; %});
    {% endif %}
    &lt;!-- Other page properties --&gt;
}
</pre>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id20">Conclusion</a></h2>
<p>I hope that using the techniques described in this essential guide you&#8217;ll
be able to create great looking <span class="caps">PDF</span> documents from your Django application
and overcome any difficulties that may arise. If you feel that there&#8217;s something
I&#8217;ve not covered properly (and is not covered by the documentation) please comment
out and I&#8217;ll be happy to research it a bit and update the article with&nbsp;info.</p>
<p>I am using all the above in various production applications for a long time and everything
is smooth so don&#8217;t afraid to create PDFs from&nbsp;Django!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2015/11/16/using-browserify-es6/">Improve your client-side-javascript workflow more by using ES6</a>
      </h1>
    <p class="meta">
<time datetime="2015-11-16T14:20:00+02:00" pubdate>Δευ 16 Νοέμβριος 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#npm-save-save-dev-and-avoiding-global-deps" id="id2"><span class="caps">NPM</span>, &#8212;save, &#8212;save-dev and avoiding global&nbsp;deps</a></li>
<li><a class="reference internal" href="#using-babel" id="id3">Using&nbsp;babel</a></li>
<li><a class="reference internal" href="#integrate-babel-with-browserify" id="id4">Integrate babel with&nbsp;browserify</a></li>
<li><a class="reference internal" href="#the-object-spread-operator" id="id5">The object-spread&nbsp;operator</a></li>
<li><a class="reference internal" href="#conclusion" id="id6">Conclusion</a></li>
</ul>
</div>
<p><strong>Update 22/12/2015:</strong> Add section for the object-spread&nbsp;operator.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>In a <a class="reference external" href="https://spapas.github.io/2015/05/27/using-browserify-watchify/">previous article</a>
we presented a simple workflow to improve your client-side (javascript) workflow
by including a bunch of tools from the node-js world i.e <a class="reference external" href="http://browserify.org/">browserify</a> and
its friends, <a class="reference external" href="https://github.com/substack/watchify">watchify</a> and <a class="reference external" href="https://www.npmjs.com/package/uglify-js">uglify-js</a>.</p>
<p>Using these tools we were able to properly manage our client side dependencies
(no more script tags in our html templates) and modularize our code
(so we could avoid monolithic javascript files that contained all our code).
Another great improvement to our workflow would be to include <span class="caps">ES6</span> to the&nbsp;mix!</p>
<p><span class="caps">ES6</span> (or EcmaScript 2015) is more or less &#8220;Javascript: <span class="caps">TNG</span>&#8221;. It has many features
that greatly improve the readability and writability of javascript code - for instance,
thick arrows, better classes, better modules, iterators/generators, template strings,
default function parameters and many others!
More info on these features and how they could be used can be found on the <a class="reference external" href="https://github.com/lukehoban/es6features">es6features</a>&nbsp;repository.</p>
<p>Unfortunately, these features are either not supported at all, or they are partially supported
on current (November 2015) browsers. However all is <em>not</em> lost yet: Since we already use browserify
to our client side workflow, we can easily enable it to read source files with <span class="caps">ES6</span> syntax
and transform them to normal javascript using a transformation through the <a class="reference external" href="https://babeljs.io/">babel</a>&nbsp;tool.</p>
<p>In the following, we&#8217;ll talk a bit more about the node-js package manager (npm) features,
talk a little about babel and finally
modify our workflow so that it will be able to use <span class="caps">ES6</span>! Please notice that to properly follow this article
you need to first read the <a class="reference external" href="https://spapas.github.io/2015/05/27/using-browserify-watchify/">previous one</a>.</p>
</div>
<div class="section" id="npm-save-save-dev-and-avoiding-global-deps">
<h2><a class="toc-backref" href="#id2"><span class="caps">NPM</span>, &#8212;save, &#8212;save-dev and avoiding global&nbsp;deps</a></h2>
<p>In the previous article, I had recommended to install the needed tools
(needed to create the output bundle browserify, watchify, uglify) globally
using npm install -g package (of course the normal dependencies like moment.js
would be installed locally).
This has one advantage and two disadvantages: It
puts these tools to the path so they can be called immediately (i.e browserify)
but you will need root access to install a package globally and nothing is
saved on <tt class="docutils literal">package.json</tt> so you don&#8217;t know which packages must be installed
in order to start developing the&nbsp;project!</p>
<p>This could be ok for the introductionary article, however for this one I
will propose another alternative: Install all the tools <em>locally</em> using just
<tt class="docutils literal">npm install package <span class="pre">--save</span></tt>. These tools will be put to the <tt class="docutils literal">node_modules</tt> folder. They
<em>will not</em> be put to the path, but if you want to execute a binary by yourself
to debug the output, you can find it in <tt class="docutils literal">node_modules/bin</tt>, for example,
for browserify you can run <tt class="docutils literal">node_modules/bin/browserify</tt>. Another intersting
thing is that if you create executable scripts in your <tt class="docutils literal">package.json</tt> you
don&#8217;t actually need to include the full path but the binaries will be&nbsp;found.</p>
<p>Another thing I&#8217;d like to discuss here is the difference between <tt class="docutils literal"><span class="pre">--save</span></tt>
and <tt class="docutils literal"><span class="pre">--save-dev</span></tt> options that can be passed to npm install. If you take
a look at other guides you&#8217;ll see that people are using <tt class="docutils literal"><span class="pre">--save-dev</span></tt> for
development dependencies (i.e testing) and <tt class="docutils literal"><span class="pre">--save</span></tt> for normal dependencies.
The difference is that these dependencies are saved in different places in
<tt class="docutils literal">package.json</tt> and if you run <tt class="docutils literal">npm install <span class="pre">--production</span></tt> you&#8217;ll get only
the normal dependencies (while, if you run <tt class="docutils literal">npm install</tt> all dependencies
will be installed). In these articles, I chose to just use <tt class="docutils literal"><span class="pre">--save</span></tt> everywhere,
after all the only thing that would be needed for production would be the
<tt class="docutils literal">bundle.js</tt> output&nbsp;file.</p>
</div>
<div class="section" id="using-babel">
<h2><a class="toc-backref" href="#id3">Using&nbsp;babel</a></h2>
<p>The <a class="reference external" href="https://babeljs.io/">babel</a> library &#8220;is a JavaScript compiler&#8221;. It gets input files in a variant
of javascript (for example, <span class="caps">ES6</span>) and produces normal javascript files &#8212; something
like what browserify transforms do. However, what babel does (and I think its
the only tool that does this) is that it allows you to use <span class="caps">ES6</span> features <em>now</em> by
transpiling them to normal (<span class="caps">ES5</span>) javascript. Also, babel has <a class="reference external" href="https://babeljs.io/docs/plugins/">various other transforms</a>,
including a react transform
(so you can use this instead of the reactify&nbsp;browserify-transform)!</p>
<p>In any case, to be able to use <span class="caps">ES6</span>, we&#8217;ll need to install babel and its es6 presets
(don&#8217;t forget that you need to have a <tt class="docutils literal">package.json</tt> for the dependencies to be
saved so either do an <tt class="docutils literal">npm init</tt> or create a <tt class="docutils literal">package.json</tt> file containing only
<tt class="docutils literal">{}</tt>):</p>
<pre class="code literal-block">
npm install  babel babel-preset-es2015 --save
</pre>
<p>If we wanted to also use babel for react we&#8217;d need to install&nbsp;babel-preset-react.</p>
<p>To configure babel we can either add a <tt class="docutils literal">babel</tt>
section in our <tt class="docutils literal">package.json</tt> or create a new file named .babelrc and put the configuration&nbsp;there.</p>
<p>I prefer the first one since we are already using the <tt class="docutils literal">package.json</tt>. So add the following attribute
to your <tt class="docutils literal">package.json</tt>:</p>
<pre class="code literal-block">
&quot;babel&quot;: {
  &quot;presets&quot;: [
    &quot;es2015&quot;
  ]
}
</pre>
<p>If you wanted to configure it through <tt class="docutils literal">.babelrc</tt> then you&#8217;d just copy to it the contents of <tt class="docutils literal">&quot;babel&quot;</tt>.</p>
<p>To do some tests with babel, you can install its cli (it&#8217;s not included in the babel package) through
<tt class="docutils literal">npm install <span class="pre">babel-cli</span></tt>. Now, you can run <tt class="docutils literal"><span class="pre">node_modules/.bin/babel</span></tt>. For example, create a
file named <tt class="docutils literal">testbabel.js</tt> with the following contents (thick&nbsp;arrow):</p>
<pre class="code literal-block">
[1,2,3].forEach(x =&gt; console.log(x) );
</pre>
<p>when you pass it to babel you&#8217;ll see the following&nbsp;output:</p>
<pre class="code literal-block">
&gt;node_modules\.bin\babel testbabel.js
&quot;use strict&quot;;

[1, 2, 3].forEach(function (x) {
  return console.log(x);
});
</pre>
</div>
<div class="section" id="integrate-babel-with-browserify">
<h2><a class="toc-backref" href="#id4">Integrate babel with&nbsp;browserify</a></h2>
<p>To call babel from browserify we&#8217;re going to use the <a class="reference external" href="https://github.com/babel/babelify">babelify</a> browserify transform which
actually uses babel to transpile the browserify input. After installing it&nbsp;with</p>
<pre class="code literal-block">
npm install babelify --save
</pre>
<p>you need to tell browserify to use it. To do this, you&#8217;ll just pass a -t babelify parameter to
browserify. So if you run it with the <tt class="docutils literal">testbabel.js</tt> file as input you&#8217;ll see the following&nbsp;output:</p>
<pre class="code literal-block">
&gt;node_modules\.bin\browserify -t babelify testbabel.js
[...] browserify gibberish
&quot;use strict&quot;;

[1, 2, 3].forEach(function (x) {
  return console.log(x);
});

[...] more browserify gibberish
</pre>
<p>yey &#8212; the code is transpiled to <span class="caps">ES5</span>!</p>
<p>To create a complete project, let&#8217;s add a normal requirement&nbsp;(moment.js):</p>
<pre class="code literal-block">
npm install moment --save
</pre>
<p>and a file named <tt class="docutils literal">src\main.js</tt> that uses it with <span class="caps">ES6</span>&nbsp;syntax:</p>
<pre class="code literal-block">
import moment from 'moment';

const arr = [1,2,3,4,5];
arr.forEach(x =&gt; setTimeout(() =&gt; console.log(`Now: ${moment().format(&quot;HH:mm:ss&quot;)}, Later: ${moment().add(x, &quot;days&quot;).format(&quot;L&quot;)}...`), x*1000));
</pre>
<p>To create the output javascript file, we&#8217;ll use the browserify and watchify commands with the
addition of the -t babelify switch. Here&#8217;s the complete <tt class="docutils literal">package.json</tt> for this&nbsp;project:</p>
<pre class="code literal-block">
{
  &quot;dependencies&quot;: {
    &quot;babel&quot;: &quot;^6.1.18&quot;,
    &quot;babel-preset-es2015&quot;: &quot;^6.1.18&quot;,
    &quot;babelify&quot;: &quot;^7.2.0&quot;,
    &quot;browserify&quot;: &quot;^12.0.1&quot;,
    &quot;moment&quot;: &quot;^2.10.6&quot;,
    &quot;uglify-js&quot;: &quot;^2.6.0&quot;,
    &quot;watchify&quot;: &quot;^3.6.1&quot;
  },
  &quot;scripts&quot;: {
    &quot;watch&quot;: &quot;watchify src/main.js -o dist/bundle.js -v -t babelify&quot;,
    &quot;build&quot;: &quot;browserify src/main.js -t babelify | uglifyjs -mc warnings=false &gt; dist/bundle.js&quot;
  },
  &quot;babel&quot;: {
    &quot;presets&quot;: [
      &quot;es2015&quot;
    ]
  }
}
</pre>
<p>Running <tt class="docutils literal">npm run build</tt> should create a <tt class="docutils literal">dist/bundle.js</tt> file. If you include this in an html,
you should see something like this in the&nbsp;console:</p>
<pre class="code literal-block">
Now: 13:52:09, Later: 11/17/2015...
Now: 13:52:10, Later: 11/18/2015...
</pre>
</div>
<div class="section" id="the-object-spread-operator">
<h2><a class="toc-backref" href="#id5">The object-spread&nbsp;operator</a></h2>
<p>Many examples in the internet use the <a class="reference external" href="https://facebook.github.io/react/docs/jsx-spread.html#spread-attributes">object spread operator</a> which is <a class="reference external" href="http://stackoverflow.com/questions/31115276/ecmascript-6-spread-operator-in-object-deconstruction-support-in-typescript-and">not part of es6</a> so our
proposed babel configuration does not support it!
To be able to use this syntax, we&#8217;ll need to install the corresponding babel plugin by using
<tt class="docutils literal">npm install <span class="pre">babel-plugin-transform-object-rest-spread</span> <span class="pre">--save</span></tt> and add it to our babel configuration
in the plugins section, something like&nbsp;this:</p>
<pre class="code literal-block">
&quot;presets&quot;: [
  &quot;es2015&quot;,
  &quot;react&quot;
],
&quot;plugins&quot;: [
  &quot;transform-object-rest-spread&quot;
]
</pre>
<p>If everything is ok this should be transpiled without errors using <tt class="docutils literal"><span class="pre">node_modules\.bin\browserify</span> testbabe.js <span class="pre">-t</span> babelify</tt></p>
<pre class="code literal-block">
let x = {a:1 , b:2 };
let y = {...x, c: 3};
</pre>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id6">Conclusion</a></h2>
<p>Using the combination of babel and javascript we can easily write <span class="caps">ES6</span> code in our modules! This,
along with the modularization of our code and the management of client-side dependencies should
make client side development a&nbsp;breeze!</p>
<p>Please notice that to keep the presented workflow simple and easy to
replicate and configure, we have not used any external
task runners (like gulp or grunt) &#8212; all configuration is kept in a single file (package.json) and
the whole environment can be replicated just by doing a <tt class="docutils literal">npm install</tt>. Of course, the capabilities of
browserify are not unlimited, so if you wanted to do something more complicated
(for instance, lint your code before passing it to browserify) you&#8217;d need to use the mentioned
task runners (or webpack which is the current trend in javascript bundlers and actually replaces
the task&nbsp;runners).</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2015/10/05/django-dynamic-tables-similar-models/">Django dynamic tables and filters for similar models</a>
      </h1>
    <p class="meta">
<time datetime="2015-10-05T14:20:00+03:00" pubdate>Δευ 05 Οκτώβριος 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#the-problem-we-ll-solve" id="id2">The problem we&#8217;ll&nbsp;solve</a></li>
<li><a class="reference internal" href="#adding-the-dynamic-table" id="id3">Adding the dynamic&nbsp;table</a></li>
<li><a class="reference internal" href="#creating-a-dynamic-form-for-filtering" id="id4">Creating a dynamic form for&nbsp;filtering</a></li>
<li><a class="reference internal" href="#creating-the-dynamic-cbv" id="id5">Creating the dynamic <span class="caps">CBV</span></a></li>
<li><a class="reference internal" href="#conclusion" id="id6">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>One of my favorite django apps is <a class="reference external" href="https://github.com/bradleyayers/django-tables2">django-tables2</a>: It allows you to
easily create pagination and sorting enabled <span class="caps">HTML</span> tables to represent
your model data using the usual djangonic technique (similar to how
you <a class="reference external" href="https://docs.djangoproject.com/en/1.8/topics/forms/modelforms/#modelform">create ModelForms</a>). I use it to almost all my projects to
represent the data, along with <a class="reference external" href="https://github.com/alex/django-filter">django-filter</a> to create forms
to filter my model data. I&#8217;ve written <a class="reference external" href="http://stackoverflow.com/questions/13611741/django-tables-column-filtering/15129259#15129259">a nice <span class="caps">SO</span> answer</a> with
instructions on how to use django-filter along with django-tables2.
This article will describe a technique that allows you to generate
tables and filters for your models in the most <span class="caps">DRY</span>&nbsp;way!</p>
</div>
<div class="section" id="the-problem-we-ll-solve">
<h2><a class="toc-backref" href="#id2">The problem we&#8217;ll&nbsp;solve</a></h2>
<p>The main tool django-tables2 offers is a template tag called <tt class="docutils literal">render_table</tt>
that gets an instance of a subclass of <tt class="docutils literal">django_tables2.Table</tt>
which contains a description of the table (columns, style etc) along
with a queryset with the table&#8217;s data and outputs it to the page. A nice
extra feature of render_table is that you could pass it just a simple
django queryset and it will output it without the need to create the
custom Table class. So you can do something like {% render_table User.objects.all() %}
and get a quick output of your Users&nbsp;table.</p>
<p>In one of my projects I had three models that
were used for keeping a different type of business log in the database (for auditing reasons)
and was using the above feature to display these logs to the administrators, just by
creating a very simple <tt class="docutils literal">ListView</tt> (a different one for each Log type) and using the
<tt class="docutils literal">render_table</tt> to display the data. So I&#8217;d created three views limilar to&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AuditLogListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">AuditLog</span>
  <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>
</pre></div>
<p>which all used a single template that contained a line <tt class="docutils literal">{% render_table logs %}</tt> to display
the table (the <tt class="docutils literal">logs</tt> context variable contains the list/queryset of <tt class="docutils literal">AuditLog</tt> s)
so <tt class="docutils literal">render_table</tt> will just output that list in a page. Each view of course had a different
<tt class="docutils literal">model</tt> attribute.</p>
<p>This was a nice <span class="caps">DRY</span> (but quick and dirty solution) that soon was not enough to fulfill the
needs of the administrators since they neeeded to have default sorting, filtering, hide
the primary key-id column etc. The obvious solution for that would be to just create three different
<tt class="docutils literal">Table</tt> subclasses that
would more or less have the same options with only their <tt class="docutils literal">model</tt> attributte different. I didn&#8217;t
like this solution that much since it seemed non-<span class="caps">DRY</span> to me and I would instead prefer to
create a generic <tt class="docutils literal">Table</tt> (that wouldn&#8217;t have a <tt class="docutils literal">model</tt> attributte) and would just output
its data with the correct options &#8212; so instead of three <tt class="docutils literal">Table</tt> classes I&#8217;d like to create
just a single one with common options that would display its data (what <tt class="docutils literal">render_table</tt> does).</p>
<p>Unfortunately, I couldn&#8217;t find a solution to this, since when I ommited the <tt class="docutils literal">model</tt> attribute
from the <tt class="docutils literal">Table</tt> subclass nothing was outputed (there is no way to define fields to
display in a <tt class="docutils literal">Table</tt> without also defining the model). An obvious (and <span class="caps">DRY</span>) resolution would be to create
a base <tt class="docutils literal">Table</tt> subclass that would define the needed options and create three subclasses
that would inherit from this class and override only the <tt class="docutils literal">model</tt> attribute. This unfortunately was not
possible becase <a class="reference external" href="http://stackoverflow.com/questions/16696066/django-tables2-dynamically-adding-columns-to-table-not-adding-attrs-to-table/16741665#16741665">inheritance does not work well with django-tables2</a>!</p>
<p>Furthermore, there&#8217;s the extra hurdle of adding filtering to the above tables so that
the admin&#8217;s would be able to quickly find a log message - if we wanted to use django-filter
we&#8217;d need again to create three different subclasses (one for each log model type)
of <tt class="docutils literal">django_filter.FilterSet</tt> since
django-filter requires you to define the model for which the filter will be&nbsp;created!</p>
<p>One cool way to resolve such problems is to create your classes dynamically when
you need &#8216;em. I&#8217;ve already described a way to <a class="reference external" href="https://spapas.github.io/2013/12/24/django-dynamic-forms/">dynamically create forms in django
in a previous post</a>. Below, I&#8217;ll describe
a similar technique which can be used to create both dynamic tables and filters. Using
this methodology, you&#8217;ll be able to add a new <span class="caps">CBV</span> that displays a table with
pagination, order and filtering for your model by just inheriting from a base&nbsp;class!</p>
</div>
<div class="section" id="adding-the-dynamic-table">
<h2><a class="toc-backref" href="#id3">Adding the dynamic&nbsp;table</a></h2>
<p>To create the <span class="caps">DRY</span> <span class="caps">CBV</span> we&#8217;ll use the <a class="reference external" href="http://django-tables2.readthedocs.org/en/latest/pages/generic-mixins.html?highlight=singletableview">SingleTableView</a> (<tt class="docutils literal">django_tables2.SingleTableView</tt>)
as a base and override its <tt class="docutils literal">get_table_class</tt> method to dynamically create our table class
using <tt class="docutils literal">type</tt>.
Here&#8217;s how it could be done using a mixin (notice that this mixin should be used in a
<tt class="docutils literal">SingleTableView</tt> to override its <tt class="docutils literal">get_table_class</tt> method):</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AddTableMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
  <span class="n">table_pagination</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}</span>

  <span class="k">def</span> <span class="nf">get_table_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">def</span> <span class="nf">get_table_column</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">django</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">):</span>
              <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">DateColumn</span><span class="p">(</span><span class="s2">&quot;d/m/Y H:i&quot;</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

      <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
          <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">get_table_column</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span>
          <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span>
      <span class="p">)</span>
      <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Meta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Meta&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;table&quot;</span><span class="p">},</span> <span class="s2">&quot;order_by&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;-created_on&quot;</span><span class="p">,</span> <span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
      <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;DTable&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">,</span> <span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">klass</span>
</pre></div>
<p>Let&#8217;s try to explain the <tt class="docutils literal">get_table_class</tt> method: First of all, we&#8217;ve defined a local <tt class="docutils literal">get_table_column</tt>
function that will return a django-tables2 column depending on the field of the model. For example, in
our case I wanted to use a <tt class="docutils literal">django_tables2.DateColumn</tt> with a specific format when a <tt class="docutils literal">DateTimeField</tt> is
encountered and for all other model fields just use the stock <tt class="docutils literal">Column</tt>. You may add other overrides here,
for example add a <tt class="docutils literal">TemplateColumn</tt> to properly render some&nbsp;data.</p>
<p>After that, we create a dictionary with all the attributes of the dynamic table model.
The <tt class="docutils literal">self.model</tt> field will contain
the model Class of this <tt class="docutils literal">SingleTableView</tt>, so using its <tt class="docutils literal">_meta.fields</tt> will return
the defined fields of that model. As we can see, I just use
a generator expression to create a tuple with the name of the field and its column type (using <tt class="docutils literal">get_table_column</tt>)
excluding the &#8216;id&#8217; column. So, attrs will be a dictionary of field names and column types. Here you may
also exclude other columns you don&#8217;t want to&nbsp;display.</p>
<p>The <tt class="docutils literal">Meta</tt> class of this table is crated using <tt class="docutils literal">type</tt> which creates a parentless class by
defining all its attributes in a dictionary
and set it as the <tt class="docutils literal">Meta</tt> key in the previously defined <tt class="docutils literal">attrs</tt> dict.
Finally, we create the actual <tt class="docutils literal">django_tables2.Table</tt> subclass by
inheriting from it and passing the <tt class="docutils literal">attrs</tt> dict. We&#8217;ll see an example of what <tt class="docutils literal">get_table_class</tt> returns&nbsp;later.</p>
</div>
<div class="section" id="creating-a-dynamic-form-for-filtering">
<h2><a class="toc-backref" href="#id4">Creating a dynamic form for&nbsp;filtering</a></h2>
<p>Let&#8217;s create another mixin that could be used to create a dynamic <tt class="docutils literal">django.Form</tt> subclass to the <span class="caps">CBV</span>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AddFormMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">):</span>
  <span class="k">def</span> <span class="nf">define_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">def</span> <span class="nf">get_form_field_type</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
          <span class="k">return</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

      <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
          <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">get_form_field_type</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span>
          <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">()</span> <span class="p">)</span>

      <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;DForm&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">,</span> <span class="p">),</span> <span class="n">attrs</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">klass</span>

  <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="n">form_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">define_form</span><span class="p">()</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form_class</span><span class="p">()</span>

      <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AddFormMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
          <span class="n">q_objects</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_form_fields</span><span class="p">():</span>
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                  <span class="n">q_objects</span> <span class="o">&amp;=</span> <span class="n">Q</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">f</span><span class="o">+</span><span class="s1">&#39;__icontains&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="n">f</span><span class="p">]})</span>

          <span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q_objects</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">qs</span>

  <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="n">ctx</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AddFormMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      <span class="n">ctx</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span>
      <span class="k">return</span> <span class="n">ctx</span>
</pre></div>
<p>The first method that will be called is the <tt class="docutils literal">get_queryset</tt> method that will generate the dynamic form
using <tt class="docutils literal">define_form</tt>. This method has a <tt class="docutils literal">get_form_field_type</tt> local function (similar to get_table_fields)
that can be used to override the types of the fields (or just fallback to a normal <tt class="docutils literal">CharField</tt>) and
then create the <tt class="docutils literal">attrs</tt> dictionary and <tt class="docutils literal">forms.Form</tt> subclass in a similar way as the <tt class="docutils literal">Table</tt> subclass. Here,
we don&#8217;t want to create a filter form from all fields of the model as we did on table, so instead
we&#8217;ll use a <tt class="docutils literal">get_form_fields</tt> (don&#8217;t confuse it with the local <tt class="docutils literal">get_form_field_type</tt>)
method that returns the name of the fields that we want to
use in the filtering form and needs to be defined in each <span class="caps">CBV</span> &#8212; the <tt class="docutils literal">get_form_fields</tt> must
be defined in classes that use this&nbsp;mixin.</p>
<p>After defining the form, we need to check if there&#8217;s anything to the <tt class="docutils literal"><span class="caps">GET</span></tt> dict &#8212; since we are just filtering the
queryset we&#8217;d need to submit the form with a <tt class="docutils literal"><span class="caps">GET</span></tt> (and not a <tt class="docutils literal"><span class="caps">POST</span></tt>). We see that if we have
data to our <tt class="docutils literal">request.<span class="caps">GET</span></tt> dictionary we&#8217;ll instantiate the form using this data (or else we&#8217;ll just
create an empty form). To do the actual filtering, we check if the form is valid and create a <tt class="docutils literal">django.models.db.Q</tt> object
that is used to combine (by <span class="caps">AND</span>) the conditions. Each of the individual Q objects that will be combined
(<tt class="docutils literal">&amp;=</tt>)
to create the complete one will be created using the line <tt class="docutils literal"><span class="pre">Q(**{f+'__icontains':self.form.cleaned_data.get(f,</span> <span class="pre">'')})</span></tt>
(where f will be the name of the field) which is a nice trick: It will create a
dictionary of the form <tt class="docutils literal">{'action__icontains': 'test text'}</tt> and then pass this as a keyword
argument to the Q (using the <tt class="docutils literal">**</tt> mechanism), so <tt class="docutils literal">Q</tt> will be called like
<tt class="docutils literal"><span class="pre">Q(action__icontains='test</span> text')</tt> - this (using the <tt class="docutils literal"><span class="pre">**{key:val}</span></tt> trick) is
the only way to pass dynamic kwargs to a&nbsp;function!</p>
<p>Finally, the queryset will be filtered using the combined <tt class="docutils literal">Q</tt> object we just&nbsp;described.</p>
</div>
<div class="section" id="creating-the-dynamic-cbv">
<h2><a class="toc-backref" href="#id5">Creating the dynamic <span class="caps">CBV</span></a></h2>
<p>Using the above mixins, we can easily create a dynamic <span class="caps">CBV</span> with a table and a filter form only by inheriting
from the mixins
and <tt class="docutils literal">SingleTableView</tt> and defining the <tt class="docutils literal">get_form_fields</tt> method:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AuditLogListView</span><span class="p">(</span><span class="n">AddTableMixin</span><span class="p">,</span> <span class="n">AddFormMixin</span><span class="p">,</span> <span class="n">SingleTableView</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">AuditLog</span>
  <span class="n">context_object_name</span> <span class="o">=</span> <span class="s1">&#39;logs&#39;</span>

  <span class="k">def</span> <span class="nf">get_form_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span><span class="s1">&#39;user__username&#39;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
<p>Let&#8217;s suppose that the <tt class="docutils literal">AuditLog</tt> is defined as&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AuditLog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="n">created_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span>
</pre></div>
<p>Using the above <tt class="docutils literal">AuditLogListView</tt>, a dynamic table and a dynamic form will be automaticall created whenever the view is visited.
The <tt class="docutils literal">Table</tt> class will be like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
  <span class="n">created_on</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">DateColumn</span><span class="p">(</span><span class="s2">&quot;d/m/Y H:i&quot;</span><span class="p">)</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">()</span>

  <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
      <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span><span class="s2">&quot;table&quot;</span><span class="p">}</span>
      <span class="n">order_by</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;-created_on&quot;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>
<p>and the <tt class="docutils literal">Form</tt> class like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
  <span class="n">user__username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
  <span class="n">action</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
</pre></div>
<p>An interesting thing to notice is that we can drill down to foreign keys (f.e. <tt class="docutils literal">user__username</tt>) to create more interesting filters.
Also we could add some more
methods to be overriden by the implementing class beyond
the <tt class="docutils literal">get_form_fields</tt>. For example, instead of using <tt class="docutils literal">self.model._meta.fields</tt>
to generate the fields of the table, we
could instead use a <tt class="docutils literal">get_table_fields</tt> (similar to the <tt class="docutils literal">get_form_fields</tt>)
method that would be overriden in the implementing
classes (and even drill down on foreign keys to display more data on the table using <a class="reference external" href="http://django-tables2.readthedocs.org/en/latest/pages/accessors.html">accessors</a>).</p>
<p>Or, we could also define the form field types and lookups (instead of always using <tt class="docutils literal">CharField</tt> and
<tt class="docutils literal">icontains</tt> ) in the <tt class="docutils literal">get_form_fields</tt> &#8212; similar to&nbsp;django-filter.</p>
<p>Please notice that instead of creating a django form instance for filtering, we could instead create a django-filter instance with
a similar methodology. However, I preferred to just use a normal django form because it makes the whole process more clear and removes
a level of abstraction (we just create a <tt class="docutils literal">django.Form</tt> subclass while, if we used django-filter we&#8217;d need to create
a django-filter subclass which would create a <tt class="docutils literal">django.Form</tt> subclass)!</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id6">Conclusion</a></h2>
<p>Using the above technique we can quickly create a table and filter for a number of Models that all share
the same properties in the most <span class="caps">DRY</span>. This technique of course is useful only for quick CBVs that
are more or less the same and require little customization. Another interesting thing is that instead of
creating different <tt class="docutils literal">SingleTableView</tt> s we could instead create a single <span class="caps">CBV</span> that will get the content type
of the Model to be viewed as a parameter and retrieve the model (and queryset) from the content type - so
we could have a single <span class="caps">CBV</span> for all our table/filtering views&nbsp;!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2015/09/08/more-complex-react-flux-example/">A (little more) complex react and flux example</a>
      </h1>
    <p class="meta">
<time datetime="2015-09-08T12:55:00+03:00" pubdate>Τρι 08 Σεπτέμβριος 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#more-about-flux-components" id="id3">More about Flux&nbsp;components</a></li>
<li><a class="reference internal" href="#explaining-the-application-components" id="id4">Explaining the application&nbsp;components</a></li>
<li><a class="reference internal" href="#reusable-application-components" id="id5">Reusable application components</a><ul>
<li><a class="reference internal" href="#dropdown-react-js" id="id6">DropDown.react.js</a></li>
<li><a class="reference internal" href="#datepicker-react-js" id="id7">DatePicker.react.js</a></li>
<li><a class="reference internal" href="#pagingpanel-react-js" id="id8">PagingPanel.react.js</a></li>
<li><a class="reference internal" href="#searchpanel-react-js" id="id9">SearchPanel.react.js</a></li>
<li><a class="reference internal" href="#messagepanel" id="id10">MessagePanel</a><ul>
<li><a class="reference internal" href="#messagepanel-react-js" id="id11">MessagePanel.react.js</a></li>
<li><a class="reference internal" href="#messagestore-js" id="id12">MessageStore.js</a></li>
<li><a class="reference internal" href="#messageactions" id="id13">MessageActions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#non-reusable-application-components" id="id14">Non-reusable application components</a><ul>
<li><a class="reference internal" href="#booktable-react-js" id="id15">BookTable.react.js</a></li>
<li><a class="reference internal" href="#authordialog-react-js" id="id16">AuthorDialog.react.js</a></li>
<li><a class="reference internal" href="#authorpanel-react-js" id="id17">AuthorPanel.react.js</a></li>
<li><a class="reference internal" href="#statpanel-react-js" id="id18">StatPanel.react.js</a></li>
<li><a class="reference internal" href="#bookform-react-js" id="id19">BookForm.react.js</a></li>
<li><a class="reference internal" href="#bookpanel-react-js" id="id20">BookPanel.react.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-actions" id="id21">The&nbsp;Actions</a></li>
<li><a class="reference internal" href="#the-stores" id="id22">The Stores</a><ul>
<li><a class="reference internal" href="#id1" id="id23">MessageStore.js</a></li>
<li><a class="reference internal" href="#authorstore-js" id="id24">AuthorStore.js</a></li>
<li><a class="reference internal" href="#categorystore-js" id="id25">CategoryStore.js</a></li>
<li><a class="reference internal" href="#bookstore-js" id="id26">BookStore.js</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id27">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a></h2>
<p>In <a class="reference external" href="https://spapas.github.io/2015/06/05/comprehensive-react-flux-tutorial/">previous</a>
<a class="reference external" href="https://spapas.github.io/2015/07/02/comprehensive-react-flux-tutorial-2/">two</a> parts of this series, we have seen
how we could implement a
not-so-simple single page application with full <span class="caps">CRUD</span> capabilities
using react only (in the <a class="reference external" href="https://spapas.github.io/2015/06/05/comprehensive-react-flux-tutorial/">first part</a> ) and then how to
change it to use the flux architecture (in the <a class="reference external" href="https://spapas.github.io/2015/07/02/comprehensive-react-flux-tutorial-2/">second part</a>).</p>
<p>In this, third, part, we will
add some more capabilities to the previous app
to prove how easy it is to create complex apps
and continue the discussion on
the Flux architecture. The source code of this project
can
be found at <a class="reference external" href="https://github.com/spapas/react-tutorial">https://github.com/spapas/react-tutorial</a> (tag name&nbsp;react-flux-complex).</p>
<p>Here&#8217;s a demo of the final&nbsp;application:</p>
<img alt="Our project" src="/images/demo2.gif" style="width: 780px;" />
<p>We can see that, when compared to the previous version this one&nbsp;has:</p>
<ul class="simple">
<li>Sorting by table&nbsp;columns</li>
<li>Pagination</li>
<li>Message for&nbsp;loading</li>
<li>Client side url updating (with&nbsp;hashes)</li>
<li>Cascading drop downs (selecting category will filter out&nbsp;subcategories)</li>
<li>Integration with jquery-ui&nbsp;datepicker</li>
<li>Add a child object&nbsp;(author)</li>
<li>Add authors with a modal dialog&nbsp;(popup)</li>
<li>Delete authors (using the &#8220;-&#8221;&nbsp;button)</li>
<li>Colored ajax result messages (green when all is ok, red with&nbsp;error)</li>
<li>A statistics panel (number of books /&nbsp;authors)</li>
</ul>
<p>In the paragraphs below, beyond the whole architecture, we&#8217;ll see
a bunch of techniques such&nbsp;as:</p>
<ul class="simple">
<li>Creating reusable flux&nbsp;components</li>
<li>Integrating react with&nbsp;jquery</li>
<li>Creating cascading&nbsp;dropdowns</li>
<li>Updating URLs with&nbsp;hashes</li>
<li>Adding pagination/sorting/querying to a table of&nbsp;results</li>
<li>Displaying pop&nbsp;ups</li>
</ul>
</div>
<div class="section" id="more-about-flux-components">
<h2><a class="toc-backref" href="#id3">More about Flux&nbsp;components</a></h2>
<p>Before delving into the source code of the above application, I&#8217;d like to
make crystal what is the proposed way to call methods in the flux chain
and which types of components can include other types of components. Let&#8217;s
take a look at the following&nbsp;diagram:</p>
<img alt="flux dependencies" src="/images/react_flux_deps1.png" style="width: 480px;" />
<p>The arrows display the dependencies of the Flux architecture - an arrow
from X to Y means that a component of type Y could depend on an Component
of type X (of example, a store could depend on an action or another store
but not on a&nbsp;panel).</p>
<p>In more detail, we can see that in the top of the hierarchy,
having no dependencies are the
Dispatcher and the Constants. The Dispatcher is just a single component
(which actually is a singleton - only one dispatcher exists in each
single page react-flux application)
that inherits from the Facebook&#8217;s dispatcher and is imported by the
action components (since action methods defined in action components
call the <tt class="docutils literal">dispatch</tt> method of the dispatcher passing the correct
parameters) and the stores which do the real actions when an action
is dispatched, depending on the action type. The Constant components
define constant values for the action types and are used by both
the actions (to set the action types to the dispatch calls) and by
the stores to be used on the switch statement when an action is
dispatched. As an example, for BookActions we have the&nbsp;following</p>
<pre class="code literal-block">
var BookConstants = require('../constants/BookConstants')
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;

var BookActions = {
    change_book: function(book) {
        AppDispatcher.dispatch({
            actionType: BookConstants.BOOK_CHANGE,
            book: book
        });
    },
// Other book actions [...]
</pre>
<p>and for&nbsp;BookStore</p>
<pre class="code literal-block">
var $ = require('jquery');
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;
var BookConstants = require('../constants/BookConstants')

// [...]

BookStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
            _editBook(action.book);
        break;
// [...] other switch branches
</pre>
<p>An interesting thing to see is that the actions depend only on the Dispatcher
and on the Constants, while the stores also depend on actions (not only
from the same action types as the store type, for example AuthorStore depends
on both AuthorActions and MessageActions) and on <em>other</em> stores. This means
that the actions should be a &#8220;clean&#8221; component: Just declare your action methods
whose only purpose is to pass the action type along with the required parameters
to the&nbsp;dispatcher.</p>
<p>On the other hand, the stores are depending on both actions and other stores.
The action dependency is because sometimes when something is done in a store
we need to notify another store to do something as a response to that. For
example, in our case, when a book is updated we need to notify the message
store to show the &#8220;Book updated ok&#8221; message. This preferrably should not be done by
directly calling the corresponding method on the message store but instead
by calling the corresponding action of MessageAction and passing the correct
parameters (actually, the method that updates the message in MessageStore
should be a private method that is called <em>only</em> through the&nbsp;action).</p>
<p>One thing to notice here is that you <em>cannot</em> call (and dispatch) an action in the
same call stack (meaning it is directly called) as of another dispatch or you&#8217;ll get a
<tt class="docutils literal">Invariant Violation: <span class="pre">Dispatch.dispatch(...):</span> Cannot dispatch in the middle of a dispatch.</tt>
error in your javascript console. Let&#8217;s see an example of what this means and how
to avoid it because its a common error. Let&#8217;s say that we have the following
code to a&nbsp;store:</p>
<pre class="code literal-block">
AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case Constants.TEST_ERR:
            TestActions.action1();
        break;
        case Constants.TEST_OK1:
            setTimeout(function() {
                TestActions.action1();
            }, 0);

        break;
        case Constants.TEST_OK2:
            $.get('/get/', function() {
                TestActions.action1();
            });

        break;
    }
    return true;
});
</pre>
<p>Here, the <tt class="docutils literal">TEST_ERR</tt> branch will throw an error because the <tt class="docutils literal">TestAction.action1</tt> is <em>in the same call stack</em>
as this dispatch! On the other hand, both <tt class="docutils literal">TEST_OK1</tt> and <tt class="docutils literal">TEST_OK2</tt> will work: <tt class="docutils literal">TEST_OK2</tt> is the most
usual, since most of the times we want to call an action as a result of an ajax call - however, sometimes we
want to call an action without any ajax &#8212; in this case we use the setTimeout (with a timeout of 0 ms) in
order to move the call to <tt class="docutils literal">TestActions.action1()</tt> to a different call&nbsp;stack.</p>
<p>Now, as I mentioned before, there&#8217;s also a <em>different-store</em> dependency on stores.
This dependency is needed because some stores may offer public methods for other stores to use
(methods that don&#8217;t actually need to be dispatched through the dispatcher) and
for the <tt class="docutils literal">waitFor</tt> method , in case there are two different
stores that respond to a single action and want to have one store executing
its dispatch method before the other.
(the waitFor method takes the dispatchToken, which is the result of <tt class="docutils literal">Dispatcher.register</tt> of
a different store as a parameter in order to wait for that action to&nbsp;finish).</p>
<p>Finally, the Panels depend on both actions (to initiate an action as a response
to user input) and stores (to read the state of the each required store when it
is changed). Of course, not all panels actually depend on stores, since as we
already know the state of a React app should be kept as high in the hierarchy
as possible, so a central component will get the state of a store and pass the
required state attributes to its children through parameters. On the other
hand, every component that responds to user input will have to import
am action object and call the corresponding method &#8212; we should never pass
callbacks from a parent to a child component as a parameter anymore <em>unless</em>
we want to make the component reusable (more on this&nbsp;later).</p>
<p>Finally, as expected, because of their hierarchy the compoents depend on their
child components (a BookTable depends on a BookTableRow&nbsp;etc).</p>
</div>
<div class="section" id="explaining-the-application-components">
<h2><a class="toc-backref" href="#id4">Explaining the application&nbsp;components</a></h2>
<p>There are a lot of components that are needed for
the above application. A bird&#8217;s eye view of the components
and their hierarchies can be seen on the following&nbsp;figure:</p>
<img alt="Our components" src="/images/complex_react_components.png" style="width: 780px;" />
<p>We will first explain a bit the components that could be easily reused
by other applications and after that the components that are specifically
implemented for our book/author single page&nbsp;application.</p>
</div>
<div class="section" id="reusable-application-components">
<h2><a class="toc-backref" href="#id5">Reusable application&nbsp;components</a></h2>
<p>We can see that beyond the specific components (<tt class="docutils literal">BookPanel</tt>, <tt class="docutils literal">BookTable</tt> etc)
there&#8217;s a bunch of more general components (<tt class="docutils literal">DropDown</tt>, <tt class="docutils literal">DatePicker</tt>, <tt class="docutils literal">PagingPanel</tt>, <tt class="docutils literal">SearchPanel</tt>,
<tt class="docutils literal">MessagePanel</tt>) that have names like they could be used by other applications (for example every application
that wants to implement a DropDown could use our component) and not only by the
Book-Author application. Let&#8217;s take a quick look at these components and if they
are actually&nbsp;reusable:</p>
<div class="section" id="dropdown-react-js">
<h3><a class="toc-backref" href="#id6">DropDown.react.js</a></h3>
<pre class="code literal-block">
var React = require('react');

var DropDown = React.createClass({
    render: function() {
        var options = [];
        options.push(&lt;option key='-1' value='' &gt;---&lt;/option&gt;);
        if(this.props.options) {
            this.props.options.forEach(function(option) {
                options.push(&lt;option key={option.id} value={option.id}&gt;{option.name}&lt;/option&gt;);
            });
        }

        return(
            &lt;select ref='dropdown' value={this.props.value?this.props.value:''} onChange={this.onFormChange} &gt;
                {options}
            &lt;/select&gt;
        );
    },
    onFormChange: function() {
        var val = React.findDOMNode(this.refs.dropdown).value
        this.props.dropDownValueChanged(val);
    }
});

module.exports.DropDown = DropDown;
</pre>
<p>What we see here is that this component does not actually have a local state and will need three&nbsp;parameters:</p>
<ul class="simple">
<li>the list of options (<tt class="docutils literal">props.options</tt>)</li>
<li>the curently selected option (<tt class="docutils literal">props.value</tt>)</li>
<li>a callback to be called when the dropdown is changed (<tt class="docutils literal">props.dropDownValueChanged</tt>)</li>
</ul>
<p>By passing the above three parameters this dropdown component can be reused whenever a dropdown is needed!
As we can see here we need to pass a callback function to this dropdown and call the corresponding action
directly. This is important to have a reusable component: The component that includes each dropdown decides
which should be the action on the dropdown value change. Another option if we wanted to avoid callbacks
would be to pass an identifier as a property for each dropdown and the dropdown would call a generic
dropdown action and passing this identifier &#8212; however I think that actually passing the callback is
easier and makes the code much more&nbsp;readable.</p>
</div>
<div class="section" id="datepicker-react-js">
<h3><a class="toc-backref" href="#id7">DatePicker.react.js</a></h3>
<p>The datepicker component has more or less the same structure as with the dropdown: It needs one parameter
for its current value (<tt class="docutils literal">props.value</tt>) and another as the callback to the function when the date is
changed (once again this is required to have a reusable&nbsp;component):</p>
<pre class="code literal-block">
var React = require('react');

var DatePicker = React.createClass({
    render: function() {
        return(
            &lt;input type='text' ref='date' value={this.props.value} onChange={this.handleChange} /&gt;
        );
    },
    componentDidMount: function() {
        $(React.findDOMNode(this)).datepicker({ dateFormat: 'yy-mm-dd' });
        $(React.findDOMNode(this)).on('change', this.handleChange);
    },
    componentWillUnmount: function() {

    },
    handleChange: function() {
        var date = React.findDOMNode(this.refs.date).value
        this.props.onChange(date);
    }
});

module.exports.DatePicker = DatePicker ;
</pre>
<p>Another thing we can see here is how can integrate jquery components with react: When
the component is mounted, we get its <span class="caps">DOM</span> component using <tt class="docutils literal">React.findDomNode(this)</tt> and
convert it to a datepicker. We also set its change function to be the passed&nbsp;callback.</p>
</div>
<div class="section" id="pagingpanel-react-js">
<h3><a class="toc-backref" href="#id8">PagingPanel.react.js</a></h3>
<p>The paging panel is not actually a reusable component because it requires BookActions
(to handle next and previous page clicks) - so
it can&#8217;t be used by Authors (if authors was a table that is). However, we can easily
change it to be reusable if we passed callbacks for next and previous page so that
the component including PagingPanel would call the correct action on each click. Having
a reusable PagingPangel is not needed for our application since only books have a&nbsp;table.</p>
<pre class="code literal-block">
var React = require('react');
var BookActions = require('../actions/BookActions').BookActions;

var PagingPanel = React.createClass({
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                {this.props.page==1?'':&lt;button onClick={this.onPreviousPageClick}&gt;&amp;lt;&lt;/button&gt;}
                &amp;nbsp; Page {this.props.page} of {this.getTotalPages()} &amp;nbsp;
                {this.props.page==this.getTotalPages()?'':&lt;button onClick={this.onNextPageClick} &gt;&amp;gt;&lt;/button&gt;}
            &lt;/div&gt;
        );
    },
    onNextPageClick: function(e) {
        e.preventDefault();
        BookActions.change_page(this.props.page+1)
    },
    onPreviousPageClick: function(e) {
        e.preventDefault();
        BookActions.change_page(this.props.page-1)
    },
    getTotalPages: function() {
        return Math.ceil(this.props.total / this.props.page_size);
    }
})

module.exports.PagingPanel = PagingPanel;
</pre>
<p>The component is very simple, it needs three&nbsp;parameters:</p>
<ul class="simple">
<li>the current page (<tt class="docutils literal">props.page</tt>)</li>
<li>the page size (<tt class="docutils literal">props.page_size</tt>)</li>
<li>the total pages number (<tt class="docutils literal">props.total</tt>)</li>
</ul>
<p>and just displayd the current page along with buttons to go to the next or previous page (if these buttons should be visible of&nbsp;course).</p>
</div>
<div class="section" id="searchpanel-react-js">
<h3><a class="toc-backref" href="#id9">SearchPanel.react.js</a></h3>
<p>The SearchPanel is another panel that could be reusable if we&#8217;d passed a callbeck instead of calling the <tt class="docutils literal">BookActions.search</tt>
action directly. The promise behavior has been explained in the previous posts and is needed to buffer the queries to the
server when a user types his search&nbsp;query.</p>
<pre class="code literal-block">
var React = require('react');
var BookActions = require('../actions/BookActions').BookActions;

var SearchPanel = React.createClass({
    getInitialState: function() {
        return {
            search: this.props.query,
        }
    },
    componentWillReceiveProps: function(nextProps) {
      this.setState({
            search: nextProps.query
      });
    },
    render: function() {
        return (
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-fourth column&quot;&gt;
                    Filter: &amp;nbsp;
                    &lt;input ref='search' name='search' type='text' value={this.state.search} onChange={this.onSearchChange} /&gt;
                    {this.state.search?&lt;button onClick={this.onClearSearch} &gt;x&lt;/button&gt;:''}
                &lt;/div&gt;
            &lt;/div&gt;
        )
    },
    onSearchChange: function() {
        var query = React.findDOMNode(this.refs.search).value;
        if (this.promise) {
            clearInterval(this.promise)
        }
        this.setState({
            search: query
        });
        this.promise = setTimeout(function () {
            BookActions.search(query);
        }.bind(this), 400);
    },
    onClearSearch: function() {
        this.setState({
            search: ''
        });
        BookActions.search('');
    }
});

module.exports.SearchPanel = SearchPanel;
</pre>
<p>As we can see, this panel is a little different than the previous ones because it actually handles its
own local state: When the component should get properties from its parent compoent, its state will
be updated to the <tt class="docutils literal">query</tt> attribute - so the current value of the search query gets updated through
properties. However, when the value of the search input is changed, we see that the local state is
changed immediately but the <tt class="docutils literal">BookActions.search</tt> (or the corresponding callback) gets called <em>only</em>
when the timeout has&nbsp;passed!</p>
<p>The above means that we can type whatever we want on the search input, but it at first it will be used
only locally to immediately update the value of the input and, only after the timeout has fired the
search action will be called. If we hadn&#8217;t used the local state it would be much more difficult to have
this consistent behavior (we&#8217;d need to add two actions, one to handle the search query value change
and another to handle the timeout firing &#8212; making everythimg much more&nbsp;complicated).</p>
</div>
<div class="section" id="messagepanel">
<h3><a class="toc-backref" href="#id10">MessagePanel</a></h3>
<p>The MessagePanel is really interesting because it is a reusable component that actually has its own action and store module! This
component can be reused in <em>different</em> applications that need to display message but <em>not</em> on the same application (because a single state
is kept for all messages). If we wanted to use a different MessagePanel for Books or Authors then we&#8217;d need to keep both in the
state <em>and</em> also it to the action to differentiate between messages for author and for book. Instead, by keeping a single Messages
state for both Books and Authors we have a much more simple&nbsp;version.</p>
<div class="section" id="messagepanel-react-js">
<h4><a class="toc-backref" href="#id11">MessagePanel.react.js</a></h4>
<p>The MessagePanel component has a local state which responds to changes on MessageStore. When the
state of MessageStore is changed the MessagePanel will be re-rendered with the new&nbsp;message.</p>
<pre class="code literal-block">
var React = require('react');
var MessageStore = require('../stores/MessageStore').MessageStore;

var MessagePanel = React.createClass({
    getInitialState: function() {
        return {

        };
    },
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                {this.state.message?&lt;div className={this.state.message.color}&gt;{this.state.message.text}&lt;/div&gt;:&quot;&quot;}
            &lt;/div&gt;
        );
    },
    _onChange: function() {
        this.setState(MessageStore.getState());
    },
    componentWillUnmount: function() {
        MessageStore.removeChangeListener(this._onChange);
    },
    componentDidMount: function() {
        MessageStore.addChangeListener(this._onChange);
    }
})

module.exports.MessagePanel = MessagePanel;
</pre>
</div>
<div class="section" id="messagestore-js">
<h4><a class="toc-backref" href="#id12">MessageStore.js</a></h4>
<p>The MessageStore has a (private) state containing a <tt class="docutils literal">message</tt> that gets updated
only when the ccorresponding action is dispached. The store has a single state
for all messages - it doesn&#8217;t care if the messages are for books or&nbsp;authors.</p>
<pre class="code literal-block">
var $ = require('jquery');
var EventEmitter = require('events').EventEmitter;
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;
var BookConstants = require('../constants/BookConstants')

var _state = {
    message: {}
};

var MessageStore = $.extend({}, EventEmitter.prototype, {
    getState: function() {
        return _state;
    },
    emitChange: function() {
        this.emit('change');
    },
    addChangeListener: function(callback) {
        this.on('change', callback);
    },
    removeChangeListener: function(callback) {
        this.removeListener('change', callback);
    }
});

MessageStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.MESSAGE_ADD:
            _state.message = action.message;
            MessageStore.emitChange();
        break;
    }
    return true;
});

module.exports.MessageStore = MessageStore;
</pre>
</div>
<div class="section" id="messageactions">
<h4><a class="toc-backref" href="#id13">MessageActions</a></h4>
<p>Finally, there are two actions that are defined for the MessageStore: One for adding
an ok message and one for adding an error message - both of which have the same
message type (but pass a different color&nbsp;parameter).</p>
<pre class="code literal-block">
var AppDispatcher = require('../dispatcher/AppDispatcher').AppDispatcher;
var BookConstants = require('../constants/BookConstants')

var MessageActions = {
    add_message_ok: function(msg) {
        AppDispatcher.dispatch({
            actionType: BookConstants.MESSAGE_ADD,
            message: {
                color: 'green',
                text: msg
            }
        });
    },
    add_message_error: function(msg) {
        AppDispatcher.dispatch({
            actionType: BookConstants.MESSAGE_ADD,
            message: {
                color: 'green',
                text: msg
            }
        });
    }
};

module.exports.MessageActions = MessageActions;
</pre>
</div>
</div>
</div>
<div class="section" id="non-reusable-application-components">
<h2><a class="toc-backref" href="#id14">Non-reusable application&nbsp;components</a></h2>
<p>I don&#8217;t want to discuss the source code for all the non-reusable components since some of them
are more or less the same with the previous version and are easy to understand just by
checking the source code (BookTableRow and ButtonPanel). However, I&#8217;ll
discuss the other, more complex components starting from the inside of the&nbsp;react-onion:</p>
<div class="section" id="booktable-react-js">
<h3><a class="toc-backref" href="#id15">BookTable.react.js</a></h3>
<p>I want to display this component to discuss how sorting is implemented: Each column has a key which,
when passed to django-rest-framework will sort the results based on that key (the <tt class="docutils literal">__</tt> does a
join so by <tt class="docutils literal">author__last_name</tt> we mean that we want to sort by the last_name field of the author
of each book. Also, you can pass the key as it is to sort ascending or with a minus (-) in front
(for example <tt class="docutils literal"><span class="pre">-author__last_name</span></tt>).</p>
<pre class="code literal-block">
var React = require('react');
var BookTableRow = require('./BookTableRow.react').BookTableRow;
var BookActions = require('../actions/BookActions').BookActions;

var BookTable = React.createClass({
    render: function() {
        var rows = [];
        this.props.books.forEach(function(book) {
            rows.push(&lt;BookTableRow key={book.id} book={book} /&gt;);
        });
        return (
            &lt;table&gt;
                &lt;thead&gt;
                    &lt;tr&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'id')}&gt;{this.showOrdering('id')} Id&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'title')}&gt;{this.showOrdering('title')} Title&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'subcategory__name')}&gt;{this.showOrdering('subcategory__name')} Category&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'publish_date')}&gt;{this.showOrdering('publish_date')} Publish date&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'author__last_name')}&gt;{this.showOrdering('author__last_name')} Author&lt;/a&gt;&lt;/th&gt;
                        &lt;th&gt;Edit&lt;/th&gt;
                    &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;{rows}&lt;/tbody&gt;
            &lt;/table&gt;
        );
    },
    onClick: function(v, e) {
        e.preventDefault();
        BookActions.sort_books(v);
    },
    showOrdering: function(v) {
        if (v==this.props.ordering) {
            return '+'
        } else if ('-'+v==this.props.ordering) {
            return '-'
        }
    }
});

module.exports.BookTable = BookTable ;
</pre>
<p>The only thing that needs explaining in this module is the line of the&nbsp;form</p>
<pre class="code literal-block">
&lt;th&gt;&lt;a href='#' onClick={this.onClick.bind(this, 'id')}&gt;{this.showOrdering('id')} Id&lt;/a&gt;&lt;/th&gt;
</pre>
<p>that creates the title of each column and triggers ascending or descending sorting on this column by
clicking on it. So, we can see that we&#8217;ve create an onClick function that actually expects a value - the key
to that column. To allow passing that value, we use the bind method of the function object which will
create new a function that has this key as its first parameter. If we didn&#8217;t want to use bind, we&#8217;d need to
creatre 5 different function (onIdClick, onTitleClick etc)! The most common usage of <tt class="docutils literal">bind</tt> is to actually <em>bind</em>
a function to an object (that&#8217;s what the first parameter to this function does)
so that calling this inside that function will refer to that object - here we leave the binding
of the function to the same object and only do the parameter&nbsp;passing.</p>
<p>Also, the showOrdering checks if the current ordering is the same as that column&#8217;s key and displays
either a + (for ascending) or - (for descending) in front of the column&nbsp;title.</p>
</div>
<div class="section" id="authordialog-react-js">
<h3><a class="toc-backref" href="#id16">AuthorDialog.react.js</a></h3>
<p>This is a handmade pop-up dialog that gets displayed when a new author is added (the + button is clicked)
using only css to center it on the screen when it is displayed.
We can see that it is either visible on invisible based on the <tt class="docutils literal">showDialog</tt> input property which actually
is the only input this component requires. When it is visible and the ok or cancel button are pressed
the corresponding action will be dispatched (which will actually close this popup by setting the <tt class="docutils literal">showDialog</tt>
to&nbsp;false):</p>
<pre class="code literal-block">
var React = require('react');
var AuthorActions = require('../actions/AuthorActions').AuthorActions;

var AuthorDialog = React.createClass({

    render: function() {
        if (!this.props.showDialog) {
            return (
                &lt;div /&gt;
            )
        } else {
            return(
                &lt;div className='modal-dialog' id=&quot;dialog-form&quot;  &gt;
                    &lt;label htmlFor=&quot;first_name&quot;&gt;First name:&lt;/label&gt; &lt;input type='text' ref='first_name' name='first_name' /&gt; &lt;br /&gt;
                    &lt;label htmlFor=&quot;last_name&quot;&gt;Last name:&lt;/label&gt; &lt;input type='text' ref='last_name' name='last_name' /&gt; &lt;br /&gt;
                    &lt;button onClick={this.onOk}&gt;Ok&lt;/button&gt;
                    &lt;button onClick={this.onCancel} &gt;Cancel&lt;/button&gt;
                &lt;/div&gt;

            );
        }
    },
    onCancel: function(e) {
        e.preventDefault();
        AuthorActions.hide_add_author();
    },
    onOk: function(e) {
        e.preventDefault();
        first_name = React.findDOMNode(this.refs.first_name).value;
        last_name = React.findDOMNode(this.refs.last_name).value;
        AuthorActions.add_author_ok({
            first_name: first_name,
            last_name: last_name
        });
    }
});

module.exports.AuthorDialog = AuthorDialog ;
</pre>
</div>
<div class="section" id="authorpanel-react-js">
<h3><a class="toc-backref" href="#id17">AuthorPanel.react.js</a></h3>
<p>The AuthorPanel displays the author select DropDown along with the + (add author) and
- (delete author) buttons. It also contains the AuthorDialog which will be displayed
or not depending on the value of the <tt class="docutils literal">showDialog</tt> property.</p>
<pre class="code literal-block">
var React = require('react');
var DropDown = require('./DropDown.react').DropDown;
var AuthorDialog = require('./AuthorDialog.react').AuthorDialog;
var AuthorActions = require('../actions/AuthorActions').AuthorActions;

var AuthorPanel = React.createClass({
    getInitialState: function() {
        return {};
    },
    render: function() {
        var authorExists = false ;
        if(this.props.authors) {
            var ids = this.props.authors.map(function(x) {
                return x.id*1;
            });

            if(ids.indexOf(1*this.props.author)&gt;=0 ) {
                authorExists = true;
            }
        }

        return(
            &lt;div className='one-half column'&gt;
                &lt;AuthorDialog showDialog={this.props.showDialog} /&gt;
                &lt;label forHtml='date'&gt;Author&lt;/label&gt;
                &lt;DropDown options={this.props.authors} dropDownValueChanged={this.props.onAuthorChanged} value={authorExists?this.props.author:''} /&gt;
                &lt;button onClick={this.addAuthor} &gt;+&lt;/button&gt;
                {authorExists?&lt;button onClick={this.deleteAuthor}&gt;-&lt;/button&gt;:&quot;&quot;}
            &lt;/div&gt;
        );
    },
    addAuthor: function(e) {
        e.preventDefault();
        console.log(&quot;ADD AUTHOR&quot;);
        AuthorActions.show_add_author();
    },
    deleteAuthor: function(e) {
        e.preventDefault();
        AuthorActions.delete_author(this.props.author);
        console.log(&quot;DELETE AUTHOR&quot;);
        console.log(this.props.author);
    },
});

module.exports.AuthorPanel = AuthorPanel;
</pre>
<p>As we can see, there are three properties that are passed to this&nbsp;component:</p>
<ul class="simple">
<li><tt class="docutils literal">props.author</tt>: The currently selected&nbsp;author</li>
<li><tt class="docutils literal">props.authors</tt>: The list of all&nbsp;authors</li>
<li><tt class="docutils literal">props.onAuthorChanged</tt>: A callback that is called when the author is changed. Here, we could have used an action (just like for add/delete author) instead of a callback, however its not actually required. When the author is changed, it means that the currently edited book&#8217;s author is changed. So we could propagate the change to the parent (form) component that handles the book change along with the other changes (i.e title, publish date&nbsp;etc).</li>
</ul>
</div>
<div class="section" id="statpanel-react-js">
<h3><a class="toc-backref" href="#id18">StatPanel.react.js</a></h3>
<p>The StatPanel is an interesting, read-only component that displays the number of
authors and books. This component requests updates from both the <tt class="docutils literal">BookStore</tt> and
<tt class="docutils literal">AuthorStore</tt> - when their state is updated the component will be re-rendered
with the number of books and&nbsp;authors:</p>
<pre class="code literal-block">
var React = require('react');
var BookStore = require('../stores/BookStore').BookStore;
var AuthorStore = require('../stores/AuthorStore').AuthorStore;

var StatPanel = React.createClass({
    getInitialState: function() {
        return {};
    },
    render: function() {
        var book_len = '-';
        var author_len = '-';
        if(this.state.books) {
            book_len = this.state.books.length
        }
        if(this.state.authors) {
            author_len = this.state.authors.length
        }
        return(
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    Books number: {book_len}
                &lt;/div&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    Authors number: {author_len}
                &lt;/div&gt;
                &lt;br /&gt;
            &lt;/div&gt;
        );
    },
    _onBookChange: function() {
        this.setState({
            books:BookStore.getState().books
        });
    },
    _onAuthorChange: function() {
        this.setState({
            authors: AuthorStore.getState().authors
        });
    },
    componentWillUnmount: function() {
        AuthorStore.removeChangeListener(this._onAuthorChange);
        BookStore.removeChangeListener(this._onBookChange);
    },
    componentDidMount: function() {
        AuthorStore.addChangeListener(this._onAuthorChange);
        BookStore.addChangeListener(this._onBookChange);
    }
});

module.exports.StatPanel = StatPanel ;
</pre>
<p>We&#8217;ve added different change listeners in case we wanted to do
some more computations for book or author change (instead of just
getting their books / authors property). Of course the same behavior
could be achieved with just a single change listener that would
get both the books and&nbsp;authors.</p>
</div>
<div class="section" id="bookform-react-js">
<h3><a class="toc-backref" href="#id19">BookForm.react.js</a></h3>
<p>The BookForm is one of the most complex panels of this application (along with BookPanel) because
it actually contains a bunch of other panels and has some callbacks for them to&nbsp;use.</p>
<p>We can see that, as explained before, when the current book form values are changed (through callbacks) the change_book action will be&nbsp;called.</p>
<pre class="code literal-block">
var React = require('react');
var BookActions = require('../actions/BookActions').BookActions;
var DropDown = require('./DropDown.react.js').DropDown;
var StatPanel = require('./StatPanel.react.js').StatPanel;
var MessagePanel = require('./MessagePanel.react.js').MessagePanel;
var DatePicker = require('./DatePicker.react.js').DatePicker;
var ButtonPanel = require('./ButtonPanel.react.js').ButtonPanel;
var AuthorPanel = require('./AuthorPanel.react.js').AuthorPanel;
var CategoryStore = require('../stores/CategoryStore').CategoryStore;
var AuthorStore = require('../stores/AuthorStore').AuthorStore;
var loadCategories = require('../stores/CategoryStore').loadCategories;
var loadAuthors = require('../stores/AuthorStore').loadAuthors;

var BookForm = React.createClass({
    getInitialState: function() {
        return {};
    },
    render: function() {
        return(
            &lt;form onSubmit={this.onSubmit}&gt;
                &lt;div className='row'&gt;
                    &lt;div className='one-half column'&gt;
                        &lt;label forHtml='title'&gt;Title&lt;/label&gt;
                        &lt;input ref='title' name='title' type='text' value={this.props.book.title} onChange={this.onTitleChange} /&gt;
                    &lt;/div&gt;
                    &lt;div className='one-half column'&gt;
                        &lt;label forHtml='date'&gt;Publish date&lt;/label&gt;
                        &lt;DatePicker ref='date' onChange={this.onDateChange} value={this.props.book.publish_date} /&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div className='row'&gt;
                    &lt;div className='one-half column'&gt;
                        &lt;label forHtml='category'&gt;Category&lt;/label&gt;
                        &lt;DropDown options={this.state.categories} dropDownValueChanged={this.onCategoryChanged} value={this.props.book.category} /&gt;
                        &lt;DropDown options={this.state.subcategories} dropDownValueChanged={this.onSubCategoryChanged} value={this.props.book.subcategory} /&gt;
                    &lt;/div&gt;
                    &lt;AuthorPanel authors={this.state.authors} author={this.props.book.author} onAuthorChanged={this.onAuthorChanged} showDialog={this.state.showDialog} /&gt;
                &lt;/div&gt;

                &lt;ButtonPanel book={this.props.book}  /&gt;
                &lt;MessagePanel /&gt;
                &lt;StatPanel  /&gt;
            &lt;/form&gt;
        );
    },
    onSubmit: function(e) {
        e.preventDefault();
        BookActions.save(this.props.book)
    },
    onTitleChange: function() {
        this.props.book.title = React.findDOMNode(this.refs.title).value;
        BookActions.change_book(this.props.book);
    },
    onDateChange: function(date) {
        this.props.book.publish_date = date;
        BookActions.change_book(this.props.book);
    },
    onCategoryChanged: function(cat) {
        this.props.book.category = cat;
        this.props.book.subcategory = '';
        BookActions.change_book(this.props.book);
    },
    onSubCategoryChanged: function(cat) {
        this.props.book.subcategory = cat;
        BookActions.change_book(this.props.book);
    },
    onAuthorChanged: function(author) {
        this.props.book.author = author;
        BookActions.change_book(this.props.book);
    },
    _onChangeCategories: function() {
        this.setState(CategoryStore.getState());
    },
    _onChangeAuthors: function() {
        this.setState(AuthorStore.getState());
    },
    componentWillUnmount: function() {
        CategoryStore.removeChangeListener(this._onChangeCategories);
        AuthorStore.removeChangeListener(this._onChangeAuthors);
    },
    componentDidMount: function() {
        CategoryStore.addChangeListener(this._onChangeCategories);
        AuthorStore.addChangeListener(this._onChangeAuthors);
        loadCategories();
        loadAuthors();
    }
});

module.exports.BookForm = BookForm;
</pre>
<p>The above component listens for updates on both Category and Author store to update
when the authors (when an author is added or deleted) and the categories are changed (for example to implement the cascading dropdown
functionality), so the list of authors and the list of categories and subcategoreis are all stored in
the local state. The book that is edited is just passed as a property - actually, this is the only
property that this component needs to&nbsp;work.</p>
</div>
<div class="section" id="bookpanel-react-js">
<h3><a class="toc-backref" href="#id20">BookPanel.react.js</a></h3>
<p>Finally, BookPanel is the last component we&#8217;ll talk about. This is the central component
of the application - however we&#8217;ll see that it is not very complex (since most user interaction
is performed in other components). This component just listens on changes in the BookStore state
and depending on the parameters either displays the &#8220;Loading&#8221; message or the table of books
(depending on the state of ajax calls that load the books). The other parameters like the
list of books, the ordering of the books etc are passed to the child&nbsp;components.</p>
<pre class="code literal-block">
var React = require('react');
var BookStore = require('../stores/BookStore').BookStore;
var BookActions = require('../actions/BookActions').BookActions;
var SearchPanel = require('./SearchPanel.react').SearchPanel;
var BookTable = require('./BookTable.react').BookTable;
var PagingPanel = require('./PagingPanel.react').PagingPanel;
var BookForm = require('./BookForm.react').BookForm;

var reloadBooks = require('../stores/BookStore').reloadBooks;

var BookPanel = React.createClass({
    getInitialState: function() {
        return BookStore.getState();
    },
    render: function() {
        return(
            &lt;div className=&quot;row&quot;&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    {
                        this.state.loading?
                        &lt;div class='loading' &gt;Loading...&lt;/div&gt;:
                        &lt;div&gt;
                            &lt;SearchPanel query={this.state.query} &gt;&lt;/SearchPanel&gt;
                            &lt;BookTable books={this.state.books} ordering={this.state.ordering} /&gt;
                            &lt;PagingPanel page_size='5' total={this.state.total} page={this.state.page} /&gt;
                        &lt;/div&gt;
                    }
                &lt;/div&gt;
                &lt;div className=&quot;one-half column&quot;&gt;
                    &lt;BookForm
                        book={this.state.editingBook}
                    /&gt;
                &lt;/div&gt;
                &lt;br /&gt;
            &lt;/div&gt;
        );
    },
    _onChange: function() {
        this.setState( BookStore.getState() );
    },
    componentWillUnmount: function() {
        BookStore.removeChangeListener(this._onChange);
    },
    componentDidMount: function() {
        BookStore.addChangeListener(this._onChange);
        reloadBooks();
    }
});

module.exports.BookPanel = BookPanel ;
</pre>
</div>
</div>
<div class="section" id="the-actions">
<h2><a class="toc-backref" href="#id21">The&nbsp;Actions</a></h2>
<p>All actions are rather simple components without other dependencies as we&#8217;ve already discussed. They
just define &#8220;actions&#8221; (which are simple functions) that create the correct parameter object type and pass it
to the dispatcher. The only attribute that is required for this object is the <tt class="docutils literal">actionType</tt> that
should get a value from the constants. I won&#8217;t go into any more detail about the actions &#8212; please check
the source code and all your questions will be&nbsp;resolved.</p>
</div>
<div class="section" id="the-stores">
<h2><a class="toc-backref" href="#id22">The&nbsp;Stores</a></h2>
<p>First of all, all stores are defined through the following code that is already discussed in the previous&nbsp;part:</p>
<pre class="code literal-block">
var MessageStore = $.extend({}, EventEmitter.prototype, {
    getState: function() {
        return _state;
    },
    emitChange: function() {
        this.emit('change');
    },
    addChangeListener: function(callback) {
        this.on('change', callback);
    },
    removeChangeListener: function(callback) {
        this.removeListener('change', callback);
    }
});
</pre>
<p>When the state of a store is changed its <tt class="docutils literal">emitChange</tt> function will be called (I mean
called manually from the code that actually changes the state and knows that it has
actually been changed - nothing will be called automatically). When <tt class="docutils literal">emitChange</tt> is called,
all the components that listen for changes for this component (that have called <tt class="docutils literal">addChangeListener</tt>
of the store with a callback)
will be notified (their callback will be called) and will use
<tt class="docutils literal">getState</tt> of the store to get its current state - after that, these components will set their own state
to re-render and display the changes to the&nbsp;store.</p>
<p>Let&#8217;s now discuss the four stores defined &#8212; I will include only the parts of each file that are
actually interesting, for everything else <em>use the source Luke</em>!</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id23">MessageStore.js</a></h3>
<p>A very simple store that goes together with MessagePanel and MessageActions. It just keeps a state with
the current message object and just changes this message when the MESSAGE_ADD message
type is dispatched. After changing the message, the listeners (only one in this case) will be notified to
update the displayed&nbsp;message:</p>
<pre class="code literal-block">
var _state = {
    message: {}
};

MessageStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.MESSAGE_ADD:
            _state.message = action.message;
            MessageStore.emitChange();
        break;
    }
    return true;
});
</pre>
</div>
<div class="section" id="authorstore-js">
<h3><a class="toc-backref" href="#id24">AuthorStore.js</a></h3>
<p>Here we see that the local state has an array of the authors and a <tt class="docutils literal">showDialog</tt> flag that
controls the state of the add author popup. For the <tt class="docutils literal">AUTHOR_ADD</tt> and <tt class="docutils literal">HIDE_ADD_AUTHOR</tt>
cases of the dispatch we just change the state of this flag and emit the change; the <tt class="docutils literal">BookForm</tt>
listens for changes to the <tt class="docutils literal">AuthorStore</tt> and will pass the <tt class="docutils literal">showDialog</tt> to the <tt class="docutils literal">AuthorPanel</tt>
as a property which in turn will pass it to <tt class="docutils literal">AuthorDialog</tt> and it will display the panel (or not)
depending on the value of that flag. This flag will also take a false value when the add author
ajax call&nbsp;returns.</p>
<p>The <tt class="docutils literal">showDialog</tt> flag is not related to the actual data but is <span class="caps">UI</span>-related. This
is something that we should keep in mind when creating stores: Stores don&#8217;t only contain the actual
data (like models in an <span class="caps">MVC</span> application) but they should also contain <span class="caps">UI</span> (controller/view in an <span class="caps">MVC</span>
architecture) related information since that is <em>also</em> part of the&nbsp;state!</p>
<p>We can see that the ajax calls just issue the corresponding <span class="caps">HTTP</span> method to the <tt class="docutils literal">authors_url</tt> and
when they return the <tt class="docutils literal">add_message_ok</tt> or <tt class="docutils literal">add_message_error</tt> methods of
<tt class="docutils literal">MessageActions</tt> will be called. These calls are in a different call stack so everything will work fine
(please remember the discussion about dispatches in different call stacks&nbsp;before).</p>
<p>Finally, on the success of <tt class="docutils literal">_load_authors</tt> the map array method is called to transform the returned data
as we want&nbsp;it:</p>
<pre class="code literal-block">
var $ = require('jquery');

var _state = {
    authors: [],
    showDialog: false
}

var _load_authors = function() {
    $.ajax({
        url: _props.authors_url,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.authors = data.map(function(a){
                return {
                    id: a.id,
                    name: a.last_name+' '+a.first_name
                }
            });
            AuthorStore.emitChange();
        },
        error: function(xhr, status, err) {
            MessageActions.add_message_error(err.toString());
        }
    });
};

var _deleteAuthor = function(authorId) {
    $.ajax({
        url: _props.authors_url+authorId,
        method: 'DELETE',
        cache: false,
        success: function(data) {
            _load_authors();
            MessageActions.add_message_ok(&quot;Author delete ok&quot;);
            AuthorActions.delete_author_ok();
        },
        error: function(xhr, status, err) {
            MessageActions.add_message_error(err.toString());
        }
    });
};

var _addAuthor = function(author) {
    $.ajax({
        url: _props.authors_url,
        dataType: 'json',
        method: 'POST',
        data:author,
        cache: false,
        success: function(data) {
            MessageActions.add_message_ok(&quot;Author add  ok&quot;);
            _state.showDialog = false;
            _load_authors();
        },
        error: function(xhr, status, err) {
            MessageActions.add_message_error(err.toString());
        }
    });

};

AuthorStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.SHOW_ADD_AUTHOR:
            _state.showDialog = true;
            AuthorStore.emitChange();
        break;
        case BookConstants.HIDE_ADD_AUTHOR:
            _state.showDialog = false;
            AuthorStore.emitChange();
        break;
        case BookConstants.AUTHOR_ADD:
            _addAuthor(action.author);
        break;
        case BookConstants.AUTHOR_DELETE:
            _deleteAuthor(action.authorId);
        break;
    }
    return true;
});
</pre>
</div>
<div class="section" id="categorystore-js">
<h3><a class="toc-backref" href="#id25">CategoryStore.js</a></h3>
<p>The CategoryStore has an interesting functionality concerning the load_subcategory
function. This function is called whenever a book is changed (so its category form field
may be changed and the subcategories may be reloaded based on this category) or is edited
(so the category is that of the new book and once again the subcategories may need to because
rerendered). It is important that we <em>actually</em> pass the current category to the book to the
action. If for example we wanted to retrieve that from the state of the BookStore then we&#8217;d
need to use the <tt class="docutils literal">waitFor</tt> functionality of the dispatcher so that the category of the
current book would be changed first then the load_category (that would read that value to
read the subcategoreis) would be called after&nbsp;that.</p>
<p>Also, another thing to notice here is that there&#8217;s a simple subcat_cache that for each category
contains the subcategories of that category so that we won&#8217;t do repeated ajax calls to reload
the subcategories each time the category is&nbsp;changed.</p>
<pre class="code literal-block">
var _state = {
    categories: [],
    subcategories: []
}

var _current_cat = ''
var _subcat_cache = []

var _load_categories = function() {
    $.ajax({
        url: _props.categories_url,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.categories = data;
            CategoryStore.emitChange();
        },
        error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
        }
    });
};

var _load_subcategories = function(cat) {

    if(!cat) {
        _state.subcategories = [];
        CategoryStore.emitChange();
        return ;
    }
    if(_subcat_cache[cat]) {
        _state.subcategories = _subcat_cache[cat] ;
        CategoryStore.emitChange();
    }
    $.ajax({
        url: _props.subcategories_url+'?category='+cat,
        dataType: 'json',
        cache: false,
        success: function(data) {
            _state.subcategories = data;
            _subcat_cache[cat] = data;
            CategoryStore.emitChange();
        },
        error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
        }
    });
};

CategoryStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
        case BookConstants.BOOK_CHANGE:
            _load_subcategories(action.book.category);
        break;
        case BookConstants.BOOK_EDIT_CANCEL:
            _state.subcategories = [];
            CategoryStore.emitChange();
        break;
    }
    return true;
});
</pre>
</div>
<div class="section" id="bookstore-js">
<h3><a class="toc-backref" href="#id26">BookStore.js</a></h3>
<p>Here, beyond the book-related functionality we have also implemented the
<span class="caps">URL</span> updating. The getUrlParameter that returns the value of a <span class="caps">URL</span> parameter has been taken from
<a class="reference external" href="http://stackoverflow.com/questions/19491336/get-url-parameter-jquery">http://stackoverflow.com/questions/19491336/get-url-parameter-jquery</a>. Depending on the url parameters, we set some initial properties of
the local state and, on the other hand, when the search query, ordering or page are changed,
the <tt class="docutils literal">_update_href</tt> function is called to update the url parameters. This is not really related
to the flux architecture beyond the initialization of&nbsp;state.</p>
<p>Another thing to notice is that the when the <tt class="docutils literal">_search</tt> is executed whenever there&#8217;s
a change in the list of books (query is updated, sorting is changed, page is changed or
when an author is deleted since the books that have that author should now display an
empty field). The setTimeout in the _search ajax return is to simulate a 400ms delay (in order for the &#8220;Loading&#8221; text to
be&nbsp;visible).</p>
<pre class="code literal-block">
function getUrlParameter(sParam) {
    var sPageURL = $(location).attr('hash');
    sPageURL = sPageURL.substr(1)
    var sURLVariables = sPageURL.split('&amp;');
    for (var i = 0; i &lt; sURLVariables.length; i++)  {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam)  {
            return sParameterName[1];
        }
    }
}

var _page_init = 1*getUrlParameter('page');
if(!_page_init) _page_init = 1 ;
var _ordering_init = getUrlParameter('ordering');
if(!_ordering_init) _ordering_init = '' ;
var _query_init = getUrlParameter('query');
if(!_query_init) _query_init = ''

var _state = {
    loading: false,
    books: [],
    message:{},
    page: _page_init,
    total: 0,
    editingBook: {},
    query: _query_init,
    ordering: _ordering_init
}


var _search = function() {
    _state.loading = true;
    BookStore.emitChange();

    $.ajax({
        url: _props.url+'?search='+_state.query+&quot;&amp;ordering=&quot;+_state.ordering+&quot;&amp;page=&quot;+_state.page,
        dataType: 'json',
        cache: false,
        success: function(data) {
            // Simulate a small delay in server response
            setTimeout(function() {
                _state.books = data.results;
                _state.total = data.count;
                _state.loading = false;
                BookStore.emitChange();
            }, 400);
        },
        error: function(xhr, status, err) {
            _state.loading = false;
            MessageActions.add_message_error(err.toString());
            BookStore.emitChange();
        }
    });
};

var _reloadBooks = function() {
    _search('');
};


var _clearEditingBook = function() {
    _state.editingBook = {};
};

var _editBook = function(book) {
    _state.editingBook = book;
    BookStore.emitChange();
};

var _cancelEditBook = function() {
    _clearEditingBook();
    BookStore.emitChange();
};

var _update_href = function() {
    var hash = 'page='+_state.page;
    hash += '&amp;ordering='+_state.ordering;
    hash += '&amp;query='+_state.query;
    $(location).attr('hash', hash);
}

BookStore.dispatchToken = AppDispatcher.register(function(action) {
    switch(action.actionType) {
        case BookConstants.BOOK_EDIT:
            _editBook(action.book);
        break;
        case BookConstants.BOOK_EDIT_CANCEL:
            _cancelEditBook();
        break;
        case BookConstants.BOOK_SAVE:
            _saveBook(action.book);
        break;
        case BookConstants.BOOK_SEARCH:
            _state.query = action.query
            _state.page = 1;
            _update_href();
            _search();
        break;
        case BookConstants.BOOK_DELETE:
            _deleteBook(action.bookId);
        break;
        case BookConstants.BOOK_CHANGE:
            _state.editingBook = action.book;
            BookStore.emitChange();
        break;
        case BookConstants.BOOK_PAGE:
            _state.page = action.page;
            _update_href();
            _search();
        break;
        case BookConstants.AUTHOR_DELETE_OK:
            _search();
        break;
        case BookConstants.BOOK_SORT:
            _state.page = 1;
            if(_state.ordering == action.field) {
                _state.ordering = '-'+_state.ordering
            } else {
                _state.ordering = action.field;
            }
            _update_href();
            _search();
        break;
    }
    return true;
});
</pre>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id27">Conclusion</a></h2>
<p>The application presented here has a number of techniques that will help
you when you actually try to create a more complex react flux application.
I hope that in the whole three part series I&#8217;ve thoroughly explained the
flux architecture and how each
part of (actions, stores, components) it works. Also, I tried to cover
almost anything that somebody creating react/flux application
will need to use &#8212; if you feel that something is not covered and
could be integrated to the authors/book application I&#8217;d be happy
to research and implement&nbsp;it!</p>
</div>
</div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://spapas.github.io/2015/09/01/django-rq-redux/">django-rq redux: advanced techniques and tools</a>
      </h1>
    <p class="meta">
<time datetime="2015-09-01T14:20:00+03:00" pubdate>Τρι 01 Σεπτέμβριος 2015</time>    </p>
</header>

<div class="entry-content"><div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#displaying-your-task-progress" id="id2">Displaying your task&nbsp;progress</a></li>
<li><a class="reference internal" href="#displaying-your-queue-statistics" id="id3">Displaying your queue&nbsp;statistics</a></li>
<li><a class="reference internal" href="#making-sure-that-workers-for-your-queue-are-actually-running" id="id4">Making sure that workers for your queue are actually&nbsp;running</a></li>
<li><a class="reference internal" href="#checking-how-many-jobs-are-in-the-queue" id="id5">Checking how many jobs are in the&nbsp;queue</a></li>
<li><a class="reference internal" href="#better-exception-handling" id="id6">Better exception&nbsp;handling</a></li>
<li><a class="reference internal" href="#multiple-django-apps-single-redis-db" id="id7">Multiple django-apps, single redis&nbsp;db</a></li>
<li><a class="reference internal" href="#low-level-debugging" id="id8">Low level&nbsp;debugging</a></li>
<li><a class="reference internal" href="#conclusion" id="id9">Conclusion</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a></h2>
<p>In the <a class="reference external" href="https://spapas.github.io/2015/01/27/async-tasks-with-django-rq/">previous django-rq article</a>
we presented a quick introduction to asynchronous job queues and created a
small (but complete) project that used rq and django-rq to implement asynchronous
job queues in a django&nbsp;project.</p>
<p>In this article, we will present some more advanced techniques and tools
for improving the capabilities of our asynchronous tasks and
integrate them to the <a class="reference external" href="https://github.com/spapas/django-test-rq">https://github.com/spapas/django-test-rq</a> project (please
checkout tag django-rq-redux
<tt class="docutils literal">git checkout <span class="pre">django-rq-redux</span></tt>)</p>
</div>
<div class="section" id="displaying-your-task-progress">
<h2><a class="toc-backref" href="#id2">Displaying your task&nbsp;progress</a></h2>
<p>Sometimes, especially for long-running tasks it is useful to let
the user (task initiator) know what is the status of each task he&#8217;s started. For this,
I recommend creating a task-description model that will hold the required information for this
task with more or less the following fields (please also check <tt class="docutils literal">LongTask</tt> model of&nbsp;django-test-rq):</p>
<pre class="code literal-block">
class LongTask(models.Model):
  created_on = models.DateTimeField(auto_now_add=True)
  name = models.CharField(max_length=128, help_text='Enter a unique name for the task',)
  progress = models.PositiveIntegerField(default=0)
  result = models.CharField(max_length=128, blank=True, null=True)
</pre>
<p>Now, when the view that starts the task is <tt class="docutils literal"><span class="caps">POST</span></tt> ed, you&#8217;ll first create
the <tt class="docutils literal">LongTask</tt> model instance with a result of <tt class="docutils literal">'<span class="caps">QUEUED</span>'</tt> and a progress
of 0 (and a name that identifies your task) and then you&#8217;ll start the real task
asynchronously by passing the LongTask instance, something like this (also check
<tt class="docutils literal">LongTaskCreateView</tt>):</p>
<pre class="code literal-block">
long_task = LongTask.objects.create(...)
long_runnig_task.delay(long_task)
</pre>
<p>In your asynchronous job, the first thing you&#8217;ll need to do is to set its result
to &#8216;<span class="caps">STARTED</span>&#8217; and save it so that the user will immediately see when he&#8217;s job is
actually started. Also, if you can estimate its progress, you can update its
progress value with the current value so that the user will know how close he
is to finishing. Finally, when the job finished (or if it throws an expectable
exception) you&#8217;ll update its status accordingly. Here&#8217;s an example of my
long_running_task that just waits for the specifid amount of&nbsp;seconds:</p>
<pre class="code literal-block">
&#64;job('django-test-rq-low')
def long_runnig_task(task):
  job = get_current_job()
  task.job_id = job.get_id()

  task.result = 'STARTED'

  duration_in_second_persentages = task.duration*1.0 / 100
  for i in range(100):
      task.progress = i
      task.save()
      print task.progress
      time.sleep(duration_in_second_persentages)

  task.result = 'FINISHED'
  task.save()
  return task.result
</pre>
<p>To have proper feedback I propose to have your task-description model instance
created by the view that starts the asynchronous task and <em>not</em> by the
actual task! This is important since the worker may be full so the asynchronous
task will need a lot of time until is actually started (or maybe there are no
running workers - more on this later) and the user will not be able to see
his task instance anywhere (unless of course you provide him access to the actual task
queue but I don&#8217;t recommend&nbsp;this).</p>
</div>
<div class="section" id="displaying-your-queue-statistics">
<h2><a class="toc-backref" href="#id3">Displaying your queue&nbsp;statistics</a></h2>
<p>django-rq has a really nice dashboard with a lot of queue statistics (
instructions here
<a class="reference external" href="https://github.com/ui/django-rq#queue-statistics">https://github.com/ui/django-rq#queue-statistics</a> and also on django-test-rq
project) which I recommend to always&nbsp;enable.</p>
<p>Also, there&#8217;s the individual use <a class="reference external" href="https://github.com/brutasse/django-rq-dashboard">django-rq-dashboard</a> project that could
be installed to display some more statistics, however the only extra
statistic that you can see throuh django-rq-dashboard is the status of
your scheduled jobs so I don&#8217;t recommend installing it if you don&#8217;t
use&nbsp;scheduling.</p>
</div>
<div class="section" id="making-sure-that-workers-for-your-queue-are-actually-running">
<h2><a class="toc-backref" href="#id4">Making sure that workers for your queue are actually&nbsp;running</a></h2>
<p>Using the django-rq dashboard you can make sure that all queues
have at least one worker. However, sometimes workers fail, or
maybe you&#8217;ve forgotten to start your workers or not configured
your application correctly (this happens to me all the time for
test/uat projects). So, for tasks that you want to display feedback
to the user, you can easily add a check to make sure that there are
active workers using the following&nbsp;code:</p>
<pre class="code literal-block">
from rq import Worker
import django_rq

redis_conn = django_rq.get_connection('default')
if len([
    x for x in Worker.all(connection=redis_conn)
        if 'django-test-rq-low' in x.queue_names()
]) == 0:
    # Error -- no workers
</pre>
<p>With <tt class="docutils literal">Worker.all()</tt> you get all workers for a connection and the <tt class="docutils literal">queue_names()</tt>
method returns the names that each worker serves. So we check that we have at least one
worker for that&nbsp;queue.</p>
<p>This check can be added when the job is started and display a feedback error
to the user (check example in&nbsp;django-test-rq).</p>
<p>For quick tasks (for example sending emails etc) you should not display anything
to the user even if no workers are running (since the task <em>will</em> be queued and
will be executed eventually when the workers are started) but instead send an email to the administrators
so that they will start the&nbsp;workers.</p>
</div>
<div class="section" id="checking-how-many-jobs-are-in-the-queue">
<h2><a class="toc-backref" href="#id5">Checking how many jobs are in the&nbsp;queue</a></h2>
<p>To find out programatically how many jobs are actually in the queue (and display a message
if the queue has too many jobs etc) you&#8217;ll need to use the <tt class="docutils literal">Queue</tt> class, something like&nbsp;this:</p>
<pre class="code literal-block">
from rq import Queue

redis_conn = django_rq.get_connection('default')
queue = Queue('django-test-rq-default', connection=redis_conn)
print queue.name
print len(queue.jobs)
</pre>
</div>
<div class="section" id="better-exception-handling">
<h2><a class="toc-backref" href="#id6">Better exception&nbsp;handling</a></h2>
<p>When a job fails, rq will put it in a failed jobs queue and finish with it. You (as administrator)
won&#8217;t get any feedback and the user (unless he has access to that failed jobs queue) won&#8217;t be
able to do anything aboutt this&nbsp;job.</p>
<p>In almost all cases you can&#8217;t rely only on this behavior but instead you have to
<a class="reference external" href="http://python-rq.org/docs/exceptions/">install a custom exception handler</a>. Using the custom exception handler you can
do whatever you want for each failed job. For instance, you can create a new instance
of a <tt class="docutils literal">FailedTask</tt> model which will have information about the failure and the
original task allow the user (or administrator) to restart the failed task after
he&#8217;s fixed the error&nbsp;conditions.</p>
<p>Or, if you want to be informed when a job is failed, you can just send an email
to <tt class="docutils literal"><span class="caps">ADMINS</span></tt> and fall back to the default behavior to enqueue the failed task the
failed jobs queue (since job exception handlers can be&nbsp;chained).</p>
<p>A simple management command that starts a worker for a specific queue and installs
a custom exception handler&nbsp;follows:</p>
<pre class="code literal-block">
from django.conf import settings
from django.core.management.base import BaseCommand

import django_rq
from rq import Queue, Worker

def my_handler(job, *exc_info):
    print &quot;FAILURE&quot;
    print job
    print exc_info

class Command(BaseCommand):
    def handle(self, *args, **options):
        redis_conn = django_rq.get_connection('default')

        q = Queue(settings.DJANGO_TEST_RQ_LOW_QUEUE, connection=redis_conn)
        worker = Worker([q], exc_handler=my_handler, connection=redis_conn)
        worker.work()
</pre>
<p>This handler is for demonstration purposes since it just prints a message to the console
(so please do not use&nbsp;it)!</p>
</div>
<div class="section" id="multiple-django-apps-single-redis-db">
<h2><a class="toc-backref" href="#id7">Multiple django-apps, single redis&nbsp;db</a></h2>
<p>One thing to keep in mind is that the only thing that seperates the queues are
their name. If you have many django applications that define a &#8220;default&#8221; (or &#8220;low&#8221;, &#8220;hight&#8221; etc)
and they all use the <em>same</em> redis database to store their queue, the workers
of each application won&#8217;t know which jobs belong to them and they&#8217;ll end up
dequeuing the wrong job types. This will lead to an exception or, if you
are really unlucky to a very nasty&nbsp;bug!</p>
<p>To avoid this, you can either use a different redis database (not database server)
for each of your apps or add a prefix with the name of your app to your queue&nbsp;names:</p>
<p>Each redis database server can host a number of databases that are identified
by a number (that&#8217;s what the /0 you see in <tt class="docutils literal"><span class="pre">redis://127.0.0.1:6379/0</span></tt> means)
and each one of them has a totally different keyspace. So, if you use /0 in an
application and /1 in another application, you&#8217;ll have no problems. This solution
has the disadvantage that you need to be really careful to use different database
numbers for your projects and also the number of possible databases that redis
can use is limited by a configuration file (so if you reach the maximum you&#8217;ll
need to also increase that&nbsp;number)!</p>
<p>Instead of this, you can avoid using the &#8216;default&#8217; queue, and use queues that
contain your application name in their name, for example, for the sample project
you could create something like &#8216;django-test-rq-default&#8217;, &#8216;django-test-rq-low&#8217;,
&#8216;django-test-rq-high&#8217; etc. You need to configure the extra queues by adding them
to the <tt class="docutils literal">RQ_QUEUES</tt> dictionary (check settings.py of django-test-rq) and then
put the jobs to these queues using for example the job decorator
(<tt class="docutils literal"><span class="pre">&#64;job('django-test-rq-default')</span></tt>)
and run your workers so that they will retrieve jobs from these queues
(<tt class="docutils literal">python manage.py rqworker <span class="pre">django-test-rq-default</span></tt>) and not the
default one (which may contain jobs of other&nbsp;applications).</p>
<p>If you use the default queue, and because you&#8217;ll need to use its name to
many places, I recommend to add a (f.i) <tt class="docutils literal">QUEUE_NAME = <span class="pre">'django-test-rq-default'</span></tt>
setting and use this instead of just a string to be totally <span class="caps">DRY</span>.</p>
<p><strong>Update 13/09/2015</strong>: Please notice that using a <em>single</em> redis database server
(either with multiple numeric databases or in the same database using a keyword
in keys to differentiate the apps) <a class="reference external" href="https://redislabs.com/blog/benchmark-shared-vs-dedicated-redis-instances#.VfUl0xHtmko">is not recommended</a> as commenter
Itamar Haber pointed out to&nbsp;me!</p>
<p>This is because for speed reasons redis uses a single thread to handle all requests
(regardless if they are in the same or different numerical databases), so all
resources may be used by a single, redis hungry, application and leave all others to&nbsp;starve!</p>
<p>Therefore, the recommended solution is to have a <em>different redis</em> server for each different
application. This does not mean that you need to have different servers, just to run
different instances of redis binding to different <span class="caps">IP</span> ports. Redis uses very little
resourecs when it is idle (<a class="reference external" href="http://redis.io/topics/faq">empty instance uses ~ 1 <span class="caps">MB</span> <span class="caps">RAM</span></a>) so you can run a lot
of instances in a single&nbsp;server.</p>
<p>Long story short, my proposal is to have a redis.conf <em>inside</em> your application root tree
(next to manage.py and requirements.txt) which has the redis options for each
application. The options in redis.conf that need to be changed per application
is the port that this redis instance will bind (this port also needs to be passed to
django settings.py) and the pid filename if you daemonize redis &#8212; I recommend using
a tool like <a class="reference external" href="http://supervisord.org/">supervisord</a> instead so that you won&#8217;t need any daemonizing and pid files for
each&nbsp;per-app-redis-instance!</p>
</div>
<div class="section" id="low-level-debugging">
<h2><a class="toc-backref" href="#id8">Low level&nbsp;debugging</a></h2>
<p>In this section I&#8217;ll present some commands that you can issue to your redis
server using a simple telnet connection to get various info about your queues. You
probably will never need to issue these commands to actually debug, but they
will answer some of your (scientific) questions! In the following, <tt class="docutils literal">&gt;</tt> is
things I type, <tt class="docutils literal">#</tt> are comments, <tt class="docutils literal"><span class="pre">[...]</span></tt> is more output and everything else is the output I&nbsp;get:</p>
<pre class="code literal-block">
&gt; telnet 127.0.0.1 6379

# You won't see anything at first but you'll be connected and you can try typing things

&gt; INFO

$1020
redis_version:2.4.10
redis_git_sha1:00000000
# [...]
db0:keys=83,expires=2
db1:keys=26,expires=1 # My redis server has two databases

# Now you'll see what you type!

&gt; SELECT 1
+ OK # Now queries will be issued to database 1
&gt; SELECT 0
+ OK # Now queries will be issued to database 0

KEYS rq* # List all rq related queues
*25
$43
rq:job:1d7afa32-3f90-4502-912f-d58eaa049fb1
$43
rq:queue:django-test-rq-low
$43
[...]

&gt; SMEMBERS rq:workers # See workers
*1
$26
rq:worker:SERAFEIM-PC.6892

&gt; LRANGE rq:queue:django-test-rq-low 0 100 # Check queued jobs
*2
$36
def896f4-84cb-4833-be6a-54d917f05271
$36
53cb1367-2fb5-46b3-99b2-7680397203b9

&gt; HGETALL rq:job:def896f4-84cb-4833-be6a-54d917f05271 # Get info about this job
*16
$6
status
$6
queued
$11
description
$57
tasks.tasks.long_runnig_task(&lt;LongTask: LongTask object&gt;)
$10
created_at
$20
2015-09-01T09:04:38Z
$7
timeout
$3
180
$6
origin
$18
django-test-rq-low
$11
enqueued_at
$20
2015-09-01T09:04:38Z
$4
data
$409
[...] # data is the pickled parameters passed to the job !

&gt; HGET rq:job:def896f4-84cb-4833-be6a-54d917f05271 status # Get only status
$6
queued
</pre>
<p>For more info on querying redis you can check the <a class="reference external" href="http://redis.io/documentation">redis documentation</a> and especially
<a class="reference external" href="http://redis.io/topics/data-types">http://redis.io/topics/data-types</a> and <a class="reference external" href="http://redis.io/commands">http://redis.io/commands</a>.</p>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#id9">Conclusion</a></h2>
<p>Using some of the above techniques will help you in your asynchronous
task adventures with rq. I&#8217;ll try to keep this article updated with
any new techniques or tools I find in the&nbsp;future!</p>
</div>
</div>
  		</article>
<div class="pagination">
    <a class="prev" href="https://spapas.github.io/index7.html">&larr; Older</a>

    <a class="next" href="https://spapas.github.io/index5.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  <section>
    <br />
    <a href='/feeds/all.atom.xml'>Atom</a>
    |
    <a href='/feeds/all.rss.xml'>RSS</a>
  </section>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- Sidebar unit -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7673322832689008" data-ad-slot="2720624730"
    data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <section>
    <h1>Subscribe</h1>
    Do you want to get notified via email when I post new content?
    <style>
      .subscribe-button {
        /* margin: 10px !important; */
        padding: 10px !important;
        background-color: black;
        display: inline-block;
        color: white !important;
        text-decoration: none;

        line-height: 36px !important;
        height: 37px !important;
        text-decoration: none !important;
        display: inline-block !important;
        color: #ffffff !important;
        background-color: #000000 !important;
        border-radius: 3px !important;
        border: 1px solid transparent !important;
        padding: 1px 9px !important;
        font-size: 23px !important;
        letter-spacing: 0.6px !important;
        box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
        -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
        margin: 0 auto !important;
        font-family: 'Cookie', cursive !important;
        -webkit-box-sizing: border-box !important;
        box-sizing: border-box !important;
        -o-transition: 0.3s all linear !important;
        -webkit-transition: 0.3s all linear !important;
        -moz-transition: 0.3s all linear !important;
        -ms-transition: 0.3s all linear !important;
        transition: 0.3s all linear !important;

      }
    </style>
    <a class='subscribe-button' target="_blank" href="http://eepurl.com/dxI3PP">Click here to subscribe!</a>
  </section>

  <style>
    .bmc-button img {
      width: 27px !important;
      margin-bottom: 3px !important;
      box-shadow: none !important;
      border: none !important;
      vertical-align: middle !important;
    }

    .bmc-button {
      line-height: 36px !important;
      height: 37px !important;
      text-decoration: none !important;
      display: inline-block !important;
      color: #ffffff !important;
      background-color: #000000 !important;
      border-radius: 3px !important;
      border: 1px solid transparent !important;
      padding: 1px 9px !important;
      font-size: 23px !important;
      letter-spacing: 0.6px !important;
      ;
      box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;
      -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      margin: 0 auto !important;
      font-family: 'Cookie', cursive !important;
      -webkit-box-sizing: border-box !important;
      box-sizing: border-box !important;
      -o-transition: 0.3s all linear !important;
      -webkit-transition: 0.3s all linear !important;
      -moz-transition: 0.3s all linear !important;
      -ms-transition: 0.3s all linear !important;
      transition: 0.3s all linear !important;
    }

    .bmc-button:hover,
    .bmc-button:active,
    .bmc-button:focus {
      -webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      text-decoration: none !important;
      box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;
      opacity: 0.85 !important;
      color: #ffffff !important;
    }
  </style>
  <link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet">


  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
        <a href="https://spapas.github.io/2019/10/17/declarative-ecto-query-sorting/">Declarative Ecto query sorting</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/10/03/html-form-submit-php/">How to properly handle an HTML form</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/07/25/declarative-ecto-query-filters/">Declarative Ecto query filters</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/06/04/phoenix-form-select2-ajax/">Phoenix forms integration with select2 and ajax</a>
      </li>
      <li class="post">
        <a href="https://spapas.github.io/2019/04/05/android-custom-filter-adapter/">How to create a custom filtered adapter in Android</a>
      </li>
    </ul>
  </section>
  <section>

    <h1>Categories</h1>
    <ul id="recent_posts">
      <li><a href="https://spapas.github.io/category/android.html">android</a></li>
      <li><a href="https://spapas.github.io/category/css.html">css</a></li>
      <li><a href="https://spapas.github.io/category/django.html">django</a></li>
      <li><a href="https://spapas.github.io/category/elixir.html">elixir</a></li>
      <li><a href="https://spapas.github.io/category/flask.html">flask</a></li>
      <li><a href="https://spapas.github.io/category/git.html">git</a></li>
      <li><a href="https://spapas.github.io/category/html.html">html</a></li>
      <li><a href="https://spapas.github.io/category/javascript.html">javascript</a></li>
      <li><a href="https://spapas.github.io/category/pelican.html">pelican</a></li>
      <li><a href="https://spapas.github.io/category/postgresql.html">postgresql</a></li>
      <li><a href="https://spapas.github.io/category/python.html">python</a></li>
      <li><a href="https://spapas.github.io/category/spring.html">spring</a></li>
      <li><a href="https://spapas.github.io/category/unix.html">unix</a></li>
      <li><a href="https://spapas.github.io/category/wagtail.html">wagtail</a></li>
    </ul>
  </section>

  <section>
    <h1>Tags</h1>
    <a href="https://spapas.github.io/tag/less.html">less</a>,    <a href="https://spapas.github.io/tag/rest.html">rest</a>,    <a href="https://spapas.github.io/tag/query.html">query</a>,    <a href="https://spapas.github.io/tag/ecto.html">ecto</a>,    <a href="https://spapas.github.io/tag/tables.html">tables</a>,    <a href="https://spapas.github.io/tag/pivot_table.html">pivot_table</a>,    <a href="https://spapas.github.io/tag/console.html">console</a>,    <a href="https://spapas.github.io/tag/async.html">async</a>,    <a href="https://spapas.github.io/tag/django-rq.html">django-rq</a>,    <a href="https://spapas.github.io/tag/github-pages.html">github-pages</a>,    <a href="https://spapas.github.io/tag/forms.html">forms</a>,    <a href="https://spapas.github.io/tag/yaml.html">yaml</a>,    <a href="https://spapas.github.io/tag/404.html">404</a>,    <a href="https://spapas.github.io/tag/ldap.html">ldap</a>,    <a href="https://spapas.github.io/tag/immutable.html">immutable</a>,    <a href="https://spapas.github.io/tag/initd.html">init.d</a>,    <a href="https://spapas.github.io/tag/youtube-dl.html">youtube-dl</a>,    <a href="https://spapas.github.io/tag/python.html">python</a>,    <a href="https://spapas.github.io/tag/django-extensions.html">django-extensions</a>,    <a href="https://spapas.github.io/tag/class-based-views.html">class-based-views</a>,    <a href="https://spapas.github.io/tag/scipy.html">scipy</a>,    <a href="https://spapas.github.io/tag/grid.html">grid</a>,    <a href="https://spapas.github.io/tag/ag-grid.html">ag-grid</a>,    <a href="https://spapas.github.io/tag/du.html">du</a>,    <a href="https://spapas.github.io/tag/watchify.html">watchify</a>,    <a href="https://spapas.github.io/tag/settings.html">settings</a>,    <a href="https://spapas.github.io/tag/flux.html">flux</a>,    <a href="https://spapas.github.io/tag/fixeddatatable.html">FixedDataTable</a>,    <a href="https://spapas.github.io/tag/queries.html">queries</a>,    <a href="https://spapas.github.io/tag/debug.html">debug</a>,    <a href="https://spapas.github.io/tag/imgur.html">imgur</a>,    <a href="https://spapas.github.io/tag/security.html">security</a>,    <a href="https://spapas.github.io/tag/npm.html">npm</a>,    <a href="https://spapas.github.io/tag/hyperapp.html">hyperapp</a>,    <a href="https://spapas.github.io/tag/spring.html">spring</a>,    <a href="https://spapas.github.io/tag/react-redux.html">react-redux</a>,    <a href="https://spapas.github.io/tag/cron.html">cron</a>,    <a href="https://spapas.github.io/tag/babelify.html">babelify</a>,    <a href="https://spapas.github.io/tag/design.html">design</a>,    <a href="https://spapas.github.io/tag/tutorial.html">tutorial</a>,    <a href="https://spapas.github.io/tag/gmail.html">gmail</a>,    <a href="https://spapas.github.io/tag/reportlab.html">reportlab</a>,    <a href="https://spapas.github.io/tag/rq.html">rq</a>,    <a href="https://spapas.github.io/tag/redis.html">redis</a>,    <a href="https://spapas.github.io/tag/python-3.html">python-3</a>,    <a href="https://spapas.github.io/tag/research.html">research</a>,    <a href="https://spapas.github.io/tag/werkzeug.html">werkzeug</a>,    <a href="https://spapas.github.io/tag/jobs.html">jobs</a>,    <a href="https://spapas.github.io/tag/redux-thunk.html">redux-thunk</a>,    <a href="https://spapas.github.io/tag/disk-usage.html">disk-usage</a>,    <a href="https://spapas.github.io/tag/javascript.html">javascript</a>,    <a href="https://spapas.github.io/tag/component.html">component</a>,    <a href="https://spapas.github.io/tag/ajax.html">ajax</a>,    <a href="https://spapas.github.io/tag/elixir.html">elixir</a>,    <a href="https://spapas.github.io/tag/ipython.html">ipython</a>,    <a href="https://spapas.github.io/tag/uglify.html">uglify</a>,    <a href="https://spapas.github.io/tag/configuration.html">configuration</a>,    <a href="https://spapas.github.io/tag/properties.html">properties</a>,    <a href="https://spapas.github.io/tag/bash.html">bash</a>,    <a href="https://spapas.github.io/tag/es6.html">es6</a>,    <a href="https://spapas.github.io/tag/spring-boot.html">spring-boot</a>,    <a href="https://spapas.github.io/tag/postgresql.html">postgresql</a>,    <a href="https://spapas.github.io/tag/kotlin.html">kotlin</a>,    <a href="https://spapas.github.io/tag/adapter.html">adapter</a>,    <a href="https://spapas.github.io/tag/filter.html">filter</a>,    <a href="https://spapas.github.io/tag/flask.html">flask</a>,    <a href="https://spapas.github.io/tag/notebook.html">notebook</a>,    <a href="https://spapas.github.io/tag/static-html.html">static-html</a>,    <a href="https://spapas.github.io/tag/pdf.html">pdf</a>,    <a href="https://spapas.github.io/tag/react-notification.html">react-notification</a>,    <a href="https://spapas.github.io/tag/pelican.html">pelican</a>,    <a href="https://spapas.github.io/tag/tasks.html">tasks</a>,    <a href="https://spapas.github.io/tag/nodejs.html">node.js</a>,    <a href="https://spapas.github.io/tag/unix.html">unix</a>,    <a href="https://spapas.github.io/tag/google.html">google</a>,    <a href="https://spapas.github.io/tag/linux.html">linux</a>,    <a href="https://spapas.github.io/tag/pivot.html">pivot</a>,    <a href="https://spapas.github.io/tag/auditing.html">auditing</a>,    <a href="https://spapas.github.io/tag/git.html">git</a>,    <a href="https://spapas.github.io/tag/java.html">java</a>,    <a href="https://spapas.github.io/tag/introduction.html">introduction</a>,    <a href="https://spapas.github.io/tag/pusher.html">pusher</a>,    <a href="https://spapas.github.io/tag/fixed-data-tables.html">fixed-data-tables</a>,    <a href="https://spapas.github.io/tag/heroku.html">heroku</a>,    <a href="https://spapas.github.io/tag/xhtml2pdf.html">xhtml2pdf</a>,    <a href="https://spapas.github.io/tag/numpy.html">numpy</a>,    <a href="https://spapas.github.io/tag/form.html">form</a>,    <a href="https://spapas.github.io/tag/django-rest-auth.html">django-rest-auth</a>,    <a href="https://spapas.github.io/tag/wagtail.html">wagtail</a>,    <a href="https://spapas.github.io/tag/rst.html">rst</a>,    <a href="https://spapas.github.io/tag/python-2.html">python-2</a>,    <a href="https://spapas.github.io/tag/ffmpeg.html">ffmpeg</a>,    <a href="https://spapas.github.io/tag/middleware.html">middleware</a>,    <a href="https://spapas.github.io/tag/profiles.html">profiles</a>,    <a href="https://spapas.github.io/tag/spring-security.html">spring-security</a>,    <a href="https://spapas.github.io/tag/githubio.html">github.io</a>,    <a href="https://spapas.github.io/tag/error.html">error</a>,    <a href="https://spapas.github.io/tag/asynchronous.html">asynchronous</a>,    <a href="https://spapas.github.io/tag/react-router-redux.html">react-router-redux</a>,    <a href="https://spapas.github.io/tag/select2.html">select2</a>,    <a href="https://spapas.github.io/tag/history.html">history</a>,    <a href="https://spapas.github.io/tag/django-rest-framework.html">django-rest-framework</a>,    <a href="https://spapas.github.io/tag/redux-form.html">redux-form</a>,    <a href="https://spapas.github.io/tag/cbv.html">cbv</a>,    <a href="https://spapas.github.io/tag/scheduling.html">scheduling</a>,    <a href="https://spapas.github.io/tag/plpgsql.html">plpgsql</a>,    <a href="https://spapas.github.io/tag/boilerplate.html">boilerplate</a>,    <a href="https://spapas.github.io/tag/generic.html">generic</a>,    <a href="https://spapas.github.io/tag/babel.html">babel</a>,    <a href="https://spapas.github.io/tag/authentication.html">authentication</a>,    <a href="https://spapas.github.io/tag/html.html">html</a>,    <a href="https://spapas.github.io/tag/android.html">android</a>,    <a href="https://spapas.github.io/tag/pandas.html">pandas</a>,    <a href="https://spapas.github.io/tag/css.html">css</a>,    <a href="https://spapas.github.io/tag/node.html">node</a>,    <a href="https://spapas.github.io/tag/phoenix.html">phoenix</a>,    <a href="https://spapas.github.io/tag/deploy.html">deploy</a>,    <a href="https://spapas.github.io/tag/mongodb.html">mongodb</a>,    <a href="https://spapas.github.io/tag/react.html">react</a>,    <a href="https://spapas.github.io/tag/autocompelte.html">autocompelte</a>,    <a href="https://spapas.github.io/tag/declarative.html">declarative</a>,    <a href="https://spapas.github.io/tag/php.html">php</a>,    <a href="https://spapas.github.io/tag/browserify.html">browserify</a>,    <a href="https://spapas.github.io/tag/branching.html">branching</a>,    <a href="https://spapas.github.io/tag/github.html">github</a>,    <a href="https://spapas.github.io/tag/jupyter.html">jupyter</a>,    <a href="https://spapas.github.io/tag/windows.html">windows</a>,    <a href="https://spapas.github.io/tag/youtube.html">youtube</a>,    <a href="https://spapas.github.io/tag/django.html">django</a>,    <a href="https://spapas.github.io/tag/q.html">q</a>,    <a href="https://spapas.github.io/tag/react-router.html">react-router</a>,    <a href="https://spapas.github.io/tag/redux.html">redux</a>,    <a href="https://spapas.github.io/tag/boostrap-material-design.html">boostrap-material-design</a>  </section>

  <section>
    <h1>Yearly archives</h1>
    <a href="https://spapas.github.io/posts/2013/">2013</a>,    <a href="https://spapas.github.io/posts/2014/">2014</a>,    <a href="https://spapas.github.io/posts/2015/">2015</a>,    <a href="https://spapas.github.io/posts/2016/">2016</a>,    <a href="https://spapas.github.io/posts/2017/">2017</a>,    <a href="https://spapas.github.io/posts/2018/">2018</a>,    <a href="https://spapas.github.io/posts/2019/">2019</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/spapas">@spapas</a> on GitHub
    <script  src="//code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script type="text/javascript">
      $(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://spapas.github.io/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'spapas',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://spapas.github.io/theme/js/github.js" type="text/javascript"> </script>
  </section>


  <section>
    <a href="https://twitter.com/_serafeim_?ref_src=twsrc%5Etfw" class="twitter-follow-button"
      data-show-count="false">Follow @_serafeim_</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2013&ndash;2019 Serafeim Papastefanos &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="https://spapas.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="https://spapas.github.io/theme/js/ender.js"></script>
  <script src="https://spapas.github.io/theme/js/octopress.js" type="text/javascript"></script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44750952-1', 'auto');

    ga('send', 'pageview');
    </script>
  <script type="text/javascript">
    var disqus_shortname = 'spapas-github-io';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>

</html>